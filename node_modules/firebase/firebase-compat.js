<<<<<<< HEAD
((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()})(this,function(){let n=()=>{},i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},g=function(e,t){if(!e)throw j(t)},j=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},s=function(t){var r=[];let n=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?r[n++]=e:(e<2048?r[n++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),r[n++]=e>>18|240,r[n++]=e>>12&63|128):r[n++]=e>>12|224,r[n++]=e>>6&63|128),r[n++]=63&e|128)}return r},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let u=0;u<r.length;u+=3){var s=r[u],a=u+1<r.length,o=a?r[u+1]:0,l=u+2<r.length,h=l?r[u+2]:0;let e=(15&o)<<2|h>>6,t=63&h;l||(t=64,a)||(e=64),i.push(n[s>>2],n[(3&s)<<4|o>>4],n[e],n[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(r,n){if(this.HAS_NATIVE_SUPPORT&&!n)return atob(r);{var i=this.decodeStringToByteArray(r,n);var s=[];let e=0,t=0;for(;e<i.length;){var a,o,l,h=i[e++];h<128?s[t++]=String.fromCharCode(h):191<h&&h<224?(a=i[e++],s[t++]=String.fromCharCode((31&h)<<6|63&a)):239<h&&h<365?(a=((7&h)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,s[t++]=String.fromCharCode(55296+(a>>10)),s[t++]=String.fromCharCode(56320+(1023&a))):(o=i[e++],l=i[e++],s[t++]=String.fromCharCode((15&h)<<12|(63&o)<<6|63&l))}return s.join("");return}},decodeStringToByteArray(e,t){this.init_();var r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let l=0;l<e.length;){var i=r[e.charAt(l++)],s=l<e.length?r[e.charAt(l)]:0,a=++l<e.length?r[e.charAt(l)]:64,o=++l<e.length?r[e.charAt(l)]:64;if(++l,null==i||null==s||null==a||null==o)throw new B;n.push(i<<2|s>>4),64!==a&&(n.push(s<<4&240|a>>2),64!==o)&&n.push(a<<6&192|o)}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class B extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function o(e){var t=s(e);return a.encodeByteArray(t,!0)}let z=function(e){return o(e).replace(/\./g,"")},K=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function W(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=W(e[r],t[r]));return e}function H(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}let G=()=>H().__FIREBASE_DEFAULTS__,$=()=>{var e;return"undefined"!=typeof process&&void 0!==process.env&&(e=process.env.__FIREBASE_DEFAULTS__)?JSON.parse(e):void 0},Q=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&K(e[1]);return t&&JSON.parse(t)}},Y=()=>{try{return n()||G()||$()||Q()}catch(e){console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},J=()=>{var e;return null==(e=Y())?void 0:e.config};var c,X;class Z{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(r){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof r&&(this.promise.catch(()=>{}),1===r.length?r(e):r(e,t))}}}function ee(e){return e.endsWith(".cloudworkstations.dev")}async function te(e){return(await fetch(e,{credentials:"include"})).ok}function re(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(i)return r=Object.assign({iss:"https://securetoken.google.com/"+r,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[z(JSON.stringify({alg:"none",type:"JWT"})),z(JSON.stringify(r)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}let ne={};let ie=!1;function se(e,t){if("undefined"!=typeof window&&"undefined"!=typeof document&&ee(window.location.host)&&ne[e]!==t&&!ne[e]&&!ie){ne[e]=t;let h="__firebase__banner";let u=0<(()=>{var e,t={prod:[],emulator:[]};for(e of Object.keys(ne))(ne[e]?t.emulator:t.prod).push(e);return t})().prod.length;function c(e){return"__firebase__banner__"+e}function d(){var e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{var e;ie=!0,(e=document.getElementById(h))&&e.remove()},e}function r(){var e,t,r=(e=>{let t=document.getElementById(e),r=!1;return t||((t=document.createElement("div")).setAttribute("id",e),r=!0),{created:r,element:t}})(h),n=c("text"),i=document.getElementById(n)||document.createElement("span"),s=c("learnmore"),a=document.getElementById(s)||document.createElement("a"),o=c("preprendIcon"),l=document.getElementById(o)||document.createElementNS("http://www.w3.org/2000/svg","svg");r.created&&(r=r.element,(t=r).style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",(t=a).setAttribute("id",s),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline",s=d(),t=o,(e=l).setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px",r.append(l,i,a,s),document.body.appendChild(r)),u?(i.innerText="Preview backend disconnected.",l.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(l.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,i.innerText="Preview backend running in this workspace."),i.setAttribute("id",n)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r()}}function ae(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function oe(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ae())}function le(){var e=null==(e=Y())?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function he(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ue(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ce(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function de(){var e=ae();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function pe(){return!0===i.NODE_ADMIN}function fe(){return!le()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ge(){try{return"object"==typeof indexedDB}catch(e){return!1}}function me(){return new Promise((n,i)=>{try{let e=!0,t="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(t);r.onsuccess=()=>{r.result.close(),e||self.indexedDB.deleteDatabase(t),n(!0)},r.onupgradeneeded=()=>{e=!1},r.onerror=()=>{var e;i((null==(e=r.error)?void 0:e.message)||"")}}catch(e){i(e)}})}function ve(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class _e extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,_e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ye.prototype.create)}}class ye{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,r=t[0]||{},i=this.service+"/"+e,s=this.errors[e],s=s?(n=r,s.replace(we,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",s=this.serviceName+`: ${s} (${i}).`;return new _e(i,s,r)}}let we=/\{\$([^}]+)}/g;function be(e){return JSON.parse(e)}function Ie(e){return JSON.stringify(e)}function Te(e){let t={},r={},n={},i="";try{var s=e.split(".");t=be(K(s[0])||""),r=be(K(s[1])||""),i=s[2],n=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:n,signature:i}}function Ee(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ce(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Se(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ke(e,t,r){var n,i={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=t.call(r,e[n],n,e));return i}function Ae(e,t){if(e!==t){var r,n,i=Object.keys(e),s=Object.keys(t);for(r of i){if(!s.includes(r))return!1;var a=e[r],o=t[r];if(Ne(a)&&Ne(o)){if(!Ae(a,o))return!1}else if(a!==o)return!1}for(n of s)if(!i.includes(n))return!1}return!0}function Ne(e){return null!==e&&"object"==typeof e}function Re(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Pe(e){let n={};return e.replace(/^\?/,"").split("&").forEach(e=>{var t,r;e&&([t,r]=e.split("="),n[decodeURIComponent(t)]=decodeURIComponent(r))}),n}function De(e){var t,r=e.indexOf("?");return r?(t=e.indexOf("#",r),e.substring(r,0<t?t:void 0)):""}class xe{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(r,n){n=n||0;var i=this.W_;if("string"==typeof r)for(let e=0;e<16;e++)i[e]=r.charCodeAt(n)<<24|r.charCodeAt(n+1)<<16|r.charCodeAt(n+2)<<8|r.charCodeAt(n+3),n+=4;else for(let t=0;t<16;t++)i[t]=r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],n+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],l=this.chain_[4],h,u;for(let p=0;p<80;p++){u=p<40?p<20?(h=o^s&(a^o),1518500249):(h=s^a^o,1859775393):p<60?(h=s&a|o&(s|a),2400959708):(h=s^a^o,3395469782);var c=(t<<5|t>>>27)+h+l+u+i[p]&4294967295;l=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=c}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(r,n){if(null!=r){var i=(n=void 0===n?r.length:n)-this.blockSize;let e=0;var s=this.buf_;let t=this.inbuf_;for(;e<n;){if(0===t)for(;e<=i;)this.compress_(r,e),e+=this.blockSize;if("string"==typeof r){for(;e<n;)if(s[t]=r.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<n;)if(s[t]=r[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=n}}digest(){var t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[r]=this.chain_[i]>>e&255,++r;return t}}function Oe(e,t){var r=new Me(e,t);return r.subscribe.bind(r)}class Me{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");void 0===(n=((e,t)=>{if("object"==typeof e&&null!==e)for(var r of t)if(r in e&&"function"==typeof e[r])return 1})(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=Le),void 0===n.error&&(n.error=Le),void 0===n.complete&&(n.complete=Le);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount)&&void 0!==this.onNoObservers&&this.onNoObservers(this)}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Le(){}function l(e,t,r,n){let i;var s;if(n<t?i="at least "+t:r<n&&(i=0===r?"none":"no more than "+r),i)throw s=e+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+i+".",new Error(s)}function Fe(e,t){return e+` failed: ${t} argument `}function Ue(e,t,r,n){if((!n||r)&&"function"!=typeof r)throw new Error(Fe(e,t)+"must be a valid function.")}function Ve(e,t,r,n){if((!n||r)&&("object"!=typeof r||null===r))throw new Error(Fe(e,t)+"must be a valid context object.")}let qe=function(e){let t=0;for(let n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t},je=1e3,Be=2,ze=144e5,Ke=.5;function We(e,t=je,r=Be){var n=t*Math.pow(r,e),i=Math.round(Ke*n*(Math.random()-.5)*2);return Math.min(ze,n+i)}function w(e){return e&&e._delegate?e._delegate:e}class u{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let He="[DEFAULT]";class Ge{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var r=new Z;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(r=null==e?void 0:e.optional)&&r;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:He})}catch(e){}for(var[t,r]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var n=this.getOrInitializeService({instanceIdentifier:t});r.resolve(n)}catch(e){}}}}clearInstance(e=He){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){var e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=He){return this.instances.has(e)}getOptions(e=He){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(this.name+`(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var n,i,s=this.getOrInitializeService({instanceIdentifier:r,options:t});for([n,i]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(n)&&i.resolve(s);return s}onInit(e,t){var r=this.normalizeInstanceIdentifier(t);let n=null!=(i=this.onInitCallbacks.get(r))?i:new Set;n.add(e),this.onInitCallbacks.set(r,n);var i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){var r=this.onInitCallbacks.get(t);if(r)for(var n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===He?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=He){return!this.component||this.component.multipleInstances?e:He}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class $e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with `+this.name);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){var t;return this.providers.has(e)?this.providers.get(e):(t=new Ge(e,this),this.providers.set(e,t),t)}getProviders(){return Array.from(this.providers.values())}}let Qe=[],Ye=((t=c=c||{})[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",{debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT}),Je=c.INFO,Xe={[c.DEBUG]:"log",[c.VERBOSE]:"log",[c.INFO]:"info",[c.WARN]:"warn",[c.ERROR]:"error"},Ze=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=Xe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};class et{constructor(e){this.name=e,this._logLevel=Je,this._logHandler=Ze,this._userLogHandler=null,Qe.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in c))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Ye[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,c.DEBUG,...e),this._logHandler(this,c.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,c.VERBOSE,...e),this._logHandler(this,c.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,c.INFO,...e),this._logHandler(this,c.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,c.WARN,...e),this._logHandler(this,c.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,c.ERROR,...e),this._logHandler(this,c.ERROR,...e)}}let tt=(t,e)=>e.some(e=>t instanceof e),rt,nt;let it=new WeakMap,st=new WeakMap,at=new WeakMap,ot=new WeakMap,lt=new WeakMap;let ht={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return st.get(e);if("objectStoreNames"===t)return e.objectStoreNames||at.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return dt(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function ut(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(nt=nt||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(pt(this),e),dt(it.get(this))}:function(...e){return dt(n.apply(pt(this),e))}:function(e,...t){var r=n.call(pt(this),e,...t);return at.set(r,e.sort?e.sort():[e]),dt(r)}}function ct(e){var s,t;return"function"==typeof e?ut(e):(e instanceof IDBTransaction&&(s=e,st.has(s)||(t=new Promise((e,t)=>{let r=()=>{s.removeEventListener("complete",n),s.removeEventListener("error",i),s.removeEventListener("abort",i)},n=()=>{e(),r()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",n),s.addEventListener("error",i),s.addEventListener("abort",i)}),st.set(s,t))),tt(e,rt=rt||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,ht):e)}function dt(e){var s,t;return e instanceof IDBRequest?(s=e,(t=new Promise((e,t)=>{let r=()=>{s.removeEventListener("success",n),s.removeEventListener("error",i)},n=()=>{e(dt(s.result)),r()},i=()=>{t(s.error),r()};s.addEventListener("success",n),s.addEventListener("error",i)})).then(e=>{e instanceof IDBCursor&&it.set(e,s)}).catch(()=>{}),lt.set(t,s),t):ot.has(e)?ot.get(e):((t=ct(e))!==e&&(ot.set(e,t),lt.set(t,e)),t)}let pt=e=>lt.get(e);function ft(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t);var o=dt(a);return n&&a.addEventListener("upgradeneeded",e=>{n(dt(a.result),e.oldVersion,e.newVersion,dt(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}function gt(e,{blocked:t}={}){var r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",e=>t(e.oldVersion,e)),dt(r).then(()=>{})}let mt=["get","getKey","getAll","getAllKeys","count"],vt=["put","add","delete","clear"],_t=new Map;function yt(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(_t.get(t))return _t.get(t);let i=t.replace(/FromIndex$/,""),s=t!==i,a=vt.includes(i);var r;return i in(s?IDBIndex:IDBObjectStore).prototype&&(a||mt.includes(i))?(r=async function(e,...t){var r=this.transaction(e,a?"readwrite":"readonly");let n=r.store;return s&&(n=n.index(t.shift())),(await Promise.all([n[i](...t),a&&r.done]))[0]},_t.set(t,r),r):void 0}}ht={...X=ht,get:(e,t,r)=>yt(e,t)||X.get(e,t,r),has:(e,t)=>!!yt(e,t)||X.has(e,t)};class wt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{var t;return"VERSION"===(null==(t=e.getComponent())?void 0:t.type)?(t=e.getImmediate()).library+"/"+t.version:null}).filter(e=>e).join(" ")}}let bt="@firebase/app",It="0.12.3",Tt=new et("@firebase/app");let Et="[DEFAULT]",Ct={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},St=new Map,kt=new Map,At=new Map;function Nt(t,r){try{t.container.addComponent(r)}catch(e){Tt.debug(`Component ${r.name} failed to register with FirebaseApp `+t.name,e)}}function Rt(e,t){e.container.addOrOverwriteComponent(t)}function Pt(e){var t,r,n=e.name;if(At.has(n))return Tt.debug(`There were multiple attempts to register component ${n}.`),!1;At.set(n,e);for(t of St.values())Nt(t,e);for(r of kt.values())Nt(r,e);return!0}function Dt(e,t){var r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function xt(e){return void 0!==e.options}function h(e){return null!=e&&void 0!==e.settings}let Ot=new ye("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Mt{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new u("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ot.create("app-deleted",{appName:this._name})}}function Lt(e,t){var r=K(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-(new Date).getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class Ft extends Mt{constructor(e,t,r,n){var i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&Lt(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&Lt(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,d(bt,It,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){jt(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Ot.create("server-app-deleted")}}let Ut="11.7.3";function Vt(e,t={}){let r=e;if("object"!=typeof t){let e=t;t={name:e}}var n=Object.assign({name:Et,automaticDataCollectionEnabled:!1},t);let i=n.name;if("string"!=typeof i||!i)throw Ot.create("bad-app-name",{appName:String(i)});if(!(r=r||J()))throw Ot.create("no-options");var s=St.get(i);if(s){if(Ae(r,s.options)&&Ae(n,s.config))return s;throw Ot.create("duplicate-app",{appName:i})}var a,o=new $e(i);for(a of At.values())o.addComponent(a);s=new Mt(r,n,o);return St.set(i,s),s}function qt(e=Et){var t=St.get(e);if(!t&&e===Et&&J())return Vt();if(t)return t;throw Ot.create("no-app",{appName:e})}async function jt(e){let t=!1;var r=e.name;St.has(r)?(t=!0,St.delete(r)):kt.has(r)&&e.decRefCount()<=0&&(kt.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function d(e,t,r){let n,i=null!=(n=Ct[e])?n:e;r&&(i+="-"+r);var s,a=i.match(/\s|\//),o=t.match(/\s|\//);a||o?(s=[`Unable to register library "${i}" with version "${t}":`],a&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tt.warn(s.join(" "))):Pt(new u(i+"-version",()=>({library:i,version:t}),"VERSION"))}function Bt(e,t){if(null!==e&&"function"!=typeof e)throw Ot.create("invalid-log-argument");var r,s=e,n=t;for(r of Qe){let i=null;n&&n.level&&(i=Ye[n.level]),r.userLogHandler=null===s?null:(e,t,...r)=>{var n=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!=i?i:e.logLevel)&&s({level:c[t].toLowerCase(),message:n,args:r,type:e.name})}}}function zt(e){var t;t=e,Qe.forEach(e=>{e.setLogLevel(t)})}let Kt="firebase-heartbeat-database",Wt=1,Ht="firebase-heartbeat-store",Gt=null;function $t(){return Gt=Gt||ft(Kt,Wt,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ht)}catch(e){console.warn(e)}}}).catch(e=>{throw Ot.create("idb-open",{originalErrorMessage:e.message})})}async function Qt(e,t){try{var r=(await $t()).transaction(Ht,"readwrite");await r.objectStore(Ht).put(t,Yt(e)),await r.done}catch(e){e instanceof _e?Tt.warn(e.message):(r=Ot.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),Tt.warn(r.message))}}function Yt(e){return e.name+"!"+e.options.appId}class Jt{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new Zt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){var e,r;try{var n,i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString();let t=Xt();if(null!=(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null==(r=this._heartbeatsCache)?void 0:r.heartbeats)))if(this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some(e=>e.date===t))return this._heartbeatsCache.heartbeats.push({date:t,agent:i}),30<this._heartbeatsCache.heartbeats.length&&(n=(e=>{if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t})(this._heartbeatsCache.heartbeats),this._heartbeatsCache.heartbeats.splice(n,1)),this._storage.overwrite(this._heartbeatsCache)}catch(e){Tt.warn(e)}}async getHeartbeatsHeader(){var e,t,r,n,i;try{return(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)?"":(t=Xt(),{heartbeatsToSend:r,unsentEntries:n}=((e,t=1024)=>{let r=[],n=e.slice();for(let s of e){var i=r.find(e=>e.agent===s.agent);if(i){if(i.dates.push(s.date),er(r)>t){i.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),er(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}})(this._heartbeatsCache.heartbeats),i=z(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i)}catch(e){return Tt.warn(e),""}}}function Xt(){return(new Date).toISOString().substring(0,10)}class Zt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ge()&&me().then(()=>!0).catch(()=>!1)}async read(){var e;return await this._canUseIndexedDBPromise&&null!=(e=await(async e=>{try{var t=(await $t()).transaction(Ht),r=await t.objectStore(Ht).get(Yt(e));return await t.done,r}catch(e){e instanceof _e?Tt.warn(e.message):(t=Ot.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),Tt.warn(t.message))}})(this.app))&&e.heartbeats?e:{heartbeats:[]}}async overwrite(e){var t,r;if(await this._canUseIndexedDBPromise)return r=await this.read(),Qt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}async add(e){var t,r;if(await this._canUseIndexedDBPromise)return r=await this.read(),Qt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}function er(e){return z(JSON.stringify({version:2,heartbeats:e})).length}t="",Pt(new u("platform-logger",e=>new wt(e),"PRIVATE")),Pt(new u("heartbeat",e=>new Jt(e),"PRIVATE")),d(bt,It,t),d(bt,It,"esm2017"),d("fire-js","");var tr=Object.freeze({__proto__:null,SDK_VERSION:Ut,_DEFAULT_ENTRY_NAME:Et,_addComponent:Nt,_addOrOverwriteComponent:Rt,_apps:St,_clearComponents:function(){At.clear()},_components:At,_getProvider:Dt,_isFirebaseApp:xt,_isFirebaseServerApp:h,_registerComponent:Pt,_removeServiceInstance:function(e,t,r=Et){Dt(e,t).clearInstance(r)},_serverApps:kt,deleteApp:jt,getApp:qt,getApps:function(){return Array.from(St.values())},initializeApp:Vt,initializeServerApp:function(e,t){if(("undefined"!=typeof window||he())&&!he())throw Ot.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1);let r;r=xt(e)?e.options:e;var n=Object.assign(Object.assign({},t),r);if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw Ot.create("finalization-registry-not-supported",{});var n=""+[...JSON.stringify(n)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),i=kt.get(n);if(i)i.incRefCount(t.releaseOnDeref);else{var s,a=new $e(n);for(s of At.values())a.addComponent(s);i=new Ft(r,t,n,a),kt.set(n,i)}return i},onLog:Bt,registerVersion:d,setLogLevel:zt,FirebaseError:_e});class rr{constructor(e,t){this._delegate=e,this.firebase=t,Nt(e,new u("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),jt(this._delegate)))}_getService(e,t=Et){this._delegate.checkDestroyed();var r,n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null==(r=n.getComponent())?void 0:r.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=Et){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Nt(this._delegate,e)}_addOrOverwriteComponent(e){Rt(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}let nr=new ye("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function ir(i){let s={},a={__esModule:!0,initializeApp:function(e,t={}){var r=Vt(e,t);if(Ee(s,r.name))return s[r.name];var n=new i(r,a);return s[r.name]=n},app:o,registerVersion:d,setLogLevel:zt,onLog:Bt,apps:null,SDK_VERSION:Ut,INTERNAL:{registerComponent:function(t){let r=t.name,n=r.replace("-compat","");{var e;Pt(t)&&"PUBLIC"===t.type&&(e=(e=o())=>{if("function"!=typeof e[n])throw nr.create("invalid-app-argument",{appName:r});return e[n]()},void 0!==t.serviceProps&&W(e,t.serviceProps),a[n]=e,i.prototype[n]=function(...e){return this._getService.bind(this,r).apply(this,t.multipleInstances?e:[])})}return"PUBLIC"===t.type?a[n]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var r=t;return r},modularAPIs:tr}};function o(e){if(e=e||Et,Ee(s,e))return s[e];throw nr.create("no-app",{appName:e})}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var sr=function e(){let t=ir(rr);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){W(t,e)},createSubscribe:Oe,ErrorFactory:ye,deepExtend:W}),t}(),e=new et("@firebase/app-compat");try{var ar=H();void 0!==ar.firebase&&(e.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `),lr=ar.firebase.SDK_VERSION)&&0<=lr.indexOf("LITE")&&e.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}catch(e){}let or=sr;d("@firebase/app-compat","0.3.3",void 0);or.registerVersion("firebase","11.7.3","app-compat");var ar="@firebase/installations",lr="0.6.16";let hr=1e4,ur="w:"+lr,cr="FIS_v2",dr="https://firebaseinstallations.googleapis.com/v1",pr=36e5;let fr=new ye("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function gr(e){return e instanceof _e&&e.code.includes("request-failed")}function mr({projectId:e}){return dr+`/projects/${e}/installations`}function vr(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function _r(e,t){var r=(await t.json()).error;return fr.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function yr({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function wr(e,{refreshToken:t}){var r=yr(e);return r.append("Authorization",(e=t,cr+" "+e)),r}async function br(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Ir(t){return new Promise(e=>{setTimeout(e,t)})}let Tr=/^[cdef][\w-]{21}$/,Er="";function Cr(){try{var e=new Uint8Array(17),t=((self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16,(e=>btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_"))(e).substr(0,22));return Tr.test(t)?t:Er}catch(e){return Er}}function Sr(e){return e.appName+"!"+e.appId}let kr=new Map;function Ar(e,t){var r=Sr(e),e=(Nr(r,t),r),r=(()=>(!Rr&&"BroadcastChannel"in self&&((Rr=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{Nr(e.data.key,e.data.fid)}),Rr))();r&&r.postMessage({key:e,fid:t}),0===kr.size&&Rr&&(Rr.close(),Rr=null)}function Nr(e,t){var r=kr.get(e);if(r)for(var n of r)n(t)}let Rr=null;let Pr="firebase-installations-database",Dr=1,xr="firebase-installations-store",Or=null;function Mr(){return Or=Or||ft(Pr,Dr,{upgrade:(e,t)=>{0===t&&e.createObjectStore(xr)}})}async function Lr(e,t){var r=Sr(e),n=(await Mr()).transaction(xr,"readwrite"),i=n.objectStore(xr),s=await i.get(r);return await i.put(t,r),await n.done,s&&s.fid===t.fid||Ar(e,t.fid),t}async function Fr(e){var t=Sr(e),r=(await Mr()).transaction(xr,"readwrite");await r.objectStore(xr).delete(t),await r.done}async function Ur(e,t){var r=Sr(e),n=(await Mr()).transaction(xr,"readwrite"),i=n.objectStore(xr),s=await i.get(r),a=t(s);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,!a||s&&s.fid===a.fid||Ar(e,a.fid),a}async function Vr(r){let n;var e=await Ur(r.appConfig,e=>{var t=jr(e||{fid:Cr(),registrationStatus:0}),t=((e,t)=>{var r,n;return 0===t.registrationStatus?navigator.onLine?(r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=(async(t,r)=>{try{var e=await(async({appConfig:e,heartbeatServiceProvider:t},{fid:r})=>{let n=mr(e);var i=yr(e),s=((s=t.getImmediate({optional:!0}))&&(s=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",s),{fid:r,authVersion:cr,appId:e.appId,sdkVersion:ur});let a={method:"POST",headers:i,body:JSON.stringify(s)};if((i=await br(()=>fetch(n,a))).ok)return{fid:(s=await i.json()).fid||r,registrationStatus:2,refreshToken:s.refreshToken,authToken:vr(s.authToken)};throw await _r("Create Installation",i)})(t,r);return Lr(t.appConfig,e)}catch(e){throw gr(e)&&409===e.customData.serverCode?await Fr(t.appConfig):await Lr(t.appConfig,{fid:r.fid,registrationStatus:0}),e}})(e,r),{installationEntry:r,registrationPromise:n}):(r=Promise.reject(fr.create("app-offline")),{installationEntry:t,registrationPromise:r}):1===t.registrationStatus?{installationEntry:t,registrationPromise:(async e=>{let t=await qr(e.appConfig);for(;1===t.registrationStatus;)await Ir(100),t=await qr(e.appConfig);var r,n;return 0!==t.registrationStatus?t:({installationEntry:r,registrationPromise:n}=await Vr(e),n||r)})(e)}:{installationEntry:t}})(r,t);return n=t.registrationPromise,t.installationEntry});return e.fid===Er?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function qr(e){return Ur(e,e=>{if(e)return jr(e);throw fr.create("installation-not-found")})}function jr(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+hr<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function Br({appConfig:e,heartbeatServiceProvider:t},r){[i,s]=[e,r.fid];let n=mr(i)+`/${s}/authTokens:generate`;var i,s,a=wr(e,r),o=t.getImmediate({optional:!0}),o=(o&&(o=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",o),{installation:{sdkVersion:ur,appId:e.appId}});let l={method:"POST",headers:a,body:JSON.stringify(o)};a=await br(()=>fetch(n,l));if(a.ok)return vr(await a.json());throw await _r("Generate Auth Token",a)}async function zr(n,i=!1){let s;var e=await Ur(n.appConfig,e=>{if(!Wr(e))throw fr.create("not-registered");var t,r=e.authToken;if(i||2!==(t=r).requestStatus||(e=>{var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+pr})(t)){if(1===r.requestStatus)return s=(async(e,t)=>{let r=await Kr(e.appConfig);for(;1===r.authToken.requestStatus;)await Ir(100),r=await Kr(e.appConfig);var n=r.authToken;return 0===n.requestStatus?zr(e,t):n})(n,i),e;if(navigator.onLine)return t=e,r={requestStatus:1,requestTime:Date.now()},r=Object.assign(Object.assign({},t),{authToken:r}),s=(async(t,r)=>{try{var e=await Br(t,r),n=Object.assign(Object.assign({},r),{authToken:e});return await Lr(t.appConfig,n),e}catch(e){var i;throw!gr(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(i=Object.assign(Object.assign({},r),{authToken:{requestStatus:0}}),await Lr(t.appConfig,i)):await Fr(t.appConfig),e}})(n,r),r;throw fr.create("app-offline")}return e});return s?await s:e.authToken}function Kr(e){return Ur(e,e=>{var t,r;if(Wr(e))return t=e.authToken,1===(r=t).requestStatus&&r.requestTime+hr<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;throw fr.create("not-registered")})}function Wr(e){return void 0!==e&&2===e.registrationStatus}async function Hr(e,t=!1){var r=e,n=(await(!(n=(await Vr(r)).registrationPromise)||!await n),await zr(r,t));return n.token}function Gr(e){return fr.create("missing-app-config-values",{valueName:e})}let $r="installations",Qr=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:(e=>{if(!e||!e.options)throw Gr("App Configuration");if(!e.name)throw Gr("App Name");var t;for(t of["projectId","apiKey","appId"])if(!e.options[t])throw Gr(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}})(t),heartbeatServiceProvider:Dt(t,"heartbeat"),_delete:()=>Promise.resolve()}},Yr=e=>{let t=Dt(e.getProvider("app").getImmediate(),$r).getImmediate();return{getId:()=>(async e=>{var t=e,{installationEntry:r,registrationPromise:n}=await Vr(t);return(n||zr(t)).catch(console.error),r.fid})(t),getToken:e=>Hr(t,e)}};Pt(new u($r,Qr,"PUBLIC")),Pt(new u("installations-internal",Yr,"PRIVATE")),d(ar,lr),d(ar,lr,"esm2017");let Jr="analytics",Xr="firebase_id",Zr="origin",en=6e4,tn="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",rn="https://www.googletagmanager.com/gtag/js",nn=new et("@firebase/analytics"),sn=new ye("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function an(e){var t;return e.startsWith(rn)?e:(t=sn.create("invalid-gtag-resource",{gtagURL:e}),nn.warn(t.message),"")}function on(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function ln(e,t){var r=((e,t)=>{let r;return r=window.trustedTypes?window.trustedTypes.createPolicy(e,t):r})("firebase-js-sdk-policy",{createScriptURL:an}),n=document.createElement("script"),i=rn+`?l=${e}&id=`+t;n.src=r?null==r?void 0:r.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function hn(k,A,N,R){return async function(e,...t){try{if("event"===e){var[r,n]=t,i=k,s=A,a=N,o=r,l=n;try{let r=[];if(l&&l.send_to){let e=l.send_to;Array.isArray(e)||(e=[e]);var h=await on(a);for(let t of e){var u=h.find(e=>e.measurementId===t),c=u&&s[u.appId];if(!c){r=[];break}r.push(c)}}0===r.length&&(r=Object.values(s)),await Promise.all(r),i("event",o,l||{})}catch(e){nn.error(e)}}else if("config"===e){var d,[p,f]=t,g=k,m=A,v=N,_=p,y=f,w=R[_];try{w?await m[w]:(d=(await on(v)).find(e=>e.measurementId===_))&&await m[d.appId]}catch(e){nn.error(e)}g("config",_,y)}else{var b,I,T,E,C,S;"consent"===e?([b,I]=t,k("consent",b,I)):"get"===e?([T,E,C]=t,k("get",T,E,C)):"set"===e?([S]=t,k("set",S)):k(e,...t)}}catch(e){nn.error(e)}}}let un=30;let cn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function dn(e){var t,{appId:r,apiKey:n}=e,n={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":n})},r=tn.replace("{app-id}",r),r=await fetch(r,n);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!=(t=i.error)&&t.message&&(e=i.error.message)}catch(e){}throw sn.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}async function pn(e,t=cn,r){var{appId:n,apiKey:i,measurementId:s}=e.options;if(!n)throw sn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:n};throw sn.create("no-api-key")}var a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()};let o=new mn;return setTimeout(async()=>{o.abort()},void 0!==r?r:en),async function i(s,{throttleEndTimeMillis:e,backoffCount:a},o,l=cn){var h;let{appId:u,measurementId:c}=s;try{await fn(o,e)}catch(e){if(c)return nn.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:u,measurementId:c};throw e}try{let e=await dn(s);return l.deleteThrottleMetadata(u),e}catch(e){let t=e;if(!gn(t)){if(l.deleteThrottleMetadata(u),c)return nn.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:u,measurementId:c};throw e}let r=503===Number(null==(h=null==t?void 0:t.customData)?void 0:h.httpStatus)?We(a,l.intervalMillis,un):We(a,l.intervalMillis),n={throttleEndTimeMillis:Date.now()+r,backoffCount:a+1};return l.setThrottleMetadata(u,n),nn.debug(`Calling attemptFetch again in ${r} millis`),i(s,n,o,l)}}({appId:n,apiKey:i,measurementId:s},a,o,t)}function fn(i,s){return new Promise((e,t)=>{var r=Math.max(s-Date.now(),0);let n=setTimeout(e,r);i.addEventListener(()=>{clearTimeout(n),t(sn.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function gn(e){var t;return!!(e instanceof _e&&e.customData)&&(429===(t=Number(e.customData.httpStatus))||500===t||503===t||504===t)}class mn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function vn(t,e,r,n,i,s,a){var o=pn(t),l=(o.then(e=>{r[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&nn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>nn.error(e)),e.push(o),(async()=>{if(!ge())return nn.warn(sn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await me()}catch(e){return nn.warn(sn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0})().then(e=>{if(e)return n.getId()})),[o,l]=await Promise.all([o,l]),h=((e=>{var t,r=window.document.getElementsByTagName("script");for(t of Object.values(r))if(t.src&&t.src.includes(rn)&&t.src.includes(e))return t})(s)||ln(s,o.measurementId),i("js",new Date),null!=(h=null==a?void 0:a.config)?h:{});return h[Zr]="firebase",h.update=!0,null!=l&&(h[Xr]=l),i("config",o.measurementId,h),o.measurementId}class _n{constructor(e){this.app=e}_delete(){return delete yn[this.app.options.appId],Promise.resolve()}}let yn={},wn=[],bn={},In="dataLayer",Tn="gtag",En,Cn,Sn=!1;function kn(e){if(Sn)throw sn.create("already-initialized");e.dataLayerName&&(In=e.dataLayerName),e.gtagName&&(Tn=e.gtagName)}function An(e,t,r){n=[],ue()&&n.push("This is a browser extension environment."),ve()||n.push("Cookies are not available."),0<n.length&&(n=n.map((e,t)=>`(${t+1}) `+e).join(" "),n=sn.create("invalid-analytics-context",{errorInfo:n}),nn.warn(n.message));var n=e.options.appId;if(!n)throw sn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw sn.create("no-api-key");nn.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=yn[n])throw sn.create("already-exists",{id:n});if(!Sn){{var i=In;let e=[];Array.isArray(window[i])?e=window[i]:window[i]=e,e}var{wrappedGtag:s,gtagCore:a}=((e,t,r,n,i)=>{let s=function(){window[n].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=hn(s,e,t,r),{gtagCore:s,wrappedGtag:window[i]}})(yn,wn,bn,In,Tn);Cn=s,En=a,Sn=!0}return yn[n]=vn(e,wn,bn,t,En,In,r),new _n(e)}async function Nn(){if(ue())return!1;if(!ve())return!1;if(!ge())return!1;try{return await me()}catch(e){return!1}}function Rn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global)return e("set",{screen_name:r}),Promise.resolve();e("config",await t,{update:!0,screen_name:r})})(Cn,yn[e.app.options.appId],t,r).catch(e=>nn.error(e))}function Pn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global)return e("set",{user_id:r}),Promise.resolve();e("config",await t,{update:!0,user_id:r})})(Cn,yn[e.app.options.appId],t,r).catch(e=>nn.error(e))}function Dn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global){var i,s={};for(i of Object.keys(r))s["user_properties."+i]=r[i];return e("set",s),Promise.resolve()}e("config",await t,{update:!0,user_properties:r})})(Cn,yn[e.app.options.appId],t,r).catch(e=>nn.error(e))}function xn(e,t){e=w(e),(async(e,t)=>{var r=await e;window["ga-disable-"+r]=!t})(yn[e.app.options.appId],t).catch(e=>nn.error(e))}function On(e,t,r,n){e=w(e),(async(e,t,r,n,i)=>{var s;i&&i.global?e("event",r,n):(s=await t,e("event",r,Object.assign(Object.assign({},n),{send_to:s})))})(Cn,yn[e.app.options.appId],t,r,n).catch(e=>nn.error(e))}let Mn="@firebase/analytics",Ln="0.10.15";Pt(new u(Jr,(e,{options:t})=>An(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),Pt(new u("analytics-internal",function(e){try{let n=e.getProvider(Jr).getImmediate();return{logEvent:(e,t,r)=>On(n,e,t,r)}}catch(e){throw sn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),d(Mn,Ln),d(Mn,Ln,"esm2017");class Fn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,r){On(this._delegate,e,t,r)}setCurrentScreen(e,t){Rn(this._delegate,e,t)}setUserId(e,t){Pn(this._delegate,e,t)}setUserProperties(e,t){Dn(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){xn(this._delegate,e)}}(t=Sm=Sm||{}).ADD_SHIPPING_INFO="add_shipping_info",t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SELECT_ITEM="select_item",t.SELECT_PROMOTION="select_promotion",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_CART="view_cart",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results";let Un=e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("analytics").getImmediate();return new Fn(t,r)};e={Analytics:Fn,settings:kn,isSupported:Nn,EventName:Sm},or.INTERNAL.registerComponent(new u("analytics-compat",Un,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),or.registerVersion("@firebase/analytics-compat","0.2.21");let Vn=new Map,qn={activated:!1,tokenObservers:[]},jn={initialized:!1,enabled:!1};function Bn(e){return Vn.get(e)||Object.assign({},qn)}let zn="https://content-firebaseappcheck.googleapis.com/v1",Kn="exchangeDebugToken",Wn={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Hn{constructor(e,t,r,n,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=n,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=n))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Z,this.pending.promise.catch(e=>{}),t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new Z,this.pending.promise.catch(e=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){var t;return e?(this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration()):(t=this.nextErrorWaitInterval,this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t)}}let Gn=new ye("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"});function $n(e=!1){var t;return e?null==(t=self.grecaptcha)?void 0:t.enterprise:self.grecaptcha}function Qn(e){if(!Bn(e).activated)throw Gn.create("use-before-activation",{appName:e.name})}function Yn(e){var t=Math.round(e/1e3),r=Math.floor(t/86400),n=Math.floor((t-3600*r*24)/3600),i=Math.floor((t-3600*r*24-3600*n)/60),t=t-3600*r*24-3600*n-60*i;let s="";return r&&(s+=Jn(r)+"d:"),n&&(s+=Jn(n)+"h:"),s+=Jn(i)+"m:"+Jn(t)+"s"}function Jn(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function Xn({url:e,body:t},r){var n={"Content-Type":"application/json"},i=r.getImmediate({optional:!0}),i=(i&&(i=await i.getHeartbeatsHeader())&&(n["X-Firebase-Client"]=i),{method:"POST",body:JSON.stringify(t),headers:n});let s;try{s=await fetch(e,i)}catch(e){throw Gn.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==s.status)throw Gn.create("fetch-status-error",{httpStatus:s.status});let a;try{a=await s.json()}catch(e){throw Gn.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var n=a.ttl.match(/^([\d.]+)(s)$/);if(n&&n[2]&&!isNaN(Number(n[1])))return i=1e3*Number(n[1]),n=Date.now(),{token:a.token,expireTimeMillis:n+i,issuedAtTimeMillis:n};throw Gn.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+a.ttl})}function Zn(e,t){var{projectId:r,appId:n,apiKey:i}=e.options;return{url:`${zn}/projects/${r}/apps/${n}:${Kn}?key=`+i,body:{debug_token:t}}}let ei="firebase-app-check-database",ti=1,ri="firebase-app-check-store",ni="debug-token",ii=null;function si(){return ii=ii||new Promise((t,r)=>{try{var e=indexedDB.open(ei,ti);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;r(Gn.create("storage-open",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))},e.onupgradeneeded=e=>{var t=e.target.result;0===e.oldVersion&&t.createObjectStore(ri,{keyPath:"compositeKey"})}}catch(e){r(Gn.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}async function ai(e,t){let n=(await si()).transaction(ri,"readwrite"),i=n.objectStore(ri).put({compositeKey:e,value:t});return new Promise((t,r)=>{i.onsuccess=e=>{t()},n.onerror=e=>{var t;r(Gn.create("storage-set",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))}})}async function oi(e){let t=(await si()).transaction(ri,"readonly"),i=t.objectStore(ri).get(e);return new Promise((r,n)=>{i.onsuccess=e=>{var t=e.target.result;r(t?t.value:void 0)},t.onerror=e=>{var t;n(Gn.create("storage-get",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))}})}function li(e){return e.options.appId+"-"+e.name}let hi=new et("@firebase/app-check");async function ui(t){if(ge()){let e=void 0;try{e=await oi(li(t))}catch(e){hi.warn("Failed to read token from IndexedDB. Error: "+e)}return e}}function ci(e,t){return ge()?ai(li(e),t).catch(e=>{hi.warn("Failed to write token to IndexedDB. Error: "+e)}):Promise.resolve()}async function di(){let e=void 0;try{e=await oi(ni)}catch(e){}var t,r;return e||(t=crypto.randomUUID(),r=t,ai(ni,r).catch(e=>hi.warn("Failed to persist debug token to IndexedDB. Error: "+e)),t)}function pi(){return jn.enabled}async function fi(){var e=jn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}let gi={error:"UNKNOWN_ERROR"};async function mi(e,t=!1,r=!1){var n,i=e.app;Qn(i);let s=Bn(i),a=s.token,o=void 0;if(a&&!bi(a)&&(s.token=void 0,a=void 0),a||(n=await s.cachedTokenPromise)&&(bi(n)?a=n:await ci(i,void 0)),!t&&a&&bi(a))return{token:a.token};let l=!1;if(pi())try{s.exchangeTokenPromise||(s.exchangeTokenPromise=Xn(Zn(i,await fi()),e.heartbeatServiceProvider).finally(()=>{s.exchangeTokenPromise=void 0}),l=!0);var h=await s.exchangeTokenPromise;return await ci(i,h),{token:(s.token=h).token}}catch(e){return"appCheck/throttled"===e.code||"appCheck/initial-throttle"===e.code?hi.warn(e.message):r&&hi.error(e),Ii(e)}try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),l=!0),a=await Bn(i).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code||"appCheck/initial-throttle"===e.code?hi.warn(e.message):r&&hi.error(e),o=e}let u;return a?o?u=bi(a)?{token:a.token,internalError:o}:Ii(o):(u={token:a.token},await ci(i,s.token=a)):u=Ii(o),l&&wi(i,u),u}function vi(t,e,r,n){var i=t.app,i=Bn(i),s={next:r,error:n,type:e};if(i.tokenObservers=[...i.tokenObservers,s],i.token&&bi(i.token)){let e=i.token;Promise.resolve().then(()=>{r({token:e.token}),yi(t)}).catch(()=>{})}i.cachedTokenPromise.then(()=>yi(t))}function _i(e,t){var r=Bn(e),n=r.tokenObservers.filter(e=>e.next!==t);0===n.length&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=n}function yi(e){var t=e.app,t=Bn(t);let r=t.tokenRefresher;r||(r=(r=>{let n=r.app;return new Hn(async()=>{var e=Bn(n);let t;if((t=e.token?await mi(r,!0):await mi(r)).error)throw t.error;if(t.internalError)throw t.internalError},()=>!0,()=>{var e,t=Bn(n);return t.token?(e=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,t=t.token.expireTimeMillis-3e5,e=Math.min(e,t),Math.max(0,e-Date.now())):0},Wn.RETRIAL_MIN_WAIT,Wn.RETRIAL_MAX_WAIT)})(e),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function wi(e,t){var r;for(r of Bn(e).tokenObservers)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch(e){}}function bi(e){return 0<e.expireTimeMillis-Date.now()}function Ii(e){return{token:(t=gi,a.encodeString(JSON.stringify(t),!1)),error:e};var t}class Ti{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e,t=Bn(this.app).tokenObservers;for(e of t)_i(this.app,e.next);return Promise.resolve()}}function Ei(t){return{getToken:e=>mi(t,e),getLimitedUseToken:()=>(async e=>{var t=e.app,r=(Qn(t),Bn(t)).provider;return pi()?{token:t=(await Xn(Zn(t,await fi()),e.heartbeatServiceProvider)).token}:{token:t=(await r.getToken()).token}})(t),addTokenListener:e=>vi(t,"INTERNAL",e),removeTokenListener:e=>_i(t.app,e)}}let Ci="https://www.google.com/recaptcha/api.js",Si="https://www.google.com/recaptcha/enterprise.js";function ki(t,r){let n=new Z;Bn(t).reCAPTCHAState={initialized:n};let i=Ri(t);var e,s=$n(!1);return s?Ni(t,r,s,i,n):(e=()=>{var e=$n(!1);if(!e)throw new Error("no recaptcha");Ni(t,r,e,i,n)},(s=document.createElement("script")).src=Ci,s.onload=e,document.head.appendChild(s)),n.promise}function Ai(t,r){let n=new Z;Bn(t).reCAPTCHAState={initialized:n};let i=Ri(t);var e,s=$n(!0);return s?Ni(t,r,s,i,n):(e=()=>{var e=$n(!0);if(!e)throw new Error("no recaptcha");Ni(t,r,e,i,n)},(s=document.createElement("script")).src=Si,s.onload=e,document.head.appendChild(s)),n.promise}function Ni(n,i,s,a,o){s.ready(()=>{var e,t,r;e=n,t=s.render(a,{sitekey:i,size:"invisible",callback:()=>{Bn(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{Bn(e).reCAPTCHAState.succeeded=!1}}),(r=Bn(e)).reCAPTCHAState=Object.assign(Object.assign({},r.reCAPTCHAState),{widgetId:t}),o.resolve(s)})}function Ri(e){var t="fire_app_check_"+e.name,r=document.createElement("div");return r.id=t,r.style.display="none",document.body.appendChild(r),t}async function Pi(n){Qn(n);let i=await Bn(n).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{let r=Bn(n).reCAPTCHAState;i.ready(()=>{e(i.execute(r.widgetId,{action:"fire_app_check"}))})})}class Di{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Li(this._throttleData);var t,r=await Pi(this._app).catch(e=>{throw Gn.create("recaptcha-error")});if(null==(t=Bn(this._app).reCAPTCHAState)||!t.succeeded)throw Gn.create("recaptcha-error");let e;try{e=await Xn(((e,t)=>{var{projectId:r,appId:n,apiKey:i}=e.options;return{url:zn+`/projects/${r}/apps/${n}:exchangeRecaptchaV3Token?key=`+i,body:{recaptcha_v3_token:t}}})(this._app,r),this._heartbeatServiceProvider)}catch(e){throw null!=(t=e.code)&&t.includes("fetch-status-error")?(this._throttleData=Mi(Number(null==(r=e.customData)?void 0:r.httpStatus),this._throttleData),Gn.create("initial-throttle",{time:Yn(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Dt(e,"heartbeat"),ki(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Di&&this._siteKey===e._siteKey}}class xi{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Li(this._throttleData);var t,r=await Pi(this._app).catch(e=>{throw Gn.create("recaptcha-error")});if(null==(t=Bn(this._app).reCAPTCHAState)||!t.succeeded)throw Gn.create("recaptcha-error");let e;try{e=await Xn(((e,t)=>{var{projectId:r,appId:n,apiKey:i}=e.options;return{url:zn+`/projects/${r}/apps/${n}:exchangeRecaptchaEnterpriseToken?key=`+i,body:{recaptcha_enterprise_token:t}}})(this._app,r),this._heartbeatServiceProvider)}catch(e){throw null!=(t=e.code)&&t.includes("fetch-status-error")?(this._throttleData=Mi(Number(null==(r=e.customData)?void 0:r.httpStatus),this._throttleData),Gn.create("initial-throttle",{time:Yn(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Dt(e,"heartbeat"),Ai(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof xi&&this._siteKey===e._siteKey}}class Oi{constructor(e){this._customProviderOptions=e}async getToken(){var e,t=await this._customProviderOptions.getToken(),r=(e=t.token,"object"==typeof(r=Te(e).claims)&&r.hasOwnProperty("iat")?r.iat:null),r=null!==r&&r<Date.now()&&0<r?1e3*r:Date.now();return Object.assign(Object.assign({},t),{issuedAtTimeMillis:r})}initialize(e){this._app=e}isEqual(e){return e instanceof Oi&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Mi(e,t){var r,n;return 404===e||403===e?{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e}:(n=We(r=t?t.backoffCount:0,1e3,2),{backoffCount:r+1,allowRequestsAfter:Date.now()+n,httpStatus:e})}function Li(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Gn.create("throttled",{time:Yn(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Fi(e=qt(),r){var t=Dt(e=w(e),"app-check");if(jn.initialized||(i=H(),(n=jn).initialized=!0,"string"!=typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==i.FIREBASE_APPCHECK_DEBUG_TOKEN)||(n.enabled=!0,s=new Z,n.token=s,"string"==typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN?s.resolve(i.FIREBASE_APPCHECK_DEBUG_TOKEN):s.resolve(di())),pi()&&fi().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){var n=t.getImmediate(),i=t.getOptions();if(i.isTokenAutoRefreshEnabled===r.isTokenAutoRefreshEnabled&&i.provider.isEqual(r.provider))return n;throw Gn.create("already-initialized",{appName:e.name})}var s=t.initialize({options:r});{var a=e,o=r.provider;r=r.isTokenAutoRefreshEnabled;let t=((e,t)=>(Vn.set(e,t),Vn.get(e)))(a,Object.assign({},qn));t.activated=!0,t.provider=o,t.cachedTokenPromise=ui(a).then(e=>(e&&bi(e)&&(t.token=e,wi(a,{token:e.token})),e)),t.isTokenAutoRefreshEnabled=void 0===r?a.automaticDataCollectionEnabled:r,t.provider.initialize(a)}return Bn(e).isTokenAutoRefreshEnabled&&vi(s,"INTERNAL",()=>{}),s}let Ui="app-check-internal";Pt(new u("app-check",e=>{var t,r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");return e=r,t=n,new Ti(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider(Ui).initialize()})),Pt(new u(Ui,e=>Ei(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),d("@firebase/app-check","0.9.3");let Vi=new ye("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class qi{constructor(e){this.app=e}activate(e,t){let r;r="string"==typeof e?new Di(e):e instanceof xi||e instanceof Di||e instanceof Oi?e:new Oi({getToken:e.getToken}),this._delegate=Fi(this.app,{provider:r,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Vi.create("use-before-activation",{appName:this.app.name});var t,r;t=this._delegate,e=e,(r=Bn(t.app)).tokenRefresher&&(!0===e?r.tokenRefresher.start():r.tokenRefresher.stop()),r.isTokenAutoRefreshEnabled=e}getToken(e){if(this._delegate)return(async(e,t)=>{var r=await mi(e,t);if(r.error)throw r.error;if(r.internalError)throw r.internalError;return{token:r.token}})(this._delegate,e);throw Vi.create("use-before-activation",{appName:this.app.name})}onTokenChanged(r,n,e){if(this._delegate){var i=this._delegate;let e=()=>{},t=()=>{};return e=null!=r.next?r.next.bind(r):r,null!=r.error?t=r.error.bind(r):n&&(t=n),vi(i,"EXTERNAL",e,t),()=>_i(i.app,e)}throw Vi.create("use-before-activation",{appName:this.app.name})}}let ji=e=>{var t=e.getProvider("app-compat").getImmediate();return new qi(t)};function Bi(e,t){var r={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}or.INTERNAL.registerComponent(new u("appCheck-compat",ji,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:xi,ReCaptchaV3Provider:Di,CustomProvider:Oi})),or.registerVersion("@firebase/app-check-compat","0.3.24");let zi={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Ki={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function Wi(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function Hi(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}let Gi=Wi,$i=new ye("auth","Firebase",Wi()),Qi=new et("@firebase/auth");function Yi(e,...t){Qi.logLevel<=c.ERROR&&Qi.error(`Auth (${Ut}): `+e,...t)}function Ji(e,...t){throw rs(e,...t)}function Xi(e,...t){return rs(e,...t)}function Zi(e,t,r){var n=Object.assign(Object.assign({},Gi()),{[t]:r});return new ye("auth","Firebase",n).create(t,{appName:e.name})}function es(e){return Zi(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ts(e,t,r){var n=r;if(!(t instanceof n))throw n.name!==t.constructor.name&&Ji(e,"argument-error"),Zi(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function rs(e,...t){var r,n;return"string"!=typeof e?(r=t[0],(n=[...t.slice(1)])[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)):$i.create(e,...t)}function m(e,t,...r){if(!e)throw rs(t,...r)}function ns(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Yi(t),new Error(t)}function is(e,t){e||ns(t)}function ss(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function as(){return"http:"===os()||"https:"===os()}function os(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class ls{constructor(e,t){is((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=oe()||ce()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(as()||ue()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function hs(e,t){is(e.emulator,"Emulator should always be set here");var r=e.emulator.url;return t?""+r+(t.startsWith("/")?t.slice(1):t):r}class us{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ns("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ns("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ns("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}let cs={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ds=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ps=new ls(3e4,6e4);function fs(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function gs(i,s,a,o,e={}){return ms(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var r=Re(Object.assign({key:i.config.apiKey},t)).slice(1),n=await i._getAdditionalHeaders(),n=(n["Content-Type"]="application/json",i.languageCode&&(n["X-Firebase-Locale"]=i.languageCode),Object.assign({method:s,headers:n},e));return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(n.referrerPolicy="no-referrer"),i.emulatorConfig&&ee(i.emulatorConfig.host)&&(n.credentials="include"),us.fetch()(await _s(i,i.config.apiHost,a,r),n)})}async function ms(t,e,r){t._canInitEmulator=!1;var n=Object.assign(Object.assign({},cs),e);try{var i=new ys(t),s=await Promise.race([r(),i.promise]),a=(i.clearNetworkTimeout(),await s.json());if("needConfirmation"in a)throw ws(t,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;var[o,l]=(s.ok?a.errorMessage:a.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===o)throw ws(t,"credential-already-in-use",a);if("EMAIL_EXISTS"===o)throw ws(t,"email-already-in-use",a);if("USER_DISABLED"===o)throw ws(t,"user-disabled",a);var h=n[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Zi(t,h,l);Ji(t,h)}catch(e){if(e instanceof _e)throw e;Ji(t,"network-request-failed",{message:String(e)})}}async function vs(e,t,r,n,i={}){var s=await gs(e,t,r,n,i);return"mfaPendingCredential"in s&&Ji(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function _s(e,t,r,n){var i=""+t+r+"?"+n,s=e,i=s.config.emulator?hs(e.config,i):e.config.apiScheme+"://"+i;if(ds.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType()))return s._getPersistence()._getFinalTarget(i).toString();return i}class ys{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Xi(this.auth,"network-request-failed")),ps.get())})}}function ws(e,t,r){var n={appName:e.name},n=(r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber),Xi(e,t,n));return n.customData._tokenResponse=r,n}function bs(e){return void 0!==e&&void 0!==e.getResponse}function Is(e){return void 0!==e&&void 0!==e.enterprise}class Ts{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(t){if(this.recaptchaEnforcementState&&0!==this.recaptchaEnforcementState.length)for(let e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t){switch(e.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Es(e,t){return gs(e,"GET","/v2/recaptchaConfig",fs(e,t))}async function Cs(e,t){return gs(e,"POST","/v1/accounts:lookup",t)}function Ss(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function ks(e){return 1e3*Number(e)}function As(e){var[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return Yi("JWT malformed, contained fewer than 3 sections"),null;try{var i=K(r);return i?JSON.parse(i):(Yi("Failed to decode base64 JWT payload"),null)}catch(e){return Yi("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Ns(e){var t=As(e);return m(t,"internal-error"),m(void 0!==t.exp,"internal-error"),m(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Rs(t,e,r=!1){if(r)return e;try{return await e}catch(e){throw e instanceof _e&&(r=[e.code][0],"auth/user-disabled"===r||"auth/user-token-expired"===r)&&(t.auth.currentUser===t&&await t.auth.signOut()),e}}class Ps{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId)&&clearTimeout(this.timerId)}getInterval(e){var t;return e?(t=this.errorBackoff,this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t):(this.errorBackoff=3e4,t=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5,Math.max(0,t))}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ds{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ss(this.lastLoginAt),this.creationTime=Ss(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xs(e){var t,r,n=e.auth,i=await e.getIdToken(),i=await Rs(e,Cs(n,{idToken:i})),n=(m(null==i?void 0:i.users.length,n,"internal-error"),i.users[0]),i=(e._notifyReloadListener(n),null!=(i=n.providerUserInfo)&&i.length?Os(n.providerUserInfo):[]),i=(t=e.providerData,r=i,[...t.filter(t=>!r.some(e=>e.providerId===t.providerId)),...r]),s=!(e.email&&n.passwordHash||null!==i&&i.length),s=!!e.isAnonymous&&s,i={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new Ds(n.createdAt,n.lastLoginAt),isAnonymous:s};Object.assign(e,i)}function Os(e){return e.map(e=>{var t=e.providerId,r=Bi(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}class Ms{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){m(e.idToken,"internal-error"),m(void 0!==e.idToken,"internal-error"),m(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ns(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){m(0!==e.length,"internal-error");var t=Ns(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(m(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){i=t;var n,i,{accessToken:r,refreshToken:s,expiresIn:a}=await{accessToken:(r=await ms(n=e,{},async()=>{var e=Re({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:r}=n.config,t=await _s(n,t,"/v1/token","key="+r),r=await n._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",us.fetch()(t,{method:"POST",headers:r,body:e})})).access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token};this.updateTokensAndExpiration(r,s,Number(a))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){var{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new Ms;return r&&(m("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(m("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(m("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ms,this.toJSON())}_performRefresh(){return ns("not implemented")}}function Ls(e,t){m("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Fs{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=Bi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ps(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ds(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Rs(this,this.stsTokenManager.getToken(this.auth,e));return m(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return(async(e,t=!1)=>{var r=w(e),n=await r.getIdToken(t),i=As(n),s=(m(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error"),null==(r="object"==typeof i.firebase?i.firebase:void 0)?void 0:r.sign_in_provider);return{claims:i,token:n,authTime:Ss(ks(i.auth_time)),issuedAtTime:Ss(ks(i.iat)),expirationTime:Ss(ks(i.exp)),signInProvider:s||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}})(this,e)}reload(){return(async e=>{var t=w(e);await xs(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})(this)}_assign(e){this!==e&&(m(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){var t=new Fs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){m(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await xs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e;return h(this.auth.app)?Promise.reject(es(this.auth)):(e=await this.getIdToken(),await Rs(this,(async(e,t)=>gs(e,"POST","/v1/accounts:delete",t))(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut())}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r=null!=(r=t.displayName)?r:void 0,n=null!=(n=t.email)?n:void 0,i=null!=(i=t.phoneNumber)?i:void 0,s=null!=(s=t.photoURL)?s:void 0,a=null!=(a=t.tenantId)?a:void 0,o=null!=(o=t._redirectEventId)?o:void 0,l=null!=(l=t.createdAt)?l:void 0,h=null!=(h=t.lastLoginAt)?h:void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:p,stsTokenManager:f}=t,f=(m(u&&f,e,"internal-error"),Ms.fromJSON(this.name,f)),u=(m("string"==typeof u,e,"internal-error"),Ls(r,e.name),Ls(n,e.name),m("boolean"==typeof c,e,"internal-error"),m("boolean"==typeof d,e,"internal-error"),Ls(i,e.name),Ls(s,e.name),Ls(a,e.name),Ls(o,e.name),Ls(l,e.name),Ls(h,e.name),new Fs({uid:u,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:f,createdAt:l,lastLoginAt:h}));return p&&Array.isArray(p)&&(u.providerData=p.map(e=>Object.assign({},e))),o&&(u._redirectEventId=o),u}static async _fromIdTokenResponse(e,t,r=!1){var n=new Ms,n=(n.updateFromServerResponse(t),new Fs({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r}));return await xs(n),n}static async _fromGetAccountInfoResponse(e,t,r){var n=t.users[0],i=(m(void 0!==n.localId,"internal-error"),void 0!==n.providerUserInfo?Os(n.providerUserInfo):[]),s=!(n.email&&n.passwordHash||null!=i&&i.length),a=new Ms,a=(a.updateFromIdToken(r),new Fs({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s})),s={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new Ds(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||null!=i&&i.length)};return Object.assign(a,s),a}}let Us=new Map;function Vs(e){is(e instanceof Function,"Expected a class definition");var t=Us.get(e);return t?is(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Us.set(e,t)),t}class qs{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}qs.type="NONE";let js=qs;function Bs(e,t,r){return`firebase:${e}:${t}:`+r}class zs{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;var{config:n,name:i}=this.auth;this.fullUserKey=Bs(this.userKey,n.apiKey,i),this.fullPersistenceKey=Bs("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e,t=await this.persistence._get(this.fullUserKey);return t?"string"==typeof t?(e=await Cs(this.auth,{idToken:t}).catch(()=>{}))?Fs._fromGetAccountInfoResponse(this.auth,e,t):null:Fs._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){var t;if(this.persistence!==e)return t=await this.getCurrentUser(),await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,r="authUser"){if(!e.length)return new zs(Vs(js),t,r);var n,i=(await Promise.all(e.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||Vs(js),a=Bs(r,t.config.apiKey,t.name),o=null;for(n of e)try{var l=await n._get(a);if(l){let e;if("string"==typeof l){var h=await Cs(t,{idToken:l}).catch(()=>{});if(!h)break;e=await Fs._fromGetAccountInfoResponse(t,h,l)}else e=Fs._fromJSON(t,l);n!==s&&(o=e),s=n;break}}catch(e){}i=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&i.length&&(s=i[0],o&&await s._set(a,o.toJSON()),await Promise.all(e.map(async e=>{if(e!==s)try{await e._remove(a)}catch(e){}}))),new zs(s,t,r)}}function Ks(e){var t=e.toLowerCase();return t.includes("opera/")||t.includes("opr/")||t.includes("opios/")?"Opera":$s(t)?"IEMobile":t.includes("msie")||t.includes("trident/")?"IE":t.includes("edge/")?"Edge":Ws(t)?"Firefox":t.includes("silk/")?"Silk":Ys(t)?"Blackberry":Js(t)?"Webos":Hs(t)?"Safari":!t.includes("chrome/")&&!Gs(t)||t.includes("edge/")?Qs(t)?"Android":2===(null==(t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))?void 0:t.length)?t[1]:"Other":"Chrome"}function Ws(e=ae()){return/firefox\//i.test(e)}function Hs(e=ae()){var t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Gs(e=ae()){return/crios\//i.test(e)}function $s(e=ae()){return/iemobile/i.test(e)}function Qs(e=ae()){return/android/i.test(e)}function Ys(e=ae()){return/blackberry/i.test(e)}function Js(e=ae()){return/webos/i.test(e)}function Xs(e=ae()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Zs(e=ae()){return Xs(e)||Qs(e)||Js(e)||Ys(e)||/windows phone/i.test(e)||$s(e)}function ea(e,t=[]){let r;switch(e){case"Browser":r=Ks(ae());break;case"Worker":r=Ks(ae())+"-"+e;break;default:r=e}var n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${Ut}/`+n}class ta{constructor(e){this.auth=e,this.queue=[]}pushCallback(n,e){var t=r=>new Promise((e,t)=>{try{e(n(r))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){var t=[];try{for(var r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){t.reverse();for(var n of t)try{n()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class ra{constructor(e){var t,r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=r.minPasswordLength)?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(t=e.allowedNonAlphanumericCharacters)?void 0:t.join(""))?r:"",this.forceUpgradeOnSignin=null!=(t=e.forceUpgradeOnSignin)&&t,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,r),this.validatePasswordCharacterOptions(e,r),r.isValid&&(r.isValid=null==(t=r.meetsMinPasswordLength)||t),r.isValid&&(r.isValid=null==(t=r.meetsMaxPasswordLength)||t),r.isValid&&(r.isValid=null==(t=r.containsLowercaseLetter)||t),r.isValid&&(r.isValid=null==(t=r.containsUppercaseLetter)||t),r.isValid&&(r.isValid=null==(t=r.containsNumericCharacter)||t),r.isValid&&(r.isValid=null==(t=r.containsNonAlphanumericCharacter)||t),r}validatePasswordLengthOptions(e,t){var r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){var r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,"a"<=r&&r<="z","A"<=r&&r<="Z","0"<=r&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&!e.containsLowercaseLetter&&(e.containsLowercaseLetter=t),this.customStrengthOptions.containsUppercaseLetter&&!e.containsUppercaseLetter&&(e.containsUppercaseLetter=r),this.customStrengthOptions.containsNumericCharacter&&!e.containsNumericCharacter&&(e.containsNumericCharacter=n),this.customStrengthOptions.containsNonAlphanumericCharacter&&!e.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter=i)}}class na{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sa(this),this.idTokenSubscription=new sa(this),this.beforeStateQueue=new ta(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$i,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=Vs(r)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await zs.create(this,t),null!=(e=this._resolvePersistenceManagerAvailable)&&e.call(this),!this._deleted)){if(null!=(e=this._popupRedirectResolver)&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(r),this.lastNotifiedUid=(null==(e=this.currentUser)?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){var e;!this._deleted&&(e=await this.assertedPersistence.getCurrentUser(),this.currentUser||e)&&(this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),await this.currentUser.getIdToken()):await this._updateCurrentUser(e,!0))}async initializeCurrentUserFromIdToken(e){try{var t=await Cs(this,{idToken:e}),r=await Fs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(h(this.app)){let t=this.app.settings.authIdToken;return t?new Promise(e=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(t).then(e,e))}):this.directlySetCurrentUser(null)}var t,r,n,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null==(t=this.redirectUser)?void 0:t._redirectEventId,r=null==s?void 0:s._redirectEventId,n=await this.tryRedirectSignIn(e),t&&t!==r||null==n||!n.user||(s=n.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return m(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xs(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){var e;this.languageCode="undefined"!=typeof navigator&&((e=navigator).languages&&e.languages[0]||e.language)||null}async _delete(){this._deleted=!0}async updateCurrentUser(e){var t;return h(this.app)?Promise.reject(es(this)):((t=e?w(e):null)&&m(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this)))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&m(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return h(this.app)?Promise.reject(es(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return h(this.app)?Promise.reject(es(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vs(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();var t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){var e,t=await gs(e=this,"GET","/v2/passwordPolicy",fs(e,{})),t=new ra(t);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ye("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((t,r)=>{if(this.currentUser)t();else{let e=this.onAuthStateChanged(()=>{e(),t()},r)}})}async revokeAccessToken(e){var t;this.currentUser&&(t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()},null!=this.tenantId&&(t.tenantId=this.tenantId),await gs(e=this,"POST","/v2/accounts:revokeToken",fs(e,t)))}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){var r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(m(t=e&&Vs(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await zs.create(this,[Vs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(t=this.redirectUser)?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:`+this.name}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!=(e=null==(e=this.currentUser)?void 0:e.uid)?e:null,this.lastNotifiedUid!==e)&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,i){if(this._deleted)return()=>{};let e="function"==typeof r?r:r.next.bind(r),s=!1;var a=this._isInitialized?Promise.resolve():this._initializationPromise;if(m(a,this,"internal-error"),a.then(()=>{s||e(this.currentUser)}),"function"==typeof r){let e=t.addObserver(r,n,i);return()=>{s=!0,e()}}{let e=t.addObserver(r);return()=>{s=!0,e()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return m(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ea(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e={"X-Client-Version":this.clientVersion},t=(this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),await(null==(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:t.getHeartbeatsHeader())),t=(t&&(e["X-Firebase-Client"]=t),await this._getAppCheckToken());return t&&(e["X-Firebase-AppCheck"]=t),e}async _getAppCheckToken(){var e,t,r;return h(this.app)&&this.app.settings.appCheckToken?this.app.settings.appCheckToken:(null!=(e=await(null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken()))&&e.error&&(t="Error while retrieving App Check token: "+e.error,r=[],Qi.logLevel<=c.WARN)&&Qi.warn(`Auth (${Ut}): `+t,...r),null==e?void 0:e.token)}}function ia(e){return w(e)}class sa{constructor(e){this.auth=e,this.observer=null,this.addObserver=Oe(e=>this.observer=e)}get next(){return m(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let aa={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oa(e){return aa.loadJS(e)}function la(e){return"__"+e+Math.floor(1e6*Math.random())}class ha{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var r=this.counter;return this._widgets.set(r,new da(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t,r=e||1e12;null!=(t=this._widgets.get(r))&&t.delete(),this._widgets.delete(r)}getResponse(e){var t;return(null==(t=this._widgets.get(e||1e12))?void 0:t.getResponse())||""}async execute(e){var t;return null!=(t=this._widgets.get(e||1e12))&&t.execute(),""}}class ua{constructor(){this.enterprise=new ca}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ca{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class da{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var n="string"==typeof e?document.getElementById(e):e;m(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=(e=>{var t=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t.push(r.charAt(Math.floor(Math.random()*r.length)));return t.join("")})(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}let pa="NO_RECAPTCHA";class fa{constructor(e){this.type="recaptcha-enterprise",this.auth=ia(e)}async verify(i="verify",e=!1){function s(e,t,r){let n=window.grecaptcha;Is(n)?n.enterprise.ready(()=>{n.enterprise.execute(e,{action:i}).then(e=>{t(e)}).catch(()=>{t(pa)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new ua).execute("siteKey",{action:"verify"}):new Promise((r,n)=>{(async i=>{if(!e){if(null==i.tenantId&&null!=i._agentRecaptchaConfig)return i._agentRecaptchaConfig.siteKey;if(null!=i.tenantId&&void 0!==i._tenantRecaptchaConfigs[i.tenantId])return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(r,n)=>{Es(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(e=>{var t;if(void 0!==e.recaptchaKey)return t=new Ts(e),null==i.tenantId?i._agentRecaptchaConfig=t:i._tenantRecaptchaConfigs[i.tenantId]=t,r(t.siteKey);n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(t=>{if(!e&&Is(window.grecaptcha))s(t,r,n);else if("undefined"==typeof window)n(new Error("RecaptchaVerifier is only supported in browser"));else{let e=aa.recaptchaEnterpriseScript;0!==e.length&&(e+=t),oa(e).then(()=>{s(t,r,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function ga(e,t,r,n=!1,i=!1){var s=new fa(e);let a;if(i)a=pa;else try{a=await s.verify(r)}catch(e){a=await s.verify(r,!0)}var o,l,s=Object.assign({},t);return"mfaSmsEnrollment"===r||"mfaSmsSignIn"===r?"phoneEnrollmentInfo"in s?(l=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.recaptchaToken,Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:o,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})):"phoneSignInInfo"in s&&(l=s.phoneSignInInfo.recaptchaToken,Object.assign(s,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})):(n?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"})),s}async function ma(r,n,i,s,e){var t;return"EMAIL_PASSWORD_PROVIDER"===e?null!=(t=r._getRecaptchaConfig())&&t.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")?(t=await ga(r,n,i,"getOobCode"===i),s(r,t)):s(r,n).catch(async e=>{var t;return"auth/missing-recaptcha-token"===e.code?(console.log(i+" is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."),t=await ga(r,n,i,"getOobCode"===i),s(r,t)):Promise.reject(e)}):"PHONE_PROVIDER"===e?null!=(t=r._getRecaptchaConfig())&&t.isProviderEnabled("PHONE_PROVIDER")?(t=await ga(r,n,i),s(r,t).catch(async e=>{var t;if("AUDIT"===(null==(t=r._getRecaptchaConfig())?void 0:t.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code))return console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${i} flow.`),t=await ga(r,n,i,!1,!0),s(r,t);return Promise.reject(e)})):(t=await ga(r,n,i,!1,!0),s(r,t)):Promise.reject(e+" provider is not supported.")}function va(e,t,r){var n=ia(e),i=(m(/^https?:\/\//.test(t),n,"invalid-emulator-scheme"),!(null==r||!r.disableWarnings)),s=_a(t),{host:a,port:o}=(e=>{var t,r=_a(e);return(r=/(\/\/)?([^?#/]+)/.exec(e.substr(r.length)))?(r=r[2].split("@").pop()||"",(t=/^(\[[^\]]+\])(:|$)/.exec(r))?{host:t=t[1],port:ya(r.substr(t.length+1))}:([t,r]=r.split(":"),{host:t,port:ya(r)})):{host:"",port:null}})(t),l=null===o?"":":"+o,h={url:s+`//${a}${l}/`},o=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});function u(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}n._canInitEmulator?(n.config.emulator=h,n.emulatorConfig=o,n.settings.appVerificationDisabledForTesting=!0,ee(a)?(se("Auth",!0),te(s+"//"+a+l)):i||("undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()))):(m(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),m(Ae(h,n.config.emulator)&&Ae(o,n.emulatorConfig),n,"emulator-config-failed"))}function _a(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ya(e){var t;return!e||(t=Number(e),isNaN(t))?null:t}class wa{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ns("not implemented")}_getIdTokenResponse(e){return ns("not implemented")}_linkToIdToken(e,t){return ns("not implemented")}_getReauthenticationResolver(e){return ns("not implemented")}}async function ba(e,t){return gs(e,"POST","/v1/accounts:resetPassword",fs(e,t))}async function Ia(e,t){return gs(e,"POST","/v1/accounts:signUp",t)}async function Ta(e,t){return vs(e,"POST","/v1/accounts:signInWithPassword",fs(e,t))}async function Ea(e,t){return gs(e,"POST","/v1/accounts:sendOobCode",fs(e,t))}async function Ca(e,t){return Ea(e,t)}async function Sa(e,t){return Ea(e,t)}class ka extends wa{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new ka(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ka(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ma(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Ta,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return(async(e,t)=>vs(e,"POST","/v1/accounts:signInWithEmailLink",fs(e,t)))(e,{email:this._email,oobCode:this._password});default:Ji(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ma(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ia,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return(async(e,t)=>vs(e,"POST","/v1/accounts:signInWithEmailLink",fs(e,t)))(e,{idToken:t,email:this._email,oobCode:this._password});default:Ji(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Aa(e,t){return vs(e,"POST","/v1/accounts:signInWithIdp",fs(e,t))}class Na extends wa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){var t=new Na(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ji("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,t=Bi(t,["providerId","signInMethod"]);return r&&n?((r=new Na(r,n)).idToken=t.idToken||void 0,r.accessToken=t.accessToken||void 0,r.secret=t.secret,r.nonce=t.nonce,r.pendingToken=t.pendingToken||null,r):null}_getIdTokenResponse(e){return Aa(e,this.buildRequest())}_linkToIdToken(e,t){var r=this.buildRequest();return r.idToken=t,Aa(e,r)}_getReauthenticationResolver(e){var t=this.buildRequest();return t.autoCreate=!1,Aa(e,t)}buildRequest(){var e,t={requestUri:"http://localhost",returnSecureToken:!0};return this.pendingToken?t.pendingToken=this.pendingToken:(e={},this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Re(e)),t}}async function Ra(e,t){return gs(e,"POST","/v1/accounts:sendVerificationCode",fs(e,t))}let Pa={USER_NOT_FOUND:"user-not-found"};class Da extends wa{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Da({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Da({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return(async(e,t)=>vs(e,"POST","/v1/accounts:signInWithPhoneNumber",fs(e,t)))(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return(async(e,t)=>{var r=await vs(e,"POST","/v1/accounts:signInWithPhoneNumber",fs(e,t));if(r.temporaryProof)throw ws(e,"account-exists-with-different-credential",r);return r})(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return(async(e,t)=>vs(e,"POST","/v1/accounts:signInWithPhoneNumber",fs(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Pa))(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return r||t||n||i?new Da({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class xa{constructor(e){var t=Pe(De(e)),r=null!=(r=t.apiKey)?r:null,n=null!=(n=t.oobCode)?n:null,i=(e=>{switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}})(null!=(i=t.mode)?i:null);m(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=null!=(r=t.continueUrl)?r:null,this.languageCode=null!=(i=t.lang)?i:null,this.tenantId=null!=(n=t.tenantId)?n:null}static parseLink(e){t=Pe(De(e=e)).link,r=t?Pe(De(t)).deep_link_id:null;var t,r,n=((n=Pe(De(e)).deep_link_id)?Pe(De(n)).link:null)||n||r||t||e;try{return new xa(n)}catch(e){return null}}}class Oa{constructor(){this.providerId=Oa.PROVIDER_ID}static credential(e,t){return ka._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var r=xa.parseLink(t);return m(r,"argument-error"),ka._fromEmailAndCode(e,r.code,r.tenantId)}}Oa.PROVIDER_ID="password",Oa.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Oa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ma{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class La extends Ma{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Fa extends La{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return m("providerId"in t&&"signInMethod"in t,"argument-error"),Na._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return m(e.idToken||e.accessToken,"argument-error"),Na._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Fa.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Fa.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:n,pendingToken:i,nonce:s,providerId:a}=e;if(!(r||n||t||i))return null;if(!a)return null;try{return new Fa(a)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:i})}catch(e){return null}}}class Ua extends La{constructor(){super("facebook.com")}static credential(e){return Na._fromParams({providerId:Ua.PROVIDER_ID,signInMethod:Ua.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ua.credentialFromTaggedObject(e)}static credentialFromError(e){return Ua.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ua.credential(e.oauthAccessToken)}catch(e){return null}}}Ua.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ua.PROVIDER_ID="facebook.com";class Va extends La{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Na._fromParams({providerId:Va.PROVIDER_ID,signInMethod:Va.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Va.credentialFromTaggedObject(e)}static credentialFromError(e){return Va.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Va.credential(t,r)}catch(e){return null}}}Va.GOOGLE_SIGN_IN_METHOD="google.com",Va.PROVIDER_ID="google.com";class qa extends La{constructor(){super("github.com")}static credential(e){return Na._fromParams({providerId:qa.PROVIDER_ID,signInMethod:qa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qa.credentialFromTaggedObject(e)}static credentialFromError(e){return qa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return qa.credential(e.oauthAccessToken)}catch(e){return null}}}qa.GITHUB_SIGN_IN_METHOD="github.com",qa.PROVIDER_ID="github.com";class ja extends wa{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Aa(e,this.buildRequest())}_linkToIdToken(e,t){var r=this.buildRequest();return r.idToken=t,Aa(e,r)}_getReauthenticationResolver(e){var t=this.buildRequest();return t.autoCreate=!1,Aa(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:r,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return t&&r&&n&&t===r?new ja(t,n):null}static _create(e,t){return new ja(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ba extends Ma{constructor(e){m(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Ba.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ba.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=ja.fromJSON(e);return m(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return ja._create(r,t)}catch(e){return null}}}class za extends La{constructor(){super("twitter.com")}static credential(e,t){return Na._fromParams({providerId:za.PROVIDER_ID,signInMethod:za.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return za.credentialFromTaggedObject(e)}static credentialFromError(e){return za.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return za.credential(t,r)}catch(e){return null}}}async function Ka(e,t){return vs(e,"POST","/v1/accounts:signUp",fs(e,t))}za.TWITTER_SIGN_IN_METHOD="twitter.com",za.PROVIDER_ID="twitter.com";class Wa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){var i=await Fs._fromIdTokenResponse(e,r,n),s=Ha(r);return new Wa({user:i,providerId:s,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);var n=Ha(r);return new Wa({user:e,providerId:n,_tokenResponse:r,operationType:t})}}function Ha(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Ga extends _e{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,Ga.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new Ga(e,t,r,n)}}function $a(t,r,e,n){return("reauthenticate"===r?e._getReauthenticationResolver(t):e._getIdTokenResponse(t)).catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Ga._fromErrorAndOperation(t,e,r,n);throw e})}function Qa(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ya(e,t){var r=w(e),n=(await Xa(!0,r,t),e=r.auth,t={idToken:await r.getIdToken(),deleteProvider:[t]},await gs(e,"POST","/v1/accounts:update",t)).providerUserInfo;let i=Qa(n||[]);return r.providerData=r.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(r.phoneNumber=null),await r.auth._persistUserIfCurrent(r),r}async function Ja(e,t,r=!1){var n=await Rs(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Wa._forOperation(e,"link",n)}async function Xa(e,t,r){await xs(t);var n=!1===e?"provider-already-linked":"no-such-provider";m(Qa(t.providerData).has(r)===e,t.auth,n)}async function Za(e,t,r=!1){var n=e.auth;if(h(n.app))return Promise.reject(es(n));var i="reauthenticate";try{var s=await Rs(e,$a(n,i,t,e),r),a=(m(s.idToken,n,"internal-error"),As(s.idToken)),o=(m(a,n,"internal-error"),a).sub;return m(e.uid===o,n,"user-mismatch"),Wa._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Ji(n,"user-mismatch"),e}}async function eo(e,t,r=!1){var n;return h(e.app)?Promise.reject(es(e)):(n=await $a(e,"signIn",t),n=await Wa._fromIdTokenResponse(e,"signIn",n),r||await e._updateCurrentUser(n.user),n)}async function to(e,t){return eo(ia(e),t)}async function ro(e,t){var r=w(e);return await Xa(!1,r,t.providerId),Ja(r,t)}async function no(e,t){return Za(w(e),t)}async function io(e,t){var r,n;return h(e.app)?Promise.reject(es(e)):(n=await vs(r=ia(e),"POST","/v1/accounts:signInWithCustomToken",fs(r,{token:t,returnSecureToken:!0})),n=await Wa._fromIdTokenResponse(r,"signIn",n),await r._updateCurrentUser(n.user),n)}class so{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ao._fromServerResponse(e,t):"totpInfo"in t?oo._fromServerResponse(e,t):Ji(e,"internal-error")}}class ao extends so{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ao(t)}}class oo extends so{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new oo(t)}}function lo(e,t,r){var n;m(0<(null==(n=r.url)?void 0:n.length),e,"invalid-continue-uri"),m(void 0===r.dynamicLinkDomain||0<r.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),m(void 0===r.linkDomain||0<r.linkDomain.length,e,"invalid-hosting-link-domain"),t.continueUrl=r.url,t.dynamicLinkDomain=r.dynamicLinkDomain,t.linkDomain=r.linkDomain,t.canHandleCodeInApp=r.handleCodeInApp,r.iOS&&(m(0<r.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=r.iOS.bundleId),r.android&&(m(0<r.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=r.android.installApp,t.androidMinimumVersionCode=r.android.minimumVersion,t.androidPackageName=r.android.packageName)}async function ho(e){var t=ia(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function uo(e,t){await gs(e=w(e),"POST","/v1/accounts:update",fs(e,{oobCode:t}))}async function co(e,t){var r=w(e),n=await ba(r,{oobCode:t}),i=n.requestType;switch(m(i,r,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":m(n.newEmail,r,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":m(n.mfaInfo,r,"internal-error");default:m(n.email,r,"internal-error")}let s=null;return n.mfaInfo&&(s=so._fromServerResponse(ia(r),n.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.newEmail:n.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.email:n.newEmail)||null,multiFactorInfo:s},operation:i}}async function po(e,t){var r=as()?ss():"http://localhost",r=(await gs(e=w(e),"POST","/v1/accounts:createAuthUri",fs(e,{identifier:t,continueUri:r}))).signinMethods;return r||[]}async function fo(e,t){var r=w(e),n={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()},r=(t&&lo(r.auth,n,t),await Ea(r.auth,n)).email;r!==e.email&&await e.reload()}async function go(e,t,r){var n=w(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t},n=(r&&lo(n.auth,i,r),await Ea(n.auth,i)).email;n!==e.email&&await e.reload()}async function mo(e,{displayName:t,photoURL:r}){var n,i,s;void 0===t&&void 0===r||(i=await(n=w(e)).getIdToken(),i=await Rs(n,(async(e,t)=>gs(e,"POST","/v1/accounts:update",t))(n.auth,{idToken:i,displayName:t,photoUrl:r,returnSecureToken:!0})),n.displayName=i.displayName||null,n.photoURL=i.photoUrl||null,(s=n.providerData.find(({providerId:e})=>"password"===e))&&(s.displayName=n.displayName,s.photoURL=n.photoURL),await n._updateTokensIfNecessary(i))}async function vo(e,t,r){var n=e.auth,i={idToken:await e.getIdToken(),returnSecureToken:!0},n=(t&&(i.email=t),r&&(i.password=r),await Rs(e,(async(e,t)=>gs(e,"POST","/v1/accounts:update",t))(n,i)));await e._updateTokensIfNecessary(n,!0)}class _o{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class yo extends _o{constructor(e,t,r,n){super(e,t,r),this.username=n}}class wo extends _o{constructor(e,t){super(e,"facebook.com",t)}}class bo extends yo{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Io extends _o{constructor(e,t){super(e,"google.com",t)}}class To extends yo{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Eo(e){var{user:t,_tokenResponse:r}=e;if(t.isAnonymous&&!r)return{providerId:null,isNewUser:!1,profile:null};var n=r;if(!n)return null;var i=n.providerId,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},a=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!i&&null!=n&&n.idToken){t=null==(t=null==(t=As(n.idToken))?void 0:t.firebase)?void 0:t.sign_in_provider;if(t)return t="anonymous"!==t&&"custom"!==t?t:null,new _o(a,t)}if(!i)return null;switch(i){case"facebook.com":return new wo(a,s);case"github.com":return new bo(a,s);case"google.com":return new Io(a,s);case"twitter.com":return new To(a,s,n.screenName||null);case"custom":case"anonymous":return new _o(a,null);default:return new _o(a,i,s)}}class Co{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Co("enroll",e,t)}static _fromMfaPendingCredential(e){return new Co("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!=(t=e.multiFactorSession)&&t.pendingCredential)return Co._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!=(t=e.multiFactorSession)&&t.idToken)return Co._fromIdtoken(e.multiFactorSession.idToken)}return null}}class So{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,i){let s=ia(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>so._fromServerResponse(s,e));m(a.mfaPendingCredential,s,"internal-error");let o=Co._fromMfaPendingCredential(a.mfaPendingCredential);return new So(o,t,async e=>{var t=await e._process(s,o),r=(delete a.mfaInfo,delete a.mfaPendingCredential,Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken}));switch(i.operationType){case"signIn":var n=await Wa._fromIdTokenResponse(s,i.operationType,r);return await s._updateCurrentUser(n.user),n;case"reauthenticate":return m(i.user,s,"internal-error"),Wa._forOperation(i.user,i.operationType,r);default:Ji(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}function ko(e,t){return gs(e,"POST","/v2/accounts/mfaEnrollment:start",fs(e,t))}class Ao{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>so._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Ao(e)}async getSession(){return Co._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){var r=e,n=await this.getSession(),r=await Rs(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid;var r,n,i=await this.user.getIdToken();try{var s=await Rs(this.user,(r=this.user.auth,n={idToken:i,mfaEnrollmentId:t},gs(r,"POST","/v2/accounts/mfaEnrollment:withdraw",fs(r,n))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}let No=new WeakMap;let Ro="__sak";class Po{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ro,"1"),this.storage.removeItem(Ro),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Do extends Po{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Zs(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(var t of Object.keys(this.listeners)){var r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,r=!1){if(e.key){let t=e.key;r?this.detachListener():this.stopPolling();var n=()=>{var e=this.storage.getItem(t);!r&&this.localCache[t]===e||this.notifyListeners(t,e)},i=this.storage.getItem(t);de()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)})}notifyListeners(e,t){this.localCache[e]=t;var r=this.listeners[e];if(r)for(var n of Array.from(r))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size)&&delete this.listeners[e],0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Do.type="LOCAL";let xo=Do;class Oo extends Po{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Oo.type="SESSION";let Mo=Oo;class Lo{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));return e||(e=new Lo(t),this.receivers.push(e),e)}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:r,eventType:n,data:i}=t.data;var s=this.handlersMap[n];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:r,eventType:n}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Fo(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(10*Math.random());return e+r}Lo.receivers=[];class Uo{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){let o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let l,h;return new Promise((r,n)=>{let i=Fo("",20),s=(o.port1.start(),setTimeout(()=>{n(new Error("unsupported_event"))},a));h={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),l=setTimeout(()=>{n(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),r(t.data.response);break;default:clearTimeout(s),clearTimeout(l),n(new Error("invalid_response"))}}},this.handlers.add(h),o.port1.addEventListener("message",h.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{h&&this.removeMessageHandler(h)})}}function Vo(){return window}function qo(){return void 0!==Vo().WorkerGlobalScope&&"function"==typeof Vo().importScripts}let jo="firebaseLocalStorageDb",Bo="firebaseLocalStorage",zo="fbase_key";class Ko{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Wo(e,t){return e.transaction([Bo],t?"readwrite":"readonly").objectStore(Bo)}function Ho(){let n=indexedDB.open(jo,1);return new Promise((t,r)=>{n.addEventListener("error",()=>{r(n.error)}),n.addEventListener("upgradeneeded",()=>{var e=n.result;try{e.createObjectStore(Bo,{keyPath:zo})}catch(e){r(e)}}),n.addEventListener("success",async()=>{var e=n.result;e.objectStoreNames.contains(Bo)?t(e):(e.close(),e=indexedDB.deleteDatabase(jo),await new Ko(e).toPromise(),t(await Ho()))})})}async function Go(e,t,r){var n=Wo(e,!0).put({fbase_key:t,value:r});return new Ko(n).toPromise()}function $o(e,t){var r=Wo(e,!0).delete(t);return new Ko(r).toPromise()}class Qo{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ho()),this.db}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qo()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Lo._getInstance(qo()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;this.activeServiceWorker=await(async()=>{if(null==navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}})(),this.activeServiceWorker&&(this.sender=new Uo(this.activeServiceWorker),t=await this.sender._send("ping",{},800))&&null!=(e=t[0])&&e.fulfilled&&null!=(e=t[0])&&e.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{var e;return indexedDB?(await Go(e=await Ho(),Ro,"1"),await $o(e,Ro),!0):!1}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(e=>Go(e,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>(async(e,t)=>{var r=Wo(e,!1).get(t);return void 0===(r=await new Ko(r).toPromise())?null:r.value})(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>$o(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e=await this._withRetries(e=>{var t=Wo(e,!1).getAll();return new Ko(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];var t,r=[],n=new Set;if(0!==e.length)for(var{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),r.push(i));for(t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),r.push(t));return r}notifyListeners(e,t){this.localCache[e]=t;var r=this.listeners[e];if(r)for(var n of Array.from(r))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size)&&delete this.listeners[e],0===Object.keys(this.listeners).length&&this.stopPolling()}}Qo.type="LOCAL";let Yo=Qo;function Jo(e,t){return gs(e,"POST","/v2/accounts/mfaSignIn:start",fs(e,t))}let Xo=la("rcb"),Zo=new ls(3e4,6e4);class el{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null==(e=Vo().grecaptcha)||!e.render)}load(i,s=""){var e;return m((e=s).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),i,"argument-error"),this.shouldResolveImmediately(s)&&bs(Vo().grecaptcha)?Promise.resolve(Vo().grecaptcha):new Promise((t,r)=>{let n=Vo().setTimeout(()=>{r(Xi(i,"network-request-failed"))},Zo.get());Vo()[Xo]=()=>{Vo().clearTimeout(n),delete Vo()[Xo];var e=Vo().grecaptcha;if(e&&bs(e)){let n=e.render;e.render=(e,t)=>{var r=n(e,t);return this.counter++,r},this.hostLanguage=s,t(e)}else r(Xi(i,"internal-error"))},oa(aa.recaptchaV2Script+"?"+Re({onload:Xo,render:"explicit",hl:s})).catch(()=>{clearTimeout(n),r(Xi(i,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null==(t=Vo().grecaptcha)||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class tl{async load(e){return new ha(e)}clearedOneInstance(){}}let rl="recaptcha",nl={theme:"light",type:"image"};class il{constructor(e,t,r=Object.assign({},nl)){this.parameters=r,this.type=rl,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ia(e),this.isInvisible="invisible"===this.parameters.size,m("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var n="string"==typeof t?document.getElementById(t):t;m(n,this.auth,"argument-error"),this.container=n,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?tl:el),this.validateStartingState()}async verify(){this.assertNotDestroyed();let e=await this.render(),n=this.getAssertedRecaptcha();var t=n.getResponse(e);return t||new Promise(t=>{let r=e=>{e&&(this.tokenChangeListeners.delete(r),t(e))};this.tokenChangeListeners.add(r),this.isInvisible&&n.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){m(!this.parameters.sitekey,this.auth,"argument-error"),m(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),m("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(r){return t=>{var e;this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof r?r(t):"string"==typeof r&&"function"==typeof(e=Vo()[r])&&e(t)}}assertNotDestroyed(){m(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){m(as()&&!qo(),this.auth,"internal-error"),await(()=>{let t=null;return new Promise(e=>{"complete"===document.readyState?e():(t=()=>e(),window.addEventListener("load",t))}).catch(e=>{throw t&&window.removeEventListener("load",t),e})})(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await gs(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");m(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return m(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class sl{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=Da._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function al(t,r,n){var i,e,s,a,o,l,h,u;if(!t._getRecaptchaConfig())try{e=ia(t),s=await Es(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),s=new Ts(s),null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,await(!s.isAnyProviderEnabled()||!new fa(e).verify())}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let e;return("session"in(e="string"==typeof r?{phoneNumber:r}:r)?(a=e.session,"phoneNumber"in e?(m("enroll"===a.type,t,"internal-error"),o={idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},(await ma(t,o,"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===pa?(m((null==n?void 0:n.type)===rl,e,"argument-error"),ko(e,await ol(e,t,n))):ko(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e))).phoneSessionInfo):(m("signin"===a.type,t,"internal-error"),m(l=(null==(i=e.multiFactorHint)?void 0:i.uid)||e.multiFactorUid,t,"missing-multi-factor-info"),h={mfaPendingCredential:a.credential,mfaEnrollmentId:l,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},(await ma(t,h,"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===pa?(m((null==n?void 0:n.type)===rl,e,"argument-error"),Jo(e,await ol(e,t,n))):Jo(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e))).phoneResponseInfo)):(u={phoneNumber:e.phoneNumber,clientType:"CLIENT_TYPE_WEB"},await ma(t,u,"sendVerificationCode",async(e,t)=>t.captchaResponse===pa?(m((null==n?void 0:n.type)===rl,e,"argument-error"),Ra(e,await ol(e,t,n))):Ra(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e)))).sessionInfo}finally{null!=n&&n._reset()}}async function ol(e,t,r){m(r.type===rl,e,"argument-error");var n,i,s,a,o=await r.verify(),l=(m("string"==typeof o,e,"argument-error"),Object.assign({},t));return"phoneEnrollmentInfo"in l?(i=l.phoneEnrollmentInfo.phoneNumber,s=l.phoneEnrollmentInfo.captchaResponse,a=l.phoneEnrollmentInfo.clientType,n=l.phoneEnrollmentInfo.recaptchaVersion,Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:o,captchaResponse:s,clientType:a,recaptchaVersion:n}})):"phoneSignInInfo"in l?(i=l.phoneSignInInfo.captchaResponse,s=l.phoneSignInInfo.clientType,a=l.phoneSignInInfo.recaptchaVersion,Object.assign(l,{phoneSignInInfo:{recaptchaToken:o,captchaResponse:i,clientType:s,recaptchaVersion:a}})):Object.assign(l,{recaptchaToken:o}),l}class ll{constructor(e){this.providerId=ll.PROVIDER_ID,this.auth=ia(e)}verifyPhoneNumber(e,t){return al(this.auth,e,w(t))}static credential(e,t){return Da._fromVerification(e,t)}static credentialFromResult(e){var t=e;return ll.credentialFromTaggedObject(t)}static credentialFromError(e){return ll.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){var t,r;return e&&({phoneNumber:t,temporaryProof:r}=e,t)&&r?Da._fromTokenResponse(t,r):null}}function hl(e,t){return t?Vs(t):(m(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}ll.PROVIDER_ID="phone",ll.PHONE_SIGN_IN_METHOD="phone";class ul extends wa{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Aa(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Aa(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Aa(e,this._buildIdpRequest())}_buildIdpRequest(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cl(e){return eo(e.auth,new ul(e),e.bypassAuthState)}function dl(e){var{auth:t,user:r}=e;return m(r,t,"internal-error"),Za(r,new ul(e),e.bypassAuthState)}async function pl(e){var{auth:t,user:r}=e;return m(r,t,"internal-error"),Ja(r,new ul(e),e.bypassAuthState)}class fl{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{s={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(s))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cl;case"linkViaPopup":case"linkViaRedirect":return pl;case"reauthViaPopup":case"reauthViaRedirect":return dl;default:Ji(this.auth,"internal-error")}}resolve(e){is(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){is(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let gl=new ls(2e3,1e4);class ml extends fl{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,ml.currentPopupAction&&ml.currentPopupAction.cancel(),ml.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return m(e,this.auth,"internal-error"),e}async onExecution(){is(1===this.filter.length,"Popup operations only handle one event");var e=Fo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Xi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Xi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ml.currentPopupAction=null}pollUserCancellation(){let t=()=>{var e;null!=(e=null==(e=this.authWindow)?void 0:e.window)&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xi(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,gl.get())};t()}}ml.currentPopupAction=null;let vl="pendingRedirect",_l=new Map;class yl extends fl{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let t=_l.get(this.auth._key());if(!t){try{let e=await(async(e,t)=>{var r,n=Tl(t),i=Il(e);return!!await i._isAvailable()&&(r="true"===await i._get(n),await i._remove(n),r)})(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}_l.set(this.auth._key(),t)}return this.bypassAuthState||_l.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)this.resolve(null);else if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function wl(e,t){return Il(e)._set(Tl(t),"true")}function bl(e,t){_l.set(e._key(),t)}function Il(e){return Vs(e._redirectPersistence)}function Tl(e){return Bs(vl,e.config.apiKey,e.name)}function El(e,t,r){return(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(es(e)):(n=ia(e),ts(e,t,Ma),await n._initializationPromise,await wl(i=hl(n,r),n),i._openRedirect(n,t,"signInViaRedirect"))})(e,t,r)}function Cl(e,t,r){return(async(e,t,r)=>{var n=w(e);if(ts(n.auth,t,Ma),h(n.auth.app))return Promise.reject(es(n.auth));await n.auth._initializationPromise;var i=hl(n.auth,r),s=(await wl(i,n.auth),await Al(n));return i._openRedirect(n.auth,t,"reauthViaRedirect",s)})(e,t,r)}function Sl(e,t,r){return(async(e,t,r)=>{var n=w(e),i=(ts(n.auth,t,Ma),await n.auth._initializationPromise,hl(n.auth,r)),s=(await Xa(!1,n,t.providerId),await wl(i,n.auth),await Al(n));return i._openRedirect(n.auth,t,"linkViaRedirect",s)})(e,t,r)}async function kl(e,t,r=!1){var n,i;return h(e.app)?Promise.reject(es(e)):(i=hl(n=ia(e),t),(i=await new yl(n,i,r).execute())&&!r&&(delete i.user._redirectEventId,await n._persistUserIfCurrent(i.user),await n._setRedirectUser(null,t)),i)}async function Al(e){var t=Fo(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Nl{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(r=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!(e=>{switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return 1;case"unknown":return Pl(e);default:return}})(t)||(this.hasHandledPotentialRedirect=!0,r)||(this.queuedRedirectEvent=t,r=!0),r}sendToConsumer(e,t){var r;e.error&&!Pl(e)?(r=(null==(r=e.error.code)?void 0:r.split("auth/")[1])||"internal-error",t.onError(Xi(this.auth,r))):t.onAuthEvent(e)}isEventForConsumer(e,t){var r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Rl(e))}saveEventToCache(e){this.cachedEventUids.add(Rl(e)),this.lastProcessedEventTime=Date.now()}}function Rl(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Pl({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Dl(e,t={}){return gs(e,"GET","/v1/projects",t)}let xl=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ol=/^https?/;async function Ml(e){if(!e.config.emulator){var t,r=(await Dl(e)).authorizedDomains;for(t of r)try{if((e=>{var t,r=ss(),{protocol:n,hostname:i}=new URL(r);return e.startsWith("chrome-extension://")?""===(t=new URL(e)).hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===r.replace("chrome-extension://",""):"chrome-extension:"===n&&t.hostname===i:Ol.test(n)&&(xl.test(e)?i===e:(r=e.replace(/\./g,"\\."),(t=new RegExp("^(.+\\."+r+"|"+r+")$","i")).test(i)))})(t))return}catch(e){}Ji(e,"unauthorized-domain")}}let Ll=new ls(3e4,6e4);function Fl(){var t=Vo().___jsl;if(null!=t&&t.H)for(var r of Object.keys(t.H))if(t.H[r].r=t.H[r].r||[],t.H[r].L=t.H[r].L||[],t.H[r].r=[...t.H[r].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}function Ul(i){return new Promise((e,t)=>{var r;function n(){Fl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Fl(),t(Xi(i,"network-request-failed"))},timeout:Ll.get()})}if(null!=(r=null==(r=Vo().gapi)?void 0:r.iframes)&&r.Iframe)e(gapi.iframes.getContext());else{if(null==(r=Vo().gapi)||!r.load)return r=la("iframefcb"),Vo()[r]=()=>{gapi.load?n():t(Xi(i,"network-request-failed"))},oa(aa.gapiScript+"?onload="+r).catch(e=>t(e));n()}}).catch(e=>{throw Vl=null,e})}let Vl=null;let ql=new ls(5e3,15e3),jl="__/auth/iframe",Bl="emulator/auth/iframe",zl={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kl=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Wl(a){e=a;var e,t,r,n=await(Vl=Vl||Ul(e)),i=Vo().gapi;return m(i,a,"internal-error"),n.open({where:document.body,url:(m((n=(e=a).config).authDomain,e,"auth-domain-config-required"),t=n.emulator?hs(n,Bl):`https://${e.config.authDomain}/`+jl,n={apiKey:n.apiKey,appName:e.name,v:Ut},(r=Kl.get(e.config.apiHost))&&(n.eid=r),(r=e._getFrameworks()).length&&(n.fw=r.join(",")),t+"?"+Re(n).slice(1)),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zl,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});let r=Xi(a,"network-request-failed"),n=Vo().setTimeout(()=>{t(r)},ql.get());function i(){Vo().clearTimeout(n),e(s)}s.ping(i).then(i,()=>{t(r)})}))}let Hl={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Gl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function $l(e,t,r,n=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let o="";var l,s=Object.assign(Object.assign({},Hl),{width:n.toString(),height:i.toString(),top:s,left:a}),a=ae().toLowerCase(),s=(r&&(o=Gs(a)?"_blank":r),Ws(a)&&(t=t||"http://localhost",s.scrollbars="yes"),Object.entries(s).reduce((e,[t,r])=>""+e+t+`=${r},`,""));if([n=ae()]=[a],Xs(n)&&null!=(a=window.navigator)&&a.standalone&&"_self"!==o)return i=t||"",r=o,(a=document.createElement("a")).href=i,a.target=r,(l=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l),new Gl(null);a=window.open(t||"",o,s);m(a,e,"popup-blocked");try{a.focus()}catch(e){}return new Gl(a)}let Ql="__/auth/handler",Yl="emulator/auth/handler",Jl=encodeURIComponent("fac");async function Xl(e,t,r,n,i,s){m(e.config.authDomain,e,"auth-domain-config-required"),m(e.config.apiKey,e,"invalid-api-key");var a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:Ut,eventId:i};if(t instanceof Ma){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",Se(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,l]of Object.entries(s||{}))a[o]=l}t instanceof La&&0<(c=t.getScopes().filter(e=>""!==e)).length&&(a.scopes=c.join(",")),e.tenantId&&(a.tid=e.tenantId);var h,u=a;for(h of Object.keys(u))void 0===u[h]&&delete u[h];var c=await e._getAppCheckToken(),c=c?`#${Jl}=`+encodeURIComponent(c):"";return`${r=[e.config][0],r.emulator?hs(r,Yl):`https://${r.authDomain}/`+Ql}?`+Re(u).slice(1)+c}let Zl="webStorageSupport";class eh{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mo,this._completeRedirectFn=kl,this._overrideRedirectResult=bl}async _openPopup(e,t,r,n){is(null==(i=this.eventManagers[e._key()])?void 0:i.manager,"_initialize() not called before _openPopup()");var i=await Xl(e,t,r,ss(),n);return $l(e,i,Fo())}async _openRedirect(e,t,r,n){await this._originValidation(e);var i=await Xl(e,t,r,ss(),n);return Vo().location.href=i,new Promise(()=>{})}_initialize(e){let r=e._key();if(this.eventManagers[r]){let{manager:e,promise:t}=this.eventManagers[r];return e?Promise.resolve(e):(is(t,"If manager is not set, promise should be"),t)}let t=this.initAndGetManager(e);return this.eventManagers[r]={promise:t},t.catch(()=>{delete this.eventManagers[r]}),t}async initAndGetManager(t){var e=await Wl(t);let r=new Nl(t);return e.register("authEvent",e=>(m(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:r.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=e,r}_isIframeWebStorageSupported(r,n){this.iframes[r._key()].send(Zl,{type:Zl},e=>{var t=null==(t=null==e?void 0:e[0])?void 0:t[Zl];void 0!==t&&n(!!t),Ji(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ml(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Zs()||Hs()||Xs()}}let th=eh;class rh extends class{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ns("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rh(e)}_finalizeEnroll(e,t,r){return e=e,t={idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()},gs(e,"POST","/v2/accounts/mfaEnrollment:finalize",fs(e,t))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},gs(e,"POST","/v2/accounts/mfaSignIn:finalize",fs(e,t))}}class nh{constructor(){}static assertion(e){return rh._fromCredential(e)}}nh.FACTOR_ID="phone";sr="@firebase/auth";class ih{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){m(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var sh;function ah(){return window}t="authIdTokenMaxAge",null!=(ar=Y())&&ar["_"+t],aa={loadJS(i){return new Promise((e,r)=>{var t,n=document.createElement("script");n.setAttribute("src",i),n.onload=e,n.onerror=e=>{var t=Xi("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(null!=(t=null==(t=document.getElementsByTagName("head"))?void 0:t[0])?t:document).appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},sh="Browser",Pt(new u("auth",(e,{options:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options,s=(m(s&&!s.includes(":"),"invalid-api-key",{appName:r.name}),{apiKey:s,authDomain:a,clientPlatform:sh,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ea(sh)}),a=new na(r,n,i,s);return e=a,r=(null==(t=t)?void 0:t.persistence)||[],r=(Array.isArray(r)?r:[r]).map(Vs),null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver),a},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Pt(new u("auth-internal",e=>{var t=ia(e.getProvider("auth").getImmediate());return e=t,new ih(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),d(sr,"1.10.4",(e=>{switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}})(sh)),d(sr,"1.10.4","esm2017");async function oh(e,t,r){var n=ah().BuildInfo,i=(is(t.sessionId,"AuthEvent did not contain a session ID"),i=(e=>{if(is(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);var t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r})(t.sessionId),i=await crypto.subtle.digest("SHA-256",i),await(i=Array.from(new Uint8Array(i))).map(e=>e.toString(16).padStart(2,"0")).join("")),s={};return Xs()?s.ibi=n.packageName:Qs()?s.apn=n.packageName:Ji(e,"operation-not-supported-in-this-environment"),n.displayName&&(s.appDisplayName=n.displayName),s.sessionId=i,Xl(e,r,t.type,void 0,null!=(n=t.eventId)?n:void 0,s)}function lh(n){let i=ah().cordova;return new Promise(r=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(n):t=i.InAppBrowser.open(n,(e=ae(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),r(t)})})}let hh=20;class uh extends Nl{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInitialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function ch(e,t,r=null){return{type:t,eventId:r,urlResponse:null,sessionId:(()=>{var e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<hh;n++){var r=Math.floor(Math.random()*t.length);e.push(t.charAt(r))}return e.join("")})(),postBody:null,tenantId:e.tenantId,error:Xi(e,"no-auth-event")}}async function dh(e){var t=await fh()._get(gh(e));return t&&await fh()._remove(gh(e)),t}function ph(e,t){i=mh(t=t),n=i.link?decodeURIComponent(i.link):void 0,r=mh(n).link,i=i.deep_link_id?decodeURIComponent(i.deep_link_id):void 0;var r,n,i=mh(i).link||i||r||n||t;return i.includes("/__/auth/callback")?(n=(r=null==(n=null==(r=null==(n=(r=mh(i)).firebaseError?(e=>{try{return JSON.parse(e)}catch(e){return null}})(decodeURIComponent(r.firebaseError)):null)?void 0:n.code)?void 0:r.split("auth/"))?void 0:n[1])?Xi(r):null)?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:n,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}:null}function fh(){return Vs(xo)}function gh(e){return Bs("authEvent",e.config.apiKey,e.name)}function mh(e){var t,r;return null!=e&&e.includes("?")?([t,...r]=e.split("?"),Pe(r.join("?"))):{}}class vh{constructor(){this._redirectPersistence=Mo,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=kl,this._overrideRedirectResult=bl}async _initialize(e){var t=e._key();let r=this.eventManagers.get(t);return r||(r=new uh(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){Ji(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,n){i=e,a=ah(),m("function"==typeof(null==(s=null==a?void 0:a.universalLinks)?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),m(void 0!==(null==(s=null==a?void 0:a.BuildInfo)?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),m("function"==typeof(null==(s=null==(s=null==(s=null==a?void 0:a.cordova)?void 0:s.plugins)?void 0:s.browsertab)?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),m("function"==typeof(null==(s=null==(s=null==(s=null==a?void 0:a.cordova)?void 0:s.plugins)?void 0:s.browsertab)?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),m("function"==typeof(null==(a=null==(s=null==a?void 0:a.cordova)?void 0:s.InAppBrowser)?void 0:a.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});var i,s=await this._initialize(e),a=(await s.initialized(),s.resetRedirect(),_l.clear(),await this._originValidation(e),ch(e,r,n)),a=(i=e,r=a,await fh()._set(gh(i),r),await oh(e,a,t));return(async(a,o,l)=>{let h=ah().cordova,u=()=>{};try{await new Promise((t,e)=>{let r=null;function n(){t();var e=null==(e=h.plugins.browsertab)?void 0:e.close;"function"==typeof e&&e(),"function"==typeof(null==l?void 0:l.close)&&l.close()}function i(){r=r||window.setTimeout(()=>{e(Xi(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null==document?void 0:document.visibilityState)&&i()}o.addPassiveListener(n),document.addEventListener("resume",i,!1),Qs()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(n),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),r&&window.clearTimeout(r)}})}finally{u()}})(e,s,await lh(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=(async e=>{var t=ah().BuildInfo,r={};Xs()?r.iosBundleId=t.packageName:Qs()?r.androidPackageName=t.packageName:Ji(e,"operation-not-supported-in-this-environment"),await Dl(e,r)})(e)),this.originValidationPromises[t]}attachCallbackListeners(n,i){var{universalLinks:e,handleOpenURL:t,BuildInfo:r}=ah();let s=setTimeout(async()=>{await dh(n),i.onEvent(yh())},500),a=async e=>{clearTimeout(s);var t=await dh(n);let r=null;t&&null!=e&&e.url&&(r=ph(t,e.url)),i.onEvent(r||yh())},o=(void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a),t),l=r.packageName.toLowerCase()+"://";ah().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(l)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}}let _h=vh;function yh(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Xi("no-auth-event")}}function wh(){var e;return(null==(e=null==self?void 0:self.location)?void 0:e.protocol)||null}function bh(e=ae()){return!("file:"!==wh()&&"ionic:"!==wh()&&"capacitor:"!==wh()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ih(e=ae()){return de()&&11===(null==document?void 0:document.documentMode)||([e=ae()]=[e],/Edge\/\d+/.test(e))}function Th(){try{var e=self.localStorage,t=Fo();if(e)return e.setItem(t,"1"),e.removeItem(t),!Ih()||ge()}catch(e){return Eh()&&ge()}return!1}function Eh(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ch(){return("http:"===wh()||"https:"===wh()||ue()||bh())&&!(ce()||le())&&Th()&&!Eh()}function Sh(){return bh()&&"undefined"!=typeof document}let kh={LOCAL:"local",NONE:"none",SESSION:"session"},Ah=m,Nh="persistence";async function Rh(e){await e._initializationPromise;var t=Ph(),r=Bs(Nh,e.config.apiKey,e.name);t&&t.setItem(r,e._getPersistenceType())}function Ph(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}let Dh=m;class xh{constructor(){this.browserResolver=Vs(th),this.cordovaResolver=Vs(_h),this.underlyingResolver=null,this._redirectPersistence=Mo,this._completeRedirectFn=kl,this._overrideRedirectResult=bl}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,n)}async _openRedirect(e,t,r,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,n)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Sh()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Dh(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Sh()&&new Promise(e=>{let t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Oh(e){return e.unwrap()}function Mh(e,t){var r,n,i,s,a=null==(a=t.customData)?void 0:a._tokenResponse;"auth/multi-factor-auth-required"===(null==t?void 0:t.code)?t.resolver=new Vh(e,(r=t,i=w(e),m((s=r).customData.operationType,i,"argument-error"),m(null==(n=s.customData._serverResponse)?void 0:n.mfaPendingCredential,i,"argument-error"),So._fromError(i,s))):a&&(i=Lh(n=t))&&(n.credential=i,n.tenantId=a.tenantId||void 0,n.email=a.email||void 0,n.phoneNumber=a.phoneNumber||void 0)}function Lh(e){var t=(e instanceof _e?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof _e)&&"temporaryProof"in t&&"phoneNumber"in t)return ll.credentialFromResult(e);var r=t.providerId;if(!r||r===zi.PASSWORD)return null;let n;switch(r){case zi.GOOGLE:n=Va;break;case zi.FACEBOOK:n=Ua;break;case zi.GITHUB:n=qa;break;case zi.TWITTER:n=za;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:l}=t;return s||a||i||o?o?r.startsWith("saml.")?ja._create(r,o):Na._fromParams({providerId:r,signInMethod:r,pendingToken:o,idToken:i,accessToken:s}):new Fa(r).credential({idToken:i,accessToken:s,rawNonce:l}):null}return e instanceof _e?n.credentialFromError(e):n.credentialFromResult(e)}function Fh(t,e){return e.catch(e=>{throw e instanceof _e&&Mh(t,e),e}).then(e=>{var t=e.operationType,r=e.user;return{operationType:t,credential:Lh(e),additionalUserInfo:Eo(e),user:qh.getOrCreate(r)}})}async function Uh(t,e){let r=await e;return{verificationId:r.verificationId,confirm:e=>Fh(t,r.confirm(e))}}class Vh{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Fh(Oh(this.auth),this.resolver.resolveSignIn(e))}}class qh{constructor(e){var t;this._delegate=e,this.multiFactor=(t=w(e),No.has(t)||No.set(t,Ao._fromUser(t)),No.get(t))}static getOrCreate(e){return qh.USER_MAP.has(e)||qh.USER_MAP.set(e,new qh(e)),qh.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Fh(this.auth,ro(this._delegate,e))}async linkWithPhoneNumber(e,t){return Uh(this.auth,(async(e,t,r)=>{let n=w(e);await Xa(!1,n,"phone");var i=await al(n.auth,t,w(r));return new sl(i,e=>ro(n,e))})(this._delegate,e,t))}async linkWithPopup(e){return Fh(this.auth,(async(e,t,r)=>{var n=w(e),i=(ts(n.auth,t,Ma),hl(n.auth,r));return new ml(n.auth,"linkViaPopup",t,i,n).executeNotNull()})(this._delegate,e,xh))}async linkWithRedirect(e){return await Rh(ia(this.auth)),Sl(this._delegate,e,xh)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Fh(this.auth,no(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Uh(this.auth,(async(e,t,r)=>{let n=w(e);var i;return h(n.auth.app)?Promise.reject(es(n.auth)):(i=await al(n.auth,t,w(r)),new sl(i,e=>no(n,e)))})(this._delegate,e,t))}reauthenticateWithPopup(e){return Fh(this.auth,(async(e,t,r)=>{var n=w(e);if(h(n.auth.app))return Promise.reject(Xi(n.auth,"operation-not-supported-in-this-environment"));ts(n.auth,t,Ma);var i=hl(n.auth,r);return new ml(n.auth,"reauthViaPopup",t,i,n).executeNotNull()})(this._delegate,e,xh))}async reauthenticateWithRedirect(e){return await Rh(ia(this.auth)),Cl(this._delegate,e,xh)}sendEmailVerification(e){return fo(this._delegate,e)}async unlink(e){return await Ya(this._delegate,e),this}updateEmail(e){return t=this._delegate,e=e,h((r=w(t)).auth.app)?Promise.reject(es(r.auth)):vo(r,e,null);var t,r}updatePassword(e){return vo(w(this._delegate),null,e)}updatePhoneNumber(e){return(async(e,t)=>{var r=w(e);if(h(r.auth.app))return Promise.reject(es(r.auth));await Ja(r,t)})(this._delegate,e)}updateProfile(e){return mo(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return go(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}qh.USER_MAP=new WeakMap;let jh=m;class Bh{constructor(e,t){var r,n;this.app=e,t.isInitialized()?this._delegate=t.getImmediate():(r=e.options.apiKey,jh(r,"invalid-api-key",{appName:e.name}),jh(r,"invalid-api-key",{appName:e.name}),n="undefined"!=typeof window?xh:void 0,this._delegate=t.initialize({options:{persistence:((e,t)=>{var r=((e,t)=>{var r=Ph();if(!r)return[];var n=Bs(Nh,e,t);switch(r.getItem(n)){case kh.NONE:return[js];case kh.LOCAL:return[Yo,Mo];case kh.SESSION:return[Mo];default:return[]}})(e,t);if("undefined"==typeof self||r.includes(Yo)||r.push(Yo),"undefined"!=typeof window)for(var n of[xo,Mo])r.includes(n)||r.push(n);return r.includes(js)||r.push(js),r})(r,e.name),popupRedirectResolver:n}}),this._delegate._updateErrorMap(Hi)),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?qh.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){va(this._delegate,e,t)}applyActionCode(e){return uo(this._delegate,e)}checkActionCode(e){return co(this._delegate,e)}confirmPasswordReset(e,t){return(async(t,e,r)=>{await ba(w(t),{oobCode:e,newPassword:r}).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ho(t),e})})(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Fh(this._delegate,(async(t,e,r)=>{var n,i;return h(t.app)?Promise.reject(es(t)):(i=await ma(n=ia(t),{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ka,"EMAIL_PASSWORD_PROVIDER").catch(e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ho(t),e}),i=await Wa._fromIdTokenResponse(n,"signIn",i),await n._updateCurrentUser(i.user),i)})(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return po(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=xa.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){jh(Ch(),this._delegate,"operation-not-supported-in-this-environment");e=this._delegate,t=xh,await ia(e)._initializationPromise;var e,t,r=await kl(e,t,!1);return r?Fh(this._delegate,Promise.resolve(r)):{credential:null,user:null}}addFrameworkForLogging(e){ia(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,r){var{next:n,error:i,complete:s}=zh(e,t,r);return this._delegate.onAuthStateChanged(n,i,s)}onIdTokenChanged(e,t,r){var{next:n,error:i,complete:s}=zh(e,t,r);return this._delegate.onIdTokenChanged(n,i,s)}sendSignInLinkToEmail(e,t){return(async(e,t,r)=>{let n=ia(e);var i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};e=i,m((t=r).handleCodeInApp,n,"argument-error"),t&&lo(n,e,t),await ma(n,i,"getOobCode",Sa,"EMAIL_PASSWORD_PROVIDER")})(this._delegate,e,t)}sendPasswordResetEmail(e,t){return(async(e,t,r)=>{var n=ia(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};r&&lo(n,i,r),await ma(n,i,"getOobCode",Ca,"EMAIL_PASSWORD_PROVIDER")})(this._delegate,e,t||void 0)}async setPersistence(e){var t,r;t=this._delegate,r=e,Ah(Object.values(kh).includes(r),t,"invalid-persistence-type"),ce()?Ah(r!==kh.SESSION,t,"unsupported-persistence-type"):le()?Ah(r===kh.NONE,t,"unsupported-persistence-type"):Eh()?Ah(r===kh.NONE||r===kh.LOCAL&&ge(),t,"unsupported-persistence-type"):Ah(r===kh.NONE||Th(),t,"unsupported-persistence-type");let n;switch(e){case kh.SESSION:n=Mo;break;case kh.LOCAL:var i=await Vs(Yo)._isAvailable();n=i?Yo:xo;break;case kh.NONE:n=js;break;default:return Ji("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(n)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Fh(this._delegate,(async e=>{var t,r;return h(e.app)?Promise.reject(es(e)):(await(t=ia(e))._initializationPromise,null!=(r=t.currentUser)&&r.isAnonymous?new Wa({user:t.currentUser,providerId:null,operationType:"signIn"}):(r=await Ka(t,{returnSecureToken:!0}),r=await Wa._fromIdTokenResponse(t,"signIn",r,!0),await t._updateCurrentUser(r.user),r))})(this._delegate))}signInWithCredential(e){return Fh(this._delegate,to(this._delegate,e))}signInWithCustomToken(e){return Fh(this._delegate,io(this._delegate,e))}signInWithEmailAndPassword(e,t){return Fh(this._delegate,(r=this._delegate,e=e,t=t,h(r.app)?Promise.reject(es(r)):to(w(r),Oa.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ho(r),e})));var r}signInWithEmailLink(e,t){return Fh(this._delegate,(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(es(e)):(n=w(e),m((i=Oa.credentialWithLink(t,r||ss()))._tenantId===(n.tenantId||null),n,"tenant-id-mismatch"),to(n,i))})(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Uh(this._delegate,(async(e,t,r)=>{if(h(e.app))return Promise.reject(es(e));let n=ia(e);var i=await al(n,t,w(r));return new sl(i,e=>to(n,e))})(this._delegate,e,t))}async signInWithPopup(e){return jh(Ch(),this._delegate,"operation-not-supported-in-this-environment"),Fh(this._delegate,(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(Xi(e,"operation-not-supported-in-this-environment")):(n=ia(e),ts(e,t,Ma),i=hl(n,r),new ml(n,"signInViaPopup",t,i).executeNotNull())})(this._delegate,e,xh))}async signInWithRedirect(e){return jh(Ch(),this._delegate,"operation-not-supported-in-this-environment"),await Rh(this._delegate),El(this._delegate,e,xh)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return(async(e,t)=>{var r=(await co(w(e),t)).data;return r.email})(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function zh(e,t,r){let n=e,i=("function"!=typeof e&&({next:n,error:t,complete:r}=e),n);return{next:e=>i(e&&qh.getOrCreate(e)),error:t,complete:r}}Bh.Persistence=kh;class Kh{static credential(e,t){return ll.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new ll(Oh(or.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Kh.PHONE_SIGN_IN_METHOD=ll.PHONE_SIGN_IN_METHOD,Kh.PROVIDER_ID=ll.PROVIDER_ID;let Wh=m;class Hh{constructor(e,t,r=or.app()){var n;Wh(null==(n=r.options)?void 0:n.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new il(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(t=or).INTERNAL.registerComponent(new u("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new Bh(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Ki.EMAIL_SIGNIN,PASSWORD_RESET:Ki.PASSWORD_RESET,RECOVER_EMAIL:Ki.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Ki.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Ki.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Ki.VERIFY_EMAIL}},EmailAuthProvider:Oa,FacebookAuthProvider:Ua,GithubAuthProvider:qa,GoogleAuthProvider:Va,OAuthProvider:Fa,SAMLAuthProvider:Ba,PhoneAuthProvider:Kh,PhoneMultiFactorGenerator:nh,RecaptchaVerifier:Hh,TwitterAuthProvider:za,Auth:Bh,AuthCredential:wa,Error:_e}).setInstantiationMode("LAZY").setMultipleInstances(!1)),t.registerVersion("@firebase/auth-compat","0.5.24");let Gh="@firebase/database",$h="";function Qh(e){$h=e}class Yh{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ie(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:be(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Jh{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ee(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}function Xh(e){try{var t;if("undefined"!=typeof window&&void 0!==window[e])return(t=window[e]).setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Yh(t)}catch(e){}return new Jh}var Zh;function eu(e){var t=(t=>{var r,n,i=[];let s=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);55296<=e&&e<=56319&&(r=e-55296,a++,g(a<t.length,"Surrogate pair missing trail surrogate."),n=t.charCodeAt(a)-56320,e=65536+(r<<10)+n),e<128?i[s++]=e:(e<2048?i[s++]=e>>6|192:(e<65536?i[s++]=e>>12|224:(i[s++]=e>>18|240,i[s++]=e>>12&63|128),i[s++]=e>>6&63|128),i[s++]=63&e|128)}return i})(e),r=new xe,t=(r.update(t),r.digest());return a.encodeByteArray(t)}function tu(t){return function(...e){gu(t,...e)}}function ru(...e){var t="FIREBASE INTERNAL ERROR: "+cu(...e);hu.error(t)}function nu(e,t){return e===t?0:e<t?-1:1}function iu(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ie(t))}function su(e){if("object"!=typeof e||null===e)return Ie(e);var t,r=[];for(t in e)r.push(t);r.sort();let n="{";for(let i=0;i<r.length;i++)0!==i&&(n+=","),n=(n=n+Ie(r[i])+":")+su(e[r[i]]);return n+="}"}function au(e,t){var r=e.length;if(r<=t)return[e];var n=[];for(let i=0;i<r;i+=t)i+t>r?n.push(e.substring(i,r)):n.push(e.substring(i,i+t));return n}let ou=Xh("localStorage"),lu=Xh("sessionStorage"),hu=new et("@firebase/database"),uu=(()=>{let e=1;return function(){return e++}})(),cu=function(...e){let t="";for(let n=0;n<e.length;n++){var r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=cu.apply(null,r):t+="object"==typeof r?Ie(r):r,t+=" "}return t},du=null,pu=!0,fu=function(e,t){g(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(hu.logLevel=c.VERBOSE,du=hu.log.bind(hu),t&&lu.set("logging_enabled",!0)):"function"==typeof e?du=e:(du=null,lu.remove("logging_enabled"))},gu=function(...e){var t;!0===pu&&(pu=!1,null===du)&&!0===lu.get("logging_enabled")&&fu(!0),du&&(t=cu.apply(null,e),du(t))},mu=function(...e){var t="FIREBASE FATAL ERROR: "+cu(...e);throw hu.error(t),new Error(t)},vu=function(...e){var t="FIREBASE WARNING: "+cu(...e);hu.warn(t)},_u=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&vu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},yu=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},wu="[MIN_NAME]",bu="[MAX_NAME]",Iu=function(e,t){var r,n;return e===t?0:e===wu||t===bu?-1:t===wu||e===bu?1:(r=Cu(e),n=Cu(t),null!==r?null!==n?r-n==0?e.length-t.length:r-n:-1:null===n&&e<t?-1:1)};function Tu(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}function Eu(e){g(!yu(e),"Invalid JSON number");let t,r,n,i,s;0===e?(r=0,n=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),n=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),r=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(r=0,Math.round(e/Math.pow(2,-1074))));var a=[];for(s=52;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);for(s=11;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);a.push(t?1:0),a.reverse();var o=a.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()}function Cu(e){if(ku.test(e)){var t=Number(e);if(t>=Au&&t<=Nu)return t}return null}function Su(e,t){var r=setTimeout(e,t);return"number"==typeof r&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(r):"object"==typeof r&&r.unref&&r.unref(),r}let ku=new RegExp("^-?(0*)\\d{1,10}$"),Au=-2147483648,Nu=2147483647,Ru=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw vu("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Pu{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,h(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(r){if(this.serverAppAppCheckToken){if(r)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(r):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(r).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!=(e=this.appCheckProvider)&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){vu(`Provided AppCheck credentials for the app named "${this.appName}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Du{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(e=>this.auth_=e)}getToken(r){return this.auth_?this.auth_.getToken(r).catch(e=>e&&"auth/token-not-initialized"===e.code?(gu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(r).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',vu(e)}}class xu{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}xu.OWNER="owner";let Ou=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Mu="websocket",Lu="long_polling";class Fu{constructor(e,t,r,n,i=!1,s="",a=!1,o=!1,l=null){this.secure=t,this.namespace=r,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ou.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost())&&ou.set("host:"+this._host,this.internalHost)}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t}}function Uu(e,t,r){g("string"==typeof t,"typeof type must == string"),g("object"==typeof r,"typeof params must == object");let n;if(t===Mu)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Lu)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(r.ns=e.namespace);let i=[];return Tu(r,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}class Vu{constructor(){this.counters_={}}incrementCounter(e,t=1){Ee(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return W(void 0,this.counters_)}}let qu={},ju={};function Bu(e){var t=e.toString();return qu[t]||(qu[t]=new Vu),qu[t]}class zu{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Ru(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Ku{constructor(e,t,r,n,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tu(e),this.stats_=Bu(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Uu(t,Lu,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new zu(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4));var r=()=>{var e;this.isClosed_||(this.scriptTagHolder=new Wu((...e)=>{var[t,r,n,,,]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=r,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);r?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(r,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,r]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,r)},()=>{this.onClosed_()},this.urlFn),(e={start:"t"}).ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Ou.test(location.hostname)&&(e.r="f"),e=this.urlFn(e),this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{}))};if("complete"===document.readyState)r();else{let e=!1,t=function(){document.body?e||(e=!0,r()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ku.forceAllow_=!0}static forceDisallow(){Ku.forceDisallow_=!0}static isAvailable(){return!!Ku.forceAllow_||!(Ku.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=Ie(e),t=(this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length),o(t)),r=au(t,1840);for(let n=0;n<r.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[n]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");var r={dframe:"t"};r.id=e,r.pw=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=Ie(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Wu{constructor(t,r,e,n){this.onDisconnect=e,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=uu(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=r,this.myIFrame=Wu.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){gu("frame writing exception"),e.stack&&gu(e.stack),gu(e)}}}static createIFrame_(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||gu("No IE domain setting required")}catch(e){var r=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var r={},r=(r.id=this.myID,r.pw=this.myPW,r.ser=this.currentSerial,this.urlFn(r));let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var n=this.pendingSegs.shift();e=e+"&seg"+t+"="+n.seg+"&ts"+t+"="+n.ts+"&d"+t+"="+n.d,t++}return r+=e,this.addLongPollTag_(r,this.currentSerial),!0}return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(r,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),r()})}addTag(e,r){setTimeout(()=>{try{if(this.sendNewPolls){let t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),r())},t.onerror=()=>{gu("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}}catch(e){}},Math.floor(1))}}let Hu=null;"undefined"!=typeof MozWebSocket?Hu=MozWebSocket:"undefined"!=typeof WebSocket&&(Hu=WebSocket);class Gu{constructor(e,t,r,n,i,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tu(this.connId),this.stats_=Bu(t),this.connURL=Gu.connectionURL_(t,s,a,n,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,n,i){var s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Ou.test(location.hostname)&&(s.r="f"),t&&(s.s=t),r&&(s.ls=r),n&&(s.ac=n),i&&(s.p=i),Uu(e,Mu,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ou.set("previous_websocket_failure",!0);try{pe(),this.mySock=new Hu(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var r=e.message||e.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Gu.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return!(e="undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4?!0:e)&&null!==Hu&&!Gu.forceDisallow_}static previouslyFailed(){return ou.isInMemoryStorage||!0===ou.get("previous_websocket_failure")}markConnectionHealthy(){ou.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=be(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(g(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=Ie(e),r=(this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length),au(t,16384));1<r.length&&this.sendString_(String(r.length));for(let n=0;n<r.length;n++)this.sendString_(r[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Gu.responsesRequiredToBeHealthy=2,Gu.healthyTimeout=3e4;class $u{static get ALL_TRANSPORTS(){return[Ku,Gu]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){var t=Gu&&Gu.isAvailable();let r=t&&!Gu.previouslyFailed();if(e.webSocketOnly&&(t||vu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Gu];else{var n,i=this.transports_=[];for(n of $u.ALL_TRANSPORTS)n&&n.isAvailable()&&i.push(n);$u.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}$u.globalTransportInitialized_=!1;class Qu{constructor(e,t,r,n,i,s,a,o,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tu("c:"+this.id+":"),this.transportManager_=new $u(t),this.log_("Connection created"),this.start_()}start_(){var e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));e=e.healthyTimeout||0;0<e&&(this.healthyTimeout_=Su(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(e)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=iu("t",e),r=iu("d",e);if("c"===t)this.onSecondaryControl_(r);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=iu("t",e),r=iu("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=iu("t",e);if("d"in e){var r=e.d;if("h"===t){var n=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(n.h=this.repoInfo_.host),this.onHandshake_(n)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(r):"r"===t?this.onReset_(r):"e"===t?ru("Server Error: "+r):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ru("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,r=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==r&&vu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Su(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Su(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ou.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_)&&(this.onDisconnect_(),this.onDisconnect_=null)}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Yu{put(e,t,r,n){}merge(e,t,r,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class Ju{constructor(e){this.allowedEvents_=e,this.listeners_={},g(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...r){if(Array.isArray(this.listeners_[t])){var n=[...this.listeners_[t]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,r)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});var n=this.getInitialEvent(e);n&&t.apply(r,n)}off(e,t,r){this.validateEventType_(e);var n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!r||r===n[i].context))return void n.splice(i,1)}validateEventType_(t){g(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Xu extends Ju{static getInstance(){return new Xu}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||oe()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return g("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}let Zu=32,ec=768;class f{constructor(r,e){if(void 0===e){this.pieces_=r.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=r,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function v(){return new f("")}function _(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function tc(e){return e.pieces_.length-e.pieceNum_}function y(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new f(e.pieces_,t)}function rc(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function nc(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ic(e){if(e.pieceNum_>=e.pieces_.length)return null;var t=[];for(let r=e.pieceNum_;r<e.pieces_.length-1;r++)t.push(e.pieces_[r]);return new f(t,0)}function sc(e,t){var r=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)r.push(e.pieces_[i]);if(t instanceof f)for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);else{var n=t.split("/");for(let e=0;e<n.length;e++)0<n[e].length&&r.push(n[e])}return new f(r,0)}function b(e){return e.pieceNum_>=e.pieces_.length}function ac(e,t){var r=_(e),n=_(t);if(null===r)return t;if(r===n)return ac(y(e),y(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function oc(e,t){var r=nc(e,0),n=nc(t,0);for(let s=0;s<r.length&&s<n.length;s++){var i=Iu(r[s],n[s]);if(0!==i)return i}return r.length===n.length?0:r.length<n.length?-1:1}function lc(e,t){if(tc(e)!==tc(t))return!1;for(let r=e.pieceNum_,n=t.pieceNum_;r<=e.pieces_.length;r++,n++)if(e.pieces_[r]!==t.pieces_[n])return!1;return!0}function hc(e,t){let r=e.pieceNum_,n=t.pieceNum_;if(tc(e)>tc(t))return!1;for(;r<e.pieces_.length;){if(e.pieces_[r]!==t.pieces_[n])return!1;++r,++n}return!0}class uc{constructor(e,t){this.errorPrefix_=t,this.parts_=nc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=qe(this.parts_[r]);cc(this)}}function cc(e){if(e.byteLength_>ec)throw new Error(e.errorPrefix_+"has a key path longer than "+ec+" bytes ("+e.byteLength_+").");if(e.parts_.length>Zu)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Zu+") or object contains a cycle "+dc(e))}function dc(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class pc extends Ju{static getInstance(){return new pc}constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}getInitialEvent(e){return g("visible"===e,"Unknown event type: "+e),[this.visible_]}}class fc extends Yu{constructor(e,t,r,n,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=fc.nextPersistentConnectionId_++,this.log_=tu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!pe())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");pc.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Xu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){var n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(Ie(i)),g(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[n]=r)}get(e){this.initConnection_();let r=new Z;var t={p:e._path.toString(),q:e._queryObject},t=(this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?r.resolve(t):r.reject(t)}}),this.outstandingGetCount_++,this.outstandingGets_.length-1);return this.connected_&&this.sendGet_(t),r.promise}listen(e,t,r,n){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g(!this.listens.get(s).has(i),"listen() called twice for same path/queryId."),{onComplete:n,hashFn:t,query:e,tag:r});this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(e)})}sendListen_(i){let s=i.query,a=s._path.toString(),o=s._queryIdentifier;this.log_("Listen on "+a+" for "+o);var e={p:a};i.tag&&(e.q=s._queryObject,e.t=i.tag),e.h=i.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,r=e.s,n=(fc.warnOnListenWarnings_(t,s),this.listens.get(a)&&this.listens.get(a).get(o));n===i&&(this.log_("listen response",e),"ok"!==r&&this.removeListen_(a,o),i.onComplete)&&i.onComplete(r,t)})}static warnOnListenWarnings_(e,t){var r,n;e&&"object"==typeof e&&Ee(e,"w")&&(r=Ce(e,"w"),Array.isArray(r))&&~r.indexOf("no_index")&&(r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString(),vu("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${r} at `+n+" to your security rules for better performance."))}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=Te(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_;r=n;var e=!!(e=Te(r).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")?"auth":"gauth",t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,r=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,r))})}var r,e}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,r=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){var r=e._path.toString(),n=e._queryIdentifier,i=(this.log_("Unlisten called for "+r+" "+n),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,n));i&&this.connected_&&this.sendUnlisten_(r,n,e._queryObject,t)}sendUnlisten_(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);var i={p:e};n&&(i.q=r,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,n){var i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,r,n){this.putInternal("p",e,t,r,n)}merge(e,t,r,n){this.putInternal("m",e,t,r,n)}putInternal(e,t,r,n,i){this.initConnection_();var s={p:t,d:r},s=(void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++,this.outstandingPuts_.length-1);this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(t){let r=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;let n=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,e,e=>{this.log_(r+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ie(e));var t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ru("Unrecognized action received from server: "+Ie(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){g(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_),e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this);let e=this.onRealtimeDisconnect_.bind(this);var s=this.id+":"+fc.nextConnectionId_++,a=this.lastSessionId;let t=!1,r=null;var o=function(){r?r.close():(t=!0,e())},l=(this.realtime_={close:o,sendRequest:function(e){g(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)}},this.forceTokenRefresh_);this.forceTokenRefresh_=!1;try{var[h,u]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);t?gu("getToken() completed but was canceled"):(gu("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=u&&u.token,r=new Qu(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,i,e,e=>{vu(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},a))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&vu(e),o())}}}interrupt(e){gu("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){gu("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Se(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;r=t?t.map(e=>su(e)).join("$"):"default";var n=this.removeListen_(e,r);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){var r,n=new f(e).toString();let i;return this.listens.has(n)?(r=this.listens.get(n),i=r.get(t),r.delete(t),0===r.size&&this.listens.delete(n)):i=void 0,i}onAuthRevoked_(e,t){gu("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){gu("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(var e of this.listens.values())for(var t of e.values())this.sendListen_(t);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){var r=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(r.action,r.pathString,r.data,r.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){var e={};e["sdk.js."+$h.replace(/\./g,"-")]=1,oe()?e["framework.cordova"]=1:ce()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Xu.getInstance().currentlyOnline();return Se(this.interruptReasons_)&&e}}fc.nextPersistentConnectionId_=0,fc.nextConnectionId_=0;class p{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new p(e,t)}}class gc{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var r=new p(wu,e),n=new p(wu,t);return 0!==this.compare(r,n)}minPost(){return p.MIN}}let mc;class vc extends gc{static get __EMPTY_NODE(){return mc}static set __EMPTY_NODE(e){mc=e}compare(e,t){return Iu(e.name,t.name)}isDefinedOn(e){throw j("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return p.MIN}maxPost(){return new p(bu,mc)}makePost(e,t){return g("string"==typeof e,"KeyIndex indexValue must always be a string."),new p(e,mc)}toString(){return".key"}}let _c=new vc;class yc{constructor(e,t,r,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){var e;return 0===this.nodeStack_.length?null:(e=this.nodeStack_[this.nodeStack_.length-1],this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value})}}class wc{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:wc.RED,this.left=null!=n?n:Ic.EMPTY_NODE,this.right=null!=i?i:Ic.EMPTY_NODE}copy(e,t,r,n,i){return new wc(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;var i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp_()}removeMin_(){if(this.left.isEmpty())return Ic.EMPTY_NODE;let e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let r,n;if(t(e,(r=this).key)<0)r=(r=r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()?r:r.moveRedLeft_()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed_()?r.rotateRight_():r).right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()?r:r.moveRedRight_()).key)){if(r.right.isEmpty())return Ic.EMPTY_NODE;n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e=(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e}moveRedLeft_(){let e=this.colorFlip_();return e=e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e}moveRedRight_(){let e=this.colorFlip_();return e=e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e}rotateLeft_(){var e=this.copy(null,null,wc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,wc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}wc.RED=!0,wc.BLACK=!1;class bc{copy(e,t,r,n,i){return this}insert(e,t,r){return new wc(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ic{constructor(e,t=Ic.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ic(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,wc.BLACK,null,null))}remove(e){return new Ic(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,wc.BLACK,null,null))}get(e){var t;let r=this.root_;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))return r.value;t<0?r=r.left:0<t&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,n=null;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key))){if(r.left.isEmpty())return n?n.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:0<t&&(r=(n=r).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new yc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new yc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new yc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new yc(this.root_,null,this.comparator_,!0,e)}}function Tc(e,t){return Iu(e.name,t.name)}function Ec(e,t){return Iu(e,t)}Ic.EMPTY_NODE=new bc;let Cc;function Sc(e){return"number"==typeof e?"number:"+Eu(e):"string:"+e}function kc(e){var t;e.isLeafNode()?(t=e.val(),g("string"==typeof t||"number"==typeof t||"object"==typeof t&&Ee(t,".sv"),"Priority must be a string or number.")):g(e===Cc||e.isEmpty(),"priority of unexpected type."),g(e===Cc||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Ac;class Nc{static set __childrenNodeConstructor(e){Ac=e}static get __childrenNodeConstructor(){return Ac}constructor(e,t=Nc.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,g(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),kc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Nc(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Nc.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return b(e)?this:".priority"===_(e)?this.priorityNode_:Nc.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Nc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var r=_(e);return null===r?t:t.isEmpty()&&".priority"!==r?this:(g(".priority"!==r||1===tc(e),".priority must be the last token in a path"),this.updateImmediateChild(r,Nc.__childrenNodeConstructor.EMPTY_NODE.updateChild(y(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Sc(this.priorityNode_.val())+":");var t=typeof this.value_;e=(e+=t+":")+("number"==t?Eu(this.value_):this.value_),this.lazyHash_=eu(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Nc.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Nc.__childrenNodeConstructor?-1:(g(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,r=typeof this.value_,n=Nc.VALUE_TYPE_ORDER.indexOf(t),i=Nc.VALUE_TYPE_ORDER.indexOf(r);return g(0<=n,"Unknown leaf type: "+t),g(0<=i,"Unknown leaf type: "+r),n===i?"object"==r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}Nc.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Rc,Pc;class Dc extends gc{compare(e,t){var r=e.node.getPriority(),n=t.node.getPriority(),r=r.compareTo(n);return 0===r?Iu(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return p.MIN}maxPost(){return new p(bu,new Nc("[PRIORITY-POST]",Pc))}makePost(e,t){var r=Rc(e);return new p(t,new Nc("[PRIORITY-POST]",r))}toString(){return".priority"}}let I=new Dc,xc=Math.log(2);class Oc{constructor(e){this.count=(t=e+1,parseInt(Math.log(t)/xc,10)),this.current_=this.count-1,t=this.count;var t,r=parseInt(Array(t+1).join("1"),2);this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Mc(l,e,h,t){l.sort(e);let u=function(e,t){var r,n,i=t-e;let s,a;return 0==i?null:1==i?(s=l[e],a=h?h(s):s,new wc(a,s.node,wc.BLACK,null,null)):(i=parseInt(i/2,10)+e,r=u(e,i),n=u(i+1,t),s=l[i],a=h?h(s):s,new wc(a,s.node,wc.BLACK,r,n))};var r=(e=>{let s=null,a=null,o=l.length;function t(e,t){var r=o-e,n=o,n=(o-=e,u(1+r,n)),r=l[r],i=h?h(r):r,e=new wc(i,r.node,t,null,n);s=(s?s.left=e:a=e,e)}for(let i=0;i<e.count;++i){var r=e.nextBitIsOne(),n=Math.pow(2,e.count-(i+1));r?t(n,wc.BLACK):(t(n,wc.BLACK),t(n,wc.RED))}return a})(new Oc(l.length));return new Ic(t||e,r)}let Lc,Fc={};class Uc{static get Default(){return g((Fc,I),"ChildrenNode.ts has not been loaded"),Lc=Lc||new Uc({".priority":Fc},{".priority":I})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){var t=Ce(this.indexes_,e);if(t)return t instanceof Ic?t:null;throw new Error("No index defined for "+e)}hasIndex(e){return Ee(this.indexSet_,e.toString())}addIndex(e,t){g(e!==_c,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var r=[];let n=!1;var i=t.getIterator(p.Wrap);let s=i.getNext();for(;s;)n=n||e.isDefinedOn(s.node),r.push(s),s=i.getNext();let a;a=n?Mc(r,e.getCompare()):Fc;var o=e.toString(),l=Object.assign({},this.indexSet_),h=(l[o]=e,Object.assign({},this.indexes_));return h[o]=a,new Uc(h,l)}addToIndexes(s,a){var e=ke(this.indexes_,(t,e)=>{var r=Ce(this.indexSet_,e);if(g(r,"Missing index implementation for "+e),t===Fc){if(r.isDefinedOn(s.node)){var n=[],i=a.getIterator(p.Wrap);let e=i.getNext();for(;e;)e.name!==s.name&&n.push(e),e=i.getNext();return n.push(s),Mc(n,r.getCompare())}return Fc}{r=a.get(s.name);let e=t;return(e=r?e.remove(new p(s.name,r)):e).insert(s,s.node)}});return new Uc(e,this.indexSet_)}removeFromIndexes(r,n){var e=ke(this.indexes_,e=>{var t;return e!==Fc&&(t=n.get(r.name))?e.remove(new p(r.name,t)):e});return new Uc(e,this.indexSet_)}}let Vc;class T{static get EMPTY_NODE(){return Vc=Vc||new T(new Ic(Ec),null,Uc.Default)}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&kc(this.priorityNode_),this.children_.isEmpty()&&g(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Vc}updatePriority(e){return this.children_.isEmpty()?this:new T(this.children_,e,this.indexMap_)}getImmediateChild(e){var t;return".priority"===e?this.getPriority():null===(t=this.children_.get(e))?Vc:t}getChild(e){var t=_(e);return null===t?this:this.getImmediateChild(t).getChild(y(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(r,n){if(g(n,"We should always be passing snapshot nodes"),".priority"===r)return this.updatePriority(n);{var i=new p(r,n);let e,t;t=n.isEmpty()?(e=this.children_.remove(r),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(r,n),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Vc:this.priorityNode_;return new T(e,i,t)}}updateChild(e,t){var r,n=_(e);return null===n?t:(g(".priority"!==_(e)||1===tc(e),".priority must be the last token in a path"),r=this.getImmediateChild(n).updateChild(y(e),t),this.updateImmediateChild(n,r))}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(r){if(this.isEmpty())return null;let n={},i=0,s=0,a=!0;if(this.forEachChild(I,(e,t)=>{n[e]=t.val(r),i++,a&&T.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!r&&a&&s<2*i){var e,t=[];for(e in n)t[e]=n[e];return t}return r&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+Sc(this.getPriority().val())+":"),this.forEachChild(I,(e,t)=>{var r=t.hash();""!==r&&(n+=":"+e+":"+r)}),this.lazyHash_=""===n?"":eu(n)}return this.lazyHash_}getPredecessorChildName(e,t,r){var n=this.resolveIndex_(r);return n?(n=n.getPredecessorKey(new p(e,t)))?n.name:null:this.children_.getPredecessorKey(e)}getFirstChildName(e){var t=this.resolveIndex_(e);return t?(t=t.minKey())&&t.name:this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new p(t,this.children_.get(t)):null}getLastChildName(e){var t=this.resolveIndex_(e);return t?(t=t.maxKey())&&t.name:this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new p(t,this.children_.get(t)):null}forEachChild(e,t){var r=this.resolveIndex_(e);return r?r.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,r){var e=this.resolveIndex_(r);if(e)return e.getIteratorFrom(t,e=>e);{var n=this.children_.getIteratorFrom(t.name,p.Wrap);let e=n.peek();for(;null!=e&&r.compare(e,t)<0;)n.getNext(),e=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,r){var e=this.resolveIndex_(r);if(e)return e.getReverseIteratorFrom(t,e=>e);{var n=this.children_.getReverseIteratorFrom(t.name,p.Wrap);let e=n.peek();for(;null!=e&&0<r.compare(e,t);)n.getNext(),e=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===jc?-1:0}withIndex(e){var t;return e===_c||this.indexMap_.hasIndex(e)?this:(t=this.indexMap_.addIndex(e,this.children_),new T(this.children_,this.priorityNode_,t))}isIndexed(e){return e===_c||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(!e.isLeafNode()){var r=e;if(this.getPriority().equals(r.getPriority())){if(this.children_.count()!==r.children_.count())return!1;{var n=this.getIterator(I),i=r.getIterator(I);let e=n.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=n.getNext(),t=i.getNext()}return null===e&&null===t}}}return!1}resolveIndex_(e){return e===_c?null:this.indexMap_.get(e.toString())}}T.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class qc extends T{constructor(){super(new Ic(Ec),T.EMPTY_NODE,Uc.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return T.EMPTY_NODE}isEmpty(){return!1}}let jc=new qc,Bc=(Object.defineProperties(p,{MIN:{value:new p(wu,T.EMPTY_NODE)},MAX:{value:new p(bu,jc)}}),vc.__EMPTY_NODE=T.EMPTY_NODE,Nc.__childrenNodeConstructor=T,t=jc,Cc=t,t=jc,Pc=t,!0);function zc(s,e=null){if(null===s)return T.EMPTY_NODE;var t,r;if("object"==typeof s&&".priority"in s&&(e=s[".priority"]),g(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(s="object"==typeof s&&".value"in s&&null!==s[".value"]?s[".value"]:s)||".sv"in s)return t=s,new Nc(t,zc(e));if(s instanceof Array||!Bc){let n=T.EMPTY_NODE;return Tu(s,(e,t)=>{var r;!Ee(s,e)||"."===e.substring(0,1)||!(r=zc(t)).isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(e,r))}),n.updatePriority(zc(e))}{let n=[],i=!1;return Tu(s,(e,t)=>{var r;"."===e.substring(0,1)||(r=zc(t)).isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new p(e,r)))}),0===n.length?T.EMPTY_NODE:(t=Mc(n,Tc,e=>e.name,Ec),i?(r=Mc(n,I.getCompare()),new T(t,zc(e),new Uc({".priority":r},{".priority":I}))):new T(t,zc(e),Uc.Default))}}Rc=zc;class Kc extends gc{constructor(e){super(),this.indexPath_=e,g(!b(e)&&".priority"!==_(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){var r=this.extractChild(e.node),n=this.extractChild(t.node),r=r.compareTo(n);return 0===r?Iu(e.name,t.name):r}makePost(e,t){var r=zc(e),r=T.EMPTY_NODE.updateChild(this.indexPath_,r);return new p(t,r)}maxPost(){var e=T.EMPTY_NODE.updateChild(this.indexPath_,jc);return new p(bu,e)}toString(){return nc(this.indexPath_,0).join("/")}}class Wc extends gc{compare(e,t){var r=e.node.compareTo(t.node);return 0===r?Iu(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return p.MIN}maxPost(){return p.MAX}makePost(e,t){var r=zc(e);return new p(t,r)}toString(){return".value"}}let Hc=new Wc;function Gc(e){return{type:"value",snapshotNode:e}}function $c(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Qc(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Yc(e,t,r){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:r}}class Jc{constructor(e){this.index_=e}updateChild(e,t,r,n,i,s){g(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(n).equals(r.getChild(n))&&a.isEmpty()===r.isEmpty()||(null!=s&&(r.isEmpty()?e.hasChild(t)?s.trackChildChange(Qc(t,a)):g(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange($c(t,r)):s.trackChildChange(Yc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(n,r,i){return null!=i&&(n.isLeafNode()||n.forEachChild(I,(e,t)=>{r.hasChild(e)||i.trackChildChange(Qc(e,t))}),r.isLeafNode()||r.forEachChild(I,(e,t)=>{var r;n.hasChild(e)?(r=n.getImmediateChild(e)).equals(t)||i.trackChildChange(Yc(e,t,r)):i.trackChildChange($c(e,t))})),r.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?T.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Xc{constructor(e){this.indexedFilter_=new Jc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Xc.getStartPost_(e),this.endPost_=Xc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,n,i,s){return this.matches(new p(t,r))||(r=T.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,n,i,s)}updateFullNode(e,t,r){let n=(t=t.isLeafNode()?T.EMPTY_NODE:t).withIndex(this.index_),i=(n=n.updatePriority(T.EMPTY_NODE),this);return t.forEachChild(I,(e,t)=>{i.matches(new p(e,t))||(n=n.updateImmediateChild(e,T.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){var t;return e.hasStart()?(t=e.getIndexStartName(),e.getIndex().makePost(e.getIndexStartValue(),t)):e.getIndex().minPost()}static getEndPost_(e){var t;return e.hasEnd()?(t=e.getIndexEndName(),e.getIndex().makePost(e.getIndexEndValue(),t)):e.getIndex().maxPost()}}class Zc{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Xc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,n,i,s){return this.rangedFilter_.matches(new p(t,r))||(r=T.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,n,i,s):this.fullLimitUpdateChild_(e,t,r,i,s)}updateFullNode(e,r,t){let n;if(r.isLeafNode()||r.isEmpty())n=T.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<r.numChildren()&&r.isIndexed(this.index_)){n=T.EMPTY_NODE.withIndex(this.index_);let e,t=(e=this.reverse_?r.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_),0);for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;n=n.updateImmediateChild(i.name,i.node),t++}}}else{n=(n=r.withIndex(this.index_)).updatePriority(T.EMPTY_NODE);let e,t=(e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_),0);for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:n=n.updateImmediateChild(s.name,T.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,n,i){let s;if(this.reverse_){let r=this.index_.getCompare();s=(e,t)=>r(t,e)}else s=this.index_.getCompare();var a=e,o=(g(a.numChildren()===this.limit_,""),new p(t,r)),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=n.getChildAfterChild(this.index_,e,this.reverse_);var c=null==e?1:s(e,o);return h&&!r.isEmpty()&&0<=c?(null!=i&&i.trackChildChange(Yc(t,r,u)),a.updateImmediateChild(t,r)):(null!=i&&i.trackChildChange(Qc(t,u)),c=a.updateImmediateChild(t,T.EMPTY_NODE),null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange($c(e.name,e.node)),c.updateImmediateChild(e.name,e.node)):c)}return!r.isEmpty()&&h&&0<=s(l,o)?(null!=i&&(i.trackChildChange(Qc(l.name,l.node)),i.trackChildChange($c(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(l.name,T.EMPTY_NODE)):e}}class ed{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=I}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return g(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return g(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:wu}hasEnd(){return this.endSet_}getIndexEndValue(){return g(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return g(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:bu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return g(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===I}copy(){var e=new ed;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function td(e,t,r){var n=e.copy();return n.startSet_=!0,n.indexStartValue_=t=void 0===t?null:t,null!=r?(n.startNameSet_=!0,n.indexStartName_=r):(n.startNameSet_=!1,n.indexStartName_=""),n}function rd(e,t,r){var n=e.copy();return n.endSet_=!0,n.indexEndValue_=t=void 0===t?null:t,void 0!==r?(n.endNameSet_=!0,n.indexEndName_=r):(n.endNameSet_=!1,n.indexEndName_=""),n}function nd(e,t){var r=e.copy();return r.index_=t,r}function id(t){var r,n={};if(!t.isDefault()){let e;e=t.index_===I?"$priority":t.index_===Hc?"$value":t.index_===_c?"$key":(g(t.index_ instanceof Kc,"Unrecognized index type!"),t.index_.toString()),n.orderBy=Ie(e),t.startSet_&&(n[r=t.startAfterSet_?"startAfter":"startAt"]=Ie(t.indexStartValue_),t.startNameSet_)&&(n[r]+=","+Ie(t.indexStartName_)),t.endSet_&&(n[r=t.endBeforeSet_?"endBefore":"endAt"]=Ie(t.indexEndValue_),t.endNameSet_)&&(n[r]+=","+Ie(t.indexEndName_)),t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_)}return n}function sd(t){var r={};if(t.startSet_&&(r.sp=t.indexStartValue_,t.startNameSet_&&(r.sn=t.indexStartName_),r.sin=!t.startAfterSet_),t.endSet_&&(r.ep=t.indexEndValue_,t.endNameSet_&&(r.en=t.indexEndName_),r.ein=!t.endBeforeSet_),t.limitSet_){r.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),r.vf=e}return t.index_!==I&&(r.i=t.index_.toString()),r}class ad extends Yu{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(g(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=n,this.log_=tu("p:rest:"),this.listens_={}}listen(e,t,n,i){let s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+e._queryIdentifier),ad.getListenId_(e,n)),o={};this.listens_[a]=o;var r=id(e._queryParams);this.restRequest_(s+".json",r,(t,e)=>{let r=e;if(null===(t=404===t?r=null:t)&&this.onDataUpdate_(s,r,!1,n),Ce(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var r=ad.getListenId_(e,t);delete this.listens_[r]}get(e){var t=id(e._queryParams);let n=e._path.toString(),i=new Z;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;null===(e=404===e?r=null:e)?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);let r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+Re(s),n=(this.log_("Sending REST request for "+r),new XMLHttpRequest);n.onreadystatechange=()=>{if(a&&4===n.readyState){this.log_("REST Response for "+r+" received. status:",n.status,"response:",n.responseText);let e=null;if(200<=n.status&&n.status<300){try{e=be(n.responseText)}catch(e){vu("Failed to parse JSON response for "+r+": "+n.responseText)}a(null,e)}else 401!==n.status&&404!==n.status&&vu("Got unsuccessful REST response for "+r+" Status: "+n.status),a(n.status);a=null}},n.open("GET",r,!0),n.send()})}}class od{constructor(){this.rootNode_=T.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ld(){return{value:null,children:new Map}}function hd(e,t,r){var n;b(t)?(e.value=r,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,r):(n=_(t),e.children.has(n)||e.children.set(n,ld()),hd(e.children.get(n),t=y(t),r))}function ud(e,r,n){var i;null!==e.value?n(r,e.value):(i=(e,t)=>{ud(t,new f(r.toString()+"/"+e),n)},e.children.forEach((e,t)=>{i(t,e)}))}class cd{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();let r=Object.assign({},e);return this.last_&&Tu(this.last_,(e,t)=>{r[e]=r[e]-t}),this.last_=e,r}}class dd{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new cd(e);var r=1e4+2e4*Math.random();Su(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){var e=this.statsListener_.get();let r={},n=!1;Tu(e,(e,t)=>{0<t&&Ee(this.statsToReport_,e)&&(r[e]=t,n=!0)}),n&&this.server_.reportStats(r),Su(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function pd(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function fd(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function gd(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(t=Zh=Zh||{})[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class md{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Zh.ACK_USER_WRITE,this.source=pd()}operationForChild(e){var t;return b(this.path)?null!=this.affectedTree.value?(g(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this):(t=this.affectedTree.subtree(new f(e)),new md(v(),t,this.revert)):(g(_(this.path)===e,"operationForChild called for unrelated child."),new md(y(this.path),this.affectedTree,this.revert))}}class vd{constructor(e,t){this.source=e,this.path=t,this.type=Zh.LISTEN_COMPLETE}operationForChild(e){return b(this.path)?new vd(this.source,v()):new vd(this.source,y(this.path))}}class _d{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Zh.OVERWRITE}operationForChild(e){return b(this.path)?new _d(this.source,v(),this.snap.getImmediateChild(e)):new _d(this.source,y(this.path),this.snap)}}class yd{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Zh.MERGE}operationForChild(e){var t;return b(this.path)?(t=this.children.subtree(new f(e))).isEmpty()?null:t.value?new _d(this.source,v(),t.value):new yd(this.source,v(),t):(g(_(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new yd(this.source,y(this.path),this.children))}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class wd{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){var t;return b(e)?this.isFullyInitialized()&&!this.filtered_:(t=_(e),this.isCompleteForChild(t))}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class bd{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Id(r,e,t,n){var i=[];let s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Td(r,i,"child_removed",e,n,t),Td(r,i,"child_added",e,n,t),Td(r,i,"child_moved",s,n,t),Td(r,i,"child_changed",e,n,t),Td(r,i,"value",e,n,t),i}function Td(s,a,t,e,o,l){var r=e.filter(e=>e.type===t);r.sort((e,t)=>{var r=s;if(null==e.childName||null==t.childName)throw j("Should only compare child_ events.");var n=new p(e.childName,e.snapshotNode),i=new p(t.childName,t.snapshotNode);return r.index_.compare(n,i)}),r.forEach(t=>{e=s,i=l,"value"!==(n=t).type&&"child_removed"!==n.type&&(n.prevName=i.getPredecessorChildName(n.childName,n.snapshotNode,e.index_));let r=n;var e,n,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(r,s.query_))})})}function Ed(e,t){return{eventCache:e,serverCache:t}}function Cd(e,t,r,n){return Ed(new wd(t,r,n),e.serverCache)}function Sd(e,t,r,n){return Ed(e.eventCache,new wd(t,r,n))}function kd(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ad(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Nd;class E{static fromObject(e){let r=new E(null);return Tu(e,(e,t)=>{r=r.set(new f(e),t)}),r}constructor(e,t=Nd=Nd||new Ic(nu)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){var r,n;return null!=this.value&&t(this.value)?{path:v(),value:this.value}:!b(e)&&(r=_(e),null!==(n=this.children.get(r)))&&null!=(n=n.findRootMostMatchingPathAndValue(y(e),t))?{path:sc(new f(r),n.path),value:n.value}:null}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){var t;return b(e)?this:(t=_(e),null!==(t=this.children.get(t))?t.subtree(y(e)):new E(null))}set(e,t){var r,n;return b(e)?new E(t,this.children):(n=_(e),r=(this.children.get(n)||new E(null)).set(y(e),t),n=this.children.insert(n,r),new E(this.value,n))}remove(t){if(b(t))return this.children.isEmpty()?new E(null):new E(null,this.children);var r=_(t),n=this.children.get(r);if(n){n=n.remove(y(t));let e;return e=n.isEmpty()?this.children.remove(r):this.children.insert(r,n),null===this.value&&e.isEmpty()?new E(null):new E(this.value,e)}return this}get(e){var t;return b(e)?this.value:(t=_(e),(t=this.children.get(t))?t.get(y(e)):null)}setTree(t,r){if(b(t))return r;{var n=_(t),i=(this.children.get(n)||new E(null)).setTree(y(t),r);let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new E(this.value,e)}}fold(e){return this.fold_(v(),e)}fold_(r,n){let i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(sc(r,e),n)}),n(r,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,v(),t)}findOnPath_(e,t,r){var n,i=!!this.value&&r(t,this.value);return i||(!b(e)&&(i=_(e),n=this.children.get(i))?n.findOnPath_(y(e),sc(t,i),r):null)}foreachOnPath(e,t){return this.foreachOnPath_(e,v(),t)}foreachOnPath_(e,t,r){var n,i;return b(e)?this:(this.value&&r(t,this.value),n=_(e),(i=this.children.get(n))?i.foreachOnPath_(y(e),sc(t,n),r):new E(null))}foreach(e){this.foreach_(v(),e)}foreach_(r,n){this.children.inorderTraversal((e,t)=>{t.foreach_(sc(r,e),n)}),this.value&&n(r,this.value)}foreachChild(r){this.children.inorderTraversal((e,t)=>{t.value&&r(e,t.value)})}}class Rd{constructor(e){this.writeTree_=e}static empty(){return new Rd(new E(null))}}function Pd(t,r,n){if(b(r))return new Rd(new E(n));var i=t.writeTree_.findRootMostValueAndPath(r);if(null==i)return s=new E(n),s=t.writeTree_.setTree(r,s),new Rd(s);{var s=i.path;let e=i.value;i=ac(s,r);return e=e.updateChild(i,n),new Rd(t.writeTree_.set(s,e))}}function Dd(e,r,t){let n=e;return Tu(t,(e,t)=>{n=Pd(n,sc(r,e),t)}),n}function xd(e,t){var r;return b(t)?Rd.empty():(r=e.writeTree_.setTree(t,new E(null)),new Rd(r))}function Od(e,t){return null!=Md(e,t)}function Md(e,t){var r=e.writeTree_.findRootMostValueAndPath(t);return null!=r?e.writeTree_.get(r.path).getChild(ac(r.path,t)):null}function Ld(e){let r=[];var t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(I,(e,t)=>{r.push(new p(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&r.push(new p(e,t.value))}),r}function Fd(e,t){var r;return b(t)?e:null!=(r=Md(e,t))?new Rd(new E(r)):new Rd(e.writeTree_.subtree(t))}function Ud(e){return e.writeTree_.isEmpty()}function Vd(e,t){return function n(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let r=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(g(null!==t.value,"Priority writes must always be leaf nodes"),r=t.value):s=n(sc(i,e),t,s)}),s=s.getChild(i).isEmpty()||null===r?s:s.updateChild(sc(i,".priority"),r)}}}(v(),e.writeTree_,t)}function qd(e,t){return Xd(t,e)}function jd(t,r){var e,n=t.allWrites.findIndex(e=>e.writeId===r);g(0<=n,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n],s=(t.allWrites.splice(n,1),i.visible),a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var l=t.allWrites[o];l.visible&&(o>=n&&((e,t)=>{if(e.snap)return hc(e.path,t);for(var r in e.children)if(e.children.hasOwnProperty(r)&&hc(sc(e.path,r),t))return 1})(l,i.path)?s=!1:hc(i.path,l.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=zd(e.allWrites,Bd,v()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=xd(t.visibleWrites,i.path):Tu(i.children,e=>{t.visibleWrites=xd(t.visibleWrites,sc(i.path,e))}),!0)}function Bd(e){return e.visible}function zd(e,t,r){let n=Rd.empty();for(let a=0;a<e.length;++a){var i=e[a];if(t(i)){var s=i.path;let e;if(i.snap)hc(r,s)?(e=ac(r,s),n=Pd(n,e,i.snap)):hc(s,r)&&(e=ac(s,r),n=Pd(n,v(),i.snap.getChild(e)));else{if(!i.children)throw j("WriteRecord should have .snap or .children");hc(r,s)?(e=ac(r,s),n=Dd(n,e,i.children)):hc(s,r)&&(b(e=ac(s,r))?n=Dd(n,v(),i.children):(s=Ce(i.children,_(e)))&&(i=s.getChild(y(e)),n=Pd(n,v(),i)))}}}return n}function Kd(e,t,r,n,i){var s;return n||i?(s=Fd(e.visibleWrites,t),!i&&Ud(s)?r:i||null!=r||Od(s,v())?Vd(zd(e.allWrites,function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(hc(e.path,t)||hc(t,e.path))},t),r||T.EMPTY_NODE):null):null!=(s=Md(e.visibleWrites,t))?s:Ud(s=Fd(e.visibleWrites,t))?r:null!=r||Od(s,v())?Vd(s,r||T.EMPTY_NODE):null}function Wd(e,t,r,n){return Kd(e.writeTree,e.treePath,t,r,n)}function Hd(e,t){{var r=e.writeTree;e=e.treePath;let i=T.EMPTY_NODE;var n=Md(r.visibleWrites,e);if(n)n.isLeafNode()||n.forEachChild(I,(e,t)=>{i=i.updateImmediateChild(e,t)});else if(t){let n=Fd(r.visibleWrites,e);t.forEachChild(I,(e,t)=>{var r=Vd(Fd(n,new f(e)),t);i=i.updateImmediateChild(e,r)}),Ld(n).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)})}else Ld(Fd(r.visibleWrites,e)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)});return i}}function Gd(e,t,r,n){return i=e.writeTree,e=e.treePath,t=t,r=r,n=n,g(r||n,"Either existingEventSnap or existingServerSnap must exist"),s=sc(e,t),Od(i.visibleWrites,s)?null:Ud(s=Fd(i.visibleWrites,s))?n.getChild(t):Vd(s,n.getChild(t));var i,s}function $d(e,t){return r=e.writeTree,e=sc(e.treePath,t),Md(r.visibleWrites,e);var r}function Qd(e,r,n,i,s,a){{var o=e.writeTree,l=(e=e.treePath,n),h=i;n=s,i=a;let t;var u=Fd(o.visibleWrites,e),c=Md(u,v());if(null!=c)t=c;else{if(null==r)return[];t=Vd(u,r)}if((t=t.withIndex(i)).isEmpty()||t.isLeafNode())return[];{var d=[],p=i.getCompare(),f=n?t.getReverseIteratorFrom(l,i):t.getIteratorFrom(l,i);let e=f.getNext();for(;e&&d.length<h;)0!==p(e,l)&&d.push(e),e=f.getNext();return d}}}function Yd(e,t,r){return n=e.writeTree,r=r,i=sc(e.treePath,e=t),null!=(s=Md(n.visibleWrites,i))?s:r.isCompleteForChild(e)?Vd(Fd(n.visibleWrites,i),r.getNode().getImmediateChild(e)):null;var n,i,s}function Jd(e,t){return Xd(sc(e.treePath,t),e.writeTree)}function Xd(e,t){return{treePath:e,writeTree:t}}class Zd{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,r=e.childName,n=(g("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),g(".priority"!==r,"Only non-priority child changes can be tracked."),this.changeMap.get(r));if(n){var i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(r,Yc(r,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(r,Qc(r,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(r,$c(r,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw j("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(r,Yc(r,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}let ep=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}};class tp{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){var t=this.viewCache_.eventCache;return t.isCompleteForChild(e)?t.getNode().getImmediateChild(e):(t=null!=this.optCompleteServerCache_?new wd(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache,Yd(this.writes_,e,t))}getChildAfterChild(e,t,r){var n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ad(this.viewCache_),n=Qd(this.writes_,n,t,1,r,e);return 0===n.length?null:n[0]}}function rp(e,t,r,n,i){var s=new Zd;let a,o;if(r.type===Zh.OVERWRITE){var l=r;a=l.source.fromUser?sp(e,t,l.path,l.snap,n,i,s):(g(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered()&&!b(l.path),ip(e,t,l.path,l.snap,n,i,o,s))}else if(r.type===Zh.MERGE){var l=r;a=l.source.fromUser?((n,i,s,e,a,o,l)=>{let h=i;return e.foreach((e,t)=>{var r=sc(s,e);ap(i,_(r))&&(h=sp(n,h,r,t,a,o,l))}),e.foreach((e,t)=>{var r=sc(s,e);ap(i,_(r))||(h=sp(n,h,r,t,a,o,l))}),h})(e,t,l.path,l.children,n,i,s):(g(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered(),lp(e,t,l.path,l.children,n,i,o,s))}else if(r.type===Zh.ACK_USER_WRITE){l=r;a=l.revert?((r,n,i,s,e,a)=>{let o;if(null!=$d(s,i))return n;{var l=new tp(s,n,e),h=n.eventCache.getNode();let t;if(b(i)||".priority"===_(i)){let e;e=e=n.serverCache.isFullyInitialized()?Wd(s,Ad(n)):(u=n.serverCache.getNode(),g(u instanceof T,"serverChildren would be complete if leaf node"),Hd(s,u)),t=r.filter.updateFullNode(h,e,a)}else{var u=_(i);let e=Yd(s,u,n.serverCache);null==e&&n.serverCache.isCompleteForChild(u)&&(e=h.getImmediateChild(u)),(t=null!=e?r.filter.updateChild(h,u,e,y(i),l,a):n.eventCache.getNode().hasChild(u)?r.filter.updateChild(h,u,T.EMPTY_NODE,y(i),l,a):h).isEmpty()&&n.serverCache.isFullyInitialized()&&(o=Wd(s,Ad(n))).isLeafNode()&&(t=r.filter.updateFullNode(t,o,a))}return o=n.serverCache.isFullyInitialized()||null!=$d(s,v()),Cd(n,t,o,r.filter.filtersNodes())}})(e,t,l.path,n,i,s):((e,t,i,r,s,a,o)=>{if(null!=$d(s,i))return t;let l=t.serverCache.isFiltered(),h=t.serverCache;if(null!=r.value){if(b(i)&&h.isFullyInitialized()||h.isCompleteForPath(i))return ip(e,t,i,h.getNode().getChild(i),s,a,l,o);if(b(i)){let r=new E(null);return h.getNode().forEachChild(_c,(e,t)=>{r=r.set(new f(e),t)}),lp(e,t,i,r,s,a,l,o)}return t}{let n=new E(null);return r.foreach((e,t)=>{var r=sc(i,e);h.isCompleteForPath(r)&&(n=n.set(e,h.getNode().getChild(r)))}),lp(e,t,i,n,s,a,l,o)}})(e,t,l.path,l.affectedTree,n,i,s)}else{if(r.type!==Zh.LISTEN_COMPLETE)throw j("Unknown operation type: "+r.type);a=(i=e,e=r.path,r=n,n=s,l=t.serverCache,l=Sd(t,l.getNode(),l.isFullyInitialized()||b(e),l.isFiltered()),np(i,l,e,r,ep,n))}var h,u,s=s.getChanges(),i=t,e=a,r=s,c=e.eventCache;return c.isFullyInitialized()&&(h=c.getNode().isLeafNode()||c.getNode().isEmpty(),u=kd(i),0<r.length||!i.eventCache.isFullyInitialized()||h&&!c.getNode().equals(u)||!c.getNode().getPriority().equals(u.getPriority()))&&r.push(Gc(kd(e))),{viewCache:a,changes:s}}function np(n,i,s,a,o,l){var h=i.eventCache;if(null!=$d(a,s))return i;{let t,r;if(b(s))g(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(u=Hd(a,(u=Ad(i))instanceof T?u:T.EMPTY_NODE),n.filter.updateFullNode(i.eventCache.getNode(),u,l)):(u=Wd(a,Ad(i)),n.filter.updateFullNode(i.eventCache.getNode(),u,l));else{var u=_(s);if(".priority"===u){g(1===tc(s),"Can't have a priority with additional path components");var c=h.getNode(),d=Gd(a,s,c,r=i.serverCache.getNode());t=null!=d?n.filter.updatePriority(c,d):h.getNode()}else{c=y(s);let e;e=h.isCompleteForChild(u)?(r=i.serverCache.getNode(),null!=(d=Gd(a,s,h.getNode(),r))?h.getNode().getImmediateChild(u).updateChild(c,d):h.getNode().getImmediateChild(u)):Yd(a,u,i.serverCache),t=null!=e?n.filter.updateChild(h.getNode(),u,e,c,o,l):h.getNode()}}return Cd(i,t,h.isFullyInitialized()||b(s),n.filter.filtersNodes())}}function ip(e,t,r,n,i,s,a,o){var l=t.serverCache;let h;var u=a?e.filter:e.filter.getIndexedFilter();if(b(r))h=u.updateFullNode(l.getNode(),n,null);else if(u.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(r,n);h=u.updateFullNode(l.getNode(),c,null)}else{c=_(r);if(!l.isCompleteForPath(r)&&1<tc(r))return t;var d=y(r),p=l.getNode().getImmediateChild(c).updateChild(d,n);h=".priority"===c?u.updatePriority(l.getNode(),p):u.updateChild(l.getNode(),c,p,d,ep,null)}c=Sd(t,h,l.isFullyInitialized()||b(r),u.filtersNodes());return np(e,c,r,i,new tp(i,c,s),o)}function sp(t,r,n,i,e,s,a){var o=r.eventCache;let l,h;var u=new tp(e,r,s);if(b(n))h=t.filter.updateFullNode(r.eventCache.getNode(),i,a),l=Cd(r,h,!0,t.filter.filtersNodes());else{var c=_(n);if(".priority"===c)h=t.filter.updatePriority(r.eventCache.getNode(),i),l=Cd(r,h,o.isFullyInitialized(),o.isFiltered());else{var d,p=y(n),f=o.getNode().getImmediateChild(c);let e;e=b(p)?i:null!=(d=u.getCompleteChild(c))?".priority"===rc(p)&&d.getChild(ic(p)).isEmpty()?d:d.updateChild(p,i):T.EMPTY_NODE,l=f.equals(e)?r:Cd(r,t.filter.updateChild(o.getNode(),c,e,p,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return l}function ap(e,t){return e.eventCache.isCompleteForChild(t)}function op(e,r,t){return t.foreach((e,t)=>{r=r.updateChild(e,t)}),r}function lp(n,i,e,t,s,a,o,l){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let h=i,r,u=(r=b(e)?t:new E(null).setTree(e,t),i.serverCache.getNode());return r.children.inorderTraversal((e,t)=>{var r;u.hasChild(e)&&(r=op(0,i.serverCache.getNode().getImmediateChild(e),t),h=ip(n,h,new f(e),r,s,a,o,l))}),r.children.inorderTraversal((e,t)=>{var r=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||r||(r=op(0,i.serverCache.getNode().getImmediateChild(e),t),h=ip(n,h,new f(e),r,s,a,o,l))}),h}class hp{constructor(e,t){this.query_=e,this.eventRegistrations_=[];var r=this.query_._queryParams,n=new Jc(r.getIndex()),r=(e=r).loadsAllData()?new Jc(e.getIndex()):new(e.hasLimit()?Zc:Xc)(e),i=(this.processor_={filter:r},t.serverCache),s=t.eventCache,a=n.updateFullNode(T.EMPTY_NODE,i.getNode(),null),o=r.updateFullNode(T.EMPTY_NODE,s.getNode(),null),a=new wd(a,i.isFullyInitialized(),n.filtersNodes()),i=new wd(o,s.isFullyInitialized(),r.filtersNodes());this.viewCache_=Ed(i,a),this.eventGenerator_=new bd(this.query_)}get query(){return this.query_}}function up(e){return 0===e.eventRegistrations_.length}function cp(n,i,s){let a=[];if(s){g(null==i,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(s,r);t&&a.push(t)})}if(i){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){var r=n.eventRegistrations_[t];if(r.matches(i)){if(i.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(r)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return a}function dp(e,t,r,n){t.type===Zh.MERGE&&null!==t.source.queryId&&(g(Ad(e.viewCache_),"We should always have a full cache before handling merges"),g(kd(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_,s=rp(e.processor_,i,t,r,n);return t=e.processor_,r=s.viewCache,g(r.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),g(r.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed"),g(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,pp(e,s.changes,s.viewCache.eventCache.getNode(),null)}function pp(e,t,r,n){var i=n?[n]:e.eventRegistrations_;return Id(e.eventGenerator_,t,r,i)}let fp;class gp{constructor(){this.views=new Map}}function mp(t,r,n,i){var e=r.source.queryId;if(null!==e)return e=t.views.get(e),g(null!=e,"SyncTree gave us an op for an invalid query."),dp(e,r,n,i);{let e=[];for(var s of t.views.values())e=e.concat(dp(s,r,n,i));return e}}function vp(e,r,n,i,s){var a=r._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=Wd(n,s?i:null),t=!1;t=!!e||(e=i instanceof T?Hd(n,i):T.EMPTY_NODE,!1);a=Ed(new wd(e,t,!1),new wd(i,s,!1));return new hp(r,a)}}function _p(e,t,n,i,s,r){var a=vp(e,t,i,s,r);e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n);{s=n,a=(i=a).viewCache_.eventCache;let r=[];return a.getNode().isLeafNode()||a.getNode().forEachChild(I,(e,t)=>{r.push($c(e,t))}),a.isFullyInitialized()&&r.push(Gc(a.getNode())),pp(i,r,a.getNode(),s)}}function yp(e,t,r,n){var i=t._queryIdentifier,s=[];let a=[];var o=Ep(e);if("default"===i)for(var[l,h]of e.views.entries())a=a.concat(cp(h,r,n)),up(h)&&(e.views.delete(l),h.query._queryParams.loadsAllData()||s.push(h.query));else{var u=e.views.get(i);u&&(a=a.concat(cp(u,r,n)),up(u))&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query))}return o&&!Ep(e)&&s.push((g(fp,"Reference.ts has not been loaded"),new fp(t._repo,t._path))),{removed:s,events:a}}function wp(e){var t,r=[];for(t of e.views.values())t.query._queryParams.loadsAllData()||r.push(t);return r}function bp(e,t){let r=null;for(var n of e.views.values())r=r||(i=n,s=t,n=void 0,(n=Ad(i.viewCache_))&&(i.query._queryParams.loadsAllData()||!b(s)&&!n.getImmediateChild(_(s)).isEmpty())?n.getChild(s):null);var i,s;return r}function Ip(e,t){var r;return t._queryParams.loadsAllData()?Cp(e):(r=t._queryIdentifier,e.views.get(r))}function Tp(e,t){return null!=Ip(e,t)}function Ep(e){return null!=Cp(e)}function Cp(e){for(var t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Sp;let kp=1;class Ap{constructor(e){this.listenProvider_=e,this.syncPointTree_=new E(null),this.pendingWriteTree_={visibleWrites:Rd.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Np(e,t,r,n,i){var s,a,o,l;return s=e.pendingWriteTree_,a=t,o=r,n=n,l=i,g(n>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:n,visible:l=void 0===l?!0:l}),l&&(s.visibleWrites=Pd(s.visibleWrites,a,o)),s.lastWriteId=n,i?Up(e,new _d(pd(),t,r)):[]}function Rp(e,t,r,n){i=e.pendingWriteTree_,s=t,a=r,n=n,g(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:n,visible:!0}),i.visibleWrites=Dd(i.visibleWrites,s,a),i.lastWriteId=n;var i,s,a,o=E.fromObject(r);return Up(e,new yd(pd(),t,o))}function Pp(e,t,r=!1){var n=((e,t)=>{for(let n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null})(e.pendingWriteTree_,t);if(jd(e.pendingWriteTree_,t)){let t=new E(null);return null!=n.snap?t=t.set(v(),!0):Tu(n.children,e=>{t=t.set(new f(e),!0)}),Up(e,new md(n.path,t,r))}return[]}function Dp(e,t,r){return Up(e,new _d(fd(),t,r))}function xp(r,t,n,i,s=!1){var a=t._path,o=r.syncPointTree_.get(a);let l=[];if(o&&("default"===t._queryIdentifier||Tp(o,t))){var h=yp(o,t,n,i),o=(0===o.views.size&&(r.syncPointTree_=r.syncPointTree_.remove(a)),h.removed);if(l=h.events,!s){var h=-1!==o.findIndex(e=>e._queryParams.loadsAllData()),u=r.syncPointTree_.findOnPath(a,(e,t)=>Ep(t));if(h&&!u){a=r.syncPointTree_.subtree(a);if(!a.isEmpty()){var c=a.fold((e,t,n)=>{if(t&&Ep(t))return[Cp(t)];{let r=[];return t&&(r=wp(t)),Tu(n,(e,t)=>{r=r.concat(t)}),r}});for(let e=0;e<c.length;++e){var d=c[e],p=d.query,d=qp(r,d);r.listenProvider_.startListening(Hp(p),jp(r,p),d.hashFn,d.onComplete)}}}!u&&0<o.length&&!i&&(h?r.listenProvider_.stopListening(Hp(t),null):o.forEach(e=>{var t=r.queryToTagMap.get(Bp(e));r.listenProvider_.stopListening(Hp(e),t)}))}var f=r,g=o;for(let e=0;e<g.length;++e){var m,v=g[e];v._queryParams.loadsAllData()||(v=Bp(v),m=f.queryToTagMap.get(v),f.queryToTagMap.delete(v),f.tagToQueryMap.delete(m))}}return l}function Op(e,t,r,n){var i,s,a=zp(e,n);return null!=a?(i=(a=Kp(a)).path,a=a.queryId,s=ac(i,t),Wp(e,i,new _d(gd(a),s,r))):[]}function Mp(e,t,r,n=!1){let i=t._path,s=null,a=!1,o=(e.syncPointTree_.foreachOnPath(i,(e,t)=>{var r=ac(e,i);s=s||bp(t,r),a=a||Ep(t)}),e.syncPointTree_.get(i));o?(a=a||Ep(o),s=s||bp(o,v())):(o=new gp,e.syncPointTree_=e.syncPointTree_.set(i,o));let l;null!=s?l=!0:(l=!1,s=T.EMPTY_NODE,e.syncPointTree_.subtree(i).foreachChild((e,t)=>{var r=bp(t,v());r&&(s=s.updateImmediateChild(e,r))}));var h,u=Tp(o,t),c=(u||t._queryParams.loadsAllData()||(h=Bp(t),g(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),c=kp++,e.queryToTagMap.set(h,c),e.tagToQueryMap.set(c,h)),qd(e.pendingWriteTree_,i));let d=_p(o,t,r,c,s,l);return u||a||n||(h=Ip(o,t),d=d.concat(((t,e,r)=>{var n=e._path,i=jp(t,e),s=qp(t,r),s=t.listenProvider_.startListening(Hp(e),i,s.hashFn,s.onComplete),n=t.syncPointTree_.subtree(n);if(i)g(!Ep(n.value),"If we're adding a query, it shouldn't be shadowed");else{var a=n.fold((e,t,n)=>{if(!b(e)&&t&&Ep(t))return[Cp(t).query];{let r=[];return t&&(r=r.concat(wp(t).map(e=>e.query))),Tu(n,(e,t)=>{r=r.concat(t)}),r}});for(let e=0;e<a.length;++e){var o=a[e];t.listenProvider_.stopListening(Hp(o),jp(t,o))}}return s})(e,t,h))),d}function Lp(e,n,t){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(n,(e,t)=>{var r=bp(t,ac(e,n));if(r)return r});return Kd(r,n,i,t,!0)}function Fp(e,t){let n=t._path,i=null,r=(e.syncPointTree_.foreachOnPath(n,(e,t)=>{var r=ac(e,n);i=i||bp(t,r)}),e.syncPointTree_.get(n));r?i=i||bp(r,v()):(r=new gp,e.syncPointTree_=e.syncPointTree_.set(n,r));var s=null!=i,a=s?new wd(i,!0,!1):null,o=qd(e.pendingWriteTree_,t._path);return kd(vp(r,t,o,s?a.getNode():T.EMPTY_NODE,s).viewCache_)}function Up(e,t){return function a(t,o,l,h){{if(b(t.path))return Vp(t,o,l,h);{let e=o.get(v()),r=(null==l&&null!=e&&(l=bp(e,v())),[]),n=_(t.path),i=t.operationForChild(n),s=o.children.get(n);if(s&&i){let e=l?l.getImmediateChild(n):null,t=Jd(h,n);r=r.concat(a(i,s,e,t))}return r=e?r.concat(mp(e,t,h,l)):r}}}(t,e.syncPointTree_,null,qd(e.pendingWriteTree_,v()))}function Vp(s,e,a,o){var t=e.get(v());null==a&&null!=t&&(a=bp(t,v()));let l=[];return e.children.inorderTraversal((e,t)=>{var r=a?a.getImmediateChild(e):null,n=Jd(o,e),i=s.operationForChild(e);i&&(l=l.concat(Vp(i,t,r,n)))}),l=t?l.concat(mp(t,s,o,a)):l}function qp(o,e){let l=e.query,h=jp(o,l);return{hashFn:()=>(e.viewCache_.serverCache.getNode()||T.EMPTY_NODE).hash(),onComplete:e=>{var t,r,n,i,s,a;return"ok"===e?h?(t=o,r=l._path,n=h,(a=zp(t,n))?(i=(a=Kp(a)).path,a=a.queryId,s=ac(i,r),Wp(t,i,new vd(gd(a),s))):[]):(n=o,r=l._path,Up(n,new vd(fd(),r))):(i=((e,t)=>{let r="Unknown Error";"too_big"===e?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?r="Client doesn't have permission to access the desired data.":"unavailable"===e&&(r="The service is unavailable");var n=new Error(e+" at "+t._path.toString()+": "+r);return n.code=e.toUpperCase(),n})(e,l),xp(o,l,null,i))}}}function jp(e,t){var r=Bp(t);return e.queryToTagMap.get(r)}function Bp(e){return e._path.toString()+"$"+e._queryIdentifier}function zp(e,t){return e.tagToQueryMap.get(t)}function Kp(e){var t=e.indexOf("$");return g(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new f(e.substr(0,t))}}function Wp(e,t,r){var n=e.syncPointTree_.get(t),i=(g(n,"Missing sync point for query tag that we're tracking"),qd(e.pendingWriteTree_,t));return mp(n,r,i,null)}function Hp(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(g(Sp,"Reference.ts has not been loaded"),new Sp(e._repo,e._path)):e}class Gp{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new Gp(t)}node(){return this.node_}}class $p{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=sc(this.path_,e);return new $p(this.syncTree_,t)}node(){return Lp(this.syncTree_,this.path_)}}let Qp=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Yp=function(e,t,r){return e&&"object"==typeof e?(g(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Jp(e[".sv"],t,r):"object"==typeof e[".sv"]?Xp(e[".sv"],t):void g(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Jp=function(e,t,r){if("timestamp"===e)return r.timestamp;g(!1,"Unexpected server value: "+e)},Xp=function(e,t,r){e.hasOwnProperty("increment")||g(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var n=e.increment,i=("number"!=typeof n&&g(!1,"Unexpected increment value: "+n),t.node());return g(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode()||"number"!=typeof(i=i.getValue())?n:i+n},Zp=function(e,t,r,n){return tf(t,new $p(r,e),n)},ef=function(e,t,r){return tf(e,new Gp(t),r)};function tf(e,n,i){var t,r,s=e.getPriority().val(),s=Yp(s,n.getImmediateChild(".priority"),i);let a;return e.isLeafNode()?(r=e,(t=Yp(r.getValue(),n,i))!==r.getValue()||s!==r.getPriority().val()?new Nc(t,zc(s)):e):(r=e,s!==(a=r).getPriority().val()&&(a=a.updatePriority(new Nc(s))),r.forEachChild(I,(e,t)=>{var r=tf(t,n.getImmediateChild(e),i);r!==t&&(a=a.updateImmediateChild(e,r))}),a)}class rf{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function nf(e,t){let r=t instanceof f?t:new f(t),n=e,i=_(r);for(;null!==i;){var s=Ce(n.node.children,i)||{children:{},childCount:0};n=new rf(i,n,s),r=y(r),i=_(r)}return n}function sf(e){return e.node.value}function af(e,t){e.node.value=t,uf(e)}function of(e){return 0<e.node.childCount}function lf(r,n){Tu(r.node.children,(e,t)=>{n(new rf(e,r,t))})}function hf(e){return new f(null===e.parent?e.name:hf(e.parent)+"/"+e.name)}function uf(e){var t,r,n,i;null!==e.parent&&(t=e.parent,r=e.name,n=(e=>void 0===sf(e)&&!of(e))(e=e),i=Ee(t.node.children,r),n&&i?(delete t.node.children[r],t.node.childCount--,uf(t)):n||i||(t.node.children[r]=e.node,t.node.childCount++,uf(t)))}function cf(e,t,r,n){n&&void 0===t||Ef(Fe(e,"value"),t,r)}function df(e,t,s,r){if(!r||void 0!==t){let n=Fe(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(n+" must be an object containing the children to replace.");let i=[];Tu(t,(e,t)=>{var r=new f(e);if(Ef(n,t,sc(s,r)),".priority"===rc(r)&&!Tf(t))throw new Error(n+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(r)});{var a=n;var o=i;let t,r;for(t=0;t<o.length;t++){var l=nc(r=o[t]);for(let e=0;e<l.length;e++)if((".priority"!==l[e]||e!==l.length-1)&&!wf(l[e]))throw new Error(a+"contains an invalid key ("+l[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}o.sort(oc);let e=null;for(t=0;t<o.length;t++){if(r=o[t],null!==e&&hc(e,r))throw new Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+r.toString());e=r}}}}function pf(e,t,r){if(!r||void 0!==t){if(yu(t))throw new Error(Fe(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Tf(t))throw new Error(Fe(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function ff(e,t,r,n){if(!(n&&void 0===r||wf(r)))throw new Error(Fe(e,t)+'was an invalid key = "'+r+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function gf(e,t,r,n){r=r&&r.replace(/^\/*\.info(\/|$)/,"/"),Cf(e,t,r,n)}function mf(e,t){if(".info"===_(t))throw new Error(e+" failed = Can't modify data under /.info/")}let vf=/[\[\].#$\/\u0000-\u001F\u007F]/,_f=/[\[\].#$\u0000-\u001F\u007F]/,yf=10485760,wf=function(e){return"string"==typeof e&&0!==e.length&&!vf.test(e)},bf=function(e){return"string"==typeof e&&0!==e.length&&!_f.test(e)},If=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),bf(e)},Tf=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!yu(e)||e&&"object"==typeof e&&Ee(e,".sv")},Ef=function(a,e,t){let o=t instanceof f?new uc(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+dc(o));if("function"==typeof e)throw new Error(a+"contains a function "+dc(o)+" with contents = "+e.toString());if(yu(e))throw new Error(a+"contains "+e.toString()+" "+dc(o));if("string"==typeof e&&e.length>yf/3&&qe(e)>yf)throw new Error(a+"contains a string greater than "+yf+" utf8 bytes "+dc(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(Tu(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!wf(e)))throw new Error(a+" contains an invalid key ("+e+") "+dc(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var r,n;r=o,e=e,0<r.parts_.length&&(r.byteLength_+=1),r.parts_.push(e),r.byteLength_+=qe(e),cc(r),Ef(a,t,o),e=o,n=e.parts_.pop(),e.byteLength_-=qe(n),0<e.parts_.length&&--e.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+dc(o)+" in addition to actual children.")}},Cf=function(e,t,r,n){if(!(n&&void 0===r||bf(r)))throw new Error(Fe(e,t)+'was an invalid path = "'+r+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Sf=function(e,t){var r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!wf(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&!If(r))throw new Error(Fe(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class kf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Af(e,t){let r=null;for(let s=0;s<t.length;s++){var n=t[s],i=n.getPath();null===r||lc(i,r.path)||(e.eventLists_.push(r),r=null),(r=null===r?{events:[],path:i}:r).events.push(n)}r&&e.eventLists_.push(r)}function Nf(e,t,r){Af(e,r),Pf(e,e=>lc(e,t))}function Rf(e,t,r){Af(e,r),Pf(e,e=>hc(e,t)||hc(t,e))}function Pf(t,e){t.recursionDepth_++;let r=!0;for(let o=0;o<t.eventLists_.length;o++){var n=t.eventLists_[o];if(n)if(e(n.path)){s=a=i=void 0;var i=t.eventLists_[o];for(let e=0;e<i.events.length;e++){var s,a=i.events[e];null!==a&&(i.events[e]=null,s=a.getEventRunner(),du&&gu("event: "+a.toString()),Ru(s))}t.eventLists_[o]=null}else r=!1}r&&(t.eventLists_=[]),t.recursionDepth_--}let Df="repo_interrupt",xf=25;class Of{constructor(e,t,r,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new kf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ld(),this.transactionQueueTree_=new rf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Mf(a,e,t){if(a.stats_=Bu(a.repoInfo_),a.forceRestClient_||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))a.server_=new ad(a.repoInfo_,(e,t,r,n)=>{Uf(a,e,t,r,n)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Vf(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ie(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new fc(a.repoInfo_,e,(e,t,r,n)=>{Uf(a,e,t,r,n)},e=>{Vf(a,e)},e=>{var r;r=a,Tu(e,(e,t)=>{qf(r,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var r;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=()=>new dd(a.stats_,a.server_),r=a.repoInfo_.toString(),ju[r]||(ju[r]=e()),ju[r]),a.infoData_=new od,a.infoSyncTree_=new Ap({startListening:(e,t,r,n)=>{let i=[];var s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Dp(a.infoSyncTree_,e._path,s),setTimeout(()=>{n("ok")},0)),i},stopListening:()=>{}}),qf(a,"connected",!1),a.serverSyncTree_=new Ap({startListening:(n,e,t,i)=>(a.server_.listen(n,t,e,(e,t)=>{var r=i(e,t);Rf(a.eventQueue_,n._path,r)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Lf(e){var t=e.infoData_.getNode(new f(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Ff(e){return Qp({timestamp:Lf(e)})}function Uf(e,t,r,n,i){e.dataUpdateCount++;var s,a,o,l,h,u,c=new f(t);r=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,r):r;let d=[],p=c;0<(d=i?n?(u=ke(r,e=>zc(e)),t=e.serverSyncTree_,s=c,a=u,(u=zp(t,i))?(o=(u=Kp(u)).path,u=u.queryId,l=ac(o,s),h=E.fromObject(a),Wp(t,o,new yd(gd(u),l,h))):[]):(o=zc(r),Op(e.serverSyncTree_,c,o,i)):n?(u=ke(r,e=>zc(e)),s=e.serverSyncTree_,a=c,t=u,l=E.fromObject(t),Up(s,new yd(fd(),a,l))):(h=zc(r),Dp(e.serverSyncTree_,c,h))).length&&(p=Jf(e,c)),Rf(e.eventQueue_,p,d)}function Vf(e,t){if(qf(e,"connected",t),!1===t){var a=e;Gf(a,"onDisconnectEvents");let n=Ff(a),i=ld(),s=(ud(a.onDisconnect_,v(),(e,t)=>{var r=Zp(e,t,a.serverSyncTree_,n);hd(i,e,r)}),[]);ud(i,v(),(e,t)=>{s=s.concat(Dp(a.serverSyncTree_,e,t));var r=tg(a,e);Jf(a,r)}),a.onDisconnect_=ld(),Rf(a.eventQueue_,v(),s)}}function qf(e,t,r){var n=new f("/.info/"+t),i=zc(r),i=(e.infoData_.updateSnapshot(n,i),Dp(e.infoSyncTree_,n,i));Rf(e.eventQueue_,n,i)}function jf(e){return e.nextWriteId_++}function Bf(n,i,e,t,s){Gf(n,"set",{path:i.toString(),value:e,priority:t});var r=Ff(n),a=zc(e,t),o=Lp(n.serverSyncTree_,i),o=ef(a,o,r);let l=jf(n);r=Np(n.serverSyncTree_,i,o,l,!0),Af(n.eventQueue_,r),n.server_.put(i.toString(),a.val(!0),(e,t)=>{var r="ok"===e,r=(r||vu("set at "+i+" failed: "+e),Pp(n.serverSyncTree_,l,!r));Rf(n.eventQueue_,i,r),$f(0,s,e,t)}),o=tg(n,i);Jf(n,o),Rf(n.eventQueue_,o,[])}function zf(r,n,i){r.server_.onDisconnectCancel(n.toString(),(e,t)=>{"ok"===e&&!function e(r,t){var n;return b(t)?(r.value=null,r.children.clear(),!0):null!==r.value?!r.value.isLeafNode()&&(n=r.value,r.value=null,n.forEachChild(I,(e,t)=>{hd(r,new f(e),t)}),e(r,t)):!(0<r.children.size)||(n=_(t),t=y(t),r.children.has(n)&&e(r.children.get(n),t)&&r.children.delete(n),0===r.children.size)}(r.onDisconnect_,n),$f(0,i,e,t)})}function Kf(r,n,e,i){let s=zc(e);r.server_.onDisconnectPut(n.toString(),s.val(!0),(e,t)=>{"ok"===e&&hd(r.onDisconnect_,n,s),$f(0,i,e,t)})}function Wf(e,t,r){let n;n=".info"===_(t._path)?xp(e.infoSyncTree_,t,r):xp(e.serverSyncTree_,t,r),Nf(e.eventQueue_,t._path,n)}function Hf(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Df)}function Gf(e,...t){let r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),gu(r,...t)}function $f(e,n,i,s){n&&Ru(()=>{if("ok"===i)n(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);var r=new Error(e);r.code=t,n(r)}})}function Qf(e,t,r){return Lp(e.serverSyncTree_,t,r)||T.EMPTY_NODE}function Yf(o,l=o.transactionQueueTree_){if(l||eg(o,l),sf(l)){var h=Zf(o,l),e=(g(0<h.length,"Sending zero length transaction queue"),h.every(e=>0===e.status));if(e){var u=o;var c=hf(l);var d=h;let e=d.map(e=>e.currentWriteId),t=Qf(u,c,e),r=t,n=t.hash();for(let a=0;a<d.length;a++){var p=d[a],f=(g(0===p.status,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++,ac(c,p.path));r=r.updateChild(f,p.currentOutputSnapshotRaw)}let i=r.val(!0),s=c;u.server_.put(s.toString(),i,t=>{Gf(u,"transaction put response",{path:s.toString(),status:t});let r=[];if("ok"===t){var n=[];for(let e=0;e<d.length;e++)d[e].status=2,r=r.concat(Pp(u.serverSyncTree_,d[e].currentWriteId)),d[e].onComplete&&n.push(()=>d[e].onComplete(null,!0,d[e].currentOutputSnapshotResolved)),d[e].unwatcher();eg(u,nf(u.transactionQueueTree_,c)),Yf(u,u.transactionQueueTree_),Rf(u.eventQueue_,c,r);for(let t=0;t<n.length;t++)Ru(n[t])}else{if("datastale"===t)for(let e=0;e<d.length;e++)3===d[e].status?d[e].status=4:d[e].status=0;else{vu("transaction at "+s.toString()+" failed: "+t);for(let e=0;e<d.length;e++)d[e].status=4,d[e].abortReason=t}Jf(u,c)}},n)}}else of(l)&&lf(l,e=>{Yf(o,e)})}function Jf(e,t){var r=Xf(e,t),n=hf(r),r=Zf(e,r),i=e,s=r,a=n;if(0!==s.length){var o=[];let r=[];var l=s.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){var h=s[n],u=ac(a,h.path);let e=!1,t;if(g(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat(Pp(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=xf)e=!0,t="maxretry",r=r.concat(Pp(i.serverSyncTree_,h.currentWriteId,!0));else{var u=Qf(i,h.path,l),c=(h.currentInputSnapshot=u,s[n].update(u.val()));if(void 0!==c){Ef("transaction failed: Data returned ",c,h.path);let e=zc(c);"object"==typeof c&&null!=c&&Ee(c,".priority")||(e=e.updatePriority(u.getPriority()));var c=h.currentWriteId,d=Ff(i),u=ef(e,u,d);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=u,h.currentWriteId=jf(i),l.splice(l.indexOf(c),1),r=(r=r.concat(Np(i.serverSyncTree_,h.path,u,h.currentWriteId,h.applyLocally))).concat(Pp(i.serverSyncTree_,c,!0))}else e=!0,t="nodata",r=r.concat(Pp(i.serverSyncTree_,h.currentWriteId,!0))}Rf(i.eventQueue_,a,r),r=[],e&&(s[n].status=2,(e=>{setTimeout(e,Math.floor(0))})(s[n].unwatcher),s[n].onComplete)&&("nodata"===t?o.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):o.push(()=>s[n].onComplete(new Error(t),!1,null)))}eg(i,i.transactionQueueTree_);for(let e=0;e<o.length;e++)Ru(o[e]);Yf(i,i.transactionQueueTree_)}return n}function Xf(e,t){let r,n=e.transactionQueueTree_;for(r=_(t);null!==r&&void 0===sf(n);)n=nf(n,r),t=y(t),r=_(t);return n}function Zf(e,t){var r=[];return function t(r,e,n){let i=sf(e);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);lf(e,e=>{t(r,e,n)})}(e,t,r),r.sort((e,t)=>e.order-t.order),r}function eg(t,r){var n=sf(r);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,af(r,0<n.length?n:void 0)}lf(r,e=>{eg(t,e)})}function tg(t,e){var r=hf(Xf(t,e)),n=nf(t.transactionQueueTree_,e);return((e,t,r)=>{let n=r?e:e.parent;for(;null!==n;){if(t(n))return;n=n.parent}})(n,e=>{rg(t,e)}),rg(t,n),function t(e,r,n,i){n&&!i&&r(e),lf(e,e=>{t(e,r,!0,i)}),n&&i&&r(e)}(n,e=>{rg(t,e)}),r}function rg(i,s){var a=sf(s);if(a){var o=[];let e=[],t=-1;for(let r=0;r<a.length;r++)3!==a[r].status&&(1===a[r].status?(g(t===r-1,"All SENT items should be at beginning of queue."),a[t=r].status=3,a[r].abortReason="set"):(g(0===a[r].status,"Unexpected transaction status in abort"),a[r].unwatcher(),e=e.concat(Pp(i.serverSyncTree_,a[r].currentWriteId,!0)),a[r].onComplete&&o.push(a[r].onComplete.bind(null,new Error("set"),!1,null))));-1===t?af(s,void 0):a.length=t+1,Rf(i.eventQueue_,hf(s),e);for(let n=0;n<o.length;n++)Ru(o[n])}}let ng=function(e,t){var r=ig(e),n=r.namespace,i=("firebase.com"===r.domain&&mu(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===r.domain||mu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||_u(),"ws"===r.scheme||"wss"===r.scheme);return{repoInfo:new Fu(r.host,r.secure,n,i,t,"",n!==r.subdomain),path:new f(r.pathString)}},ig=function(n){let i="",s="",a="",o="",l="",h=!0,u="https",c=443;if("string"==typeof n){let e=n.indexOf("//"),t=(0<=e&&(u=n.substring(0,e-1),n=n.substring(e+2)),n.indexOf("/")),r=(-1===t&&(t=n.length),n.indexOf("?"));-1===r&&(r=n.length),i=n.substring(0,Math.min(t,r)),t<r&&(o=(e=>{let t="";var r=e.split("/");for(let n=0;n<r.length;n++)if(0<r[n].length){let e=r[n];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t})(n.substring(t,r)));var d=(e=>{var t,r,n={};for(t of(e="?"===e.charAt(0)?e.substring(1):e).split("&"))0!==t.length&&(2===(r=t.split("=")).length?n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):vu(`Invalid query segment '${t}' in query '${e}'`));return n})(n.substring(Math.min(n.length,r))),p=(0<=(e=i.indexOf(":"))?(h="https"===u||"wss"===u,c=parseInt(i.substring(e+1),10)):e=i.length,i.slice(0,e));"localhost"===p.toLowerCase()?s="localhost":p.split(".").length<=2?s=p:(p=i.indexOf("."),a=i.substring(0,p).toLowerCase(),s=i.substring(p+1),l=a),"ns"in d&&(l=d.ns)}return{host:i,port:c,domain:s,subdomain:a,secure:h,scheme:u,pathString:o,namespace:l}},sg="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ag=(()=>{let s=0,a=[];return function(e){var t=e===s;s=e;let r;var n=new Array(8);for(r=7;0<=r;r--)n[r]=sg.charAt(e%64),e=Math.floor(e/64);g(0===e,"Cannot push at time == 0");let i=n.join("");if(t){for(r=11;0<=r&&63===a[r];r--)a[r]=0;a[r]++}else for(r=0;r<12;r++)a[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)i+=sg.charAt(a[r]);return g(20===i.length,"nextPushId: Length should be 20."),i}})();class og{constructor(e,t,r,n){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=n}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ie(this.snapshot.exportVal())}}class lg{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class hg{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return g(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ug{constructor(e,t){this._repo=e,this._path=t}cancel(){var e=new Z;return zf(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){mf("OnDisconnect.remove",this._path);var e=new Z;return Kf(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){mf("OnDisconnect.set",this._path),cf("OnDisconnect.set",e,this._path,!1);var t=new Z;return Kf(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){mf("OnDisconnect.setWithPriority",this._path),cf("OnDisconnect.setWithPriority",e,this._path,!1),pf("OnDisconnect.setWithPriority",t,!1);var n=new Z;{var i=this._repo,s=this._path,a=n.wrapCallback(()=>{});let r=zc(e,t);i.server_.onDisconnectPut(s.toString(),r.val(!0),(e,t)=>{"ok"===e&&hd(i.onDisconnect_,s,r),$f(0,a,e,t)})}return n.promise}update(e){mf("OnDisconnect.update",this._path),df("OnDisconnect.update",e,this._path,!1);var n,i,r,s,t=new Z;return n=this._repo,i=this._path,r=e,s=t.wrapCallback(()=>{}),Se(r)?(gu("onDisconnect().update() called with empty data.  Don't do anything."),$f(0,s,"ok",void 0)):n.server_.onDisconnectMerge(i.toString(),r,(e,t)=>{"ok"===e&&Tu(r,(e,t)=>{var r=zc(t);hd(n.onDisconnect_,sc(i,e),r)}),$f(0,s,e,t)}),t.promise}}class cg{constructor(e,t,r,n){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=n}get key(){return b(this._path)?null:rc(this._path)}get ref(){return new gg(this._repo,this._path)}get _queryIdentifier(){var e=sd(this._queryParams),e=su(e);return"{}"===e?"default":e}get _queryObject(){return sd(this._queryParams)}isEqual(e){var t,r,n;return(e=w(e))instanceof cg&&(t=this._repo===e._repo,r=lc(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier,t)&&r&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+(e=>{let t="";for(let r=e.pieceNum_;r<e.pieces_.length;r++)""!==e.pieces_[r]&&(t+="/"+encodeURIComponent(String(e.pieces_[r])));return t||"/"})(this._path)}}function dg(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function pg(e){let t=null,r=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(r=e.getIndexEndValue()),e.getIndex()===_c){var n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==wu)throw new Error(n);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==bu)throw new Error(n);if("string"!=typeof r)throw new Error(i)}}else if(e.getIndex()===I){if(null!=t&&!Tf(t)||null!=r&&!Tf(r))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(g(e.getIndex()instanceof Kc||e.getIndex()===Hc,"unknown index type."),null!=t&&"object"==typeof t||null!=r&&"object"==typeof r)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function fg(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class gg extends cg{constructor(e,t){super(e,t,new ed,!1)}get parent(){var e=ic(this._path);return null===e?null:new gg(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class mg{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new f(e),r=yg(this.ref,e);return new mg(this._node.getChild(t),r,I)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(r){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(e,t)=>r(new mg(t,yg(this.ref,e),I)))}hasChild(e){var t=new f(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function vg(e,t){return(e=w(e))._checkNotDeleted("ref"),void 0!==t?yg(e._root,t):e._root}function _g(e,t){(e=w(e))._checkNotDeleted("refFromURL");var r=ng(t,e._repo.repoInfo_.nodeAdmin),n=(Sf("refFromURL",r),r.repoInfo);return e._repo.repoInfo_.isCustomHost()||n.host===e._repo.repoInfo_.host||mu("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+e._repo.repoInfo_.host+")"),vg(e,r.path.toString())}function yg(e,t){return(null===_((e=w(e))._path)?gf:Cf)("child","path",t,!1),new gg(e._repo,sc(e._path,t))}function wg(e,t){e=w(e),mf("set",e._path),cf("set",t,e._path,!1);var r=new Z;return Bf(e._repo,e._path,t,null,r.wrapCallback(()=>{})),r.promise}function bg(e,t){df("update",t,e._path,!1);var i=new Z;{var a=e._repo,o=e._path,l=(e=t,i.wrapCallback(()=>{}));Gf(a,"update",{path:o.toString(),value:e});let r=!0,n=Ff(a),s={};if(Tu(e,(e,t)=>{r=!1,s[e]=Zp(sc(o,e),zc(t),a.serverSyncTree_,n)}),r)gu("update() called with empty data.  Don't do anything."),$f(0,l,"ok",void 0);else{let i=jf(a);var h=Rp(a.serverSyncTree_,o,s,i);Af(a.eventQueue_,h),a.server_.merge(o.toString(),e,(e,t)=>{var r="ok"===e,r=(r||vu("update at "+o+" failed: "+e),Pp(a.serverSyncTree_,i,!r)),n=0<r.length?Jf(a,o):o;Rf(a.eventQueue_,n,r),$f(0,l,e,t)}),Tu(e,e=>{var t=tg(a,sc(o,e));Jf(a,t)}),Rf(a.eventQueue_,o,[])}}return i.promise}function Ig(t){t=w(t);var i,s,a,e=new hg(()=>{}),e=new Tg(e);return i=t._repo,s=t,a=e,(null!=(e=Fp(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,r=zc(e).withIndex(s._queryParams.getIndex());Mp(i.serverSyncTree_,s,a,!0);let n;return n=s._queryParams.loadsAllData()?Dp(i.serverSyncTree_,s._path,r):(t=jp(i.serverSyncTree_,s),Op(i.serverSyncTree_,s._path,r,t)),Rf(i.eventQueue_,s._path,n),xp(i.serverSyncTree_,s,a,null,!0),r},e=>(Gf(i,"get for query "+Ie(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new mg(e,new gg(t._repo,t._path),t._queryParams.getIndex()))}class Tg{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var r=t._queryParams.getIndex();return new og("value",this,new mg(e.snapshotNode,new gg(t._repo,t._path),r))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lg(this,e,t):null}matches(e){return e instanceof Tg&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Eg{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){var t="children_added"===e?"child_added":e;return this.eventType===("children_removed"===t?"child_removed":t)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new lg(this,e,t):null}createEvent(e,t){g(null!=e.childName,"Child events should have a childName.");var r=yg(new gg(t._repo,t._path),e.childName),n=t._queryParams.getIndex();return new og(e.type,this,new mg(e.snapshotNode,r,n),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Eg&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Cg(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){let r=t;var a=(e,t)=>{Wf(n._repo,n,o),r(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new hg(t,s||void 0);let o="value"===e?new Tg(a):new Eg(e,a);{r=n._repo,i=n,t=o;let e;e=".info"===_(i._path)?Mp(r.infoSyncTree_,i,t):Mp(r.serverSyncTree_,i,t),Nf(r.eventQueue_,i._path,e)}return()=>Wf(n._repo,n,o)}function Sg(e,t,r,n){return Cg(e,"value",t,r,n)}function kg(e,t,r,n){Cg(e,"child_added",t,r,n)}function Ag(e,t,r,n){Cg(e,"child_changed",t,r,n)}function Ng(e,t,r,n){Cg(e,"child_moved",t,r,n)}function Rg(e,t,r,n){Cg(e,"child_removed",t,r,n)}function Pg(e,t,r){let n=null;var i=r?new hg(r):null;"value"===t?n=new Tg(i):t&&(n=new Eg(t,i)),Wf(e._repo,e,n)}class Dg{}class xg extends Dg{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){cf("endAt",this._value,e._path,!0);var t=rd(e._queryParams,this._value,this._key);if(fg(t),pg(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new cg(e._repo,e._path,t,e._orderByCalled)}}class Og extends Dg{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){cf("endBefore",this._value,e._path,!1);var t=((e,t,r)=>{let n;return(n=e.index_===_c||r?rd(e,t,r):rd(e,t,wu)).endBeforeSet_=!0,n})(e._queryParams,this._value,this._key);if(fg(t),pg(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new cg(e._repo,e._path,t,e._orderByCalled)}}class Mg extends Dg{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){cf("startAt",this._value,e._path,!0);var t=td(e._queryParams,this._value,this._key);if(fg(t),pg(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new cg(e._repo,e._path,t,e._orderByCalled)}}class Lg extends Dg{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){cf("startAfter",this._value,e._path,!1);var t=((e,t,r)=>{let n;return(n=e.index_===_c||r?td(e,t,r):td(e,t,bu)).startAfterSet_=!0,n})(e._queryParams,this._value,this._key);if(fg(t),pg(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new cg(e._repo,e._path,t,e._orderByCalled)}}class Fg extends Dg{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new cg(e._repo,e._path,(t=e._queryParams,r=this._limit,(n=t.copy()).limitSet_=!0,n.limit_=r,n.viewFrom_="l",n),e._orderByCalled);var t,r,n}}class Ug extends Dg{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new cg(e._repo,e._path,(t=e._queryParams,r=this._limit,(n=t.copy()).limitSet_=!0,n.limit_=r,n.viewFrom_="r",n),e._orderByCalled);var t,r,n}}class Vg extends Dg{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){dg(e,"orderByChild");var t=new f(this._path);if(b(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Kc(t),t=nd(e._queryParams,t);return pg(t),new cg(e._repo,e._path,t,!0)}}class qg extends Dg{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){dg(e,"orderByKey");var t=nd(e._queryParams,_c);return pg(t),new cg(e._repo,e._path,t,!0)}}class jg extends Dg{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){dg(e,"orderByPriority");var t=nd(e._queryParams,I);return pg(t),new cg(e._repo,e._path,t,!0)}}class Bg extends Dg{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){dg(e,"orderByValue");var t=nd(e._queryParams,Hc);return pg(t),new cg(e._repo,e._path,t,!0)}}class zg extends Dg{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(cf("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new xg(this._value,this._key)._apply(new Mg(this._value,this._key)._apply(e))}}function Kg(e,...t){let r=w(e);for(var n of t)r=n._apply(r);return r}t=gg,g(!fp,"__referenceConstructor has already been defined"),fp=t,t=gg,g(!Sp,"__referenceConstructor has already been defined"),Sp=t;let Wg="FIREBASE_DATABASE_EMULATOR_HOST",Hg={},Gg=!1;function $g(e,t,r,n,i){let s=n||e.options.databaseURL,a=(void 0===s&&(e.options.projectId||mu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),gu("Using default host for project ",e.options.projectId),s=e.options.projectId+"-default-rtdb.firebaseio.com"),ng(s,i)),o=a.repoInfo,l,h=void 0;(h="undefined"!=typeof process&&process.env?process.env[Wg]:h)?(l=!0,s=`http://${h}?ns=`+o.namespace,a=ng(s,i),o=a.repoInfo):l=!a.repoInfo.secure;var u=i&&l?new xu(xu.OWNER):new Du(e.name,e.options,t),u=(Sf("Invalid Firebase Database URL",a),b(a.path)||mu("Database URL must point to the root of a Firebase Database (not including a child path)."),((e,t,r,n)=>{let i=Hg[t.name];var s;return i||(i={},Hg[t.name]=i),(s=i[e.toURLString()])&&mu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Of(e,Gg,r,n),i[e.toURLString()]=s})(o,e,u,new Pu(e,r)));return new Qg(u,e)}class Qg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Mf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0,se("Database",null!==this._repo.repoInfo_.emulatorOptions)),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new gg(this._repo,v())),this._rootInternal}_delete(){var e,t,r;return null!==this._rootInternal&&(e=this._repo,t=this.app.name,(r=Hg[t])&&r[e.key]===e||mu(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Hf(e),delete r[e.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&mu("Cannot call "+e+" on a deleted database.")}}function Yg(){$u.IS_TRANSPORT_INITIALIZED&&vu("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Jg(){Yg(),Ku.forceDisallow()}function Xg(){Yg(),Gu.forceDisallow(),Ku.forceAllow()}function Zg(e,t,r,n={}){(e=w(e))._checkNotDeleted("useEmulator");var i,s=t+":"+r,a=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&Ae(n,a.repoInfo_.emulatorOptions))return;mu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o=void 0;a.repoInfo_.nodeAdmin?(n.mockUserToken&&mu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new xu(xu.OWNER)):n.mockUserToken&&(i="string"==typeof n.mockUserToken?n.mockUserToken:re(n.mockUserToken,e.app.options.projectId),o=new xu(i)),ee(t)&&(te(t),se("Database",!0)),r=a,e=s,t=n,n=o,i=e.lastIndexOf(":"),i=ee(e.substring(0,i)),r.repoInfo_=new Fu(e,i,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0,t),n&&(r.authTokenProvider_=n)}function em(e){(e=w(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Df)}function tm(e,t){fu(e,t)}let rm={".sv":"timestamp"};class nm{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function im(i,e,t){if(i=w(i),mf("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var r=null==(r=null==t?void 0:t.applyLocally)||r;let s=new Z;var n=Sg(i,()=>{}),t=i._repo,a=i._path,o=(e,t,r)=>{var n;e?s.reject(e):(n=new mg(r,new gg(i._repo,i._path),I),s.resolve(new nm(t,n)))},l=n,h=r;Gf(t,"transaction on "+a);var u,n={path:a,update:e,onComplete:o,status:null,order:uu(),applyLocally:h,retryCount:0,unwatcher:l,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},r=Qf(t,a,void 0);if(n.currentInputSnapshot=r,void 0===(u=n.update(r.val())))n.unwatcher(),n.currentOutputSnapshotRaw=null,n.currentOutputSnapshotResolved=null,n.onComplete&&n.onComplete(null,!1,n.currentInputSnapshot);else{Ef("transaction failed: Data returned ",u,n.path),n.status=0;var c=nf(t.transactionQueueTree_,a),d=sf(c)||[];d.push(n),af(c,d);let e;"object"==typeof u&&null!==u&&Ee(u,".priority")?(e=Ce(u,".priority"),g(Tf(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):(c=Lp(t.serverSyncTree_,a)||T.EMPTY_NODE,e=c.getPriority().val());d=Ff(t),c=zc(u,e),u=ef(c,r,d),r=(n.currentOutputSnapshotRaw=c,n.currentOutputSnapshotResolved=u,n.currentWriteId=jf(t),Np(t.serverSyncTree_,a,u,n.currentWriteId,n.applyLocally));Rf(t.eventQueue_,a,r),Yf(t,t.transactionQueueTree_)}return s.promise}fc.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},fc.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Qh(Ut),Pt(new u("database",(e,{instanceIdentifier:t})=>$g(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),d(Gh,"1.0.17",rD),d(Gh,"1.0.17","esm2017");function sm(e){var t="FIREBASE WARNING: "+e;am.warn(t)}let am=new et("@firebase/database-compat");class om{constructor(e){this._delegate=e}cancel(t){l("OnDisconnect.cancel",0,1,arguments.length),Ue("OnDisconnect.cancel","onComplete",t,!0);var e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){l("OnDisconnect.remove",0,1,arguments.length),Ue("OnDisconnect.remove","onComplete",t,!0);var e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){l("OnDisconnect.set",1,2,arguments.length),Ue("OnDisconnect.set","onComplete",t,!0);var r=this._delegate.set(e);return t&&r.then(()=>t(null),e=>t(e)),r}setWithPriority(e,t,r){l("OnDisconnect.setWithPriority",2,3,arguments.length),Ue("OnDisconnect.setWithPriority","onComplete",r,!0);var n=this._delegate.setWithPriority(e,t);return r&&n.then(()=>r(null),e=>r(e)),n}update(t,r){if(l("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){var n={};for(let e=0;e<t.length;++e)n[""+e]=t[e];t=n,sm("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ue("OnDisconnect.update","onComplete",r,!0);var e=this._delegate.update(t);return r&&e.then(()=>r(null),e=>r(e)),e}}class lm{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return l("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class hm{constructor(e,t){this._database=e,this._delegate=t}val(){return l("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return l("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return l("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return l("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return l("DataSnapshot.child",0,1,arguments.length),e=String(e),Cf("DataSnapshot.child","path",e,!1),new hm(this._database,this._delegate.child(e))}hasChild(e){return l("DataSnapshot.hasChild",1,1,arguments.length),Cf("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return l("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return l("DataSnapshot.forEach",1,1,arguments.length),Ue("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new hm(this._database,e)))}hasChildren(){return l("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return l("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return l("DataSnapshot.ref",0,0,arguments.length),new cm(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class um{constructor(e,t){this.database=e,this._delegate=t}on(e,r,t,n){var i;l("Query.on",2,4,arguments.length),Ue("Query.on","callback",r,!1);let s=um.getCancelAndContextArgs_("Query.on",t,n);var a=(e,t)=>{r.call(s.context,new hm(this.database,e),t)},o=(a.userCallback=r,a.context=s.context,null==(i=s.cancel)?void 0:i.bind(s.context));switch(e){case"value":return Sg(this._delegate,a,o),r;case"child_added":return kg(this._delegate,a,o),r;case"child_removed":return Rg(this._delegate,a,o),r;case"child_changed":return Ag(this._delegate,a,o),r;case"child_moved":return Ng(this._delegate,a,o),r;default:throw new Error(Fe("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){l("Query.off",0,3,arguments.length);var n,i="Query.off",s=e,a=!0;if(!a||void 0!==s)switch(s){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Fe(i,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}Ue("Query.off","callback",t,!0),Ve("Query.off","context",r,!0),t?((n=()=>{}).userCallback=t,n.context=r,Pg(this._delegate,e,n)):Pg(this._delegate,e)}get(){return Ig(this._delegate).then(e=>new hm(this.database,e))}once(e,n,t,r){l("Query.once",1,4,arguments.length),Ue("Query.once","callback",n,!0);let i=um.getCancelAndContextArgs_("Query.once",t,r),s=new Z;var a=(e,t)=>{var r=new hm(this.database,e);n&&n.call(i.context,r,t),s.resolve(r)},o=(a.userCallback=n,a.context=i.context,e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)});switch(e){case"value":Sg(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":kg(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":Rg(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":Ag(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":Ng(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(Fe("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return l("Query.limitToFirst",1,1,arguments.length),new um(this.database,Kg(this._delegate,(e=>{if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Fg(e)})(e)))}limitToLast(e){return l("Query.limitToLast",1,1,arguments.length),new um(this.database,Kg(this._delegate,(e=>{if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Ug(e)})(e)))}orderByChild(e){return l("Query.orderByChild",1,1,arguments.length),new um(this.database,Kg(this._delegate,(e=>{if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Cf("orderByChild","path",e,!1),new Vg(e)})(e)))}orderByKey(){return l("Query.orderByKey",0,0,arguments.length),new um(this.database,Kg(this._delegate,new qg))}orderByPriority(){return l("Query.orderByPriority",0,0,arguments.length),new um(this.database,Kg(this._delegate,new jg))}orderByValue(){return l("Query.orderByValue",0,0,arguments.length),new um(this.database,Kg(this._delegate,new Bg))}startAt(e=null,t){return l("Query.startAt",0,2,arguments.length),new um(this.database,Kg(this._delegate,([e=null,t]=[e,t],ff("startAt","key",t,!0),new Mg(e,t))))}startAfter(e=null,t){return l("Query.startAfter",0,2,arguments.length),new um(this.database,Kg(this._delegate,(e=e,t=t,ff("startAfter","key",t,!0),new Lg(e,t))))}endAt(e=null,t){return l("Query.endAt",0,2,arguments.length),new um(this.database,Kg(this._delegate,(e=e,t=t,ff("endAt","key",t,!0),new xg(e,t))))}endBefore(e=null,t){return l("Query.endBefore",0,2,arguments.length),new um(this.database,Kg(this._delegate,(e=e,t=t,ff("endBefore","key",t,!0),new Og(e,t))))}equalTo(e,t){return l("Query.equalTo",1,2,arguments.length),new um(this.database,Kg(this._delegate,(e=e,t=t,ff("equalTo","key",t,!0),new zg(e,t))))}toString(){return l("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return l("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(l("Query.isEqual",1,1,arguments.length),e instanceof um)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,r){var n={cancel:void 0,context:void 0};if(t&&r)n.cancel=t,Ue(e,"cancel",n.cancel,!0),n.context=r,Ve(e,"context",n.context,!0);else if(t)if("object"==typeof t&&null!==t)n.context=t;else{if("function"!=typeof t)throw new Error(Fe(e,"cancelOrContext")+" must either be a cancel callback or a context object.");n.cancel=t}return n}get ref(){return new cm(this.database,new gg(this._delegate._repo,this._delegate._path))}}class cm extends um{constructor(e,t){super(e,new cg(t._repo,t._path,new ed,!1)),this.database=e,this._delegate=t}getKey(){return l("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return l("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new cm(this.database,yg(this._delegate,e))}getParent(){l("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new cm(this.database,e):null}getRoot(){return l("Reference.root",0,0,arguments.length),new cm(this.database,this._delegate.root)}set(e,t){l("Reference.set",1,2,arguments.length),Ue("Reference.set","onComplete",t,!0);var r=wg(this._delegate,e);return t&&r.then(()=>t(null),e=>t(e)),r}update(t,r){if(l("Reference.update",1,2,arguments.length),Array.isArray(t)){var n={};for(let e=0;e<t.length;++e)n[""+e]=t[e];t=n,sm("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}mf("Reference.update",this._delegate._path),Ue("Reference.update","onComplete",r,!0);var e=bg(this._delegate,t);return r&&e.then(()=>r(null),e=>r(e)),e}setWithPriority(e,t,r){l("Reference.setWithPriority",2,3,arguments.length),Ue("Reference.setWithPriority","onComplete",r,!0);var n=((e,t,r)=>{if(mf("setWithPriority",e._path),cf("setWithPriority",t,e._path,!1),pf("setWithPriority",r,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var n=new Z;return Bf(e._repo,e._path,t,r,n.wrapCallback(()=>{})),n.promise})(this._delegate,e,t);return r&&n.then(()=>r(null),e=>r(e)),n}remove(t){l("Reference.remove",0,1,arguments.length),Ue("Reference.remove","onComplete",t,!0);e=this._delegate,mf("remove",e._path);var e,r=wg(e,null);return t&&r.then(()=>t(null),e=>t(e)),r}transaction(e,t,r){l("Reference.transaction",1,3,arguments.length),Ue("Reference.transaction","transactionUpdate",e,!1),Ue("Reference.transaction","onComplete",t,!0);var n,i="Reference.transaction",s="applyLocally",a=r,o=!0;if(o&&void 0===a||"boolean"==typeof a)return n=im(this._delegate,e,{applyLocally:r}).then(e=>new lm(e.committed,new hm(this.database,e.snapshot))),t&&n.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),n;throw new Error(Fe(i,s)+"must be a boolean.")}setPriority(e,t){l("Reference.setPriority",1,2,arguments.length),Ue("Reference.setPriority","onComplete",t,!0);r=this._delegate,e=e,r=w(r),mf("setPriority",r._path),pf("setPriority",e,!1),n=new Z,Bf(r._repo,sc(r._path,".priority"),e,null,n.wrapCallback(()=>{}));var r,n=n.promise;return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){l("Reference.push",0,2,arguments.length),Ue("Reference.push","onComplete",t,!0);var r=((e,t)=>{e=w(e),mf("push",e._path),cf("push",t,e._path,!0);var r=Lf(e._repo),r=ag(r),n=yg(e,r);let i=yg(e,r),s;return s=null!=t?wg(i,t).then(()=>i):Promise.resolve(i),n.then=s.then.bind(s),n.catch=s.then.bind(s,void 0),n})(this._delegate,e),n=r.then(e=>new cm(this.database,e)),r=(t&&n.then(()=>t(null),e=>t(e)),new cm(this.database,r));return r.then=n.then.bind(n),r.catch=n.catch.bind(n,void 0),r}onDisconnect(){return mf("Reference.onDisconnect",this._delegate._path),new om(new ug(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class dm{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Jg,forceLongPolling:Xg}}useEmulator(e,t,r={}){Zg(this._delegate,e,t,r)}ref(e){var t;return l("database.ref",0,1,arguments.length),e instanceof cm?(t=_g(this._delegate,e.toString()),new cm(this,t)):(t=vg(this._delegate,e),new cm(this,t))}refFromURL(e){l("database.refFromURL",1,1,arguments.length);var t=_g(this._delegate,e);return new cm(this,t)}goOffline(){var e;l("database.goOffline",0,0,arguments.length),(e=w(e=this._delegate))._checkNotDeleted("goOffline"),Hf(e._repo)}goOnline(){return l("database.goOnline",0,0,arguments.length),em(this._delegate)}}dm.ServerValue={TIMESTAMP:rm,increment:e=>({".sv":{increment:e}})};lr=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:r,customAuthImpl:n,customAppCheckImpl:i,namespace:s,nodeAdmin:a=!1}){Qh(r);var o=new $e("database-standalone"),l=new Ge("auth-internal",o);l.setComponent(new u("auth-internal",()=>n,"PRIVATE"));let h=void 0;return i&&(h=new Ge("app-check-internal",o)).setComponent(new u("app-check-internal",()=>i,"PRIVATE")),{instance:new dm($g(e,l,h,t,a),e),namespace:s}}});let pm=dm.ServerValue;(t=or).INTERNAL.registerComponent(new u("database-compat",(e,{instanceIdentifier:t})=>{var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("database").getImmediate({identifier:t});return new dm(n,r)},"PUBLIC").setServiceProps({Reference:cm,Query:um,Database:dm,DataSnapshot:hm,enableLogging:tm,INTERNAL:lr,ServerValue:pm}).setMultipleInstances(!0)),t.registerVersion("@firebase/database-compat","2.0.8");var fm,gm,mm,vm,_m,ym,wm,bm,Im,Tm,Em,Cm,Sm="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},km=(!(function(){var e,t,s;function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(){}function a(e,t,r){r=r||0;var n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1];var i=e.g[2],s=e.g[3],a=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=r+((a=t+(s^r&(i^s))+n[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i^s)+n[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(r|~s))+n[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=r+((a=t+(i^(r|~s))+n[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~r))+n[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+n[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function h(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}t=r,s=function(){this.blockSize=-1},n.prototype=s.prototype,t.D=s.prototype,t.prototype=new n,(t.prototype.constructor=t).C=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)},r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},r.prototype.u=function(e,t){for(var r=(t=void 0===t?e.length:t)-this.blockSize,n=this.B,i=this.h,s=0;s<t;){if(0==i)for(;s<=r;)a(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(n[i++]=e.charCodeAt(s++),i==this.blockSize){a(this,n),i=0;break}}else for(;s<t;)if(n[i++]=e[s++],i==this.blockSize){a(this,n),i=0;break}}this.h=i,this.o+=t},r.prototype.v=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;for(var r=8*this.o,t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;t<4;++t)for(var n=0;n<32;n+=8)e[r++]=this.g[t]>>>n&255;return e};var i={};function o(e){return-128<=e&&e<128?(t=e,r=function(e){return new h([0|e],e<0?-1:0)},n=i,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=r(t)):new h([0|e],e<0?-1:0);var t,r,n}function u(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(u(-e));for(var t=[],r=1,n=0;r<=e;n++)t[n]=e/r|0,r*=4294967296;return new h(t,0)}var c=o(0),l=o(1),d=o(16777216);function p(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function f(e){return-1==e.h}function g(e){for(var t=e.g.length,r=[],n=0;n<t;n++)r[n]=~e.g[n];return new h(r,~e.h).add(l)}function m(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function _(e,t){this.g=e,this.h=t}function y(e,t){if(p(t))throw Error("division by zero");if(p(e))return new _(c,c);if(f(e))return t=y(g(e),t),new _(g(t.g),g(t.h));if(f(t))return t=y(e,g(t)),new _(g(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=l,n=t;n.l(e)<=0;)r=w(r),n=w(n);for(var i=b(r,1),s=b(n,1),n=b(n,2),r=b(r,2);!p(n);){var a=s.add(n);a.l(e)<=0&&(i=i.add(r),s=a),n=b(n,1),r=b(r,1)}return t=m(e,i.j(t)),new _(i,t)}for(i=c;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=(n=Math.ceil(Math.log(r)/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=u(r)).j(t);f(a)||0<a.l(e);)a=(s=u(r-=n)).j(t);p(s)&&(s=l),i=i.add(s),e=m(e,a)}return new _(i,e)}function w(e){for(var t=e.g.length+1,r=[],n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new h(r,e.h)}function b(e,t){var r=t>>5;t%=32;for(var n=e.g.length-r,i=[],s=0;s<n;s++)i[s]=0<t?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new h(i,e.h)}(e=h.prototype).m=function(){if(f(this))return-g(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(f(this))return"-"+g(this).toString(e);for(var t=u(Math.pow(e,6)),r=this,n="";;){var i=y(r,t).g,s=((0<(r=m(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return f(e=m(this,e))?-1:p(e)?0:1},e.abs=function(){return f(this)?g(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0,i=0;i<=t;i++){var s=n+(65535&this.i(i))+(65535&e.i(i)),a=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16),n=a>>>16;r[i]=(a&=65535)<<16|(s&=65535)}return new h(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(p(this)||p(e))return c;if(f(this))return f(e)?g(this).j(g(e)):g(g(this).j(e));if(f(e))return g(this.j(g(e)));if(this.l(d)<0&&e.l(d)<0)return u(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(var i=0;i<e.g.length;i++){var s=this.i(n)>>>16,a=65535&this.i(n),o=e.i(i)>>>16,l=65535&e.i(i);r[2*n+2*i]+=a*l,v(r,2*n+2*i),r[2*n+2*i+1]+=s*l,v(r,2*n+2*i+1),r[2*n+2*i+1]+=a*o,v(r,2*n+2*i+1),r[2*n+2*i+2]+=s*o,v(r,2*n+2*i+2)}for(n=0;n<t;n++)r[n]=r[2*n+1]<<16|r[2*n];for(n=t;n<2*t;n++)r[n]=0;return new h(r,0)},e.A=function(e){return y(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new h(r,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new h(r,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new h(r,this.h^e.h)},r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,gm=r,h.prototype.multiply=h.prototype.j,h.prototype.modulo=h.prototype.A,h.prototype.compare=h.prototype.l,h.prototype.toNumber=h.prototype.m,h.prototype.getBits=h.prototype.i,h.fromNumber=u,h.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=u(Math.pow(r,8)),i=c,s=0;s<t.length;s+=8)var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),r),i=(a<8?(a=u(Math.pow(r,a)),i.j(a)):i=i.j(n)).add(u(o));return i},fm=h}).apply(void 0!==Sm?Sm:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});!(function(){var e,R="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value),e};var P=(e=>{e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof km&&km];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")})(this);var t="Array.prototype.values",r=function(e){return e||function(){return r=function(e,t){return t},(t=this)instanceof String&&(t+=""),n=0,i=!1,(e={next:function(){var e;return!i&&n<t.length?(e=n++,{value:r(e,t[e]),done:!1}):{done:i=!0,value:void 0}}})[Symbol.iterator]=function(){return e},e;var t,r,n,i,e}};if(r)e:{var n=P;t=t.split(".");for(var i=0;i<t.length-1;i++){var U=t[i];if(!(U in n))break e;n=n[U]}(r=r(i=n[t=t[t.length-1]]))!=i&&null!=r&&R(n,t,{configurable:!0,writable:!0,value:r})}var V=V||{},D=this||self;function q(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function h(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function j(e,t,r){return e.call.apply(e.bind,arguments)}function B(t,r,e){var n;if(t)return 2<arguments.length?(n=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,n),t.apply(r,e)}):function(){return t.apply(r,arguments)};throw Error()}function m(e,t,r){return(m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?j:B).apply(null,arguments)}function z(t){var r=Array.prototype.slice.call(arguments,1);return function(){var e=r.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function s(e,s){function t(){}t.prototype=s.prototype,e.aa=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Qb=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)}}function K(t){var r=t.length;if(0<r){var n=Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n}return[]}function W(t){for(let e=1;e<arguments.length;e++){var r=arguments[e];if(q(r)){var n=t.length||0,i=r.length||0;t.length=n+i;for(let e=0;e<i;e++)t[n+e]=r[e]}else t.push(r)}}function x(e){return/^[\s\xa0]*$/.test(e)}function a(){var e=D.navigator;return(e=e&&e.userAgent)||""}function H(e){return H[" "](e),e}H[" "]=function(){};var G=!(-1==a().indexOf("Gecko")||-1!=a().toLowerCase().indexOf("webkit")&&-1==a().indexOf("Edge")||-1!=a().indexOf("Trident")||-1!=a().indexOf("MSIE")||-1!=a().indexOf("Edge"));function $(e,t,r){for(var n in e)t.call(r,e[n],n,e)}function Q(e){var t,r={};for(t in e)r[t]=e[t];return r}let Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t){let r,n;for(let i=1;i<arguments.length;i++){for(r in n=arguments[i])t[r]=n[r];for(let e=0;e<Y.length;e++)r=Y[e],Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}}var X=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Z,e=>e.reset());class Z{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let o,l=!1,ee=new class{constructor(){this.h=this.g=null}add(e,t){var r=X.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},te=()=>{let e=D.Promise.resolve(void 0);o=()=>{e.then(re)}};var re=()=>{for(var e;e=(()=>{let e=ee,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t})();){try{e.h.call(e.g)}catch(e){(e=>{D.setTimeout(()=>{throw e},0)})(e)}var t=X;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}l=!1};function u(){this.s=this.s,this.C=this.C}function c(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}u.prototype.s=!1,u.prototype.ma=function(){this.s||(this.s=!0,this.N())},u.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},c.prototype.h=function(){this.defaultPrevented=!0};var ne=(()=>{if(!D.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var r=()=>{};D.addEventListener("test",r,t),D.removeEventListener("test",r,t)}catch(e){}return e})();function d(e,t){if(c.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(G){e:{try{H(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ie[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&d.aa.h.call(this)}}s(d,c);var ie={2:"touch",3:"pen",4:"mouse"},p=(d.prototype.h=function(){d.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1},"closure_listenable_"+(1e6*Math.random()|0)),se=0;function ae(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++se,this.da=this.fa=!1}function oe(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function le(e){this.src=e,this.g={},this.h=0}function he(e,t){var r,n,i,s=t.type;s in e.g&&(r=e.g[s],(i=0<=(n=Array.prototype.indexOf.call(r,t,void 0)))&&Array.prototype.splice.call(r,n,1),i)&&(oe(t),0==e.g[s].length)&&(delete e.g[s],e.h--)}function ue(e,t,r,n){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!r&&s.ha==n)return i}return-1}le.prototype.add=function(e,t,r,n,i){var s=e.toString(),a=((e=this.g[s])||(e=this.g[s]=[],this.h++),ue(e,t,n,i));return-1<a?(t=e[a],r||(t.fa=!1)):((t=new ae(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var ce="closure_lm_"+(1e6*Math.random()|0),de={};function pe(e,t,r,n,i){if(n&&n.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}n=we(n);return t&&t[p]?t.L(r,n,h(i)?!!i.capture:!!i,s):fe(t,r,n,!0,i,s)}(e,t,r,n,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)pe(e,t[s],r,n,i);return null}return r=we(r),e&&e[p]?e.K(t,r,h(n)?!!n.capture:!!n,i):fe(e,t,r,!1,n,i)}function fe(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");var a=h(i)?!!i.capture:!!i,o=_e(e);if(o||(e[ce]=o=new le(e)),!(r=o.add(t,r,n,a,s)).proxy)if(n=(()=>{let r=ve;return function e(t){return r.call(e.src,e.listener,t)}})(),(r.proxy=n).src=e,n.listener=r,e.addEventListener)void 0===(i=ne?i:a)&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(me(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function ge(e){var t,r,n;"number"!=typeof e&&e&&!e.da&&((t=e.src)&&t[p]?he(t.i,e):(r=e.type,n=e.proxy,t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(me(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=_e(t))?(he(r,e),0==r.h&&(r.src=null,t[ce]=null)):oe(e)))}function me(e){return e in de?de[e]:de[e]="on"+e}function ve(e,t){var r,n;return e=!!e.da||(t=new d(t,this),r=e.listener,n=e.ha||e.src,e.fa&&ge(e),r.call(n,t))}function _e(e){return(e=e[ce])instanceof le?e:null}var ye="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(t){return"function"==typeof t?t:(t[ye]||(t[ye]=function(e){return t.handleEvent(e)}),t[ye])}function f(){u.call(this),this.i=new le(this),(this.M=this).F=null}function g(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t?t=new c(t,e):t instanceof c?t.target=t.target||e:(a=t,J(t=new c(n,e),a)),a=!0,r)for(var i=r.length-1;0<=i;i--)var s=t.g=r[i],a=be(s,n,!0,t)&&a;if(a=be(s=t.g=e,n,!0,t)&&a,a=be(s,n,!1,t)&&a,r)for(i=0;i<r.length;i++)a=be(s=t.g=r[i],n,!1,t)&&a}function be(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,l=t[s];l&&!l.da&&l.capture==r&&(a=l.listener,o=l.ha||l.src,l.fa&&he(e.i,l),i=!1!==a.call(o,n)&&i)}return i&&!n.defaultPrevented}function Ie(e,t,r){if("function"==typeof e)r&&(e=m(e,r));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=m(e.handleEvent,e)}return 2147483647<Number(t)?-1:D.setTimeout(e,t||0)}s(f,u),f.prototype[p]=!0,f.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else i=h(i)?!!i.capture:!!i,n=we(n),t&&t[p]?(t=t.i,(r=String(r).toString())in t.g&&-1<(n=ue(a=t.g[r],n,i,s))&&(oe(a[n]),Array.prototype.splice.call(a,n,1),0==a.length)&&(delete t.g[r],t.h--)):(t=t&&_e(t))&&(r=t.g[r.toString()],n=(t=-1)<(t=r?ue(r,n,i,s):t)?r[t]:null)&&ge(n)}(this,e,t,r,n)},f.prototype.N=function(){if(f.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)oe(r[n]);delete t.g[e],t.h--}}this.F=null},f.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},f.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class Te extends u{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Ie(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);var r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function v(e){u.call(this),this.h=e,this.g={}}s(v,u);var Ee=[];function Ce(e){$(e.g,function(e,t){this.g.hasOwnProperty(t)&&ge(e)},e),e.g={}}v.prototype.N=function(){v.aa.N.call(this),Ce(this)},v.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Se=D.JSON.stringify,ke=D.JSON.parse,Ae=class{stringify(e){return D.JSON.stringify(e,void 0)}parse(e){return D.JSON.parse(e,void 0)}};function Ne(){}function Re(e){return e.h||(e.h=e.i())}function Pe(){}Ne.prototype.h=null;var De={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xe(){c.call(this,"d")}function Oe(){c.call(this,"c")}s(xe,c),s(Oe,c);var _={},Me=null;function Le(){return Me=Me||new f}function Fe(e){c.call(this,_.La,e)}function Ue(){var e=Le();g(e,new Fe(e))}function Ve(e,t){c.call(this,_.STAT_EVENT,e),this.stat=t}function O(e){var t=Le();g(t,new Ve(t,e))}function qe(e,t){c.call(this,_.Ma,e),this.size=t}function je(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){e()},t)}function Be(){this.g=!0}function M(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+((e,t)=>{if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Se(r)}catch(e){return t}})(e,r)+(n?" "+n:"")})}_.La="serverreachability",s(Fe,c),_.STAT_EVENT="statevent",s(Ve,c),_.Ma="timingevent",s(qe,c),Be.prototype.xa=function(){this.g=!1},Be.prototype.info=function(){};var ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ke={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function We(){}function y(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new v(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new He}function He(){this.i=null,this.g="",this.h=!1}s(We,Ne),We.prototype.g=function(){return new XMLHttpRequest},We.prototype.i=function(){return{}};var Ge=new We,$e={},Qe={};function Ye(e,t,r){e.L=1,e.v=vt(b(t)),e.m=r,e.P=!0,Je(e,null)}function Je(e,t){e.F=Date.now(),Ze(e),e.A=b(e.v);var r=e.A,n=e.R,i=(Array.isArray(n)||(n=[String(n)]),Rt(r.i,"t",n),e.C=0,r=e.j.J,e.h=new He,e.g=cr(e.j,r?t:null,!e.m),0<e.O&&(e.M=new Te(m(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca,"readystatechange");Array.isArray(i)||(i&&(Ee[0]=i.toString()),i=Ee);for(var a,o,l,h,u,c,s=0;s<i.length;s++){var d=pe(r,i[s],n||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?Q(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ue(),a=e.i,o=e.u,l=e.A,h=e.l,u=e.R,c=e.m,a.info(function(){if(a.g)if(c)for(var e="",t=c.split("&"),r=0;r<t.length;r++){var n,i,s=t[r].split("=");1<s.length&&(n=s[0],s=s[1],e=2<=(i=n.split("_")).length&&"type"==i[1]?e+(n+"=")+s+"&":e+(n+"=redacted&"))}else e=null;else e=c;return"XMLHTTP REQ ("+h+") [attempt "+u+"]: "+o+"\n"+l+"\n"+e})}function Xe(e){return e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Ze(e){e.S=Date.now()+e.I,et(e,e.I)}function et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=je(m(e.ba,e),t)}function tt(e){e.B&&(D.clearTimeout(e.B),e.B=null)}function rt(e){0==e.j.G||e.J||or(e.j,e)}function L(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,Ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function nt(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||lt(r.h,e)))if(!e.K&&lt(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.u){if(r.g){if(!(r.g.F+3e3<e.F))break e;ar(r),Yt(r)}nr(r),O(18)}}else r.za=i[1],0<r.za-r.T&&i[2]<37500&&r.F&&0==r.v&&!r.C&&(r.C=je(m(r.Za,r),6e3));if(ot(r.h)<=1&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else k(r,11)}else if(!e.K&&r.g!=e||ar(r),!x(t))for(i=r.Da.g.parse(t),t=0;t<i.length;t++){var s,a,o,l,h,u,c,d,p,f,g=i[t];r.T=g[0],g=g[1],2==r.G?"c"==g[0]?(r.K=g[1],r.ia=g[2],null!=(s=g[3])&&(r.la=s,r.j.info("VER="+r.la)),null!=(a=g[4])&&(r.Aa=a,r.j.info("SVER="+r.Aa)),null!=(o=g[5])&&"number"==typeof o&&0<o&&(n=1.5*o,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r,(l=e.g)&&(!(h=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null)||(u=n.h).g||-1==h.indexOf("spdy")&&-1==h.indexOf("quic")&&-1==h.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(ht(u,u.h),u.h=null)),n.D)&&(c=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.ya=c,I(n.I,n.D,c)),r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms")),d=e,(n=r).qa=ur(n,n.J?n.ia:null,n.W),d.K?(ut(n.h,d),p=d,(f=n.L)&&(p.I=f),p.B&&(tt(p),Ze(p)),n.g=d):rr(n),0<r.i.length&&Xt(r)):"stop"!=g[0]&&"close"!=g[0]||k(r,7):3==r.G&&("stop"==g[0]||"close"==g[0]?"stop"==g[0]?k(r,7):Qt(r):"noop"!=g[0]&&r.l&&r.l.ta(g),r.v=0)}Ue()}catch(e){}}y.prototype.ca=function(e){e=e.target;var t=this.M;t&&3==F(e)?t.j():this.Y(e)},y.prototype.Y=function(e){try{if(e==this.g)e:{var t=F(this.g),r=this.g.Ba();this.g.Z();if(!(t<3)&&(3!=t||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=t||7==r||Ue(),tt(this);var n=this.g.Z();this.X=n;t:if(Xe(this)){var i=Ht(this.g),s=(e="",i.length),a=4==F(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){L(this),rt(this);var o="";break t}this.h.i=new D.TextDecoder}for(r=0;r<s;r++)this.h.h=!0,e+=this.h.i.decode(i[r],{stream:!(a&&r==s-1)});i.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,C=this.i,S=this.u,k=this.A,A=this.l,N=this.R,R=t,P=n,C.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+N+"]: "+S+"\n"+k+"\n"+R+" "+P}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h=this.g;if((l=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,O(12),L(this),rt(this);break e}M(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nt(this,n)}if(this.P){for(var c,d,n=!0;!this.J&&this.C<o.length;){if(I=o,E=T=void 0,T=(b=this).C,(c=-1==(E=I.indexOf("\n",T))?Qe:(T=Number(I.substring(T,E)),isNaN(T)?$e:(E+=1)+T>I.length?Qe:(I=I.slice(E,E+T),b.C=E+T,I)))==Qe){4==t&&(this.s=4,O(14),n=!1),M(this.i,this.l,null,"[Incomplete Response]");break}if(c==$e){this.s=4,O(15),M(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}M(this.i,this.l,c,null),nt(this,c)}Xe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=t||0!=o.length||this.h.h||(this.s=1,O(16),n=!1),this.o=this.o&&n,n?0<o.length&&!this.W&&(this.W=!0,(d=this.j).g==this)&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),ir(d),d.M=!0,O(11)):(M(this.i,this.l,o,"[Invalid Chunked Response]"),L(this),rt(this))}else M(this.i,this.l,o,null),nt(this,o);4==t&&L(this),this.o&&!this.J&&(4==t?or(this.j,this):(this.o=!1,Ze(this)))}else{{var p=this.g;var f,g,m,v={};p=(p.g&&2<=F(p)&&p.g.getAllResponseHeaders()||"").split("\r\n");for(let e=0;e<p.length;e++)x(p[e])||(f=(e=>{for(var t=1,r=(e=e.split(":"),[]);0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r})(p[e]),g=f[0],"string"==typeof(f=f[1])&&(f=f.trim(),m=v[g]||[],(v[g]=m).push(f)));var _,y=v,w=function(e){return e.join(", ")};for(_ in y)w.call(void 0,y[_],_,y)}400==n&&0<o.indexOf("Unknown SID")?(this.s=3,O(12)):(this.s=0,O(13)),L(this),rt(this)}}}}catch(e){}var b,I,T,E,C,S,k,A,N,R,P},y.prototype.cancel=function(){this.J=!0,L(this)},y.prototype.ba=function(){this.B=null;var e,t,r=Date.now();0<=r-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(Ue(),O(17)),L(this),this.s=2,rt(this)):et(this,this.S-r)};var it=class{constructor(e,t){this.g=e,this.map=t}};function st(e){this.l=e||10,e=D.PerformanceNavigationTiming?0<(e=D.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(D.chrome&&D.chrome.loadTimes&&D.chrome.loadTimes()&&D.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function at(e){return e.h||e.g&&e.g.size>=e.j}function ot(e){return e.h?1:e.g?e.g.size:0}function lt(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function ht(e,t){e.g?e.g.add(t):e.h=t}function ut(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ct(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return K(t.i);{let e=t.i;for(var r of t.g.values())e=e.concat(r.D);return e}}function dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(q(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=(e=>{if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(q(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r)}else for(var n in t=[],r=0,e)t[r++]=n;return t}}})(e),n=(e=>{if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(q(e))for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);else for(n in t=[],r=0,e)t[r++]=e[n];return t})(e),i=n.length,s=0;s<i;s++)t.call(void 0,n[s],r&&r[s],e)}st.prototype.cancel=function(){if(this.i=ct(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(var e of this.g.values())e.cancel();this.g.clear()}};var pt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function w(e){var t,r;this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof w?(this.h=e.h,ft(this,e.j),this.o=e.o,this.g=e.g,gt(this,e.s),this.l=e.l,t=e.i,(r=new kt).i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),mt(this,r),this.m=e.m):e&&(t=String(e).match(pt))?(this.h=!1,ft(this,t[1]||"",!0),this.o=_t(t[2]||""),this.g=_t(t[3]||"",!0),gt(this,t[4]),this.l=_t(t[5]||"",!0),mt(this,t[6]||"",!0),this.m=_t(t[7]||"")):(this.h=!1,this.i=new kt(null,this.h))}function b(e){return new w(e)}function ft(e,t,r){e.j=r?_t(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.s=t}else e.s=null}function mt(e,t,r){var n,i;t instanceof kt?(e.i=t,n=e.i,(i=e.h)&&!n.j&&(T(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(At(this,t),Rt(this,r,e))},n)),n.j=i):(r||(t=yt(t,Ct)),e.i=new kt(t,e.h))}function I(e,t,r){e.i.set(t,r)}function vt(e){return I(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function _t(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function yt(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,wt),e=r?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function wt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}w.prototype.toString=function(){var e=[],t=this.j,r=(t&&e.push(yt(t,It,!0),":"),this.g);return!r&&"file"!=t||(e.push("//"),(t=this.o)&&e.push(yt(t,It,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null==(r=this.s))||e.push(":",String(r)),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(yt(r,"/"==r.charAt(0)?Et:Tt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",yt(r,St)),e.join("")};var bt,It=/[#\/\?@]/g,Tt=/[#\?:]/g,Et=/[#\?]/g,Ct=/[#\?@]/g,St=/#/g;function kt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function T(r){if(!r.g&&(r.g=new Map,r.h=0,r.i)){var e=r.i,t=function(e,t){r.add(decodeURIComponent(e.replace(/\+/g," ")),t)};if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i,s=e[n].indexOf("="),a=null;0<=s?(i=e[n].substring(0,s),a=e[n].substring(s+1)):i=e[n],t(i,a?decodeURIComponent(a.replace(/\+/g," ")):"")}}}}function At(e,t){T(e),t=E(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Nt(e,t){return T(e),t=E(e,t),e.g.has(t)}function Rt(e,t,r){At(e,t),0<r.length&&(e.i=null,e.g.set(E(e,t),K(r)),e.h+=r.length)}function E(e,t){return t=String(t),t=e.j?t.toLowerCase():t}function C(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function Pt(){this.g=new Ae}function Dt(e){this.l=e.Ub||null,this.j=e.eb||!1}function xt(e,t){f.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ot(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Mt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Lt(e)}function Lt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ft(e){let r="";return $(e,function(e,t){r=(r=r+t+":")+e+"\r\n"}),r}function Ut(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Ft(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):I(e,t,r))}function S(e){f.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=kt.prototype).add=function(e,t){T(this),this.i=null,e=E(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(r,n){T(this),this.g.forEach(function(e,t){e.forEach(function(e){r.call(n,e,t,this)},this)},this)},e.na=function(){T(this);var t=Array.from(this.g.values()),r=Array.from(this.g.keys()),n=[];for(let s=0;s<r.length;s++){var i=t[s];for(let e=0;e<i.length;e++)n.push(r[s])}return n},e.V=function(t){T(this);let r=[];if("string"==typeof t)Nt(this,t)&&(r=r.concat(this.g.get(E(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)r=r.concat(t[e])}return r},e.set=function(e,t){return T(this),this.i=null,Nt(this,e=E(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),r=0;r<t.length;r++)for(var n=t[r],i=encodeURIComponent(String(n)),s=this.V(n),n=0;n<s.length;n++){var a=i;""!==s[n]&&(a+="="+encodeURIComponent(String(s[n]))),e.push(a)}return this.i=e.join("&")},s(Dt,Ne),Dt.prototype.g=function(){return new xt(this.l,this.j)},Dt.prototype.i=(bt={},function(){return bt}),s(xt,f),(e=xt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Lt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||D).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Lt(this)),this.g)&&(this.readyState=3,Lt(this),this.g))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==D.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ot(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){var t;this.g&&(this.o&&e.value?this.response.push(e.value):!this.o&&(t=e.value||new Uint8Array(0),t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t),(e.done?Mt:Lt)(this),3==this.readyState)&&Ot(this)},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Mt(this))},e.Qa=function(e){this.g&&(this.response=e,Mt(this))},e.ga=function(){this.g&&Mt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(xt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),s(S,f);var Vt=/^https?$/i,qt=["POST","PUT"];function jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),Kt(e)}function Bt(e){e.A||(e.A=!0,g(e,"complete"),g(e,"error"))}function zt(e){if(e.h&&void 0!==V&&(!e.v[1]||4!=F(e)||2!=e.Z()))if(e.u&&4==F(e))Ie(e.Ea,0,e);else if(g(e,"readystatechange"),4==F(e)){e.h=!1;try{var t,r,n,i=e.Z();switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break;default:s=!1}if((t=s)||((r=0===i)&&(!(n=String(e.D).match(pt)[1]||null)&&D.self&&D.self.location&&(n=D.self.location.protocol.slice(0,-1)),r=!Vt.test(n?n.toLowerCase():"")),t=r),t)g(e,"complete"),g(e,"success");else{e.m=6;try{var a=2<F(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Bt(e)}}finally{Kt(e)}}}function Kt(e,t){if(e.g){Wt(e);var r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||g(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function Wt(e){e.I&&(D.clearTimeout(e.I),e.I=null)}function F(e){return e.g?e.g.readyState:0}function Ht(e){try{if(e.g){if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}}return null}catch(e){return null}}function Gt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function $t(e){this.Aa=0,this.i=[],this.j=new Be,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new st(e&&e.concurrentRequestLimit),this.Da=new Pt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Jt(e),3==e.G){var t=e.U++,r=b(e.I);if(I(r,"SID",e.K),I(r,"RID",t),I(r,"TYPE","terminate"),er(e,r),(t=new y(e,e.j,t)).L=2,t.v=vt(b(r)),r=!1,D.navigator&&D.navigator.sendBeacon)try{r=D.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&D.Image&&((new Image).src=t.v,r=!0),r||(t.g=cr(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ze(t)}hr(e)}function Yt(e){e.g&&(ir(e),e.g.cancel(),e.g=null)}function Jt(e){Yt(e),e.u&&(D.clearTimeout(e.u),e.u=null),ar(e),e.h.cancel(),e.s&&("number"==typeof e.s&&D.clearTimeout(e.s),e.s=null)}function Xt(e){var t;at(e.h)||e.s||(e.s=!0,t=e.Ga,o||te(),l||(o(),l=!0),ee.add(t,e),e.B=0)}function Zt(e,t){var r=t?t.l:e.U++,n=b(e.I);I(n,"SID",e.K),I(n,"RID",r),I(n,"AID",e.T),er(e,n),e.m&&e.o&&Ut(n,e.m,e.o),r=new y(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tr(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),ht(e.h,r),Ye(r,n,t)}function er(e,r){e.H&&$(e.H,function(e,t){I(r,t,e)}),e.l&&dt({},function(e,t){I(r,t,e)})}function tr(e,t,i){i=Math.min(e.i.length,i);var s=e.l?m(e.l.Na,e.l,e):null;e:{let r=e.i,n=-1;for(;;){var a=["count="+i];-1==n?0<i?(n=r[0].g,a.push("ofs="+n)):n=0:a.push("ofs="+n);let e=!0;for(let t=0;t<i;t++){var o=r[t].g,l=r[t].map;if((o-=n)<0)n=Math.max(0,r[t].g-100),e=!1;else try{((e,n,t)=>{let i=t||"";try{dt(e,function(e,t){let r=e;h(e)&&(r=Se(e)),n.push(i+t+"="+encodeURIComponent(r))})}catch(e){throw n.push(i+"type="+encodeURIComponent("_badmap")),e}})(l,a,"req"+o+"_")}catch(e){s&&s(l)}}if(e){s=a.join("&");break e}}}return e=e.i.splice(0,i),t.D=e,s}function rr(e){var t;e.g||e.u||(e.Y=1,t=e.Fa,o||te(),l||(o(),l=!0),ee.add(t,e),e.v=0)}function nr(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=je(m(e.Fa,e),lr(e,e.v)),e.v++,1)}function ir(e){null!=e.A&&(D.clearTimeout(e.A),e.A=null)}function sr(e){e.g=new y(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=b(e.qa),r=(I(t,"RID","rpc"),I(t,"SID",e.K),I(t,"AID",e.T),I(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&I(t,"TO",e.ja),I(t,"TYPE","xmlhttp"),er(e,t),e.m&&e.o&&Ut(t,e.m,e.o),e.L&&(e.g.I=e.L),e.g);e=e.ia,r.L=1,r.v=vt(b(t)),r.m=null,r.P=!0,Je(r,e)}function ar(e){null!=e.C&&(D.clearTimeout(e.C),e.C=null)}function or(e,t){var r,n,i,s=null;if(e.g==t){ar(e),ir(e),e.g=null;var a=2}else{if(!lt(e.h,t))return;s=t.D,ut(e.h,t),a=1}if(0!=e.G)if(t.o)(1==a?(s=t.m?t.m.length:0,t=Date.now()-t.F,r=e.B,g(a=Le(),new qe(a,s)),Xt):rr)(e);else if(3==(r=t.s)||0==r&&0<t.X||(1!=a||(i=t,ot((n=e).h)>=n.h.j-(n.s?1:0))||(n.s?(n.i=i.D.concat(n.i),0):1==n.G||2==n.G||n.B>=(n.Va?0:n.Wa)||(n.s=je(m(n.Ga,n,i),lr(n,n.B)),n.B++,0)))&&(2!=a||!nr(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),r){case 1:k(e,5);break;case 4:k(e,10);break;case 3:k(e,6);break;default:k(e,2)}}function lr(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function k(e,t){var r,n,i;e.j.info("Error code "+t),2==t?(r=m(e.fb,e),n=!(i=e.Xa),i=new w(i||"//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||ft(i,"https"),vt(i),(n?(t,r)=>{var n=new Be;if(D.Image){let e=new Image;e.onload=z(C,n,"TestLoadImage: loaded",!0,r,e),e.onerror=z(C,n,"TestLoadImage: error",!1,r,e),e.onabort=z(C,n,"TestLoadImage: abort",!1,r,e),e.ontimeout=z(C,n,"TestLoadImage: timeout",!1,r,e),D.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=t}else r(!1)}:(e,t)=>{let r=new Be,n=new AbortController,i=setTimeout(()=>{n.abort(),C(r,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?C(r,0,!0,t):C(r,0,!1,t)}).catch(()=>{clearTimeout(i),C(r,0,!1,t)})})(i.toString(),r)):O(2),e.G=0,e.l&&e.l.sa(t),hr(e),Jt(e)}function hr(e){var t;e.G=0,e.ka=[],e.l&&(0==(t=ct(e.h)).length&&0==e.i.length||(W(e.ka,t),W(e.ka,e.i),e.h.i.length=0,K(e.i),e.i.length=0),e.l.ra())}function ur(e,t,r){var n,i,s=r instanceof w?b(r):new w(r);return""!=s.g?(t&&(s.g=t+"."+s.g),gt(s,s.s)):(s=(n=D.location).protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port,i=new w(null),s&&ft(i,s),t&&(i.g=t),n&&gt(i,n),r&&(i.l=r),s=i),r=e.D,t=e.ya,r&&t&&I(s,r,t),I(s,"VER",e.la),er(e,s),s}function cr(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new S(new Dt({eb:r})):new S(e.pa)).Ha(e.J),t}function dr(){}function pr(){}function A(e,t){f.call(this),this.g=new $t(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!x(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!x(t)&&(this.g.D=t,null!==(e=this.h))&&t in e&&t in(e=this.h)&&delete e[t],this.j=new N(this)}function fr(e){xe.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function gr(){Oe.call(this),this.status=1}function N(e){this.g=e}(e=S.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=(this.o||Ge).g(),this.v=this.o?Re(this.o):Re(Ge),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void jt(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(var s of n.keys())r.set(s,n.get(s))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=D.FormData&&e instanceof D.FormData,0<=Array.prototype.indexOf.call(qt,t,void 0)&&!n&&!i&&r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[a,o]of r)this.g.setRequestHeader(a,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){jt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,g(this,"complete"),g(this,"abort"),Kt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kt(this,!0)),S.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<F(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ke(t)},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=$t.prototype).la=8,e.G=1,e.connect=function(e,t,r,n){O(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=ur(this,null,this.W),Xt(this)},e.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;var r=new y(this,this.j,t);let e=this.o;if(this.S&&(e?J(e=Q(e),this.S):e=this.S),null!==this.m||this.O||(r.H=e,e=null),this.P)e:{for(var n=0,i=0;i<this.i.length;i++){var s=this.i[i];if("__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(n+=s)){n=i;break e}if(4096===n||i===this.i.length-1){n=i+1;break e}}n=1e3}else n=1e3;n=tr(this,r,n),I(i=b(this.I),"RID",t),I(i,"CVER",22),this.D&&I(i,"X-HTTP-Session-Id",this.D),er(this,i),e&&(this.O?n="headers="+encodeURIComponent(String(Ft(e)))+"&"+n:this.m&&Ut(i,this.m,e)),ht(this.h,r),this.Ua&&I(i,"TYPE","init"),this.P?(I(i,"$req",n),I(i,"SID","null"),r.T=!0,Ye(r,i,null)):Ye(r,i,n),this.G=2}}else 3==this.G&&(t?Zt(this,t):0==this.i.length||at(this.h)||Zt(this))},e.Fa=function(){var e;this.u=null,sr(this),this.ba&&!(this.M||null==this.g||this.R<=0)&&(e=2*this.R,this.j.info("BP detection timer enabled: "+e),this.A=je(m(this.ab,this),e))},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,O(10),Yt(this),sr(this))},e.Za=function(){null!=this.C&&(this.C=null,Yt(this),nr(this),O(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),O(2)):(this.j.info("Failed to ping google.com"),O(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=dr.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pr.prototype.g=function(e,t){return new A(e,t)},s(A,f),A.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},A.prototype.close=function(){Qt(this.g)},A.prototype.o=function(e){var t,r=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.u&&((t={}).__data__=Se(e),e=t),r.i.push(new it(r.Ya++,e)),3==r.G&&Xt(r)},A.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,A.aa.N.call(this)},s(fr,xe),s(gr,Oe),s(N,dr),N.prototype.ua=function(){g(this.g,"a")},N.prototype.ta=function(e){g(this.g,new fr(e))},N.prototype.sa=function(e){g(this.g,new gr)},N.prototype.ra=function(){g(this.g,"b")},pr.prototype.createWebChannel=pr.prototype.g,A.prototype.send=A.prototype.o,A.prototype.open=A.prototype.m,Tm=function(){return new pr},Im=Le,bm=_,wm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ze.NO_ERROR=0,ze.TIMEOUT=8,ze.HTTP_ERROR=6,ym=ze,Ke.COMPLETE="complete",_m=Ke,(Pe.EventType=De).OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",f.prototype.listen=f.prototype.K,vm=Pe,S.prototype.listenOnce=S.prototype.L,S.prototype.getLastError=S.prototype.Ka,S.prototype.getLastErrorCode=S.prototype.Ba,S.prototype.getStatus=S.prototype.Z,S.prototype.getResponseJson=S.prototype.Oa,S.prototype.getResponseText=S.prototype.oa,S.prototype.send=S.prototype.ea,S.prototype.setWithCredentials=S.prototype.Ha,mm=S}).apply(void 0!==km?km:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let Am="@firebase/firestore";class Nm{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Nm.UNAUTHENTICATED=new Nm(null),Nm.GOOGLE_CREDENTIALS=new Nm("google-credentials-uid"),Nm.FIRST_PARTY=new Nm("first-party-uid"),Nm.MOCK_USER=new Nm("mock-user");let Rm="11.7.3",Pm=new et("@firebase/firestore");function Dm(){return Pm.logLevel}function C(e,...t){var r;Pm.logLevel<=c.DEBUG&&(r=t.map(Mm),Pm.debug(`Firestore (${Rm}): `+e,...r))}function xm(e,...t){var r;Pm.logLevel<=c.ERROR&&(r=t.map(Mm),Pm.error(`Firestore (${Rm}): `+e,...r))}function Om(e,...t){var r;Pm.logLevel<=c.WARN&&(r=t.map(Mm),Pm.warn(`Firestore (${Rm}): `+e,...r))}function Mm(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function S(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,Lm(e,n,r)}function Lm(e,t,r){let n=`FIRESTORE (${Rm}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw xm(n),new Error(n)}function k(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||Lm(t,i,n)}let A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends _e{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class Fm{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Um{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class Vm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Nm.UNAUTHENTICATED))}shutdown(){}}class qm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jm{constructor(e){this.t=e,this.currentUser=Nm.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,r){k(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,r(e)):Promise.resolve(),s=new Fm,a=(this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Fm,t.enqueueRetryable(()=>i(this.currentUser))},()=>{let e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})}),o=e=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Fm))},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(k("string"==typeof e.accessToken,31837,{l:e}),new Um(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){var e=this.auth&&this.auth.getUid();return k(null===e||"string"==typeof e,2055,{h:e}),new Nm(e)}}class Bm{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Nm.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);var e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class zm{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Bm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Nm.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Km{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Wm{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,h(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(t,r){k(void 0===this.o,3512);let n=e=>{null!=e.error&&C("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.m;return this.m=e.token,C("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?r(e.token):Promise.resolve()},i=(this.o=e=>{t.enqueueRetryable(()=>n(e))},e=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)});this.V.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.V.getImmediate({optional:!0}))?i(e):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e;return this.p?Promise.resolve(new Km(this.p)):(e=this.forceRefresh,this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(k("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Km(e.token)):null):Promise.resolve(null))}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Hm(){return new TextEncoder}class Gm{static newId(){var t=62*Math.floor(256/62);let r="";for(;r.length<20;){var n=(t=>{var r="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(r&&"function"==typeof r.getRandomValues)r.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n})(40);for(let e=0;e<n.length;++e)r.length<20&&n[e]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[e]%62))}return r}}function R(e,t){return e<t?-1:t<e?1:0}function $m(e,t){let r=0;for(;r<e.length&&r<t.length;){var n,i=e.codePointAt(r),s=t.codePointAt(r);if(i!==s)return!(i<128&&s<128)&&0!==(n=((e,t)=>{for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return R(e[r],t[r]);return R(e.length,t.length)})((n=Hm()).encode(Qm(e,r)),n.encode(Qm(t,r))))?n:R(i,s);r+=65535<i?2:1}return R(e.length,t.length)}function Qm(e,t){return 65535<e.codePointAt(t)?e.substring(t,t+2):e.substring(t,t+1)}function Ym(e,r,n){return e.length===r.length&&e.every((e,t)=>n(e,r[t]))}function Jm(e){return e+"\0"}let Xm=-62135596800;class Zm{static now(){return Zm.fromMillis(Date.now())}static fromDate(e){return Zm.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Zm(t,r)}constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Xm)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?R(this.nanoseconds,e.nanoseconds):R(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds-Xm;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class P{static fromTimestamp(e){return new P(e)}static min(){return new P(new Zm(0,0))}static max(){return new P(new Zm(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let ev="__name__";class tv{constructor(e,t,r){void 0===t?t=0:t>e.length&&S(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&S(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===tv.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tv?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){let e=Math.min(t.length,r.length);for(let n=0;n<e;n++){let e=tv.compareSegments(t.get(n),r.get(n));if(0!==e)return e}return R(t.length,r.length)}static compareSegments(e,t){var r=tv.isNumericId(e),n=tv.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?tv.extractNumericId(e).compare(tv.extractNumericId(t)):$m(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fm.fromString(e.substring(4,e.length-2))}}class D extends tv{construct(e,t,r){return new D(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){var t,r=[];for(t of e){if(0<=t.indexOf("//"))throw new N(A.INVALID_ARGUMENT,`Invalid segment (${t}). Paths must not contain // in them.`);r.push(...t.split("/").filter(e=>0<e.length))}return new D(r)}static emptyPath(){return new D([])}}let rv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nv extends tv{construct(e,t,r){return new nv(e,t,r)}static isValidIdentifier(e){return rv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=nv.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ev}static keyField(){return new nv([ev])}static fromServerFormat(t){let e=[],r="",n=0;var i=()=>{if(0===r.length)throw new N(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let s=!1;for(;n<t.length;){let e=t[n];if("\\"===e){if(n+1===t.length)throw new N(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let e=t[n+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new N(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=e,n+=2}else"`"===e?s=!s:"."!==e||s?r+=e:i(),n++}if(i(),s)throw new N(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new nv(e)}static emptyPath(){return new nv([])}}class x{constructor(e){this.path=e}static fromPath(e){return new x(D.fromString(e))}static fromName(e){return new x(D.fromString(e).popFirst(5))}static empty(){return new x(D.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===D.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return D.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new x(new D(e.slice()))}}let iv=-1;class sv{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function av(e){return e.fields.find(e=>2===e.kind)}function ov(e){return e.fields.filter(e=>2!==e.kind)}sv.UNKNOWN_ID=-1;class lv{constructor(e,t){this.fieldPath=e,this.kind=t}}class hv{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new hv(0,dv.min())}}function uv(e,t){var r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=P.fromTimestamp(1e9===n?new Zm(r+1,0):new Zm(r,n));return new dv(r,x.empty(),t)}function cv(e){return new dv(e.readTime,e.key,iv)}class dv{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new dv(P.min(),x.empty(),iv)}static max(){return new dv(P.max(),x.empty(),iv)}}function pv(e,t){var r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=x.comparator(e.documentKey,t.documentKey))?r:R(e.largestBatchId,t.largestBatchId)}let fv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function mv(e){if(e.code!==A.FAILED_PRECONDITION||e.message!==fv)throw e;C("LocalStore","Unexpectedly lost primary lease")}class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(n,i){return this.callbackAttached&&S(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new O((t,r)=>{this.nextCallback=e=>{this.wrapSuccess(n,e).next(t,r)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof O?t:O.resolve(t)}catch(e){return O.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(r){return new O((e,t)=>{e(r)})}static reject(r){return new O((e,t)=>{t(r)})}static waitFor(e){return new O((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=O.resolve(!1);for(let r of e)t=t.next(e=>e?O.resolve(e):r());return t}static forEach(e,r){let n=[];return e.forEach((e,t)=>{n.push(r.call(this,e,t))}),this.waitFor(n)}static mapArray(o,l){return new O((r,n)=>{let i=o.length,s=new Array(i),a=0;for(let e=0;e<i;e++){let t=e;l(o[t]).next(e=>{s[t]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(n,i){return new O((e,t)=>{let r=()=>{!0===n()?i().next(()=>{r()},t):e()};r()})}}let vv="SimpleDb";class _v{static open(e,t,r,n){try{return new _v(t,e.transaction(n,r))}catch(e){throw new Iv(t,e)}}constructor(r,e){this.action=r,this.transaction=e,this.aborted=!1,this.S=new Fm,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new Iv(r,e.error)):this.S.resolve()},this.transaction.onerror=e=>{var t=kv(e.target.error);this.S.reject(new Iv(r,t))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(C(vv,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new Ev(t)}}class yv{static delete(e){return C(vv,"Removing database:",e),Cv(H().indexedDB.deleteDatabase(e)).toPromise()}static C(){var e,t,r;return!(!ge()||!yv.F()&&(e=ae(),t=0<(t=yv.M(e))&&t<10,r=0<(r=wv(e))&&r<4.5,0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||t||r))}static F(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.__PRIVATE_env)?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,12.2===yv.M(ae())&&xm("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(s){return this.db||(C(vv,"Opening database:",this.name),this.db=await new Promise((r,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;r(t)},i.onblocked=()=>{n(new Iv(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?n(new N(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?n(new N(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):n(new Iv(s,t))},i.onupgradeneeded=e=>{C(vv,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=`+t.version);this.B.q(t,i.transaction,e.oldVersion,this.version).next(()=>{C(vv,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{var t=e.target;this.L=t.version},{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(t){this.$=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(r,e,n,i){var s="readonly"===e;let a=0;for(;;){++a;try{this.db=await this.k(r);let t=_v.open(this.db,r,s?"readonly":"readwrite",n),e=i(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),O.reject(e))).toPromise();return e.catch(()=>{}),await t.D,e}catch(r){let e=r,t="FirebaseError"!==e.name&&a<3;if(C(vv,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function wv(e){var t=e.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class bv{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return Cv(this.K.delete())}}class Iv extends N{constructor(e,t){super(A.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function Tv(e){return"IndexedDbTransactionError"===e.name}class Ev{constructor(e){this.store=e}put(e,t){let r;return Cv(r=void 0!==t?(C(vv,"PUT",this.store.name,e,t),this.store.put(t,e)):(C(vv,"PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return C(vv,"ADD",this.store.name,e,e),Cv(this.store.add(e))}get(t){return Cv(this.store.get(t)).next(e=>(void 0===e&&(e=null),C(vv,"GET",this.store.name,t,e),e))}delete(e){return C(vv,"DELETE",this.store.name,e),Cv(this.store.delete(e))}count(){return C(vv,"COUNT",this.store.name),Cv(this.store.count())}J(e,t){var n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new O((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),r=[];return this.Y(e,(e,t)=>{r.push(t)}).next(()=>r)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new O((t,r)=>{n.onerror=e=>{r(e.target.error)},n.onsuccess=e=>{t(e.target.result)}})}X(e,t){C(vv,"DELETE ALL",this.store.name);var r=this.options(e,t),r=(r.ee=!1,this.cursor(r));return this.Y(r,(e,t,r)=>r.delete())}te(e,t){let r;t?r=e:(r={},t=e);var n=this.cursor(r);return this.Y(n,t)}ne(i){let e=this.cursor({});return new O((r,n)=>{e.onerror=e=>{var t=kv(e.target.error);n(t)},e.onsuccess=e=>{let t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():r()}):r()}})}Y(e,s){let a=[];return new O((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{var n=e.target.result;if(n){let t=new bv(n),r=s(n.primaryKey,n.value,t);if(r instanceof O){let e=r.catch(e=>(t.done(),O.reject(e)));a.push(e)}t.isDone?i():null===t.j?n.continue():n.continue(t.j)}else i()}}).next(()=>O.waitFor(a))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";var r;return e.reverse&&(t="prev"),e.index?(r=this.store.index(e.index),e.ee?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)):this.store.openCursor(e.range,t)}}function Cv(e){return new O((r,n)=>{e.onsuccess=e=>{var t=e.target.result;r(t)},e.onerror=e=>{var t=kv(e.target.error);n(t)}})}let Sv=!1;function kv(e){let t=yv.M(ae());if(12.2<=t&&t<13){let t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){let e=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Sv||(Sv=!0,setTimeout(()=>{throw e},0)),e}}return e}let Av="IndexBackfiller";class Nv{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){C(Av,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{var e=await this.re.se();C(Av,"Documents written: "+e)}catch(e){Tv(e)?C(Av,"Ignoring IndexedDB error during index backfill: ",e):await mv(e)}await this.ie(6e4)})}}class Rv{constructor(e,t){this.localStore=e,this.persistence=t}async se(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.oe(e,t))}oe(e,t){let r=new Set,n=t,i=!0;return O.doWhile(()=>!0===i&&0<n,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return C(Av,"Processing collection: "+t),this._e(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}_e(n,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(n,i).next(r=>this.localStore.localDocuments.getNextDocuments(n,i,r,e).next(e=>{let t=e.changes;return this.localStore.indexManager.updateIndexEntries(n,t).next(()=>this.ae(r,e)).next(e=>(C(Av,"Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(n,i,e))).next(()=>t.size)}))}ae(e,t){let n=e;return t.changes.forEach((e,t)=>{var r=cv(t);0<pv(r,n)&&(n=r)}),new dv(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Pv{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ce&&this.ce(e),e}}let Dv=Pv.le=-1;function xv(e){return null==e}function Ov(e){return 0===e&&1/e==-1/0}function Mv(e){return"number"==typeof e&&Number.isInteger(e)&&!Ov(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let Lv="";function Fv(e){let t="";for(let r=0;r<e.length;r++)0<t.length&&(t=Uv(t)),t=((t,e)=>{let r=e,n=t.length;for(let i=0;i<n;i++){let e=t.charAt(i);switch(e){case"\0":r+="";break;case Lv:r+="";break;default:r+=e}}return r})(e.get(r),t);return Uv(t)}function Uv(e){return e+Lv+""}function Vv(r){let e=r.length;if(k(2<=e,64408,{path:r}),2===e)return k(r.charAt(0)===Lv&&""===r.charAt(1),56145,{path:r}),D.emptyPath();var __PRIVATE_lastReasonableEscapeIndex=e-2,n=[];let i="";for(let a=0;a<e;){let t=r.indexOf(Lv,a);switch((t<0||t>__PRIVATE_lastReasonableEscapeIndex)&&S(50515,{path:r}),r.charAt(t+1)){case"":var s=r.substring(a,t);let e;0===i.length?e=s:(i+=s,e=i,i=""),n.push(e);break;case"":i=i+r.substring(a,t)+"\0";break;case"":i+=r.substring(a,t+1);break;default:S(61167,{path:r})}a=t+2}return new D(n)}let qv="remoteDocuments",jv="owner",Bv="owner",zv="mutationQueues",Kv="mutations",Wv="batchId",Hv="userMutationsIndex",Gv=["userId","batchId"];function $v(e,t){return[e,Fv(t)]}function Qv(e,t,r){return[e,Fv(t),r]}let Yv={},Jv="documentMutations",Xv="remoteDocumentsV14",Zv=["prefixPath","collectionGroup","readTime","documentId"],e_="documentKeyIndex",t_=["prefixPath","collectionGroup","documentId"],r_="collectionGroupIndex",n_=["collectionGroup","readTime","prefixPath","documentId"],i_="remoteDocumentGlobal",s_="remoteDocumentGlobalKey",a_="targets",o_="queryTargetsIndex",l_=["canonicalId","targetId"],h_="targetDocuments",u_=["targetId","path"],c_="documentTargetsIndex",d_=["path","targetId"],p_="targetGlobalKey",f_="targetGlobal",g_="collectionParents",m_=["collectionId","parent"],v_="clientMetadata",__="bundles",y_="namedQueries",w_="indexConfiguration",b_="collectionGroupIndex",I_="indexState",T_=["indexId","uid"],E_="sequenceNumberIndex",C_=["uid","sequenceNumber"],S_="indexEntries",k_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],A_="documentKeyIndex",N_=["indexId","uid","orderedDocumentKey"],R_="documentOverlays",P_=["userId","collectionPath","documentId"],D_="collectionPathOverlayIndex",x_=["userId","collectionPath","largestBatchId"],O_="collectionGroupOverlayIndex",M_=["userId","collectionGroup","largestBatchId"],L_="globals",F_=[zv,Kv,Jv,qv,a_,jv,f_,h_,v_,i_,g_,__,y_],U_=[...F_,R_],V_=[zv,Kv,Jv,Xv,a_,jv,f_,h_,v_,i_,g_,__,y_,R_],q_=V_,j_=[...q_,w_,I_,S_],B_=j_,z_=[...j_,L_];class K_ extends gv{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function W_(e,t){var r=e;return yv.N(r.he,t)}function H_(e){let t=0;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function G_(e,t){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function $_(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class M{constructor(e,t){this.comparator=e,this.root=t||Y_.EMPTY}insert(e,t){return new M(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Y_.BLACK,null,null))}remove(e){return new M(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Y_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:0<r&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){var n=this.comparator(e,r.key);if(0===n)return t+r.left.size;r=n<0?r.left:(t+=r.left.size+1,r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(r){this.inorderTraversal((e,t)=>(r(e,t),!1))}toString(){let r=[];return this.inorderTraversal((e,t)=>(r.push(e+":"+t),!1)),`{${r.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Q_(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Q_(this.root,e,this.comparator,!1)}getReverseIterator(){return new Q_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Q_(this.root,e,this.comparator,!0)}}class Q_{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){var e;return 0===this.nodeStack.length?null:{key:(e=this.nodeStack[this.nodeStack.length-1]).key,value:e.value}}}class Y_{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:Y_.RED,this.left=null!=n?n:Y_.EMPTY,this.right=null!=i?i:Y_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new Y_(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){var n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return Y_.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n=(n=n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()?n:n.moveRedLeft()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed()?n.rotateRight():n).right.isEmpty()||n.right.isRed()||n.right.left.isRed()?n:n.moveRedRight()).key)){if(n.right.isEmpty())return Y_.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,Y_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Y_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw S(43730,{key:this.key,value:this.value});if(this.right.isRed())throw S(14113,{key:this.key,value:this.value});var e=this.left.check();if(e!==this.right.check())throw S(27949);return e+(this.isRed()?0:1)}}Y_.EMPTY=null,Y_.RED=!0,Y_.BLACK=!1,Y_.EMPTY=new class{constructor(){this.size=0}get key(){throw S(57766)}get value(){throw S(16141)}get color(){throw S(16727)}get left(){throw S(29726)}get right(){throw S(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new Y_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class L{constructor(e){this.comparator=e,this.data=new M(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(r){this.data.inorderTraversal((e,t)=>(r(e),!1))}forEachInRange(e,t){for(var r=this.data.getIteratorFrom(e[0]);r.hasNext();){var n=r.getNext();if(0<=this.comparator(n.key,e[1]))return;t(n.key)}}forEachWhile(e,t){for(var r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new J_(this.data.getIterator())}getIteratorFrom(e){return new J_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof L))return!1;if(this.size!==e.size)return!1;for(var r=this.data.getIterator(),n=e.data.getIterator();r.hasNext();){let e=r.getNext().key,t=n.getNext().key;if(0!==this.comparator(e,t))return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){var t=new L(this.comparator);return t.data=e,t}}class J_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function X_(e){return e.hasNext()?e.getNext():void 0}class Z_{constructor(e){(this.fields=e).sort(nv.comparator)}static empty(){return new Z_([])}unionWith(e){let t=new L(nv.comparator);for(let e of this.fields)t=t.add(e);for(var r of e)t=t.add(r);return new Z_(t.toArray())}covers(e){for(var t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ym(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ey extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ty{constructor(e){this.binaryString=e}static fromBase64String(e){var t=(e=>{try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ey("Invalid base64 string: "+e):e}})(e);return new ty(t)}static fromUint8Array(e){var t=(e=>{let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t})(e);return new ty(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){var e=this.binaryString,t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return R(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ty.EMPTY_BYTE_STRING=new ty("");let ry=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ny(t){if(k(!!t,39018),"string"!=typeof t)return{seconds:iy(t.seconds),nanos:iy(t.nanos)};{let e=0;var r=ry.exec(t),r=(k(!!r,46558,{timestamp:t}),r[1]&&(r=((r=r[1])+"000000000").substr(0,9),e=Number(r)),new Date(t));return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function iy(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sy(e){return"string"==typeof e?ty.fromBase64String(e):ty.fromUint8Array(e)}let ay="server_timestamp",oy="__type__",ly="__previous_value__",hy="__local_write_time__";function uy(e){var t;return(null==(t=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[oy])?void 0:t.stringValue)===ay}function cy(e){var t=e.mapValue.fields[ly];return uy(t)?cy(t):t}function dy(e){var t=ny(e.mapValue.fields[hy].timestampValue);return new Zm(t.seconds,t.nanos)}class py{constructor(e,t,r,n,i,s,a,o,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=h}}let fy="(default)";class gy{constructor(e,t){this.projectId=e,this.database=t||fy}static empty(){return new gy("","")}get isDefaultDatabase(){return this.database===fy}isEqual(e){return e instanceof gy&&e.projectId===this.projectId&&e.database===this.database}}let my="__type__",vy="__max__",_y={mapValue:{fields:{__type__:{stringValue:vy}}}},yy="__vector__",wy="value",by={nullValue:"NULL_VALUE"};function Iy(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?uy(e)?4:Fy(e)?9007199254740991:My(e)?10:11:S(28295,{value:e})}function Ty(t,r){if(t===r)return!0;var n,i,s,a,o,e=Iy(t);if(e!==Iy(r))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===r.booleanValue;case 4:return dy(t).isEqual(dy(r));case 3:return s=r,"string"==typeof(i=t).timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length?i.timestampValue===s.timestampValue:(a=ny(i.timestampValue),o=ny(s.timestampValue),a.seconds===o.seconds&&a.nanos===o.nanos);case 5:return t.stringValue===r.stringValue;case 6:return i=r,sy(t.bytesValue).isEqual(sy(i.bytesValue));case 7:return t.referenceValue===r.referenceValue;case 8:return s=r,iy((n=t).geoPointValue.latitude)===iy(s.geoPointValue.latitude)&&iy(n.geoPointValue.longitude)===iy(s.geoPointValue.longitude);case 2:return n=r,"integerValue"in(h=t)&&"integerValue"in n?iy(h.integerValue)===iy(n.integerValue):"doubleValue"in h&&"doubleValue"in n&&((a=iy(h.doubleValue))===(o=iy(n.doubleValue))?Ov(a)===Ov(o):isNaN(a)&&isNaN(o));case 9:return Ym(t.arrayValue.values||[],r.arrayValue.values||[],Ty);case 10:case 11:var l=t,h=r,u=l.mapValue.fields||{},c=h.mapValue.fields||{};if(H_(u)!==H_(c))return!1;for(let e in u)if(u.hasOwnProperty(e)&&(void 0===c[e]||!Ty(u[e],c[e])))return!1;return!0;default:return S(52216,{left:t})}}function Ey(e,t){return void 0!==(e.values||[]).find(e=>Ty(e,t))}function Cy(e,n){if(e===n)return 0;var i,s,a,o,l,h,u,c,d=Iy(e),t=Iy(n);if(d!==t)return R(d,t);switch(d){case 0:case 9007199254740991:return 0;case 1:return R(e.booleanValue,n.booleanValue);case 2:return h=n,u=iy((l=e).integerValue||l.doubleValue),c=iy(h.integerValue||h.doubleValue),u<c?-1:c<u?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return Sy(e.timestampValue,n.timestampValue);case 4:return Sy(dy(e),dy(n));case 5:return $m(e.stringValue,n.stringValue);case 6:return l=e.bytesValue,h=n.bytesValue,u=sy(l),c=sy(h),u.compareTo(c);case 7:var p=e.referenceValue,f=n.referenceValue,g=p.split("/"),m=f.split("/");for(let t=0;t<g.length&&t<m.length;t++){let e=R(g[t],m[t]);if(0!==e)return e}return R(g.length,m.length);case 8:return p=e.geoPointValue,f=n.geoPointValue,0!==(o=R(iy(p.latitude),iy(f.latitude)))?o:R(iy(p.longitude),iy(f.longitude));case 9:return ky(e.arrayValue,n.arrayValue);case 10:return v=e.mapValue,i=n.mapValue,o=v.fields||{},s=i.fields||{},o=null==(o=o[wy])?void 0:o.arrayValue,s=null==(s=s[wy])?void 0:s.arrayValue,0!==(a=R((null==(a=null==o?void 0:o.values)?void 0:a.length)||0,(null==(a=null==s?void 0:s.values)?void 0:a.length)||0))?a:ky(o,s);case 11:var v=e.mapValue,_=n.mapValue;if(v===_y.mapValue&&_===_y.mapValue)return 0;if(v===_y.mapValue)return 1;if(_===_y.mapValue)return-1;var y=v.fields||{},w=Object.keys(y),b=_.fields||{},I=Object.keys(b);w.sort(),I.sort();for(let r=0;r<w.length&&r<I.length;++r){let e=$m(w[r],I[r]);if(0!==e)return e;var T=Cy(y[w[r]],b[I[r]]);if(0!==T)return T}return R(w.length,I.length);default:throw S(23264,{Pe:d})}}function Sy(e,t){var r,n,i;return"string"==typeof e&&"string"==typeof t&&e.length===t.length?R(e,t):(r=ny(e),n=ny(t),0!==(i=R(r.seconds,n.seconds))?i:R(r.nanos,n.nanos))}function ky(e,t){var r=e.values||[],n=t.values||[];for(let i=0;i<r.length&&i<n.length;++i){let e=Cy(r[i],n[i]);if(e)return e}return R(r.length,n.length)}function Ay(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(e=>{let t=ny(e);return`time(${t.seconds},${t.nanos})`})(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?(e=>sy(e).toBase64())(e.bytesValue):"referenceValue"in e?(e=>x.fromName(e).toString())(e.referenceValue):"geoPointValue"in e?(e=>`geo(${e.latitude},${e.longitude})`)(e.geoPointValue):"arrayValue"in e?(e=>{let t="[",r=!0;for(var n of e.values||[])r?r=!1:t+=",",t+=s(n);return t+"]"})(e.arrayValue):"mapValue"in e?(e=>{let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(var i of t)n?n=!1:r+=",",r+=i+":"+s(e.fields[i]);return r+"}"})(e.mapValue):S(61005,{value:e})}(e)}function Ny(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function Ry(e){return!!e&&"integerValue"in e}function Py(e){return!!e&&"arrayValue"in e}function Dy(e){return e&&"nullValue"in e}function xy(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Oy(e){return e&&"mapValue"in e}function My(e){var t;return(null==(t=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[my])?void 0:t.stringValue)===yy}function Ly(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let r={mapValue:{fields:{}}};return G_(t.mapValue.fields,(e,t)=>r.mapValue.fields[e]=Ly(t)),r}if(t.arrayValue){var r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Ly(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Fy(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===vy}let Uy={mapValue:{fields:{[my]:{stringValue:yy},[wy]:{arrayValue:{}}}}};function Vy(e,t){var r=Cy(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function qy(e,t){var r=Cy(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class jy{constructor(e){this.value=e}static empty(){return new jy({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let e=this.value;for(let t=0;t<r.length-1;++t)if(!Oy(e=(e.mapValue.fields||{})[r.get(t)]))return null;return(e=(e.mapValue.fields||{})[r.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ly(t)}setAll(e){let r=nv.emptyPath(),n={},i=[];e.forEach((e,t)=>{if(!r.isImmediateParentOf(t)){let e=this.getFieldsMap(r);this.applyChanges(e,n,i),n={},i=[],r=t.popLast()}e?n[t.lastSegment()]=Ly(e):i.push(t.lastSegment())});var t=this.getFieldsMap(r);this.applyChanges(t,n,i)}delete(e){var t=this.field(e.popLast());Oy(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ty(this.value,e.value)}getFieldsMap(t){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let n=0;n<t.length;++n){let e=r.mapValue.fields[t.get(n)];Oy(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[t.get(n)]=e),r=e}return r.mapValue.fields}applyChanges(r,e,t){G_(e,(e,t)=>r[e]=t);for(let e of t)delete r[e]}clone(){return new jy(Ly(this.value))}}class By{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new By(e,0,P.min(),P.min(),P.min(),jy.empty(),0)}static newFoundDocument(e,t,r,n){return new By(e,1,t,P.min(),r,n,0)}static newNoDocument(e,t){return new By(e,2,t,P.min(),P.min(),jy.empty(),0)}static newUnknownDocument(e,t){return new By(e,3,t,P.min(),P.min(),jy.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(P.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jy.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jy.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof By&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new By(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zy{constructor(e,t){this.position=e,this.inclusive=t}}function Ky(e,t,r){let n=0;for(let a=0;a<e.position.length;a++){var i=t[a],s=e.position[a];if(n=i.field.isKeyField()?x.comparator(x.fromName(s.referenceValue),r.key):Cy(s,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Wy(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!Ty(e.position[r],t.position[r]))return!1;return!0}class Hy{constructor(e,t="asc"){this.field=e,this.dir=t}}class Gy{}class F extends Gy{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new ew(e,t,r):"array-contains"===t?new iw(e,r):"in"===t?new sw(e,r):"not-in"===t?new aw(e,r):"array-contains-any"===t?new ow(e,r):new F(e,t,r)}static createKeyFieldInFilter(e,t,r){return new("in"===t?tw:rw)(e,r)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Cy(t,this.value)):null!==t&&Iy(this.value)===Iy(t)&&this.matchesComparison(Cy(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return S(47266,{operator:this.op})}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class U extends Gy{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new U(e,t)}matches(t){return $y(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.Te&&(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function $y(e){return"and"===e.op}function Qy(e){return"or"===e.op}function Yy(e){return Jy(e)&&$y(e)}function Jy(e){for(var t of e.filters)if(t instanceof U)return!1;return!0}function Xy(e,t){var r=e.filters.concat(t);return U.create(r,e.op)}function Zy(e){return e instanceof F?`${(t=e).field.canonicalString()} ${t.op} `+Ay(t.value):e instanceof U?(t=e).op.toString()+" {"+t.getFilters().map(Zy).join(" ,")+"}":"Filter";var t}class ew extends F{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){var t=x.comparator(e.key,this.key);return this.matchesComparison(t)}}class tw extends F{constructor(e,t){super(e,"in",t),this.keys=nw(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class rw extends F{constructor(e,t){super(e,"not-in",t),this.keys=nw(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function nw(e,t){var r;return((null==(r=t.arrayValue)?void 0:r.values)||[]).map(e=>x.fromName(e.referenceValue))}class iw extends F{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Py(t)&&Ey(t.arrayValue,this.value)}}class sw extends F{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Ey(this.value.arrayValue,t)}}class aw extends F{constructor(e,t){super(e,"not-in",t)}matches(e){var t;return!Ey(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&null!==(t=e.data.field(this.field))&&void 0===t.nullValue&&!Ey(this.value.arrayValue,t)}}class ow extends F{constructor(e,t){super(e,"array-contains-any",t)}matches(e){var t=e.data.field(this.field);return!(!Py(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Ey(this.value.arrayValue,e))}}class lw{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Ie=null}}function hw(e,t=null,r=[],n=[],i=null,s=null,a=null){return new lw(e,t,r,n,i,s,a)}function uw(e){var t=e;if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>function t(e){var r;return e instanceof F?e.field.canonicalString()+e.op.toString()+Ay(e.value):Yy(e)?e.filters.map(e=>t(e)).join(","):(r=e.filters.map(e=>t(e)).join(","),e.op+`(${r})`)}(e)).join(",")+"|ob:")+t.orderBy.map(e=>(e=e).field.canonicalString()+e.dir).join(","),xv(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>Ay(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>Ay(e)).join(",")),t.Ie=e}return t.Ie}function cw(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(r=e.orderBy[i],n=t.orderBy[i],r.dir!==n.dir||!r.field.isEqual(n.field))return!1;var r,n;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function n(e,t){return e instanceof F?(r=e,(s=t)instanceof F&&r.op===s.op&&r.field.isEqual(s.field)&&Ty(r.value,s.value)):e instanceof U?(r=e,(i=t)instanceof U&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((e,t,r)=>e&&n(t,i.filters[r]),!0)):void S(19439);var i,r,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Wy(e.startAt,t.startAt)&&Wy(e.endAt,t.endAt)}function dw(e){return x.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function pw(e,t){return e.filters.filter(e=>e instanceof F&&e.field.isEqual(t))}function fw(e,r,n){let i=by,s=!0;for(let n of pw(e,r)){let e=by,t=!0;switch(n.op){case"<":case"<=":e="nullValue"in(a=n.value)?by:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Ny(gy.empty(),x.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?My(a)?Uy:{mapValue:{}}:S(35942,{value:a});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=by}Vy({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==n)for(let t=0;t<e.orderBy.length;++t)if(e.orderBy[t].field.isEqual(r)){let e=n.position[t];Vy({value:i,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}function gw(e,r,n){let i=_y,s=!0;for(let n of pw(e,r)){let e=_y,t=!0;switch(n.op){case">=":case">":e="nullValue"in(a=n.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Ny(gy.empty(),x.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?Uy:"mapValue"in a?My(a)?{mapValue:{}}:_y:S(61959,{value:a}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=_y}0<qy({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==n)for(let t=0;t<e.orderBy.length;++t)if(e.orderBy[t].field.isEqual(r)){let e=n.position[t];0<qy({value:i,inclusive:s},{value:e,inclusive:n.inclusive})&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}class mw{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function vw(e,t,r,n,i,s,a,o){return new mw(e,t,r,n,i,s,a,o)}function _w(e){return new mw(e)}function yw(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ww(e){return null!==e.collectionGroup}function bw(e){let n=e;if(null===n.Ee){n.Ee=[];let t=new Set;for(var i of n.explicitOrderBy)n.Ee.push(i),t.add(i.field.canonicalString());let r=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc",e=(e=>{let t=new L(nv.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(n);e.forEach(e=>{t.has(e.canonicalString())||e.isKeyField()||n.Ee.push(new Hy(e,r))}),t.has(nv.keyField().canonicalString())||n.Ee.push(new Hy(nv.keyField(),r))}return n.Ee}function Iw(e){var t=e;return t.de||(t.de=((e,t)=>{if("F"===e.limitType)return hw(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map(e=>{var t="desc"===e.dir?"asc":"desc";return new Hy(e.field,t)});var r=e.endAt?new zy(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new zy(e.startAt.position,e.startAt.inclusive):null;return hw(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)})(t,bw(e))),t.de}function Tw(e,t){var r=e.filters.concat([t]);return new mw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function Ew(e,t,r){return new mw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function Cw(e,t){return cw(Iw(e),Iw(t))&&e.limitType===t.limitType}function Sw(e){return uw(Iw(e))+"|lt:"+e.limitType}function kw(e){return`Query(target=${(e=>{let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>Zy(e)).join(", ")}]`),xv(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>`${(e=e).field.canonicalString()} (${e.dir})`).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>Ay(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>Ay(e)).join(","):t})`})(Iw(e))}; limitType=${e.limitType})`}function Aw(e,t){return t.isFoundDocument()&&(s=e,o=(a=t).key.path,null!==s.collectionGroup?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):x.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o))&&((e,t)=>{for(var r of bw(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return;return 1})(e,t)&&((e,t)=>{for(var r of e.filters)if(!r.matches(t))return;return 1})(e,t)&&(a=t,!(s=e).startAt||(n=s.startAt,r=bw(s),i=Ky(n,r,a),n.inclusive?i<=0:i<0))&&(!s.endAt||(r=s.endAt,n=bw(s),i=Ky(r,n,a),r.inclusive?0<=i:0<i));var r,n,i,s,a,o}function Nw(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Rw(e){return(t,r)=>{let n=!1;for(var i of bw(e)){let e=((e,t,r)=>{var n=e.field.isKeyField()?x.comparator(t.key,r.key):((e,t,r)=>{var n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?Cy(n,i):S(42886)})(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return S(19790,{direction:e.dir})}})(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class Pw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(r){let e=this.mapKeyFn(r),n=this.inner[e];if(void 0!==n)for(let[e,t]of n)if(this.equalsFn(e,r))return t}has(e){return void 0!==this.get(e)}set(t,r){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)this.inner[e]=[[t,r]];else{for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return void(n[e]=[t,r]);n.push([t,r])}this.innerSize++}delete(t){var r=this.mapKeyFn(t),n=this.inner[r];if(void 0!==n)for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return 1===n.length?delete this.inner[r]:n.splice(e,1),this.innerSize--,!0;return!1}forEach(n){G_(this.inner,(e,t)=>{for(let[e,r]of t)n(e,r)})}isEmpty(){return $_(this.inner)}size(){return this.innerSize}}let Dw=new M(x.comparator);let xw=new M(x.comparator);function Ow(...e){let t=xw;for(var r of e)t=t.insert(r.key,r);return t}function Mw(e){let r=xw;return e.forEach((e,t)=>r=r.insert(e,t.overlayedDocument)),r}function Lw(){return new Pw(e=>e.toString(),(e,t)=>e.isEqual(t))}let Fw=new M(x.comparator),Uw=new L(x.comparator);function V(...e){let t=Uw;for(var r of e)t=t.add(r);return t}let Vw=new L(R);function qw(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ov(t)?"-0":t}}function jw(e){return{integerValue:""+e}}function Bw(e,t){return Mv(t)?jw(t):qw(e,t)}class zw{constructor(){this._=void 0}}function Kw(e,t){return e instanceof Yw?Ry(e=t)||(e=e)&&"doubleValue"in e?t:{integerValue:0}:null}class Ww extends zw{}class Hw extends zw{constructor(e){super(),this.elements=e}}function Gw(e,t){var r=Xw(t);for(let t of e.elements)r.some(e=>Ty(e,t))||r.push(t);return{arrayValue:{values:r}}}class $w extends zw{constructor(e){super(),this.elements=e}}function Qw(e,t){let r=Xw(t);for(let t of e.elements)r=r.filter(e=>!Ty(e,t));return{arrayValue:{values:r}}}class Yw extends zw{constructor(e,t){super(),this.serializer=e,this.Re=t}}function Jw(e){return iy(e.integerValue||e.doubleValue)}function Xw(e){return Py(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Zw{constructor(e,t){this.field=e,this.transform=t}}class eb{constructor(e,t){this.version=e,this.transformResults=t}}class tb{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new tb}static exists(e){return new tb(void 0,e)}static updateTime(e){return new tb(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rb(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nb{}function ib(e,r){if(!e.hasLocalMutations||r&&0===r.fields.length)return null;if(null===r)return e.isNoDocument()?new db(e.key,tb.none()):new ob(e.key,e.data,tb.none());{var n,i=e.data,s=jy.empty();let t=new L(nv.comparator);for(n of r.fields)if(!t.has(n)){let e=i.field(n);null===e&&1<n.length&&(n=n.popLast(),e=i.field(n)),null===e?s.delete(n):s.set(n,e),t=t.add(n)}return new lb(e.key,s,new Z_(t.toArray()),tb.none())}}function sb(e,t,r,n){return e instanceof ob?(s=t,a=r,o=n,rb((i=e).precondition,s)?(l=i.value.clone(),h=cb(i.fieldTransforms,o,s),l.setAll(h),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null):a):e instanceof lb?(i=t,o=r,s=n,rb((a=e).precondition,i)?(h=cb(a.fieldTransforms,s,i),(l=i.data).setAll(hb(a)),l.setAll(h),i.convertToFoundDocument(i.version,l).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))):o):(n=t,t=r,rb(e.precondition,n)?(n.convertToNoDocument(n.version).setHasLocalMutations(),null):t);var i,s,a,o,l,h}function ab(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||r&&n&&Ym(r,n,(e,t)=>(t=t,(e=e).field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Hw&&t instanceof Hw||e instanceof $w&&t instanceof $w?Ym(e.elements,t.elements,Ty):e instanceof Yw&&t instanceof Yw?Ty(e.Re,t.Re):e instanceof Ww&&t instanceof Ww)))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var r,n}class ob extends nb{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class lb extends nb{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function hb(r){let n=new Map;return r.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=r.data.field(e),n.set(e,t))}),n}function ub(e,t,r){var n,i,s,a=new Map;k(e.length===r.length,32656,{Ve:r.length,me:e.length});for(let u=0;u<r.length;u++){var o=e[u],l=o.transform,h=t.data.field(o.field);a.set(o.field,(n=l,i=h,s=r[u],n instanceof Hw?Gw(n,i):n instanceof $w?Qw(n,i):s))}return a}function cb(e,r,n){var i,s,a,o,l,h,u,c=new Map;for(i of e){let e=i.transform,t=n.data.field(i.field);c.set(i.field,(s=e,a=t,o=r,u=h=l=void 0,s instanceof Ww?(o=o,h=a,u={fields:{[oy]:{stringValue:ay},[hy]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}},(h=h&&uy(h)?cy(h):h)&&(u.fields[ly]=h),{mapValue:u}):s instanceof Hw?Gw(s,a):s instanceof $w?Qw(s,a):(u=Kw(o=s,a),l=Jw(u)+Jw(o.Re),Ry(u)&&Ry(o.Re)?jw(l):qw(o.serializer,l))))}return c}class db extends nb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class pb extends nb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class fb{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){var r,n,i,s,a,o,l,h=t.mutationResults;for(let c=0;c<this.mutations.length;c++){var u=this.mutations[c];u.key.isEqual(e.key)&&(r=u,n=e,i=h[c],l=u=o=a=s=void 0,r instanceof ob?(a=n,o=i,u=(s=r).value.clone(),l=ub(s.fieldTransforms,a,o.transformResults),u.setAll(l),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()):r instanceof lb?(s=n,a=i,rb((o=r).precondition,s)?(l=ub(o.fieldTransforms,s,a.transformResults),(u=s.data).setAll(hb(o)),u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()):s.convertToUnknownDocument(a.version)):n.convertToNoDocument(i.version).setHasCommittedMutations())}}applyToLocalView(e,t){for(var r of this.baseMutations)r.key.isEqual(e.key)&&(t=sb(r,e,t,this.localWriteTime));for(var n of this.mutations)n.key.isEqual(e.key)&&(t=sb(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(n,i){let s=Lw();return this.mutations.forEach(e=>{var t=n.get(e.key),r=t.overlayedDocument,t=this.applyToLocalView(r,t.mutatedFields),t=ib(r,i.has(e.key)?null:t);null!==t&&s.set(e.key,t),r.isValidDocument()||r.convertToNoDocument(P.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),V())}isEqual(e){return this.batchId===e.batchId&&Ym(this.mutations,e.mutations,(e,t)=>ab(e,t))&&Ym(this.baseMutations,e.baseMutations,(e,t)=>ab(e,t))}}class gb{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){k(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let n=Fw;var i=e.mutations;for(let s=0;s<i.length;s++)n=n.insert(i[s].key,r[s].version);return new gb(e,t,r,n)}}class mb{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class vb{constructor(e,t){this.count=e,this.unchangedNames=t}}function _b(e){switch(e){case A.OK:return S(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return S(15467,{code:e})}}function yb(e){if(void 0===e)return xm("GRPC error has no .code"),A.UNKNOWN;switch(e){case Em.OK:return A.OK;case Em.CANCELLED:return A.CANCELLED;case Em.UNKNOWN:return A.UNKNOWN;case Em.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case Em.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case Em.INTERNAL:return A.INTERNAL;case Em.UNAVAILABLE:return A.UNAVAILABLE;case Em.UNAUTHENTICATED:return A.UNAUTHENTICATED;case Em.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case Em.NOT_FOUND:return A.NOT_FOUND;case Em.ALREADY_EXISTS:return A.ALREADY_EXISTS;case Em.PERMISSION_DENIED:return A.PERMISSION_DENIED;case Em.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case Em.ABORTED:return A.ABORTED;case Em.OUT_OF_RANGE:return A.OUT_OF_RANGE;case Em.UNIMPLEMENTED:return A.UNIMPLEMENTED;case Em.DATA_LOSS:return A.DATA_LOSS;default:return S(39323,{code:e})}}(e=Em=Em||{})[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS";let wb=new fm([4294967295,4294967295],0);function bb(e){var t=Hm().encode(e),r=new gm;return r.update(t),new Uint8Array(r.digest())}function Ib(e){var t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),t=t.getUint32(12,!0);return[new fm([r,n],0),new fm([i,t],0)]}class Tb{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||8<=t)throw new Eb("Invalid padding: "+t);if(r<0)throw new Eb("Invalid hash count: "+r);if(0<e.length&&0===this.hashCount)throw new Eb("Invalid hash count: "+r);if(0===e.length&&0!==t)throw new Eb("Invalid padding when bitmap length is 0: "+t);this.pe=8*e.length-t,this.ye=fm.fromNumber(this.pe)}we(e,t,r){let n=e.add(t.multiply(fm.fromNumber(r)));return(n=1===n.compare(wb)?new fm([n.getBits(0),n.getBits(1)],0):n).modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let t=bb(e),[r,n]=Ib(t);for(let i=0;i<this.hashCount;i++){let e=this.we(r,n,i);if(!this.be(e))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Tb(i,n,t);return r.forEach(e=>s.insert(e)),s}insert(i){if(0!==this.pe){let e=bb(i),[t,r]=Ib(e);for(let n=0;n<this.hashCount;n++){let e=this.we(t,r,n);this.Se(e)}}}Se(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Eb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Cb{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){var n=new Map;return n.set(e,Sb.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Cb(P.min(),n,new M(R),Dw,V())}}class Sb{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Sb(r,t,V(),V(),V())}}class kb{constructor(e,t,r,n){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=n}}class Ab{constructor(e,t){this.targetId=e,this.Ce=t}}class Nb{constructor(e,t,r=ty.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class Rb{constructor(){this.Fe=0,this.Me=xb(),this.xe=ty.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){0<e.approximateByteSize()&&(this.Ne=!0,this.xe=e)}qe(){let r=V(),n=V(),i=V();return this.Me.forEach((e,t)=>{switch(t){case 0:r=r.add(e);break;case 2:n=n.add(e);break;case 1:i=i.add(e);break;default:S(38017,{changeType:t})}}),new Sb(this.xe,this.Oe,r,n,i)}Qe(){this.Ne=!1,this.Me=xb()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){--this.Fe,k(0<=this.Fe,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class Pb{constructor(e){this.ze=e,this.je=new Map,this.He=Dw,this.Je=Db(),this.Ye=Db(),this.Ze=new M(R)}Xe(e){for(var t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(var r of e.removedTargetIds)this.tt(r,e.key,e.ve)}nt(r){this.forEachTarget(r,e=>{var t=this.rt(e);switch(r.state){case 0:this.it(e)&&t.ke(r.resumeToken);break;case 1:t.We(),t.Be||t.Qe(),t.ke(r.resumeToken);break;case 2:t.We(),t.Be||this.removeTarget(e);break;case 3:this.it(e)&&(t.Ge(),t.ke(r.resumeToken));break;case 4:this.it(e)&&(this.st(e),t.ke(r.resumeToken));break;default:S(56790,{state:r.state})}})}forEachTarget(e,r){0<e.targetIds.length?e.targetIds.forEach(r):this.je.forEach((e,t)=>{this.it(t)&&r(t)})}ot(n){let i=n.targetId,e=n.Ce.count,t=this._t(i);if(t){var r=t.target;if(dw(r))if(0===e){let e=new x(r.path);this.tt(i,e,By.newNoDocument(e,P.min()))}else k(1===e,20013,{expectedCount:e});else{let r=this.ut(i);if(r!==e){let e=this.ct(n),t=e?this.lt(e,n,r):1;if(0!==t){this.st(i);let e=2===t?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(i,e)}}}}}ct(e){var t=e.Ce.unchangedNames;if(!t||!t.bits)return null;var{bits:{bitmap:t="",padding:r=0},hashCount:n=0}=t;let i,s;try{i=sy(t).toUint8Array()}catch(e){if(e instanceof ey)return Om("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new Tb(i,r,n)}catch(e){return Om(e instanceof Eb?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.pe?null:s}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(r,n){var e=this.ze.getRemoteKeysForTarget(n);let i=0;return e.forEach(e=>{var t=this.ze.Pt(),t=`projects/${t.projectId}/databases/${t.database}/documents/`+e.path.canonicalString();r.mightContain(t)||(this.tt(n,e,null),i++)}),i}It(n){let i=new Map,s=(this.je.forEach((e,t)=>{var r=this._t(t);if(r){if(e.current&&dw(r.target)){let e=new x(r.target.path);this.Et(e).has(t)||this.dt(t,e)||this.tt(t,e,By.newNoDocument(e,n))}e.Le&&(i.set(t,e.qe()),e.Qe())}}),V());this.Ye.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{var t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1)}),r&&(s=s.add(e))}),this.He.forEach((e,t)=>t.setReadTime(n));var e=new Cb(n,i,this.Ze,this.He,s);return this.He=Dw,this.Je=Db(),this.Ye=Db(),this.Ze=new M(R),e}et(e,t){var r;this.it(e)&&(r=this.dt(e,t.key)?2:0,this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e)))}tt(e,t,r){var n;this.it(e)&&(n=this.rt(e),this.dt(e,t)?n.$e(t,1):n.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r)&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){var t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Rb,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new L(R),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new L(R),this.Je=this.Je.insert(e,t)),t}it(e){var t=null!==this._t(e);return t||C("WatchChangeAggregator","Detected inactive target",e),t}_t(e){var t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(t){this.je.set(t,new Rb),this.ze.getRemoteKeysForTarget(t).forEach(e=>{this.tt(t,e,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Db(){return new M(x.comparator)}function xb(){return new M(x.comparator)}let Ob={asc:"ASCENDING",desc:"DESCENDING"},Mb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Lb={and:"AND",or:"OR"};class Fb{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ub(e,t){return e.useProto3Json||xv(t)?t:{value:t}}function Vb(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function qb(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function jb(e){return k(!!e,49232),P.fromTimestamp((t=ny(e),new Zm(t.seconds,t.nanos)));var t}function Bb(e,t){return zb(e,t).canonicalString()}function zb(e,t){e=e;var r=new D(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function Kb(e){var t=D.fromString(e);return k(uI(t),10190,{key:t.toString()}),t}function Wb(e,t){return Bb(e.databaseId,t.path)}function Hb(e,t){var r=Kb(t);if(r.get(1)!==e.databaseId.projectId)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new x(Yb(r))}function Gb(e,t){return Bb(e.databaseId,t)}function $b(e){var t=Kb(e);return 4===t.length?D.emptyPath():Yb(t)}function Qb(e){return new D(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Yb(e){return k(4<e.length&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Jb(e,t,r){return{name:Wb(e,t),fields:r.value.mapValue.fields}}function Xb(e,t,r){var n=Hb(e,t.name),i=jb(t.updateTime),s=t.createTime?jb(t.createTime):P.min(),a=new jy({mapValue:{fields:t.fields}}),n=By.newFoundDocument(n,i,s,a);return r&&n.setHasCommittedMutations(),r?n.setHasCommittedMutations():n}function Zb(e,t){let r;if(t instanceof ob)r={update:Jb(e,t.key,t.value)};else if(t instanceof db)r={delete:Wb(e,t.key)};else if(t instanceof lb)r={update:Jb(e,t.key,t.data),updateMask:(e=>{let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}})(t.fieldMask)};else{if(!(t instanceof pb))return S(16599,{ft:t.type});r={verify:Wb(e,t.key)}}return 0<t.fieldTransforms.length&&(r.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof Ww)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Hw)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof $w)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Yw)return{fieldPath:e.field.canonicalString(),increment:t.Re};throw S(20930,{transform:e.transform})})),t.precondition.isNone||(r.currentDocument=(e=e,void 0!==(t=t.precondition).updateTime?{updateTime:(n=t.updateTime,Vb(e,n.toTimestamp()))}:void 0!==t.exists?{exists:t.exists}:S(27497))),r;var n}function eI(i,t){let r=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?tb.updateTime(jb(s.updateTime)):void 0!==s.exists?tb.exists(s.exists):tb.none():tb.none(),n=t.updateTransforms?t.updateTransforms.map(r=>{{var e=i;let t=null;if("setToServerValue"in r)k("REQUEST_TIME"===r.setToServerValue,16630,{proto:r}),t=new Ww;else if("appendMissingElements"in r){let e=r.appendMissingElements.values||[];t=new Hw(e)}else if("removeAllFromArray"in r){let e=r.removeAllFromArray.values||[];t=new $w(e)}else"increment"in r?t=new Yw(e,r.increment):S(16584,{proto:r});var n=nv.fromServerFormat(r.fieldPath);return new Zw(n,t)}}):[];var s,a;if(t.update){t.update.name;var o=Hb(i,t.update.name),l=new jy({mapValue:{fields:t.update.fields}});if(t.updateMask){s=t.updateMask,a=s.fieldPaths||[];let e=new Z_(a.map(e=>nv.fromServerFormat(e)));return new lb(o,l,e,r,n)}return new ob(o,l,r,n)}if(t.delete){let e=Hb(i,t.delete);return new db(e,r)}if(t.verify){let e=Hb(i,t.verify);return new pb(e,r)}return S(1463,{proto:t})}function tI(e,n){return e&&0<e.length?(k(void 0!==n,14353),e.map(t=>{{var r=n;let e=t.updateTime?jb(t.updateTime):jb(r);return e.isEqual(P.min())&&(e=jb(r)),new eb(e,t.transformResults||[])}})):[]}function rI(e,t){return{documents:[Gb(e,t.path)]}}function nI(e,t){var r={structuredQuery:{}},n=t.path;let i;null!==t.collectionGroup?(i=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Gb(e,i);n=(e=>{if(0!==e.length)return function r(e){return e instanceof F?(e=>{if("=="===e.op){if(xy(e.value))return{unaryFilter:{field:lI(e.field),op:"IS_NAN"}};if(Dy(e.value))return{unaryFilter:{field:lI(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(xy(e.value))return{unaryFilter:{field:lI(e.field),op:"IS_NOT_NAN"}};if(Dy(e.value))return{unaryFilter:{field:lI(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lI(e.field),op:aI(e.op),value:e.value}}})(e):e instanceof U?(e=>{let t=e.getFilters().map(e=>r(e));return 1===t.length?t[0]:{compositeFilter:{op:oI(e.op),filters:t}}})(e):S(54877,{filter:e})}(U.create(e,"and"))})(t.filters),n&&(r.structuredQuery.where=n),n=(e=>{if(0!==e.length)return e.map(e=>({field:lI((e=e).field),direction:(e=e.dir,Ob[e])}))})(t.orderBy),n&&(r.structuredQuery.orderBy=n),n=Ub(e,t.limit);return null!==n&&(r.structuredQuery.limit=n),t.startAt&&(r.structuredQuery.startAt={before:(e=t.startAt).inclusive,values:e.position}),t.endAt&&(r.structuredQuery.endAt={before:!(e=t.endAt).inclusive,values:e.position}),{gt:r,parent:i}}function iI(e){let t=$b(e.parent);var r,n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(0<i){k(1===i,65062);let e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let a=[],o=(n.where&&(a=(e=n.where,(i=function t(e){return void 0!==e.unaryFilter?(i=>{switch(i.unaryFilter.op){case"IS_NAN":let e=hI(i.unaryFilter.field);return F.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=hI(i.unaryFilter.field);return F.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=hI(i.unaryFilter.field);return F.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let n=hI(i.unaryFilter.field);return F.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return S(61313);default:return S(60726)}})(e):void 0!==e.fieldFilter?(e=>F.create(hI(e.fieldFilter.field),(e=>{switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return S(58110);default:return S(50506)}})(e.fieldFilter.op),e.fieldFilter.value))(e):void 0!==e.compositeFilter?(e=>U.create(e.compositeFilter.filters.map(e=>t(e)),(e=>{switch(e){case"AND":return"and";case"OR":return"or";default:return S(1026)}})(e.compositeFilter.op)))(e):S(30097,{filter:e})}(e))instanceof U&&Yy(i)?i.getFilters():[i])),[]),l=(n.orderBy&&(o=n.orderBy.map(e=>(e=e,new Hy(hI(e.field),(e=>{switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(e.direction))))),null),h=(n.limit&&(l=(e=n.limit,xv(i="object"==typeof e?e.value:e)?null:i)),null),u=(n.startAt&&(h=(e=n.startAt,i=!!e.before,r=e.values||[],new zy(r,i))),null);return n.endAt&&(u=(e=n.endAt,r=!e.before,i=e.values||[],new zy(i,r))),vw(t,s,o,a,l,"F",h,u)}function sI(e,t){var r=(e=>{switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S(28987,{purpose:e})}})(t.purpose);return null==r?null:{"goog-listen-tags":r}}function aI(e){return Mb[e]}function oI(e){return Lb[e]}function lI(e){return{fieldPath:e.canonicalString()}}function hI(e){return nv.fromServerFormat(e.fieldPath)}function uI(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class cI{constructor(e,t,r,n,i=P.min(),s=P.min(),a=ty.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new cI(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cI(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dI{constructor(e){this.wt=e}}function pI(e,t){var r,n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:fI(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document={name:Wb(e=e.wt,(r=t).key),fields:r.data.value.mapValue.fields,updateTime:Vb(e,r.version.toTimestamp()),createTime:Vb(e,r.createTime.toTimestamp())};else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:gI(t.version)};else{if(!t.isUnknownDocument())return S(57904,{document:t});i.unknownDocument={path:n.path.toArray(),version:gI(t.version)}}return i}function fI(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function gI(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function mI(e){var t=new Zm(e.seconds,e.nanoseconds);return P.fromTimestamp(t)}function vI(t,r){let e=(r.baseMutations||[]).map(e=>eI(t.wt,e));for(let s=0;s<r.mutations.length-1;++s){let t=r.mutations[s];if(s+1<r.mutations.length&&void 0!==r.mutations[s+1].transform){let e=r.mutations[s+1];t.updateTransforms=e.transform.fieldTransforms,r.mutations.splice(s+1,1),++s}}let n=r.mutations.map(e=>eI(t.wt,e)),i=Zm.fromMillis(r.localWriteTimeMs);return new fb(r.batchId,i,e,n)}function _I(e){var t,r=mI(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?mI(e.lastLimboFreeSnapshotVersion):P.min(),i=void 0!==e.query.documents?(t=e.query,k(1===(i=t.documents.length),1966,{count:i}),Iw(_w($b(t.documents[0])))):Iw(iI(e.query));return new cI(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,ty.fromBase64String(e.resumeToken))}function yI(e,t){var r=gI(t.snapshotVersion),n=gI(t.lastLimboFreeSnapshotVersion),i=dw(t.target)?rI(e.wt,t.target):nI(e.wt,t.target).gt,s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:uw(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function wI(e){var t=iI({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ew(t,t.limit,"L"):t}function bI(e,t){return new mb(t.largestBatchId,eI(e.wt,t.overlayMutation))}function II(e,t){var r=t.path.lastSegment();return[e,Fv(t.path.popLast()),r]}function TI(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:gI(n.readTime),documentKey:Fv(n.documentKey.path),largestBatchId:n.largestBatchId}}class EI{getBundleMetadata(e,t){return CI(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:mI(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return CI(e).put({bundleId:(e=t).id,createTime:gI(jb(e.createTime)),version:e.version})}getNamedQuery(e,t){return SI(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:wI(e.bundledQuery),readTime:mI(e.readTime)}})}saveNamedQuery(e,t){return SI(e).put({name:(e=t).name,readTime:gI(jb(e.readTime)),bundledQuery:e.bundledQuery})}}function CI(e){return W_(e,__)}function SI(e){return W_(e,y_)}class kI{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){var r=t.uid||"";return new kI(e,r)}getOverlay(e,t){return AI(e).get(II(this.userId,t)).next(e=>e?bI(this.serializer,e):null)}getOverlays(e,t){let r=Lw();return O.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(n,i,e){let s=[];return e.forEach((e,t)=>{var r=new mb(i,t);s.push(this.St(n,r))}),O.waitFor(s)}removeOverlaysForBatchId(r,e,n){let t=new Set,i=(e.forEach(e=>t.add(Fv(e.getCollectionPath()))),[]);return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(AI(r).X(D_,t))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){let n=Lw(),i=Fv(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return AI(e).J(D_,s).next(e=>{for(var t of e){let e=bI(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,i){let s=Lw(),a;var n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return AI(e).te({index:O_,range:n},(e,t,r)=>{var n=bI(this.serializer,t);s.size()<i||n.largestBatchId===a?(s.set(n.getKey(),n),a=n.largestBatchId):r.done()}).next(()=>s)}St(e,t){return AI(e).put(((e,t,r)=>{var[,n,i]=II(t,r.mutation.key);return{userId:t,collectionPath:n,documentId:i,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Zb(e.wt,r.mutation)}})(this.serializer,this.userId,t))}}function AI(e){return W_(e,R_)}class NI{Dt(e){return W_(e,L_)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(e=>{var t=null==e?void 0:e.value;return t?ty.fromUint8Array(t):ty.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class RI{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(t,r){if("nullValue"in t)this.Mt(r,5);else if("booleanValue"in t)this.Mt(r,10),r.xt(t.booleanValue?1:0);else if("integerValue"in t)this.Mt(r,15),r.xt(iy(t.integerValue));else if("doubleValue"in t){var e=iy(t.doubleValue);isNaN(e)?this.Mt(r,13):(this.Mt(r,15),Ov(e)?r.xt(0):r.xt(e))}else if("timestampValue"in t){let e=t.timestampValue;this.Mt(r,20),"string"==typeof e&&(e=ny(e)),r.Ot(""+(e.seconds||"")),r.xt(e.nanos||0)}else"stringValue"in t?(this.Nt(t.stringValue,r),this.Bt(r)):"bytesValue"in t?(this.Mt(r,30),r.Lt(sy(t.bytesValue)),this.Bt(r)):"referenceValue"in t?this.kt(t.referenceValue,r):"geoPointValue"in t?(e=t.geoPointValue,this.Mt(r,45),r.xt(e.latitude||0),r.xt(e.longitude||0)):"mapValue"in t?Fy(t)?this.Mt(r,Number.MAX_SAFE_INTEGER):My(t)?this.qt(t.mapValue,r):(this.Qt(t.mapValue,r),this.Bt(r)):"arrayValue"in t?(this.$t(t.arrayValue,r),this.Bt(r)):S(19022,{Ut:t})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){var r=e.fields||{};this.Mt(t,55);for(let e of Object.keys(r))this.Nt(e,t),this.Ct(r[e],t)}qt(e,t){var r=e.fields||{},n=(this.Mt(t,53),wy),i=(null==(i=null==(i=r[n].arrayValue)?void 0:i.values)?void 0:i.length)||0;this.Mt(t,15),t.xt(iy(i)),this.Nt(n,t),this.Ct(r[n],t)}$t(e,t){var r=e.values||[];this.Mt(t,50);for(let e of r)this.Ct(e,t)}kt(e,t){this.Mt(t,37),x.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}RI.Wt=new RI;function PI(e){var t=64-(e=>{let t=0;for(let n=0;n<8;++n){var r=(e=>{if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t})(255&e[n]);if(t+=r,8!==r)break}return t})(e);return Math.ceil(t/8)}class DI{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.zt(r.value),r=t.next();this.jt()}Ht(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Yt()}Zt(e){for(var t of e){let e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{let e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(var t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){var t=this.tn(e),r=PI(t);this.nn(1+r),this.buffer[this.position++]=255&r;for(let n=t.length-r;n<t.length;++n)this.buffer[this.position++]=255&t[n]}rn(e){var t=this.tn(e),r=PI(t);this.nn(1+r),this.buffer[this.position++]=~(255&r);for(let n=t.length-r;n<t.length;++n)this.buffer[this.position++]=~(255&t[n])}sn(){this._n(255),this._n(255)}an(){this.un(255),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){e=e,(t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1);var t,r=new Uint8Array(t.buffer),n=!!(128&r[0]);r[0]^=n?255:128;for(let i=1;i<r.length;++i)r[i]^=n?255:0;return r}zt(e){var t=255&e;0==t?(this._n(0),this._n(255)):255==t?(this._n(255),this._n(0)):this._n(t)}Jt(e){var t=255&e;0==t?(this.un(0),this.un(255)):255==t?(this.un(255),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);t=new Uint8Array(e);t.set(this.buffer),this.buffer=t}}}class xI{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class OI{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class MI{constructor(){this.ln=new DI,this.hn=new xI(this.ln),this.Pn=new OI(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class LI{constructor(e,t,r,n){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=n}In(){var e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new LI(this.indexId,this.documentKey,this.arrayValue,r)}}function FI(e,t){var r=e.indexId-t.indexId;return 0!=r||0!==(r=UI(e.arrayValue,t.arrayValue))||0!==(r=UI(e.directionalValue,t.directionalValue))?r:x.comparator(e.documentKey,t.documentKey)}function UI(e,t){for(let n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!=r)return r}return e.length-t.length}class VI{constructor(e){this.En=new L((e,t)=>nv.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[];for(var t of e.filters){let e=t;e.isInequality()?this.En=this.En.add(e):this.An.push(e)}}get Rn(){return 1<this.En.size}Vn(e){if(k(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;let t=av(e);if(void 0!==t&&!this.mn(t))return!1;var r=ov(e);let n=new Set,i=0,s=0;for(;i<r.length&&this.mn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i!==r.length){if(0<this.En.size){let t=this.En.getIterator().getNext();if(!n.has(t.field.canonicalString())){let e=r[i];if(!this.fn(t,e)||!this.gn(this.dn[s++],e))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.gn(this.dn[s++],e))return!1}}return!0}pn(){if(this.Rn)return null;let e=new L(nv.comparator);var t,r,n=[];for(t of this.An)t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n.push(new lv(t.field,2)):e.has(t.field)||(e=e.add(t.field),n.push(new lv(t.field,0))));for(r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new lv(r.field,"asc"===r.dir?0:1)));return new sv(sv.UNKNOWN_ID,this.collectionId,n,hv.empty())}mn(e){for(var t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){var r;return!(void 0===e||!e.field.isEqual(t.fieldPath))&&(r="array-contains"===e.op||"array-contains-any"===e.op,2===t.kind==r)}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function qI(e){var t;return 0===e.getFilters().length?[]:(t=function t(e){if(k(e instanceof F||e instanceof U,34018),e instanceof F)return e;if(1===e.filters.length)return t(e.filters[0]);let r=e.filters.map(e=>t(e));let n=U.create(r,e.op);return n=HI(n),zI(n)?n:(k(n instanceof U,64498),k($y(n),40251),k(1<n.filters.length,57927),n.filters.reduce((e,t)=>KI(e,t)))}(function t(r){var n;if(k(r instanceof F||r instanceof U,20012),r instanceof F){if(r instanceof sw){let e=(null==(n=null==(n=r.value.arrayValue)?void 0:n.values)?void 0:n.map(e=>F.create(r.field,"==",e)))||[];return U.create(e,"or")}return r}let e=r.filters.map(e=>t(e));return U.create(e,r.op)}(e)),k(zI(t),7391),jI(t)||BI(t)?[t]:t.getFilters())}function jI(e){return e instanceof F}function BI(e){return e instanceof U&&Yy(e)}function zI(e){return jI(e)||BI(e)||(e=>{if(e instanceof U&&Qy(e)){for(var t of e.getFilters())if(!jI(t)&&!BI(t))return!1;return!0}return!1})(e)}function KI(e,t){var r,n;return k(e instanceof F||e instanceof U,38388),k(t instanceof F||t instanceof U,25473),HI(e instanceof F?t instanceof F?(r=e,n=t,U.create([r,n],"and")):WI(e,t):t instanceof F?WI(t,e):((e,t)=>{if(k(0<e.filters.length&&0<t.filters.length,48005),$y(e)&&$y(t))return Xy(e,t.getFilters());let r=Qy(e)?e:t,n=Qy(e)?t:e,i=r.filters.map(e=>KI(e,n));return U.create(i,"or")})(e,t))}function WI(t,e){var r;return $y(e)?Xy(e,t.getFilters()):(r=e.filters.map(e=>KI(t,e)),U.create(r,"or"))}function HI(t){if(k(t instanceof F||t instanceof U,11850),t instanceof F)return t;var e=t.getFilters();if(1===e.length)return HI(e[0]);if(Jy(t))return t;let r=e.map(e=>HI(e)),n=[];return r.forEach(e=>{e instanceof F?n.push(e):e instanceof U&&(e.op===t.op?n.push(...e.filters):n.push(e))}),1===n.length?n[0]:U.create(n,t.op)}class GI{constructor(){this.yn=new $I}addToCollectionParentIndex(e,t){return this.yn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(dv.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(dv.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class $I{constructor(){this.index={}}add(e){var t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new L(D.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){var t=e.lastSegment(),r=e.popLast(),t=this.index[t];return t&&t.has(r)}getEntries(e){return(this.index[e]||new L(D.comparator)).toArray()}}let QI="IndexedDbIndexManager",YI=new Uint8Array(0);class JI{constructor(e,t){this.databaseId=t,this.wn=new $I,this.bn=new Pw(e=>uw(e),(e,t)=>cw(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){var r,n;return this.wn.has(t)?O.resolve():(n=t.lastSegment(),r=t.popLast(),e.addOnCommittedListener(()=>{this.wn.add(t)}),n={collectionId:n,parent:Fv(r)},XI(e).put(n))}getCollectionParents(e,r){let n=[],t=IDBKeyRange.bound([r,""],[Jm(r),""],!1,!0);return XI(e).J(t).next(e=>{for(var t of e){if(t.collectionId!==r)break;n.push(Vv(t.parent))}return n})}addFieldIndex(e,r){let t=eT(e),n={indexId:r.indexId,collectionGroup:r.collectionGroup,fields:r.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;var i=t.add(n);if(r.indexState){let t=tT(e);return i.next(e=>{t.put(TI(e,this.uid,r.indexState.sequenceNumber,r.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=eT(e),n=tT(e),i=ZI(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=eT(e),r=ZI(e),n=tT(e);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(r,e){return O.forEach(this.Sn(e),t=>this.getIndexType(r,t).next(e=>{if(0===e||1===e){let e=new VI(t).pn();if(null!=e)return this.addFieldIndex(r,e)}}))}getDocumentsMatchingTarget(e,c){let d=ZI(e),r=!0,n=new Map;return O.forEach(this.Sn(c),t=>this.Dn(e,t).next(e=>{r=r&&!!e,n.set(t,e)})).next(()=>{if(r){let h=V(),u=[];return O.forEach(n,(e,t)=>{C(QI,`Using index ${r=e,`id=${r.indexId}|cg=${r.collectionGroup}|f=`+r.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+uw(c));var r,n=((t,e)=>{var r=av(e);if(void 0!==r)for(let e of pw(t,r.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null})(t,e),i=((t,r)=>{var n,i=new Map;for(n of ov(r))for(let e of pw(t,n.fieldPath))switch(e.op){case"==":case"in":i.set(n.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return i.set(n.fieldPath.canonicalString(),e.value),Array.from(i.values())}return null})(t,e),s=((t,e)=>{var r,n=[];let i=!0;for(r of ov(e)){let e=(0===r.kind?fw:gw)(t,r.fieldPath,t.startAt);n.push(e.value),i=i&&e.inclusive}return new zy(n,i)})(t,e),a=((t,e)=>{var r,n=[];let i=!0;for(r of ov(e)){let e=(0===r.kind?gw:fw)(t,r.fieldPath,t.endAt);n.push(e.value),i=i&&e.inclusive}return new zy(n,i)})(t,e),o=this.vn(e,t,s),l=this.vn(e,t,a),i=this.Cn(e,t,i),n=this.Fn(e.indexId,n,o,s.inclusive,l,a.inclusive,i);return O.forEach(n,e=>d.Z(e,c.limit).next(e=>{e.forEach(e=>{var t=x.fromSegments(e.documentKey);h.has(t)||(h=h.add(t),u.push(t))})}))}).next(()=>u)}return O.resolve(null)})}Sn(t){let e=this.bn.get(t);return e||(e=0===t.filters.length?[t]:qI(U.create(t.filters,"and")).map(e=>hw(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.bn.set(t,e)),e}Fn(i,s,a,o,l,h,u){let e=(null!=s?s.length:1)*Math.max(a.length,l.length),c=e/(null!=s?s.length:1),d=[];for(let p=0;p<e;++p){let t=s?this.Mn(s[p/c]):YI,e=this.xn(i,t,a[p%c],o),r=this.On(i,t,l[p%c],h),n=u.map(e=>this.xn(i,t,e,!0));d.push(...this.createRange(e,r,n))}return d}xn(e,t,r,n){var i=new LI(e,x.empty(),t,r);return n?i:i.In()}On(e,t,r,n){var i=new LI(e,x.empty(),t,r);return n?i.In():i}Dn(e,t){let n=new VI(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(var r of e)n.Vn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let r=2,n=this.Sn(t);return O.forEach(n,t=>this.Dn(e,t).next(e=>{e?0!==r&&e.fields.length<(t=>{let r=new L(nv.comparator),n=!1;for(var i of t.filters)for(let e of i.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:r=r.add(e.field));for(let n of t.orderBy)n.field.isKeyField()||(r=r.add(n.field));return r.size+(n?1:0)})(t)&&(r=1):r=0})).next(()=>null!==t.limit&&1<n.length&&2===r?1:r)}Nn(e,t){var r,n=new MI;for(r of ov(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;var i=n.Tn(r.kind);RI.Wt.vt(e,i)}return n.cn()}Mn(e){var t=new MI;return RI.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){var r,n=new MI;return RI.Wt.vt(Ny(this.databaseId,t),n.Tn(0===(r=ov(e)).length?0:r[r.length-1].kind)),n.cn()}Cn(e,n,i){if(null===i)return[];let s=[],a=(s.push(new MI),0);for(var o of ov(e)){let t=i[a++];for(let r of s)if(this.Ln(n,o.fieldPath)&&Py(t))s=this.kn(s,o,t);else{let e=r.Tn(o.kind);RI.Wt.vt(t,e)}}return this.qn(s)}vn(e,t,r){return this.Cn(e,t,r.position)}qn(e){var t=[];for(let r=0;r<e.length;++r)t[r]=e[r].cn();return t}kn(r,n,e){let i=[...r],s=[];for(let r of e.arrayValue.values||[])for(let t of i){let e=new MI;e.seed(t.cn()),RI.Wt.vt(r,e.Tn(n.kind)),s.push(e)}return s}Ln(e,t){return!!e.filters.find(e=>e instanceof F&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=eT(e),n=tT(e);return(t?r.J(b_,IDBKeyRange.bound(t,t)):r.J()).next(e=>{let s=[];return O.forEach(e,i=>n.get([i.indexId,this.uid]).next(e=>{var t,r,n;s.push((t=i,r=(e=e)?new hv(e.sequenceNumber,new dv(mI(e.readTime),new x(Vv(e.documentKey)),e.largestBatchId)):hv.empty(),n=t.fields.map(([e,t])=>new lv(nv.fromServerFormat(e),t)),new sv(t.indexId,t.collectionGroup,n,r)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=r?r:R(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,r,n){let i=eT(e),s=tT(e);return this.Qn(e).next(t=>i.J(b_,IDBKeyRange.bound(r,r)).next(e=>O.forEach(e,e=>s.put(TI(e.indexId,this.uid,t,n)))))}updateIndexEntries(i,e){let r=new Map;return O.forEach(e,(t,n)=>{var e=r.get(t.collectionGroup);return(e?O.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(r.set(t.collectionGroup,e),O.forEach(e,r=>this.$n(i,t,r).next(e=>{var t=this.Un(n,r);return e.isEqual(t)?O.resolve():this.Kn(i,n,r,e,t)}))))})}Wn(e,t,r,n){return ZI(e).put({indexId:n.indexId,uid:this.uid,arrayValue:n.arrayValue,directionalValue:n.directionalValue,orderedDocumentKey:this.Bn(r,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,r,n){return ZI(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,this.Bn(r,t.key),t.key.path.toArray()])}$n(e,r,n){var t=ZI(e);let i=new L(FI);return t.te({index:A_,range:IDBKeyRange.only([n.indexId,this.uid,this.Bn(n,r)])},(e,t)=>{i=i.add(new LI(n.indexId,r,t.arrayValue,t.directionalValue))}).next(()=>i)}Un(t,r){let n=new L(FI);var i=this.Nn(r,t);if(null!=i){let e=av(r);if(null!=e){var s=t.data.field(e.fieldPath);if(Py(s))for(let e of s.arrayValue.values||[])n=n.add(new LI(r.indexId,t.key,this.Mn(e),i))}else n=n.add(new LI(r.indexId,t.key,YI,i))}return n}Kn(t,r,s,e,a){C(QI,"Updating index entries for document '%s'",r.key);let o=[];{var l=FI,h=e=>{o.push(this.Wn(t,r,s,e))},u=e=>{o.push(this.Gn(t,r,s,e))},c=e.getIterator(),d=a.getIterator();let n=X_(c),i=X_(d);for(;n||i;){let t=!1,r=!1;if(n&&i){let e=l(n,i);e<0?r=!0:0<e&&(t=!0)}else null!=n?r=!0:t=!0;t?(h(i),i=X_(d)):r?(u(n),n=X_(c)):(n=X_(c),i=X_(d))}}return O.waitFor(o)}Qn(e){let n=1;return tT(e).te({index:E_,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,r)=>{r.done(),n=t.sequenceNumber+1}).next(()=>n)}createRange(r,n,e){e=e.sort((e,t)=>FI(e,t)).filter((e,t,r)=>!t||0!==FI(e,r[t-1]));var i=[];i.push(r);for(let s of e){let e=FI(s,r),t=FI(s,n);if(0===e)i[0]=r.In();else if(0<e&&t<0)i.push(s),i.push(s.In());else if(0<t)break}i.push(n);let s=[];for(let a=0;a<i.length;a+=2){if(this.zn(i[a],i[a+1]))return[];let e=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,YI,[]],t=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,YI,[]];s.push(IDBKeyRange.bound(e,t))}return s}zn(e,t){return 0<FI(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(rT)}getMinOffset(t,e){return O.mapArray(this.Sn(e),e=>this.Dn(t,e).next(e=>e||S(44426))).next(rT)}}function XI(e){return W_(e,g_)}function ZI(e){return W_(e,S_)}function eT(e){return W_(e,w_)}function tT(e){return W_(e,I_)}function rT(e){k(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let i=1;i<e.length;i++){var n=e[i].indexState.offset;pv(n,t)<0&&(t=n),r<n.largestBatchId&&(r=n.largestBatchId)}return new dv(t.readTime,t.documentKey,r)}let nT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class iT{static withCacheSize(e){return new iT(e,iT.DEFAULT_COLLECTION_PERCENTILE,iT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function sT(t,r,n){let e=t.store(Kv),i=t.store(Jv),s=[],a=IDBKeyRange.only(n.batchId),o=0;var l=e.te({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{k(1===o,47070,{batchId:n.batchId})}));let h=[];for(let t of n.mutations){let e=Qv(r,t.key.path,n.batchId);s.push(i.delete(e)),h.push(t.key)}return O.waitFor(s).next(()=>h)}function aT(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw S(14731);t=e.noDocument}return JSON.stringify(t).length}iT.DEFAULT_COLLECTION_PERCENTILE=10,iT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,iT.DEFAULT=new iT(41943040,iT.DEFAULT_COLLECTION_PERCENTILE,iT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),iT.DISABLED=new iT(-1,0,0);class oT{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.jn={}}static bt(e,t,r,n){k(""!==e.uid,64387);var i=e.isAuthenticated()?e.uid:"";return new oT(i,t,r,n)}checkEmpty(e){let n=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hT(e).te({index:Hv,range:t},(e,t,r)=>{n=!1,r.done()}).next(()=>n)}addMutationBatch(c,d,p,f){let g=uT(c),m=hT(c);return m.add({}).next(t=>{k("number"==typeof t,49019);let e=new fb(t,d,p,f),r=(i=this.serializer,s=this.userId,a=e,o=a.baseMutations.map(e=>Zb(i.wt,e)),l=a.mutations.map(e=>Zb(i.wt,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:l}),n=[];var i,s,a,o,l;let h=new L((e,t)=>R(e.canonicalString(),t.canonicalString()));for(let u of f){let e=Qv(this.userId,u.key.path,t);h=h.add(u.key.path.popLast()),n.push(m.put(r)),n.push(g.put(e,Yv))}return h.forEach(e=>{n.push(this.indexManager.addToCollectionParentIndex(c,e))}),c.addOnCommittedListener(()=>{this.jn[t]=e.keys()}),O.waitFor(n).next(()=>e)})}lookupMutationBatch(e,t){return hT(e).get(t).next(e=>e?(k(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),vI(this.serializer,e)):null)}Hn(e,r){return this.jn[r]?O.resolve(this.jn[r]):this.lookupMutationBatch(e,r).next(e=>{var t;return e?(t=e.keys(),this.jn[r]=t):null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return hT(e).te({index:Hv,range:r},(e,t,r)=>{t.userId===this.userId&&(k(t.batchId>=n,47524,{Jn:n}),i=vI(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Dv;return hT(e).te({index:Hv,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,Dv],[this.userId,Number.POSITIVE_INFINITY]);return hT(e).J(Hv,t).next(e=>e.map(e=>vI(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(o,l){let e=$v(this.userId,l.path),t=IDBKeyRange.lowerBound(e),h=[];return uT(o).te({range:t},(t,e,r)=>{let[n,i,s]=t,a=Vv(i);if(n===this.userId&&l.path.isEqual(a))return hT(o).get(s).next(e=>{if(!e)throw S(61480,{Yn:t,batchId:s});k(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:s}),h.push(vI(this.serializer,e))});r.done()}).next(()=>h)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new L(R),r=[];return e.forEach(a=>{var e=$v(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=uT(t).te({range:e},(e,t,r)=>{var[n,i,s]=e,i=Vv(i);n===this.userId&&a.path.isEqual(i)?o=o.add(s):r.done()});r.push(e)}),O.waitFor(r).next(()=>this.Zn(t,o))}getAllMutationBatchesAffectingQuery(e,t){let a=t.path,o=a.length+1,r=$v(this.userId,a),n=IDBKeyRange.lowerBound(r),l=new L(R);return uT(e).te({range:n},(e,t,r)=>{var[n,i,s]=e,i=Vv(i);n===this.userId&&a.isPrefixOf(i)?i.length===o&&(l=l.add(s)):r.done()}).next(()=>this.Zn(e,l))}Zn(e,t){let r=[],n=[];return t.forEach(t=>{n.push(hT(e).get(t).next(e=>{if(null===e)throw S(35274,{batchId:t});k(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(vI(this.serializer,e))}))}),O.waitFor(n).next(()=>r)}removeMutationBatch(t,r){return sT(t.he,this.userId,r).next(e=>(t.addOnCommittedListener(()=>{this.Xn(r.batchId)}),O.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Xn(e){delete this.jn[e]}performConsistencyCheck(r){return this.checkEmpty(r).next(e=>{if(!e)return O.resolve();let t=IDBKeyRange.lowerBound([this.userId]),n=[];return uT(r).te({range:t},(t,e,r)=>{if(t[0]===this.userId){let e=Vv(t[1]);n.push(e)}else r.done()}).next(()=>{k(0===n.length,56720,{er:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return lT(e,this.userId,t)}tr(e){return cT(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Dv,lastStreamToken:""})}}function lT(e,s,t){let r=$v(s,t.path),a=r[1],n=IDBKeyRange.lowerBound(r),o=!1;return uT(e).te({range:n,ee:!0},(e,t,r)=>{var[n,i,,]=e;n===s&&i===a&&(o=!0),r.done()}).next(()=>o)}function hT(e){return W_(e,Kv)}function uT(e){return W_(e,Jv)}function cT(e){return W_(e,zv)}class dT{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new dT(0)}static ir(){return new dT(-1)}}class pT{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(r){return this.sr(r).next(e=>{var t=new dT(e.highestTargetId);return e.highestTargetId=t.next(),this._r(r,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.sr(e).next(e=>P.fromTimestamp(new Zm(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.sr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,r,n){return this.sr(t).next(e=>(e.highestListenSequenceNumber=r,n&&(e.lastRemoteSnapshotVersion=n.toTimestamp()),e.highestListenSequenceNumber<r&&(e.highestListenSequenceNumber=r),this._r(t,e)))}addTargetData(t,r){return this.ar(t,r).next(()=>this.sr(t).next(e=>(e.targetCount+=1,this.ur(r,e),this._r(t,e))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>fT(t).delete(e.targetId)).next(()=>this.sr(t)).next(e=>(k(0<e.targetCount,8065),--e.targetCount,this._r(t,e)))}removeTargets(n,i,s){let a=0,o=[];return fT(n).te((e,t)=>{var r=_I(t);r.sequenceNumber<=i&&null===s.get(r.targetId)&&(a++,o.push(this.removeTargetData(n,r)))}).next(()=>O.waitFor(o)).next(()=>a)}forEachTarget(e,n){return fT(e).te((e,t)=>{var r=_I(t);n(r)})}sr(e){return gT(e).get(p_).next(e=>(k(null!==e,2888),e))}_r(e,t){return gT(e).put(p_,t)}ar(e,t){return fT(e).put(yI(this.serializer,t))}ur(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),t.highestListenSequenceNumber<e.sequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.sr(e).next(e=>e.targetCount)}getTargetData(e,i){var t=uw(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return fT(e).te({range:t,index:o_},(e,t,r)=>{var n=_I(t);cw(i,n.target)&&(s=n,r.done())}).next(()=>s)}addMatchingKeys(r,e,n){let i=[],s=mT(r);return e.forEach(e=>{var t=Fv(e.path);i.push(s.put({targetId:n,path:t})),i.push(this.referenceDelegate.addReference(r,n,e))}),O.waitFor(i)}removeMatchingKeys(r,e,n){let i=mT(r);return O.forEach(e,e=>{var t=Fv(e.path);return O.waitFor([i.delete([n,t]),this.referenceDelegate.removeReference(r,n,e)])})}removeMatchingKeysForTargetId(e,t){var r=mT(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){var r=IDBKeyRange.bound([t],[t+1],!1,!0),n=mT(e);let i=V();return n.te({range:r,ee:!0},(e,t,r)=>{var n=Vv(e[1]),n=new x(n);i=i.add(n)}).next(()=>i)}containsKey(e,t){var r=Fv(t.path),r=IDBKeyRange.bound([r],[Jm(r)],!1,!0);let n=0;return mT(e).te({index:c_,ee:!0,range:r},([e],t,r)=>{0!==e&&(n++,r.done())}).next(()=>0<n)}Rt(e,t){return fT(e).get(t).next(e=>e?_I(e):null)}}function fT(e){return W_(e,a_)}function gT(e){return W_(e,f_)}function mT(e){return W_(e,h_)}let vT="LruGarbageCollector";function _T([e,t],[r,n]){var i=R(e,r);return 0===i?R(t,n):i}class yT{constructor(e){this.cr=e,this.buffer=new L(_T),this.lr=0}hr(){return++this.lr}Pr(e){var t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();_T(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Tr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return null!==this.Tr}Ir(e){C(vT,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Tv(e)?C(vT,"Ignoring IndexedDB error during garbage collection: ",e):await mv(e)}await this.Ir(3e5)})}}class bT{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return O.resolve(Pv.le);let r=new yT(t);return this.Er.forEachTarget(e,e=>r.Pr(e.sequenceNumber)).next(()=>this.Er.Ar(e,e=>r.Pr(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Er.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(t,r){return-1===this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(nT)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),nT):this.Rr(t,r))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(t,r){let n,i,s,a,o,l,h,u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(n=e,o=Date.now(),this.removeTargets(t,n,r))).next(e=>(s=e,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(e=>(h=Date.now(),Dm()<=c.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(h-l)+"ms\n"+`Total Duration: ${h-u}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}function IT(e,t){return new bT(e,t)}class TT{constructor(e,t){this.db=e,this.garbageCollector=IT(this,t)}dr(e){let r=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,r){return this.mr(e,(e,t)=>r(t))}addReference(e,t,r){return ET(e,r)}removeReference(e,t,r){return ET(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ET(e,t)}gr(e,r){{var n=e,i=r;let t=!1;return cT(n).ne(e=>lT(n,e,i).next(e=>(e&&(t=!0),O.resolve(!e)))).next(()=>t)}}removeOrphanedDocuments(r,n){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.mr(r,(t,e)=>{if(e<=n){let e=this.gr(r,t).next(e=>{if(!e)return a++,i.getEntry(r,t).next(()=>(i.removeEntry(t,P.min()),mT(r).delete([0,Fv(t.path)])))});s.push(e)}}).next(()=>O.waitFor(s)).next(()=>i.apply(r)).next(()=>a)}removeTarget(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ET(e,t)}mr(e,n){var t=mT(e);let i,s=Pv.le;return t.te({index:c_},([e],{path:t,sequenceNumber:r})=>{0===e?(s!==Pv.le&&n(new x(Vv(i)),s),s=r,i=t):s=Pv.le}).next(()=>{s!==Pv.le&&n(new x(Vv(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ET(e,t){return mT(e).put((e=e.currentSequenceNumber,{targetId:0,path:Fv(t.path),sequenceNumber:e}))}class CT{constructor(){this.changes=new Pw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,By.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var r=this.changes.get(t);return void 0!==r?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ST{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return RT(e).put(r)}removeEntry(e,t,r){return RT(e).delete((e=r,[(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],fI(e),n[n.length-1]]));var n}updateMetadata(t,r){return this.getMetadata(t).next(e=>(e.byteSize+=r,this.pr(t,e)))}getEntry(e,r){let n=By.newInvalidDocument(r);return RT(e).te({index:e_,range:IDBKeyRange.only(PT(r))},(e,t)=>{n=this.yr(r,t)}).next(()=>n)}wr(e,r){let n={size:0,document:By.newInvalidDocument(r)};return RT(e).te({index:e_,range:IDBKeyRange.only(PT(r))},(e,t)=>{n={document:this.yr(r,t),size:aT(t)}}).next(()=>n)}getEntries(e,t){let n=Dw;return this.br(e,t,(e,t)=>{var r=this.yr(e,t);n=n.insert(e,r)}).next(()=>n)}Sr(e,t){let n=Dw,i=new M(x.comparator);return this.br(e,t,(e,t)=>{var r=this.yr(e,t);n=n.insert(e,r),i=i.insert(e,aT(t))}).next(()=>({documents:n,Dr:i}))}br(e,t,i){if(t.isEmpty())return O.resolve();let r=new L(xT),n=(t.forEach(e=>r=r.add(e)),IDBKeyRange.bound(PT(r.first()),PT(r.last()))),s=r.getIterator(),a=s.getNext();return RT(e).te({index:e_,range:n},(e,t,r)=>{for(var n=x.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&xT(a,n)<0;)i(a,null),a=s.getNext();a&&a.isEqual(n)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?r.H(PT(a)):r.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,n,t,i,s){var r=n.path,a=[r.popLast().toArray(),r.lastSegment(),fI(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],r=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return RT(e).J(IDBKeyRange.bound(a,r,!0)).next(e=>{null!=s&&s.incrementDocumentReadCount(e.length);let t=Dw;for(let r of e){let e=this.yr(x.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);e.isFoundDocument()&&(Aw(n,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,r,i){let s=Dw;var n=DT(t,r),a=DT(t,dv.max());return RT(e).te({index:r_,range:IDBKeyRange.bound(n,a,!0)},(e,t,r)=>{var n=this.yr(x.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(s=s.insert(n.key,n)).size===i&&r.done()}).next(()=>s)}newChangeBuffer(e){return new AT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return NT(e).get(s_).next(e=>(k(!!e,20021),e))}pr(e,t){return NT(e).put(s_,t)}yr(e,t){if(t){let e=((e,r)=>{let n;if(r.document)n=Xb(e.wt,r.document,!!r.hasCommittedMutations);else if(r.noDocument){let e=x.fromSegments(r.noDocument.path),t=mI(r.noDocument.readTime);n=By.newNoDocument(e,t),r.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!r.unknownDocument)return S(56709);{let e=x.fromSegments(r.unknownDocument.path),t=mI(r.unknownDocument.version);n=By.newUnknownDocument(e,t)}}return r.readTime&&n.setReadTime((e=r.readTime,t=new Zm(e[0],e[1]),P.fromTimestamp(t))),n;var t})(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(P.min()))return e}return By.newInvalidDocument(e)}}function kT(e){return new ST(e)}class AT extends CT{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new Pw(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){let a=[],o=0,l=new L((e,t)=>R(e.canonicalString(),t.canonicalString()));return this.changes.forEach((t,r)=>{var e=this.Cr.get(t);if(a.push(this.vr.removeEntry(s,t,e.readTime)),r.isValidDocument()){var n=pI(this.vr.serializer,r),i=(l=l.add(t.path.popLast()),aT(n));o+=i-e.size,a.push(this.vr.addEntry(s,t,n))}else if(o-=e.size,this.trackRemovals){let e=pI(this.vr.serializer,r.convertToNoDocument(P.min()));a.push(this.vr.addEntry(s,t,e))}}),l.forEach(e=>{a.push(this.vr.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.vr.updateMetadata(s,o)),O.waitFor(a)}getFromCache(e,t){return this.vr.wr(e,t).next(e=>(this.Cr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.vr.Sr(e,t).next(({documents:r,Dr:e})=>(e.forEach((e,t)=>{this.Cr.set(e,{size:t,readTime:r.get(e).readTime})}),r))}}function NT(e){return W_(e,i_)}function RT(e){return W_(e,Xv)}function PT(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function DT(e,t){var r=t.documentKey.path.toArray();return[e,fI(t.readTime),r.slice(0,r.length-2),0<r.length?r[r.length-1]:""]}function xT(e,t){var r=e.path.toArray(),n=t.path.toArray();let i=0;for(let s=0;s<r.length-2&&s<n.length-2;++s)if(i=R(r[s],n[s]))return i;return(i=R(r.length,n.length))||(i=R(r[r.length-2],n[n.length-2]))||R(r[r.length-1],n[n.length-1])}class OT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class MT{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(t,r){let n=null;return this.documentOverlayCache.getOverlay(t,r).next(e=>(n=e,this.remoteDocumentCache.getEntry(t,r))).next(e=>(null!==n&&sb(n.mutation,e,Z_.empty(),Zm.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,V()).next(()=>e))}getLocalViewOfDocuments(e,t,r=V()){let n=Lw();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let r=Ow();return e.forEach((e,t)=>{r=r.insert(e,t.overlayedDocument)}),r}))}getOverlayedDocuments(e,t){let r=Lw();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,V()))}populateOverlays(e,r,t){let n=[];return t.forEach(e=>{r.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,t)=>{r.set(e,t)})})}computeViews(e,t,n,i){let s=Dw,a=Lw(),o=Lw();return t.forEach((e,t)=>{var r=n.get(t.key);i.has(t.key)&&(void 0===r||r.mutation instanceof lb)?s=s.insert(t.key,t):void 0!==r?(a.set(t.key,r.mutation.getFieldMask()),sb(r.mutation,t,r.mutation.getFieldMask(),Zm.now())):a.set(t.key,Z_.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new OT(t,null!=(r=a.get(e))?r:null))}),o))}recalculateAndSaveOverlays(a,o){let l=Lw(),h=new M((e,t)=>e-t),u=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,o).next(e=>{for(let n of e)n.keys().forEach(e=>{var t,r=o.get(e);null!==r&&(t=l.get(e)||Z_.empty(),t=n.applyToLocalView(r,t),l.set(e,t),r=(h.get(n.batchId)||V()).add(e),h=h.insert(n.batchId,r))})}).next(()=>{for(var i=[],s=h.getReverseIterator();s.hasNext();){let e=s.getNext(),t=e.key,r=e.value,n=Lw();r.forEach(e=>{var t;u.has(e)||(null!==(t=ib(o.get(e),l.get(e)))&&n.set(e,t),u=u.add(e))}),i.push(this.documentOverlayCache.saveOverlays(a,t,n))}return O.waitFor(i)}).next(()=>l)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,r,n){return i=t,x.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ww(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n);var i}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(r=>{var e=0<o-r.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-r.size):O.resolve(Lw());let n=iv,i=r;return e.next(e=>O.forEach(e,(t,e)=>(n<e.largestBatchId&&(n=e.largestBatchId),r.get(t)?O.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,r)).next(()=>this.computeViews(s,i,e,V())).next(e=>({batchId:n,changes:Mw(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(e=>{let t=Ow();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(n,i,s,a){let o=i.collectionGroup,l=Ow();return this.indexManager.getCollectionParents(n,o).next(e=>O.forEach(e,e=>{t=i,e=e.child(o);var t,r=new mw(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(n,r,s,a).next(e=>{e.forEach((e,t)=>{l=l.insert(e,t)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(t,s,r,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,r.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,r,a,n))).next(n=>{a.forEach((e,t)=>{var r=t.getKey();null===n.get(r)&&(n=n.insert(r,By.newInvalidDocument(r)))});let i=Ow();return n.forEach((e,t)=>{var r=a.get(e);void 0!==r&&sb(r.mutation,t,Z_.empty(),Zm.now()),Aw(s,t)&&(i=i.insert(e,t))}),i})}}class LT{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return O.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,{id:t.id,version:t.version,createTime:jb(t.createTime)}),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,{name:(t=t).name,query:wI(t.bundledQuery),readTime:jb(t.readTime)}),O.resolve()}}class FT{constructor(){this.overlays=new M(x.comparator),this.Or=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Lw();return O.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(r,n,e){return e.forEach((e,t)=>{this.St(r,n,t)}),O.resolve()}removeOverlaysForBatchId(e,t,r){var n=this.Or.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Or.delete(r)),O.resolve()}getOverlaysForCollection(e,r,n){let i=Lw(),s=r.length+1,t=new x(r.child("")),a=this.overlays.getIteratorFrom(t);for(;a.hasNext();){let e=a.getNext().value,t=e.getKey();if(!r.isPrefixOf(t.path))break;t.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return O.resolve(i)}getOverlaysForCollectionGroup(e,r,n,t){let i=new M((e,t)=>e-t);for(var s=this.overlays.getIterator();s.hasNext();){let t=s.getNext().value;if(t.getKey().getCollectionGroup()===r&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Lw(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}let a=Lw(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=t)););return O.resolve(a)}St(e,t,r){var n=this.overlays.get(r.key);if(null!==n){let e=this.Or.get(n.largestBatchId).delete(r.key);this.Or.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new mb(t,r));let i=this.Or.get(t);void 0===i&&(i=V(),this.Or.set(t,i)),this.Or.set(t,i.add(r.key))}}class UT{constructor(){this.sessionToken=ty.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}class VT{constructor(){this.Nr=new L(qT.Br),this.Lr=new L(qT.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){var r=new qT(e,t);this.Nr=this.Nr.add(r),this.Lr=this.Lr.add(r)}qr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Qr(new qT(e,t))}$r(e,t){e.forEach(e=>this.removeReference(e,t))}Ur(e){let t=new x(new D([])),r=new qT(t,e),n=new qT(t,e+1),i=[];return this.Lr.forEachInRange([r,n],e=>{this.Qr(e),i.push(e.key)}),i}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){var t=new x(new D([])),r=new qT(t,e),t=new qT(t,e+1);let n=V();return this.Lr.forEachInRange([r,t],e=>{n=n.add(e.key)}),n}containsKey(e){var t=new qT(e,0),t=this.Nr.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class qT{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return x.comparator(e.key,t.key)||R(e.Gr,t.Gr)}static kr(e,t){return R(e.Gr,t.Gr)||x.comparator(e.key,t.key)}}class jT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new L(qT.Br)}checkEmpty(e){return O.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){var i=this.Jn,s=(this.Jn++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new fb(i,t,r,n));this.mutationQueue.push(s);for(let t of n)this.zr=this.zr.add(new qT(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return O.resolve(s)}lookupMutationBatch(e,t){return O.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){var r=this.Hr(t+1),r=r<0?0:r;return O.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(0===this.mutationQueue.length?Dv:this.Jn-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new qT(t,0),n=new qT(t,Number.POSITIVE_INFINITY),i=[];return this.zr.forEachInRange([r,n],e=>{var t=this.jr(e.Gr);i.push(t)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new L(R);return t.forEach(e=>{var t=new qT(e,0),r=new qT(e,Number.POSITIVE_INFINITY);this.zr.forEachInRange([t,r],e=>{n=n.add(e.Gr)})}),O.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;x.isDocumentKey(i)||(i=i.child(""));var s=new qT(new x(i),0);let a=new L(R);return this.zr.forEachWhile(e=>{var t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Gr)),!0)},s),O.resolve(this.Jr(a))}Jr(e){let r=[];return e.forEach(e=>{var t=this.jr(e);null!==t&&r.push(t)}),r}removeMutationBatch(r,n){k(0===this.Yr(n.batchId,"removed"),55003),this.mutationQueue.shift();let i=this.zr;return O.forEach(n.mutations,e=>{var t=new qT(e.key,n.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(r,e.key)}).next(()=>{this.zr=i})}Xn(e){}containsKey(e,t){var r=new qT(t,0),r=this.zr.firstAfterOrEqual(r);return O.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}jr(e){var t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class BT{constructor(e){this.Zr=e,this.docs=new M(x.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){var r=t.key,n=this.docs.get(r),n=n?n.size:0,i=this.Zr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){var r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():By.newInvalidDocument(t))}getEntries(e,t){let r=Dw;return t.forEach(e=>{var t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():By.newInvalidDocument(e))}),O.resolve(r)}getDocumentsMatchingQuery(e,r,n,i){let s=Dw,a=r.path,t=new x(a.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(t);for(;o.hasNext();){let{key:e,value:{document:t}}=o.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||pv(cv(t),n)<=0||(i.has(t.key)||Aw(r,t))&&(s=s.insert(t.key,t.mutableCopy()))}return O.resolve(s)}getAllFromCollectionGroup(e,t,r,n){S(9500)}Xr(e,t){return O.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new zT(this)}getSize(e){return O.resolve(this.size)}}class zT extends CT{constructor(e){super(),this.vr=e}applyChanges(r){let n=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?n.push(this.vr.addEntry(r,t)):this.vr.removeEntry(e)}),O.waitFor(n)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}class KT{constructor(e){this.persistence=e,this.ei=new Pw(e=>uw(e),cw),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.ti=0,this.ni=new VT,this.targetCount=0,this.ri=dT.rr()}forEachTarget(e,r){return this.ei.forEach((e,t)=>r(t)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ti&&(this.ti=t),O.resolve()}ar(e){this.ei.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.ri=new dT(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.ar(t),O.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),--this.targetCount,O.resolve()}removeTargets(r,n,i){let s=0,a=[];return this.ei.forEach((e,t)=>{t.sequenceNumber<=n&&null===i.get(t.targetId)&&(this.ei.delete(e),a.push(this.removeMatchingKeysForTargetId(r,t.targetId)),s++)}),O.waitFor(a).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){var r=this.ei.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.ni.qr(t,r),O.resolve()}removeMatchingKeys(t,e,r){this.ni.$r(e,r);let n=this.persistence.referenceDelegate,i=[];return n&&e.forEach(e=>{i.push(n.markPotentiallyOrphaned(t,e))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),O.resolve()}getMatchingKeysForTargetId(e,t){var r=this.ni.Wr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.ni.containsKey(t))}}class WT{constructor(e,t){this.ii={},this.overlays={},this.si=new Pv(0),this.oi=!1,this.oi=!0,this._i=new UT,this.referenceDelegate=e(this),this.ai=new KT(this),this.indexManager=new GI,this.remoteDocumentCache=(e=e=>this.referenceDelegate.ui(e),new BT(e)),this.serializer=new dI(t),this.ci=new LT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new FT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ii[e.toKey()];return r||(r=new jT(t,this.referenceDelegate),this.ii[e.toKey()]=r),r}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,r){C("MemoryPersistence","Starting transaction:",e);let n=new HT(this.si.next());return this.referenceDelegate.li(),r(n).next(e=>this.referenceDelegate.hi(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Pi(t,r){return O.or(Object.values(this.ii).map(e=>()=>e.containsKey(t,r)))}}class HT extends gv{constructor(e){super(),this.currentSequenceNumber=e}}class GT{constructor(e){this.persistence=e,this.Ti=new VT,this.Ii=null}static Ei(e){return new GT(e)}get di(){if(this.Ii)return this.Ii;throw S(60996)}addReference(e,t,r){return this.Ti.addReference(r,t),this.di.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Ti.removeReference(r,t),this.di.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),O.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}li(){this.Ii=new Set}hi(r){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.di,e=>{let t=x.fromPath(e);return this.Ai(r,t).next(e=>{e||n.removeEntry(t,P.min())})}).next(()=>(this.Ii=null,n.apply(r)))}updateLimboDocument(e,t){return this.Ai(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return O.or([()=>O.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class $T{constructor(e,t){this.persistence=e,this.Ri=new Pw(e=>Fv(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=IT(this,t)}static Ei(e,t){return new $T(e,t)}li(){}hi(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let r=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}Ar(r,n){return O.forEach(this.Ri,(e,t)=>this.gr(r,e,t).next(e=>e?O.resolve():n(t)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,r){let n=0,t=this.persistence.getRemoteDocumentCache(),i=t.newChangeBuffer();return t.Xr(e,t=>this.gr(e,t,r).next(e=>{e||(n++,i.removeEntry(t,P.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.Ri.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),O.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function n(e){switch(Iy(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=cy(e);return t?16+n(t):16;case 5:return 2*e.stringValue.length;case 6:return sy(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+n(t),0);case 10:case 11:{var i=e.mapValue;let r=0;return G_(i.fields,(e,t)=>{r+=e.length+n(t)}),r}default:throw S(13486,{value:e})}}(e.data.value)),t}gr(e,t,r){return O.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{var e=this.Ri.get(t);return O.resolve(void 0!==e&&r<e)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class QT{constructor(e){this.serializer=e}q(t,e,r,n){let s=new _v("createOrUpgrade",e);var i;r<1&&1<=n&&(t.createObjectStore(jv),(i=t).createObjectStore(zv,{keyPath:"userId"}),i.createObjectStore(Kv,{keyPath:Wv,autoIncrement:!0}).createIndex(Hv,Gv,{unique:!0}),i.createObjectStore(Jv),YT(t),t.createObjectStore(qv));let a=O.resolve();return r<3&&3<=n&&(0!==r&&((i=t).deleteObjectStore(h_),i.deleteObjectStore(a_),i.deleteObjectStore(f_),YT(t)),a=a.next(()=>{return e=s,t=e.store(f_),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0},t.put(p_,r);var e,t,r})),r<4&&4<=n&&(a=(a=0!==r?a.next(()=>{return n=t,(i=s).store(Kv).J().next(e=>{n.deleteObjectStore(Kv),n.createObjectStore(Kv,{keyPath:Wv,autoIncrement:!0}).createIndex(Hv,Gv,{unique:!0});let t=i.store(Kv),r=e.map(e=>t.put(e));return O.waitFor(r)});var n,i}):a).next(()=>{t.createObjectStore(v_,{keyPath:"clientId"})})),r<5&&5<=n&&(a=a.next(()=>this.Vi(s))),r<6&&6<=n&&(a=a.next(()=>(t.createObjectStore(i_),this.mi(s)))),r<7&&7<=n&&(a=a.next(()=>this.fi(s))),r<8&&8<=n&&(a=a.next(()=>this.gi(t,s))),r<9&&9<=n&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&10<=n&&(a=a.next(()=>this.pi(s))),r<11&&11<=n&&(a=a.next(()=>{t.createObjectStore(__,{keyPath:"bundleId"}),t.createObjectStore(y_,{keyPath:"name"})})),r<12&&12<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(R_,{keyPath:P_})).createIndex(D_,x_,{unique:!1}),e.createIndex(O_,M_,{unique:!1})})),r<13&&13<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(Xv,{keyPath:Zv})).createIndex(e_,t_),e.createIndex(r_,n_)}).next(()=>this.yi(t,s)).next(()=>t.deleteObjectStore(qv))),r<14&&14<=n&&(a=a.next(()=>this.wi(t,s))),r<15&&15<=n&&(a=a.next(()=>{var e;(e=t).createObjectStore(w_,{keyPath:"indexId",autoIncrement:!0}).createIndex(b_,"collectionGroup",{unique:!1}),e.createObjectStore(I_,{keyPath:T_}).createIndex(E_,C_,{unique:!1}),e.createObjectStore(S_,{keyPath:k_}).createIndex(A_,N_,{unique:!1})})),r<16&&16<=n&&(a=a.next(()=>{e.objectStore(I_).clear()}).next(()=>{e.objectStore(S_).clear()})),a=r<17&&17<=n?a.next(()=>{t.createObjectStore(L_,{keyPath:"name"})}):a}mi(t){let r=0;return t.store(qv).te((e,t)=>{r+=aT(t)}).next(()=>{var e={byteSize:r};return t.store(i_).put(s_,e)})}Vi(n){let e=n.store(zv),t=n.store(Kv);return e.J().next(e=>O.forEach(e,r=>{var e=IDBKeyRange.bound([r.userId,Dv],[r.userId,r.lastAcknowledgedBatchId]);return t.J(Hv,e).next(e=>O.forEach(e,e=>{k(e.userId===r.userId,18650,"Cannot process batch from unexpected user",{batchId:e.batchId});var t=vI(this.serializer,e);return sT(n,r.userId,t).next(()=>{})}))}))}fi(e){let a=e.store(h_),t=e.store(qv);return e.store(f_).get(p_).next(i=>{let s=[];return t.te((e,t)=>{let r=new D(e),n=[0,Fv(r)];s.push(a.get(n).next(e=>e?O.resolve():(e=r,a.put({targetId:0,path:Fv(e),sequenceNumber:i.highestListenSequenceNumber}))))}).next(()=>O.waitFor(s))})}gi(e,t){e.createObjectStore(g_,{keyPath:m_});let n=t.store(g_),i=new $I,s=r=>{if(i.add(r)){let e=r.lastSegment(),t=r.popLast();return n.put({collectionId:e,parent:Fv(t)})}};return t.store(qv).te({ee:!0},(e,t)=>{var r=new D(e);return s(r.popLast())}).next(()=>t.store(Jv).te({ee:!0},([,e],t)=>{var r=Vv(e);return s(r.popLast())}))}pi(e){let n=e.store(a_);return n.te((e,t)=>{var r=_I(t),r=yI(this.serializer,r);return n.put(r)})}yi(e,s){let t=s.store(qv),a=[];return t.te((e,t)=>{var r,n=s.store(Xv),i=((r=t).document?new x(D.fromString(r.document.name).popFirst(5)):r.noDocument?x.fromSegments(r.noDocument.path):r.unknownDocument?x.fromSegments(r.unknownDocument.path):S(36783)).path.toArray(),i={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>O.waitFor(a))}wi(e,s){let t=s.store(Kv),a=kT(this.serializer),o=new WT(GT.Ei,this.serializer.wt);return t.J().next(e=>{let n=new Map;return e.forEach(e=>{let t,r=null!=(t=n.get(e.userId))?t:V();vI(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),O.forEach(n,(e,t)=>{var r=new Nm(t),n=kI.bt(this.serializer,r),i=o.getIndexManager(r),r=oT.bt(r,this.serializer,i,o.referenceDelegate);return new MT(a,r,n,i).recalculateAndSaveOverlaysForDocumentKeys(new K_(s,Pv.le),e).next()})})}}function YT(e){e.createObjectStore(h_,{keyPath:u_}).createIndex(c_,d_,{unique:!0}),e.createObjectStore(a_,{keyPath:"targetId"}).createIndex(o_,l_,{unique:!0}),e.createObjectStore(f_)}let JT="IndexedDbPersistence",XT="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ZT{constructor(e,t,r,n,i,s,a,o,l,h,u=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.bi=i,this.window=s,this.document=a,this.Si=l,this.Di=h,this.Ci=u,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=e=>Promise.resolve(),!ZT.C())throw new N(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new TT(this,n),this.Bi=t+"main",this.serializer=new dI(o),this.Li=new yv(this.Bi,this.Ci,new QT(this.serializer)),this._i=new NI,this.ai=new pT(this.referenceDelegate,this.serializer),this.remoteDocumentCache=kT(this.serializer),this.ci=new EI,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,!1===h&&xm(JT,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ai.getHighestSequenceNumber(e));throw new N(A.FAILED_PRECONDITION,XT)}).then(e=>{this.si=new Pv(e,this.Si)}).then(()=>{this.oi=!0}).catch(e=>(this.Li&&this.Li.close(),Promise.reject(e)))}Ki(t){return this.Ni=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Li.U(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget(async()=>{this.started&&await this.qi()}))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>t0(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Wi(t).next(e=>{e||(this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)))})}).next(()=>this.Gi(t)).next(e=>this.isPrimary&&!e?this.zi(t).next(()=>!1):!!e&&this.ji(t).next(()=>!0))).catch(e=>{if(Tv(e))return C(JT,"Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return C(JT,"Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.bi.enqueueRetryable(()=>this.Ni(e)),this.isPrimary=e})}Wi(e){return e0(e).get(Bv).next(e=>O.resolve(this.Hi(e)))}Ji(e){return t0(e).delete(this.clientId)}async Yi(){if(this.isPrimary&&!this.Zi(this.Oi,18e5)){this.Oi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=W_(e,v_);return n.J().next(e=>{let t=this.Xi(e,18e5),r=e.filter(e=>-1===t.indexOf(e));return O.forEach(r,e=>n.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.ki)for(var t of e)this.ki.removeItem(this.es(t.clientId))}}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.qi().then(()=>this.Yi()).then(()=>this.Ui()))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(t){return this.Di?O.resolve(!0):e0(t).get(Bv).next(e=>{if(null!==e&&this.Zi(e.leaseTimestampMs,5e3)&&!this.ts(e.ownerId)){if(this.Hi(e)&&this.networkEnabled)return!0;if(!this.Hi(e)){if(e.allowTabSynchronization)return!1;throw new N(A.FAILED_PRECONDITION,XT)}}return!(!this.networkEnabled||!this.inForeground)||t0(t).J().next(e=>void 0===this.Xi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&C(JT,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),await this.Li.runTransaction("shutdown","readwrite",[jv,v_],e=>{let t=new K_(e,Pv.le);return this.zi(t).next(()=>this.Ji(t))}),this.Li.close(),this._s()}Xi(e,t){return e.filter(e=>this.Zi(e.updateTimeMs,t)&&!this.ts(e.clientId))}us(){return this.runTransaction("getActiveClients","readonly",e=>t0(e).J().next(e=>this.Xi(e,18e5).map(e=>e.clientId)))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return oT.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new JI(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return kI.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(t,r,n){C(JT,"Starting transaction:",t);var e,i="readonly"===r?"readonly":"readwrite",s=17===(e=this.Ci)?z_:16===e?B_:15===e?j_:14===e?q_:13===e?V_:12===e?U_:11===e?F_:void S(60245);let a;return this.Li.runTransaction(t,i,s,e=>(a=new K_(e,this.si?this.si.next():Pv.le),"readwrite-primary"===r?this.Wi(a).next(e=>!!e||this.Gi(a)).next(e=>{if(e)return n(a);throw xm(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)),new N(A.FAILED_PRECONDITION,fv)}).next(e=>this.ji(a).next(()=>e)):this.cs(a).next(()=>n(a)))).then(e=>(a.raiseOnCommittedEvent(),e))}cs(e){return e0(e).get(Bv).next(e=>{if(null!==e&&this.Zi(e.leaseTimestampMs,5e3)&&!this.ts(e.ownerId)&&!this.Hi(e)&&!(this.Di||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(A.FAILED_PRECONDITION,XT)})}ji(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return e0(e).put(Bv,t)}static C(){return yv.C()}zi(e){let t=e0(e);return t.get(Bv).next(e=>this.Hi(e)?(C(JT,"Releasing primary lease."),t.delete(Bv)):O.resolve())}Zi(e,t){var r=Date.now();return!(e<r-t||r<e&&(xm(`Detected an update time that is in the future: ${e} > `+r),1))}Qi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Mi=()=>{this.bi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.qi()))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground="visible"===this.document.visibilityState)}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Fi=()=>{this.ns();var e=/(?:Version|Mobile)\/1[456]/;fe()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{var r=null!==(null==(t=this.ki)?void 0:t.getItem(this.es(e)));return C(JT,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return xm(JT,"Failed to get zombied client id.",e),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){xm("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch(e){}}es(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function e0(e){return W_(e,jv)}function t0(e){return W_(e,v_)}function r0(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class n0{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.ls=r,this.hs=n}static Ps(e,t){let r=V(),n=V();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new n0(e,t.fromCache,r,n)}}class i0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class s0{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=fe()?8:0<wv(ae())?6:4}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(r,n,e,t){let i={result:null};return this.Rs(r,n).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Vs(r,n,t,e).next(e=>{i.result=e})}).next(()=>{if(!i.result){let t=new i0;return this.fs(r,n,t).next(e=>{if(i.result=e,this.Is)return this.gs(r,n,t,e.size)})}}).next(()=>i.result)}gs(e,t,r,n){return r.documentReadCount<this.Es?(Dm()<=c.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",kw(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),O.resolve()):(Dm()<=c.DEBUG&&C("QueryEngine","Query:",kw(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(Dm()<=c.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",kw(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Iw(t))):O.resolve())}Rs(i,s){if(yw(s))return O.resolve(null);let t=Iw(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=Ew(s,null,"F"),t=Iw(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{let n=V(...e);return this.As.getDocuments(i,n).next(r=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.ps(s,r);return this.ys(s,t,n,e.readTime)?this.Rs(i,Ew(s,null,"F")):this.ws(i,t,s,e)}))})))}Vs(r,n,i,s){return yw(n)||s.isEqual(P.min())?O.resolve(null):this.As.getDocuments(r,i).next(e=>{var t=this.ps(n,e);return this.ys(n,t,i,s)?O.resolve(null):(Dm()<=c.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),kw(n)),this.ws(r,t,n,uv(s,iv)).next(e=>e))})}ps(r,e){let n=new L(Rw(r));return e.forEach((e,t)=>{Aw(r,t)&&(n=n.add(t))}),n}ys(e,t,r,n){var i;return null!==e.limit&&(r.size!==t.size||!!(i="F"===e.limitType?t.last():t.first())&&(i.hasPendingWrites||0<i.version.compareTo(n)))}fs(e,t,r){return Dm()<=c.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",kw(t)),this.As.getDocumentsMatchingQuery(e,t,dv.min(),r)}ws(e,r,t,n){return this.As.getDocumentsMatchingQuery(e,t,n).next(t=>(r.forEach(e=>{t=t.insert(e.key,e)}),t))}}let a0="LocalStore",o0=3e8;class l0{constructor(e,t,r,n){this.persistence=e,this.bs=t,this.serializer=n,this.Ss=new M(R),this.Ds=new Pw(e=>uw(e),cw),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(r)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new MT(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ss))}}function h0(e,t,r,n){return new l0(e,t,r,n)}async function u0(e,t){let o=e;return o.persistence.runTransaction("Handle user change","readonly",s=>{let a;return o.mutationQueue.getAllMutationBatches(s).next(e=>(a=e,o.Fs(t),o.mutationQueue.getAllMutationBatches(s))).next(e=>{let t=[],r=[],n=V();for(let i of a){t.push(i.batchId);for(let e of i.mutations)n=n.add(e.key)}for(let i of e){r.push(i.batchId);for(let e of i.mutations)n=n.add(e.key)}return o.localDocuments.getDocuments(s,n).next(e=>({Ms:e,removedBatchIds:t,addedBatchIds:r}))})})}function c0(e,n){let i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let t=n.batch.keys(),r=i.Cs.newChangeBuffer({trackRemovals:!0});return((e,t,n,i)=>{let s=n.batch,r=s.keys(),a=O.resolve();return r.forEach(r=>{a=a.next(()=>i.getEntry(t,r)).next(e=>{var t=n.docVersions.get(r);k(null!==t,48541),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument())&&(e.setReadTime(n.commitVersion),i.addEntry(e))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))})(i,e,n,r).next(()=>r.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,(e=>{let t=V();for(let r=0;r<e.mutationResults.length;++r)0<e.mutationResults[r].transformResults.length&&(t=t.add(e.batch.mutations[r].key));return t})(n))).next(()=>i.localDocuments.getDocuments(e,t))})}function d0(e){let t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ai.getLastRemoteSnapshotVersion(e))}function p0(e,h){let u=e,c=h.snapshotVersion,d=u.Ss;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let e=u.Cs.newChangeBuffer({trackRemovals:!0}),l=(d=u.Ss,[]),t=(h.targetChanges.forEach((t,r)=>{var n,i,s,a=d.get(r);if(a){l.push(u.ai.removeMatchingKeys(o,t.removedDocuments,r).next(()=>u.ai.addMatchingKeys(o,t.addedDocuments,r)));let e=a.withSequenceNumber(o.currentSequenceNumber);null!==h.targetMismatches.get(r)?e=e.withResumeToken(ty.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,c)),d=d.insert(r,e),n=a,i=e,s=t,(0===n.resumeToken.approximateByteSize()||i.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=o0||0<s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size)&&l.push(u.ai.updateTargetData(o,e))}}),Dw),r=V();if(h.documentUpdates.forEach(e=>{h.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),l.push(f0(o,e,h.documentUpdates).next(e=>{t=e.xs,r=e.Os})),!c.isEqual(P.min())){let e=u.ai.getLastRemoteSnapshotVersion(o).next(e=>u.ai.setTargetsMetadata(o,o.currentSequenceNumber,c));l.push(e)}return O.waitFor(l).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,r)).next(()=>t)}).then(e=>(u.Ss=d,e))}function f0(e,s,t){let r=V(),a=V();return t.forEach(e=>r=r.add(e)),s.getEntries(e,r).next(n=>{let i=Dw;return t.forEach((e,t)=>{var r=n.get(e);t.isFoundDocument()!==r.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(P.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!r.isValidDocument()||0<t.version.compareTo(r.version)||0===t.version.compareTo(r.version)&&r.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):C(a0,"Ignoring outdated watch update for ",e,". Current version:",r.version," Watch version:",t.version)}),{xs:i,Os:a}})}function g0(e,n){let i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return i.ai.getTargetData(t,n).next(e=>e?(r=e,O.resolve(r)):i.ai.allocateTargetId(t).next(e=>(r=new cI(n,e,"TargetPurposeListen",t.currentSequenceNumber),i.ai.addTargetData(t,r).next(()=>r))))}).then(e=>{var t=i.Ss.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ss=i.Ss.insert(e.targetId,e),i.Ds.set(n,e.targetId)),e})}async function m0(e,t,r){let n=e,i=n.Ss.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Tv(e))throw e;C(a0,`Failed to update sequence numbers for target ${t}: `+e)}n.Ss=n.Ss.remove(t),n.Ds.delete(i.target)}function v0(e,a,o){let l=e,h=P.min(),u=V();return l.persistence.runTransaction("Execute query","readwrite",t=>{return e=l,r=t,n=Iw(a),(void 0!==(s=(i=e).Ds.get(n))?O.resolve(i.Ss.get(s)):i.ai.getTargetData(r,n)).next(e=>{if(e)return h=e.lastLimboFreeSnapshotVersion,l.ai.getMatchingKeysForTargetId(t,e.targetId).next(e=>{u=e})}).next(()=>l.bs.getDocumentsMatchingQuery(t,a,o?h:P.min(),o?u:V())).next(e=>(w0(l,Nw(a),e),{documents:e,Ns:u}));var e,r,n,i,s})}function _0(e,t){let r=e,n=r.ai,i=r.Ss.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.Rt(e,t).next(e=>e?e.target:null))}function y0(e,t){let r=e,n=r.vs.get(t)||P.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.Cs.getAllFromCollectionGroup(e,t,uv(n,iv),Number.MAX_SAFE_INTEGER)).then(e=>(w0(r,t,e),e))}function w0(e,t,r){let n=e.vs.get(t)||P.min();r.forEach((e,t)=>{0<t.readTime.compareTo(n)&&(n=t.readTime)}),e.vs.set(t,n)}let b0="firestore_clients";function I0(e,t){return b0+`_${e}_`+t}let T0="firestore_mutations";function E0(e,t,r){let n=T0+`_${e}_`+r;return t.isAuthenticated()&&(n+="_"+t.uid),n}let C0="firestore_targets";function S0(e,t){return C0+`_${e}_`+t}let k0="SharedClientState";class A0{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static qs(e,t,r){var n=JSON.parse(r);let i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new N(n.error.code,n.error.message)),s?new A0(e,t,n.state,i):(xm(k0,`Failed to parse mutation state for ID '${t}': `+r),null)}Qs(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class N0{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static qs(e,t){var r=JSON.parse(t);let n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new N(r.error.code,r.error.message)),i?new N0(e,r.state,n):(xm(k0,`Failed to parse target state for ID '${e}': `+t),null)}Qs(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class R0{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static qs(e,t){var r=JSON.parse(t);let n="object"==typeof r&&r.activeTargetIds instanceof Array,i=Vw;for(let s=0;n&&s<r.activeTargetIds.length;++s)n=Mv(r.activeTargetIds[s]),i=i.add(r.activeTargetIds[s]);return n?new R0(e,i):(xm(k0,`Failed to parse client data for instance '${e}': `+t),null)}}class P0{constructor(e,t){this.clientId=e,this.onlineState=t}static qs(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new P0(t.clientId,t.onlineState):(xm(k0,"Failed to parse online state: "+e),null)}}class D0{constructor(){this.activeTargetIds=Vw}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class x0{constructor(e,t,r,n,i){this.window=e,this.bi=t,this.persistenceKey=r,this.Ks=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ws=this.Gs.bind(this),this.zs=new M(R),this.started=!1,this.js=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Hs=I0(this.persistenceKey,this.Ks),this.Js="firestore_sequence_number_"+this.persistenceKey,this.zs=this.zs.insert(this.Ks,new D0),this.Ys=new RegExp(`^${b0}_${s}_([^_]*)$`),this.Zs=new RegExp(`^${T0}_${s}_(\\d+)(?:_(.*))?$`),this.Xs=new RegExp(`^${C0}_${s}_(\\d+)$`),this.eo="firestore_online_state_"+this.persistenceKey,this.no="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.Ws)}static C(e){return!(!e||!e.localStorage)}async start(){let e=await this.syncEngine.us();for(let r of e)if(r!==this.Ks){let e=this.getItem(I0(this.persistenceKey,r));var t;e&&(t=R0.qs(r,e))&&(this.zs=this.zs.insert(t.clientId,t))}this.ro();let r=this.storage.getItem(this.eo);if(r){let e=this.io(r);e&&this.so(e)}for(let e of this.js)this.Gs(e);this.js=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Js,JSON.stringify(e))}getAllActiveQueryTargets(){return this.oo(this.zs)}isActiveQueryTarget(r){let n=!1;return this.zs.forEach((e,t)=>{t.activeTargetIds.has(r)&&(n=!0)}),n}addPendingMutation(e){this._o(e,"pending")}updateMutationState(e,t,r){this._o(e,t,r),this.ao(e)}addLocalQueryTarget(t,e=!0){let r="not-current";if(this.isActiveQueryTarget(t)){let e=this.storage.getItem(S0(this.persistenceKey,t));var n;e&&(n=N0.qs(t,e))&&(r=n.state)}return e&&this.uo.$s(t),this.ro(),r}removeLocalQueryTarget(e){this.uo.Us(e),this.ro()}isLocalQueryTarget(e){return this.uo.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(S0(this.persistenceKey,e))}updateQueryState(e,t,r){this.co(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.ao(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.lo(e)}notifyBundleLoaded(e){this.ho(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ws),this.removeItem(this.Hs),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return C(k0,"READ",e,t),t}setItem(e,t){C(k0,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){C(k0,"REMOVE",e),this.storage.removeItem(e)}Gs(e){let t=e;t.storageArea===this.storage&&(C(k0,"EVENT",t.key,t.newValue),t.key===this.Hs?xm("Received WebStorage notification for local change. Another client might have garbage-collected our state"):this.bi.enqueueRetryable(async()=>{if(this.started){if(null!==t.key){if(this.Ys.test(t.key))return null==t.newValue?(e=this.Po(t.key),this.To(e,null)):(e=this.Io(t.key,t.newValue))?this.To(e.clientId,e):void 0;if(this.Zs.test(t.key)){if(null!==t.newValue){var e=this.Eo(t.key,t.newValue);if(e)return this.Ao(e)}}else if(this.Xs.test(t.key)){if(null!==t.newValue){var e=this.Ro(t.key,t.newValue);if(e)return this.Vo(e)}}else if(t.key===this.eo){if(null!==t.newValue){var e=this.io(t.newValue);if(e)return this.so(e)}}else t.key===this.Js?(e=(e=>{let t=Pv.le;if(null!=e)try{var r=JSON.parse(e);k("number"==typeof r,30636,{mo:e}),t=r}catch(e){xm(k0,"Failed to read sequence number from WebStorage",e)}return t})(t.newValue))!==Pv.le&&this.sequenceNumberHandler(e):t.key===this.no&&(e=this.fo(t.newValue),await Promise.all(e.map(e=>this.syncEngine.po(e))))}}else this.js.push(t)}))}get uo(){return this.zs.get(this.Ks)}ro(){this.setItem(this.Hs,this.uo.Qs())}_o(e,t,r){var n=new A0(this.currentUser,e,t,r),i=E0(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Qs())}ao(e){var t=E0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}lo(e){var t={clientId:this.Ks,onlineState:e};this.storage.setItem(this.eo,JSON.stringify(t))}co(e,t,r){var n=S0(this.persistenceKey,e),i=new N0(e,t,r);this.setItem(n,i.Qs())}ho(e){var t=JSON.stringify(Array.from(e));this.setItem(this.no,t)}Po(e){var t=this.Ys.exec(e);return t?t[1]:null}Io(e,t){var r=this.Po(e);return R0.qs(r,t)}Eo(e,t){var r=this.Zs.exec(e),n=Number(r[1]),r=void 0!==r[2]?r[2]:null;return A0.qs(new Nm(r),n,t)}Ro(e,t){var r=this.Xs.exec(e),r=Number(r[1]);return N0.qs(r,t)}io(e){return P0.qs(e)}fo(e){return JSON.parse(e)}async Ao(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.yo(e.batchId,e.state,e.error);C(k0,"Ignoring mutation for non-active user "+e.user.uid)}Vo(e){return this.syncEngine.wo(e.targetId,e.state,e.error)}To(e,t){let r=t?this.zs.insert(e,t):this.zs.remove(e),n=this.oo(this.zs),i=this.oo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.bo(s,a).then(()=>{this.zs=r})}so(e){this.zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}oo(e){let r=Vw;return e.forEach((e,t)=>{r=r.unionWith(t.activeTargetIds)}),r}}class O0{constructor(){this.So=new D0,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,r){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new D0,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class M0{vo(e){}shutdown(){}}let L0="ConnectivityMonitor";class F0{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){C(L0,"Network connectivity changed: AVAILABLE");for(var e of this.Oo)e(0)}xo(){C(L0,"Network connectivity changed: UNAVAILABLE");for(var e of this.Oo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let U0=null;function V0(){return null===U0?U0=268435456+Math.round(2147483648*Math.random()):U0++,"0x"+U0.toString(16)}let q0="RestConnection",j0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class B0{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}let z0="WebChannelConnection";class K0 extends class{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${r}/databases/`+n,this.qo=this.databaseId.database===fy?"project_id="+r:`project_id=${r}&database_id=`+n}Qo(t,e,r,n,i){let s=V0(),a=this.$o(t,e.toUriEncodedString());C(q0,`Sending RPC '${t}' ${s}:`,a,r);var o={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo},l=(this.Uo(o,n,i),new URL(a)).host,l=ee(l);return this.Ko(t,a,o,r,l).then(e=>(C(q0,`Received RPC '${t}' ${s}: `,e),e),e=>{throw Om(q0,`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",r),e})}Wo(e,t,r,n,i,s){return this.Qo(e,t,r,n,i)}Uo(r,e,t){r["X-Goog-Api-Client"]="gl-js/ fire/"+Rm,r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>r[t]=e),t&&t.headers.forEach((e,t)=>r[t]=e)}$o(e,t){var r=j0[e];return this.Lo+`/v1/${t}:`+r}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(l,t,r,n,e){let h=V0();return new Promise((s,a)=>{let o=new mm;o.setWithCredentials(!0),o.listenOnce(_m.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case ym.NO_ERROR:var e=o.getResponseJson();C(z0,`XHR for RPC '${l}' ${h} received:`,JSON.stringify(e)),s(e);break;case ym.TIMEOUT:C(z0,`RPC '${l}' ${h} timed out`),a(new N(A.DEADLINE_EXCEEDED,"Request time out"));break;case ym.HTTP_ERROR:var t=o.getStatus();if(C(z0,`RPC '${l}' ${h} failed with status:`,t,"response text:",o.getResponseText()),0<t){let e=o.getResponseJson();var r=null==(e=Array.isArray(e)?e[0]:e)?void 0:e.error;if(r&&r.status&&r.message){n=r.status,i=n.toLowerCase().replace(/_/g,"-");let e=0<=Object.values(A).indexOf(i)?i:A.UNKNOWN;a(new N(e,r.message))}else a(new N(A.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new N(A.UNAVAILABLE,"Connection failed."));break;default:S(9055,{s_:l,streamId:h,o_:o.getLastErrorCode(),__:o.getLastError()})}}finally{C(z0,`RPC '${l}' ${h} completed.`)}var n,i});var e=JSON.stringify(n);C(z0,`RPC '${l}' ${h} sending request:`,n),o.send(t,"POST",e,r,15)})}a_(i,e,t){let s=V0(),r=[this.Lo,"/","google.firestore.v1.Firestore","/",i,"/channel"],n=Tm(),a=Im(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Uo(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var h=r.join("");C(z0,`Creating RPC '${i}' stream ${s}: `+h,o);let u=n.createWebChannel(h,o),c=!1,d=!1,p=new B0({Go:e=>{d?C(z0,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(c||(C(z0,`Opening RPC '${i}' stream ${s} transport.`),u.open(),c=!0),C(z0,`RPC '${i}' stream ${s} sending:`,e),u.send(e))},zo:()=>u.close()}),f=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(u,vm.EventType.OPEN,()=>{d||(C(z0,`RPC '${i}' stream ${s} transport opened.`),p.t_())}),f(u,vm.EventType.CLOSE,()=>{d||(d=!0,C(z0,`RPC '${i}' stream ${s} transport closed`),p.r_())}),f(u,vm.EventType.ERROR,e=>{d||(d=!0,Om(z0,`RPC '${i}' stream ${s} transport errored. Name:`,e.name,"Message:",e.message),p.r_(new N(A.UNAVAILABLE,"The operation could not be completed")))}),f(u,vm.EventType.MESSAGE,e=>{if(!d){var t=e.data[0],n=(k(!!t,16349),t),n=(null==n?void 0:n.error)||(null==(n=n[0])?void 0:n.error);if(n){C(z0,`RPC '${i}' stream ${s} received error:`,n);let e=n.status,t=(e=>{var t=Em[e];if(void 0!==t)return yb(t)})(e),r=n.message;void 0===t&&(t=A.INTERNAL,r="Unknown error status: "+e+" with message "+n.message),d=!0,p.r_(new N(t,r)),u.close()}else C(z0,`RPC '${i}' stream ${s} received:`,t),p.i_(t)}}),f(a,bm.STAT_EVENT,e=>{e.stat===wm.PROXY?C(z0,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===wm.NOPROXY&&C(z0,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.n_()},0),p}}function W0(){return"undefined"!=typeof window?window:null}function H0(){return"undefined"!=typeof document?document:null}function G0(e){return new Fb(e,!0)}class $0{constructor(e,t,r=1e3,n=1.5,i=6e4){this.bi=e,this.timerId=t,this.u_=r,this.c_=n,this.l_=i,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();var t=Math.floor(this.h_+this.d_()),r=Math.max(0,Date.now()-this.T_),n=Math.max(0,t-r);0<n&&C("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,n,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){null!==this.P_&&(this.P_.skipDelay(),this.P_=null)}cancel(){null!==this.P_&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}let Q0="PersistentStream";class Y0{constructor(e,t,r,n,i,s,a,o){this.bi=e,this.R_=r,this.V_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new $0(e,t)}w_(){return 1===this.state||5===this.state||this.b_()}b_(){return 2===this.state||3===this.state}start(){this.p_=0,4!==this.state?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&null===this.f_&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,t){this.M_(),this.x_(),this.y_.cancel(),this.m_++,4!==e?this.y_.reset():t&&t.code===A.RESOURCE_EXHAUSTED?(xm(t.toString()),xm("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===A.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(t)}O_(){}auth(){this.state=1;let e=this.N_(this.m_),r=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.m_===r&&this.B_(e,t)},t=>{e(()=>{var e=new N(A.UNKNOWN,"Fetching auth token failed: "+t.message);return this.L_(e)})})}B_(e,t){let r=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{r(()=>this.listener.jo())}),this.stream.Jo(()=>{r(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(e=>{r(()=>this.L_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.p_?this.q_(e):this.onNext(e))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return C(Q0,"close with error: "+e),this.stream=null,this.close(4,e)}N_(t){return e=>{this.bi.enqueueAndForget(()=>this.m_===t?e():(C(Q0,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class J0 extends Y0{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();var t=((e,t)=>{let r;if("targetChange"in t){t.targetChange;var n="NO_CHANGE"===(l=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:S(39313,{state:l}),i=t.targetChange.targetIds||[],s=(l=t.targetChange.resumeToken,e.useProto3Json?(k(void 0===l||"string"==typeof l,58123),ty.fromBase64String(l||"")):(k(void 0===l||l instanceof Buffer||l instanceof Uint8Array,16193),ty.fromUint8Array(l||new Uint8Array))),a=t.targetChange.cause,a=a&&(a=void 0===(l=a).code?A.UNKNOWN:yb(l.code),new N(a,l.message||""));r=new Nb(n,i,s,a||null)}else if("documentChange"in t){t.documentChange;var n=t.documentChange,i=(n.document,n.document.name,n.document.updateTime,Hb(e,n.document.name)),s=jb(n.document.updateTime),a=n.document.createTime?jb(n.document.createTime):P.min(),o=new jy({mapValue:{fields:n.document.fields}}),i=By.newFoundDocument(i,s,a,o),s=n.targetIds||[],o=n.removedTargetIds||[];r=new kb(s,o,i.key,i)}else if("documentDelete"in t){t.documentDelete;n=t.documentDelete,s=(n.document,Hb(e,n.document)),o=n.readTime?jb(n.readTime):P.min(),i=By.newNoDocument(s,o),s=n.removedTargetIds||[];r=new kb([],s,i.key,i)}else if("documentRemove"in t){t.documentRemove;o=t.documentRemove,n=(o.document,Hb(e,o.document)),s=o.removedTargetIds||[];r=new kb([],s,n,null)}else{if(!("filter"in t))return S(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;var{count:i=0,unchangedNames:o}=e,s=new vb(i,o),n=e.targetId;r=new Ab(n,s)}}var l;return r})(this.serializer,e),r="targetChange"in(e=e)&&(!(r=e.targetChange).targetIds||!r.targetIds.length)&&r.readTime?jb(r.readTime):P.min();return this.listener.Q_(t,r)}U_(e){var t={},r=(t.database=Qb(this.serializer),t.addTarget=((t,r)=>{var n;let e=r.target;if((n=dw(e)?{documents:rI(t,e)}:{query:nI(t,e).gt}).targetId=r.targetId,0<r.resumeToken.approximateByteSize()){n.resumeToken=qb(t,r.resumeToken);let e=Ub(t,r.expectedCount);null!==e&&(n.expectedCount=e)}else if(0<r.snapshotVersion.compareTo(P.min())){n.readTime=Vb(t,r.snapshotVersion.toTimestamp());let e=Ub(t,r.expectedCount);null!==e&&(n.expectedCount=e)}return n})(this.serializer,e),sI(this.serializer,e));r&&(t.labels=r),this.F_(t)}K_(e){var t={};t.database=Qb(this.serializer),t.removeTarget=e,this.F_(t)}}class X0 extends Y0{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get W_(){return 0<this.p_}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return k(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,k(!e.writeResults||0===e.writeResults.length,55816),this.listener.z_()}onNext(e){k(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();var t=tI(e.writeResults,e.commitTime),r=jb(e.commitTime);return this.listener.j_(r,t)}H_(){var e={};e.database=Qb(this.serializer),this.F_(e)}G_(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>Zb(this.serializer,e))};this.F_(t)}}class Z0 extends class{}{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.J_=!1}Y_(){if(this.J_)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(r,n,i,s){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Qo(r,zb(n,i),s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(A.UNKNOWN,e.toString())})}Wo(r,n,i,s,a){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Wo(r,zb(n,i),s,e,t,a)).catch(e=>{throw"FirebaseError"===e.name?(e.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(A.UNKNOWN,e.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class eE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){0===this.Z_&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){"Online"===this.state?this.na("Unknown"):(this.Z_++,1<=this.Z_&&(this.sa(),this.ra("Connection failed 1 times. Most recent error: "+e.toString()),this.na("Offline")))}set(e){this.sa(),this.Z_=0,"Online"===e&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){var t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(xm(t),this.ea=!1):C("OnlineStateTracker",t)}sa(){null!==this.X_&&(this.X_.cancel(),this.X_=null)}}let tE="RemoteStore";class rE{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=i,this.ca.vo(e=>{r.enqueueAndForget(async()=>{var e;cE(this)&&(C(tE,"Restarting streams for network reachability change."),(e=this).aa.add(4),await iE(e),e.la.set("Unknown"),e.aa.delete(4),await nE(e))})}),this.la=new eE(r,n)}}async function nE(e){if(cE(e))for(var t of e.ua)await t(!0)}async function iE(e){for(var t of e.ua)await t(!1)}function sE(e,t){var r=e;r._a.has(t.targetId)||(r._a.set(t.targetId,t),uE(r)?hE(r):wE(r).b_()&&oE(r,t))}function aE(e,t){var r=e,n=wE(r);r._a.delete(t),n.b_()&&lE(r,t),0===r._a.size&&(n.b_()?n.v_():cE(r)&&r.la.set("Unknown"))}function oE(e,t){var r;e.ha.Ke(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(P.min()))&&(r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(r)),wE(e).U_(t)}function lE(e,t){e.ha.Ke(t),wE(e).K_(t)}function hE(t){t.ha=new Pb({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t._a.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),wE(t).start(),t.la.ta()}function uE(e){return cE(e)&&!wE(e).w_()&&0<e._a.size}function cE(e){return 0===e.aa.size}function dE(e){e.ha=void 0}async function pE(e,t,r){if(!Tv(t))throw t;e.aa.add(1),await iE(e),e.la.set("Offline"),r=r||(()=>d0(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{C(tE,"Retrying IndexedDB access"),await r(),e.aa.delete(1),await nE(e)})}function fE(t,r){return r().catch(e=>pE(t,e,r))}async function gE(e){var t,r,n,i,s=e,a=bE(s);let o=0<s.oa.length?s.oa[s.oa.length-1].batchId:Dv;for(;cE(i=s)&&i.oa.length<10;)try{let e=await((e,t)=>{let r=e;return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=Dv),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))})(s.localStore,o);if(null===e){0===s.oa.length&&a.v_();break}o=e.batchId,t=s,r=e,n=void 0,t.oa.push(r),(n=bE(t)).b_()&&n.W_&&n.G_(r.mutations)}catch(e){await pE(s,e)}mE(s)&&vE(s)}function mE(e){return cE(e)&&!bE(e).w_()&&0<e.oa.length}function vE(e){bE(e).start()}async function _E(e,t){var r=e,n=(r.asyncQueue.verifyOperationInProgress(),C(tE,"RemoteStore received new credentials"),cE(r));r.aa.add(3),await iE(r),n&&r.la.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.aa.delete(3),await nE(r)}async function yE(e,t){var r=e;t?(r.aa.delete(2),await nE(r)):(r.aa.add(2),await iE(r),r.la.set("Unknown"))}function wE(t){return t.Pa||(t.Pa=(e=t.datastore,r=t.asyncQueue,n={jo:(async function(e){e.la.set("Online")}).bind(null,t),Jo:(async function(r){r._a.forEach((e,t)=>{oE(r,e)})}).bind(null,t),Zo:(async function(e,t){dE(e),uE(e)?(e.la.ia(t),hE(e)):e.la.set("Unknown")}).bind(null,t),Q_:(async function(t,e,r){if(t.la.set("Online"),e instanceof Nb&&2===e.state&&e.cause)try{var n,i=t,s=e,a=s.cause;for(n of s.targetIds)i._a.has(n)&&(await i.remoteSyncer.rejectListen(n,a),i._a.delete(n),i.ha.removeTarget(n))}catch(r){C(tE,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await pE(t,r)}else if(e instanceof kb?t.ha.Xe(e):e instanceof Ab?t.ha.ot(e):t.ha.nt(e),!r.isEqual(P.min()))try{let e=await d0(t.localStore);0<=r.compareTo(e)&&(l=r,(h=(o=t).ha.It(l)).targetChanges.forEach((e,t)=>{var r;0<e.resumeToken.approximateByteSize()&&(r=o._a.get(t))&&o._a.set(t,r.withResumeToken(e.resumeToken,l))}),h.targetMismatches.forEach((e,t)=>{var r=o._a.get(e);r&&(o._a.set(e,r.withResumeToken(ty.EMPTY_BYTE_STRING,r.snapshotVersion)),lE(o,e),r=new cI(r.target,e,t,r.sequenceNumber),oE(o,r))}),await o.remoteSyncer.applyRemoteEvent(h))}catch(e){C(tE,"Failed to raise snapshot:",e),await pE(t,e)}var o,l,h}).bind(null,t)},(i=e).Y_(),new J0(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)),t.ua.push(async e=>{e?(t.Pa.D_(),uE(t)?hE(t):t.la.set("Unknown")):(await t.Pa.stop(),dE(t))})),t.Pa;var e,r,n,i}function bE(t){return t.Ta||(t.Ta=(e=t.datastore,r=t.asyncQueue,n={jo:()=>Promise.resolve(),Jo:(async function(e){bE(e).H_()}).bind(null,t),Zo:(async function(e,t){if(t&&bE(e).W_){var r=e,n=t;if(_b(t=n.code)&&t!==A.ABORTED){let e=r.oa.shift();bE(r).D_(),await fE(r,()=>r.remoteSyncer.rejectFailedWrite(e.batchId,n)),await gE(r)}await 0}mE(e)&&vE(e)}).bind(null,t),z_:(async function(e){var t,r=bE(e);for(t of e.oa)r.G_(t.mutations)}).bind(null,t),j_:(async function(e,t,r){let n=e.oa.shift(),i=gb.from(n,t,r);await fE(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await gE(e)}).bind(null,t)},(i=e).Y_(),new X0(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)),t.ua.push(async e=>{e?(t.Ta.D_(),await gE(t)):(await t.Ta.stop(),0<t.oa.length&&(C(tE,`Stopping write stream with ${t.oa.length} pending writes`),t.oa=[]))})),t.Ta;var e,r,n,i}class IE{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new Fm,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){var s=Date.now()+r,s=new IE(e,t,s,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(A.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function TE(e,t){if(xm("AsyncQueue",t+": "+e),Tv(e))return new N(A.UNAVAILABLE,t+": "+e);throw e}class EE{static emptySet(e){return new EE(e.comparator)}constructor(r){this.comparator=r?(e,t)=>r(e,t)||x.comparator(e.key,t.key):(e,t)=>x.comparator(e.key,t.key),this.keyedMap=Ow(),this.sortedSet=new M(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(r){this.sortedSet.inorderTraversal((e,t)=>(r(e),!1))}add(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof EE))return!1;if(this.size!==e.size)return!1;for(var r=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();r.hasNext();){let e=r.getNext().key,t=n.getNext().key;if(!e.isEqual(t))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){var r=new EE;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class CE{constructor(){this.Ia=new M(x.comparator)}track(e){var t=e.doc.key,r=this.Ia.get(t);!r||0!==e.type&&3===r.type?this.Ia=this.Ia.insert(t,e):3===e.type&&1!==r.type?this.Ia=this.Ia.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Ia=this.Ia.remove(t):1===e.type&&2===r.type?this.Ia=this.Ia.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):S(63341,{Vt:e,Ea:r})}da(){let r=[];return this.Ia.inorderTraversal((e,t)=>{r.push(t)}),r}}class SE{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new SE(e,t,EE.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cw(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(t[n].type!==r[n].type||!t[n].doc.isEqual(r[n].doc))return!1;return!0}}class kE{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class AE{constructor(){this.queries=NE(),this.onlineState="Unknown",this.fa=new Set}terminate(){var e,r,t,n;e=this,r=new N(A.ABORTED,"Firestore shutting down"),n=(t=e).queries,t.queries=NE(),n.forEach((e,t)=>{for(let e of t.Ra)e.onError(r)})}}function NE(){return new Pw(e=>Sw(e),Cw)}async function RE(t,r){let e=t,n=3;var i=r.query;let s=e.queries.get(i);s?!s.Va()&&r.ma()&&(n=2):(s=new kE,n=r.ma()?0:1);try{switch(n){case 0:s.Aa=await e.onListen(i,!0);break;case 1:s.Aa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(t){let e=TE(t,`Initialization of query '${kw(r.query)}' failed`);return void r.onError(e)}e.queries.set(i,s),s.Ra.push(r),r.ga(e.onlineState),s.Aa&&r.pa(s.Aa)&&DE(e)}async function PE(e,t){var r=e,n=t.query;let i=3;var s=r.queries.get(n);if(s){let e=s.Ra.indexOf(t);0<=e&&(s.Ra.splice(e,1),0===s.Ra.length?i=t.ma()?0:1:!s.Va()&&t.ma()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function DE(e){e.fa.forEach(e=>{e.next()})}(Cm=Cm||{}).ya="default",Cm.Cache="cache";class xE{constructor(e,t,r){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=r||{}}pa(t){if(!this.options.includeMetadataChanges){let e=[];for(var r of t.docChanges)3!==r.type&&e.push(r);t=new SE(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ba?this.Da(t)&&(this.wa.next(t),e=!0):this.va(t,this.onlineState)&&(this.Ca(t),e=!0),this.Sa=t,e}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){return!e.fromCache||!this.ma()||(!this.options.Fa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Da(e){var t;return 0<e.docChanges.length||(t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites,!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges)}Ca(e){e=SE.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Cm.Cache}}class OE{constructor(e,t){this.Ma=e,this.byteLength=t}xa(){return"metadata"in this.Ma}}class ME{constructor(e){this.serializer=e}Bs(e){return Hb(this.serializer,e)}Ls(e){return e.metadata.exists?Xb(this.serializer,e.document,!1):By.newNoDocument(this.Bs(e.metadata.name),this.ks(e.metadata.readTime))}ks(e){return jb(e)}}class LE{constructor(e,t,r){this.Oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=FE(e)}Na(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;var r;return e.Ma.namedQuery?this.queries.push(e.Ma.namedQuery):e.Ma.documentMetadata?(this.documents.push({metadata:e.Ma.documentMetadata}),e.Ma.documentMetadata.exists||++t,r=D.fromString(e.Ma.documentMetadata.name),this.collectionGroups.add(r.get(r.length-2))):e.Ma.document&&(this.documents[this.documents.length-1].document=e.Ma.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ba(e){let r=new Map,n=new ME(this.serializer);for(var i of e)if(i.metadata.queries){let e=n.Bs(i.metadata.name);for(let t of i.metadata.queries){var s=(r.get(t)||V()).add(e);r.set(t,s)}}return r}async complete(){let e=await(async(r,n,e,t)=>{let i=r,s=V(),a=Dw;for(let r of e){let e=n.Bs(r.metadata.name),t=(r.document&&(s=s.add(e)),n.Ls(r));t.setReadTime(n.ks(r.metadata.readTime)),a=a.insert(e,t)}let o=i.Cs.newChangeBuffer({trackRemovals:!0}),l=await g0(i,(r=t,Iw(_w(D.fromString("__bundle__/docs/"+r)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>f0(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.ai.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.ai.addMatchingKeys(t,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.xs,e.Os)).next(()=>e.xs)))})(this.localStore,new ME(this.serializer),this.documents,this.Oa.id),t=this.Ba(this.documents);for(let e of this.queries)await(async(e,r,n=V())=>{let i=await g0(e,Iw(wI(r.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=jb(r.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.ci.saveNamedQuery(e,r):(t=i.withResumeToken(ty.EMPTY_BYTE_STRING,t),s.Ss=s.Ss.insert(t.targetId,t),s.ai.updateTargetData(e,t).next(()=>s.ai.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.ai.addMatchingKeys(e,n,i.targetId)).next(()=>s.ci.saveNamedQuery(e,r)))})})(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,La:this.collectionGroups,ka:e}}}function FE(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class UE{constructor(e){this.key=e}}class VE{constructor(e){this.key=e}}class qE{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=V(),this.mutatedKeys=V(),this.Ua=Rw(e),this.Ka=new EE(this.Ua)}get Wa(){return this.qa}Ga(e,t){let o=t?t.za:new CE,l=(t||this).Ka,h=(t||this).mutatedKeys,u=l,c=!1,d="F"===this.query.limitType&&l.size===this.query.limit?l.last():null,p="L"===this.query.limitType&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((e,t)=>{var r=l.get(e),n=Aw(this.query,t)?t:null,i=!!r&&this.mutatedKeys.has(r.key),s=!!n&&(n.hasLocalMutations||this.mutatedKeys.has(n.key)&&n.hasCommittedMutations);let a=!1;r&&n?r.data.isEqual(n.data)?i!==s&&(o.track({type:3,doc:n}),a=!0):!this.ja(r,n)&&(o.track({type:2,doc:n}),a=!0,d&&0<this.Ua(n,d)||p&&this.Ua(n,p)<0)&&(c=!0):!r&&n?(o.track({type:0,doc:n}),a=!0):r&&!n&&(o.track({type:1,doc:r}),a=!0,d||p)&&(c=!0),a&&(h=n?(u=u.add(n),s?h.add(e):h.delete(e)):(u=u.delete(e),h.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){let e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),h=h.delete(e.key),o.track({type:1,doc:e})}return{Ka:u,za:o,ys:c,mutatedKeys:h}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){var i=this.Ka,s=(this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys,e.za.da()),a=(s.sort((e,t)=>{return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S(20277,{Vt:e})}})(r)-i(n)||this.Ua(e.doc,t.doc);var r,n,i}),this.Ha(r),n=null!=n&&n,t&&!n?this.Ja():[]),o=0===this.$a.size&&this.current&&!n?1:0,l=o!==this.Qa;return this.Qa=o,0!==s.length||l?{snapshot:new SE(this.query,e.Ka,i,s,e.mutatedKeys,0==o,l,!1,!!r&&0<r.resumeToken.approximateByteSize()),Ya:a}:{Ya:a}}ga(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new CE,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(e=>this.qa=this.qa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qa=this.qa.delete(e)),this.current=e.current)}Ja(){if(!this.current)return[];let t=this.$a,r=(this.$a=V(),this.Ka.forEach(e=>{this.Za(e.key)&&(this.$a=this.$a.add(e.key))}),[]);return t.forEach(e=>{this.$a.has(e)||r.push(new VE(e))}),this.$a.forEach(e=>{t.has(e)||r.push(new UE(e))}),r}Xa(e){this.qa=e.Ns,this.$a=V();var t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return SE.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,0===this.Qa,this.hasCachedResults)}}let jE="SyncEngine";class BE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class zE{constructor(e){this.key=e,this.tu=!1}}class KE{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.nu={},this.ru=new Pw(e=>Sw(e),Cw),this.iu=new Map,this.su=new Set,this.ou=new M(x.comparator),this._u=new Map,this.au=new VT,this.uu={},this.cu=new Map,this.lu=dT.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return!0===this.hu}}async function WE(e,t,r,n){var i=await g0(e.localStore,Iw(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,r);let o;return n&&(o=await HE(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&r&&sE(e.remoteStore,i),o}async function HE(n,e,t,r,i){n.Pu=(e,t,r)=>(async(e,t,r,n)=>{let i=t.view.Ga(r);i.ys&&(i=await v0(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ga(e,i)));var s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),s=t.view.applyChanges(i,e.isPrimaryClient,s,a);return rC(e,t.targetId,s.Ya),s.snapshot})(n,e,t,r);var s=await v0(n.localStore,e,!0),a=new qE(e,s.Ns),s=a.Ga(s.documents),o=Sb.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),s=a.applyChanges(s,n.isPrimaryClient,o),o=(rC(n,t,s.Ya),new BE(e,t,a));return n.ru.set(e,o),n.iu.has(t)?n.iu.get(t).push(e):n.iu.set(t,[e]),s.snapshot}async function GE(t,e,r){var n=hC(t);try{let t=await((e,i)=>{let s=e,a=Zm.now(),o=i.reduce((e,t)=>e.add(t.key),V()),l,h;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=Dw,r=V();return s.Cs.getEntries(n,o).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{l=e;var t=[];for(let r of i){let e=((e,r)=>{let n=null;for(var i of e.fieldTransforms){let e=r.data.field(i.field),t=Kw(i.transform,e||null);null!=t&&(n=null===n?jy.empty():n).set(i.field,t)}return n||null})(r,l.get(r.key).overlayedDocument);null!=e&&t.push(new lb(r.key,e,function i(e){let s=[];return G_(e.fields,(e,r)=>{var n=new nv([e]);if(Oy(r)){let t=i(r.mapValue).fields;if(0===t.length)s.push(n);else for(let e of t)s.push(n.child(e))}else s.push(n)}),new Z_(s)}(e.value.mapValue),tb.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(h=e).applyToLocalDocumentSet(l,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:h.batchId,changes:Mw(l)}))})(n.localStore,e);n.sharedClientState.addPendingMutation(t.batchId);{var i=n;var s=t.batchId;var a=r;let e=i.uu[i.currentUser.toKey()];e=(e=e||new M(R)).insert(s,a),i.uu[i.currentUser.toKey()]=e}await iC(n,t.changes),await gE(n.remoteStore)}catch(t){let e=TE(t,"Failed to persist write");r.reject(e)}}async function $E(e,t){let n=e;try{let e=await p0(n.localStore,t);t.targetChanges.forEach((e,t)=>{var r=n._u.get(t);r&&(k(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),0<e.addedDocuments.size?r.tu=!0:0<e.modifiedDocuments.size?k(r.tu,14607):0<e.removedDocuments.size&&(k(r.tu,42227),r.tu=!1))}),await iC(n,e,t)}catch(e){await mv(e)}}function QE(e,i,t){var s=e;if(s.isPrimaryClient&&0===t||!s.isPrimaryClient&&1===t){let n=[];s.ru.forEach((e,t)=>{var r=t.view.ga(i);r.snapshot&&n.push(r.snapshot)});{t=s.eventManager;var a=i;var o=t;o.onlineState=a;let r=!1;o.queries.forEach((e,t)=>{for(let e of t.Ra)e.ga(a)&&(r=!0)}),r&&DE(o)}n.length&&s.nu.Q_(n),s.onlineState=i,s.isPrimaryClient&&s.sharedClientState.setOnlineState(i)}}async function YE(e,t,r){var n=e;try{let e=await((e,n)=>{let i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return i.mutationQueue.lookupMutationBatch(t,n).next(e=>(k(null!==e,37113),r=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,r,n)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>i.localDocuments.getDocuments(t,r))})})(n.localStore,t);ZE(n,t,r),XE(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await iC(n,e)}catch(r){await mv(r)}}async function JE(t,r){let n=t;cE(n.remoteStore)||C(jE,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await(e=>{let t=e;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))})(n.localStore);var i;e===Dv?r.resolve():((i=n.cu.get(e)||[]).push(r),n.cu.set(e,i))}catch(t){let e=TE(t,"Initialization of waitForPendingWrites() operation failed");r.reject(e)}}function XE(e,t){(e.cu.get(t)||[]).forEach(e=>{e.resolve()}),e.cu.delete(t)}function ZE(e,t,r){var n=e;let i=n.uu[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.uu[n.currentUser.toKey()]=i}}function eC(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(var n of t.iu.get(e))t.ru.delete(n),r&&t.nu.Tu(n,r);t.iu.delete(e),t.isPrimaryClient&&t.au.Ur(e).forEach(e=>{t.au.containsKey(e)||tC(t,e)})}function tC(e,t){e.su.delete(t.path.canonicalString());var r=e.ou.get(t);null!==r&&(aE(e.remoteStore,r),e.ou=e.ou.remove(t),e._u.delete(r),nC(e))}function rC(e,t,r){for(var n of r)n instanceof UE?(e.au.addReference(n.key,t),i=e,s=n,o=a=void 0,a=s.key,o=a.path.canonicalString(),i.ou.get(a)||i.su.has(o)||(C(jE,"New document in limbo: "+a),i.su.add(o),nC(i))):n instanceof VE?(C(jE,"Document no longer in limbo: "+n.key),e.au.removeReference(n.key,t),e.au.containsKey(n.key)||tC(e,n.key)):S(19791,{Iu:n});var i,s,a,o}function nC(e){for(;0<e.su.size&&e.ou.size<e.maxConcurrentLimboResolutions;){var t=e.su.values().next().value,t=(e.su.delete(t),new x(D.fromString(t))),r=e.lu.next();e._u.set(r,new zE(t)),e.ou=e.ou.insert(t,r),sE(e.remoteStore,new cI(Iw(_w(t.path)),r,"TargetPurposeLimboResolution",Pv.le))}}async function iC(e,t,i){let s=e,a=[],o=[],r=[];if(!s.ru.isEmpty()){s.ru.forEach((e,n)=>{r.push(s.Pu(n,t,i).then(t=>{var r;if((t||i)&&s.isPrimaryClient){let e=t?!t.fromCache:null==(r=null==i?void 0:i.targetChanges.get(n.targetId))?void 0:r.current;s.sharedClientState.updateQueryState(n.targetId,e?"current":"not-current")}if(t){a.push(t);let e=n0.Ps(n.targetId,t);o.push(e)}}))}),await Promise.all(r),s.nu.Q_(a);{var n=s.localStore,l=o;let i=n;try{await i.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>O.forEach(l,t=>O.forEach(t.ls,e=>i.persistence.referenceDelegate.addReference(r,t.targetId,e)).next(()=>O.forEach(t.hs,e=>i.persistence.referenceDelegate.removeReference(r,t.targetId,e)))))}catch(n){if(!Tv(n))throw n;C(a0,"Failed to update sequence numbers: "+n)}for(let e of l){let n=e.targetId;if(!e.fromCache){let e=i.Ss.get(n),t=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(t);i.Ss=i.Ss.insert(n,r)}}}}}async function sC(e,t,r,n){var i=e,s=await((e,r)=>{let n=e,i=n.mutationQueue;return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Hn(t,r).next(e=>e?n.localDocuments.getDocuments(t,e):O.resolve(null)))})(i.localStore,t);null!==s?("pending"===r?await gE(i.remoteStore):"acknowledged"===r||"rejected"===r?(ZE(i,t,n||null),XE(i,t),i.localStore.mutationQueue.Xn(t)):S(6720,"Unknown batchState",{Eu:r}),await iC(i,s)):C(jE,"Cannot apply mutation batch with id: "+t)}async function aC(r,e){var n,i,s,a=r,o=[],l=[];for(let r of e){let t,e=a.iu.get(r);if(e&&0!==e.length){t=await g0(a.localStore,Iw(e[0]));for(let r of e){let e=a.ru.get(r),t=(n=e,s=i=void 0,s=await v0((i=a).localStore,n.query,!0),s=n.view.Xa(s),i.isPrimaryClient&&rC(i,n.targetId,s.Ya),await s);t.snapshot&&l.push(t.snapshot)}}else{let e=await _0(a.localStore,r);t=await g0(a.localStore,e),await HE(a,oC(e),r,!1,t.resumeToken)}o.push(t)}return a.nu.Q_(l),o}function oC(e){return vw(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function lC(e){var t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=$E.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){let n=e,r=n._u.get(t);if(r&&r.tu)return V().add(r.key);{let r=V(),e=n.iu.get(t);if(e)for(let t of e){let e=n.ru.get(t);r=r.unionWith(e.view.Wa)}return r}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,n,t){let i=e,r=(i.sharedClientState.updateQueryState(n,"rejected",t),i._u.get(n)),s=r&&r.key;if(s){let e=new M(x.comparator),t=(e=e.insert(s,By.newNoDocument(s,P.min())),V().add(s)),r=new Cb(P.min(),new Map,new M(R),e,t);await $E(i,r),i.ou=i.ou.remove(s),i._u.delete(n),nC(i)}else await m0(i.localStore,n,!1).then(()=>eC(i,n,t)).catch(mv)}).bind(null,t),t.nu.Q_=(function(r,e){var n=r;let i=!1;for(let r of e){let e=r.query,t=n.queries.get(e);if(t){for(let e of t.Ra)e.pa(r)&&(i=!0);t.Aa=r}}i&&DE(n)}).bind(null,t.eventManager),t.nu.Tu=(function(e,t,r){var n=e,i=n.queries.get(t);if(i)for(let e of i.Ra)e.onError(r);n.queries.delete(t)}).bind(null,t.eventManager),t}function hC(e){var t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=(async function(e,t){var r=e,n=t.batch.batchId;try{let e=await c0(r.localStore,t);ZE(r,n,null),XE(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await iC(r,e)}catch(e){await mv(e)}}).bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=YE.bind(null,t),t}function uC(e,t,r){let n=e;(async(e,r,n)=>{try{var i=await r.getMetadata();if(await((e,t)=>{let r=e,n=jb(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.ci.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(n))})(e.localStore,i))return await r.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(FE(i));var s=new LE(i,e.localStore,r.serializer);let t=await r.du();for(;t;){let e=await s.Na(t);e&&n._updateProgress(e),t=await r.du()}var a=await s.complete();return await iC(e,a.ka,void 0),await((e,t)=>{let r=e;return r.persistence.runTransaction("Save bundle","readwrite",e=>r.ci.saveBundleMetadata(e,t))})(e.localStore,i),n._completeWith(a.progress),Promise.resolve(a.La)}catch(e){return Om(jE,"Loading bundle failed with "+e),n._failWith(e),Promise.resolve(new Set)}})(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}class cC{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=G0(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,t){return null}fu(e,t){return null}Vu(e){return h0(this.persistence,new s0,e.initialUser,this.serializer)}Ru(e){return new WT(GT.Ei,this.serializer)}Au(e){return new O0}async terminate(){var e;null!=(e=this.gcScheduler)&&e.stop(),null!=(e=this.indexBackfillerScheduler)&&e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cC.provider={build:()=>new cC};class dC extends cC{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){k(this.persistence.referenceDelegate instanceof $T,46915);var r=this.persistence.referenceDelegate.garbageCollector;return new wT(r,e.asyncQueue,t)}Ru(e){let t=void 0!==this.cacheSizeBytes?iT.withCacheSize(this.cacheSizeBytes):iT.DEFAULT;return new WT(e=>$T.Ei(e,t),this.serializer)}}class pC extends cC{constructor(e,t,r){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.gu.initialize(this,e),await hC(this.gu.syncEngine),await gE(this.gu.remoteStore),await this.persistence.Ki(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Vu(e){return h0(this.persistence,new s0,e.initialUser,this.serializer)}mu(e,t){var r=this.persistence.referenceDelegate.garbageCollector;return new wT(r,e.asyncQueue,t)}fu(e,t){var r=new Rv(t,this.persistence);return new Nv(e.asyncQueue,r)}Ru(e){var t=r0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?iT.withCacheSize(this.cacheSizeBytes):iT.DEFAULT;return new ZT(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,W0(),H0(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new O0}}class fC extends pC{constructor(e,t){super(e,t,!1),this.gu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.gu.syncEngine;this.sharedClientState instanceof x0&&(this.sharedClientState.syncEngine={yo:sC.bind(null,t),wo:(async function(e,r,n,t){var i=e;if(i.hu)C(jE,"Ignoring unexpected query state notification.");else{var s=i.iu.get(r);if(s&&0<s.length)switch(n){case"current":case"not-current":{let e=await y0(i.localStore,Nw(s[0])),t=Cb.createSynthesizedRemoteEventForCurrentChange(r,"current"===n,ty.EMPTY_BYTE_STRING);await iC(i,e,t);break}case"rejected":await m0(i.localStore,r,!0),eC(i,r,t);break;default:S(64155,n)}}}).bind(null,t),bo:(async function(e,t,n){let i=lC(e);if(i.hu){for(let r of t)if(i.iu.has(r)&&i.sharedClientState.isActiveQueryTarget(r))C(jE,"Adding an already active target "+r);else{let e=await _0(i.localStore,r),t=await g0(i.localStore,e);await HE(i,oC(e),t.targetId,!1,t.resumeToken),sE(i.remoteStore,t)}for(let r of n)i.iu.has(r)&&await m0(i.localStore,r,!1).then(()=>{aE(i.remoteStore,r),eC(i,r)}).catch(mv)}}).bind(null,t),us:(function(e){return e.localStore.persistence.us()}).bind(null,t),po:(async function(e,t){let r=e;return y0(r.localStore,t).then(e=>iC(r,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ki(async e=>{{var t=this.gu.syncEngine,s=e;let i=t;if(lC(i),hC(i),!0===s&&!0!==i.hu){let e=i.sharedClientState.getAllActiveQueryTargets(),t=await aC(i,e.toArray());i.hu=!0,await yE(i.remoteStore,!0);for(let e of t)sE(i.remoteStore,e)}else if(!1===s&&!1!==i.hu){let r=[],n=Promise.resolve();i.iu.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(eC(i,t),m0(i.localStore,t,!0))),aE(i.remoteStore,t)}),await n,await aC(i,r);{s=i;let r=s;r._u.forEach((e,t)=>{aE(r.remoteStore,t)}),r.au.Kr(),r._u=new Map,r.ou=new M(x.comparator)}i.hu=!1,await yE(i.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Au(e){var t,r=W0();if(x0.C(r))return t=r0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),new x0(r,e.asyncQueue,t,e.clientId,e.initialUser);throw new N(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}}class gC{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>QE(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){var r,n,i=e;if(!i.currentUser.isEqual(t)){C(jE,"User change. New user:",t.toKey());let e=await u0(i.localStore,t);i.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",(r=i).cu.forEach(e=>{e.forEach(e=>{e.reject(new N(A.CANCELLED,n))})}),r.cu.clear(),i.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await iC(i,e.Ms)}}).bind(null,this.syncEngine),await yE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new AE}createDatastore(e){var t,r,n,i=G0(e.databaseInfo.databaseId),s=(t=e.databaseInfo,new K0(t));return t=e.authCredentials,e=e.appCheckCredentials,r=s,n=i,new Z0(t,e,r,n)}createRemoteStore(e){return t=this.localStore,r=this.datastore,e=e.asyncQueue,n=e=>QE(this.syncEngine,e,0),i=new(F0.C()?F0:M0),new rE(t,r,e,n,i);var t,r,n,i}createSyncEngine(e,t){return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,e=e.maxConcurrentLimboResolutions,t=t,o=new KE(r,n,i,s,a,e),t&&(o.hu=!0),o;var r,n,i,s,a,o}async terminate(){var e,t;e=this.remoteStore,t=e,C(tE,"RemoteStore shutting down."),t.aa.add(5),await iE(t),t.ca.shutdown(),await!t.la.set("Unknown"),null!=(t=this.datastore)&&t.terminate(),null!=(t=this.eventManager)&&t.terminate()}}function mC(t,r=10240){let n=0;return{async read(){var e;return n<t.byteLength?(e={value:t.slice(n,n+r),done:!1},n+=r,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}gC.provider={build:()=>new gC};class vC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):xm("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class _C{constructor(e,t){this.wu=e,this.serializer=t,this.metadata=new Fm,this.buffer=new Uint8Array,this.bu=new TextDecoder("utf-8"),this.Su().then(e=>{e&&e.xa()?this.metadata.resolve(e.Ma.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(null==e?void 0:e.Ma)))},e=>this.metadata.reject(e))}close(){return this.wu.cancel()}async getMetadata(){return this.metadata.promise}async du(){return await this.getMetadata(),this.Su()}async Su(){var e,t,r=await this.Du();return null===r?null:(t=this.bu.decode(r),e=Number(t),isNaN(e)&&this.vu(`length string (${t}) is not valid number`),t=await this.Cu(e),new OE(JSON.parse(t),r.length+e))}Fu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Du(){for(;this.Fu()<0&&!await this.Mu(););var e,t;return 0===this.buffer.length?null:((e=this.Fu())<0&&this.vu("Reached the end of bundle when a length string is expected."),t=this.buffer.slice(0,e),this.buffer=this.buffer.slice(e),t)}async Cu(e){for(;this.buffer.length<e;)await this.Mu()&&this.vu("Reached the end of bundle when more is expected.");var t=this.bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}vu(e){throw this.wu.cancel(),new Error("Invalid bundle format: "+e)}async Mu(){var e,t=await this.wu.read();return t.done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),t.done}}class yC{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw this.lastTransactionError=new N(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;var t=await(async(e,t)=>{let l=e,r={documents:t.map(e=>Wb(l.serializer,e))},n=await l.Wo("BatchGetDocuments",l.serializer.databaseId,D.emptyPath(),r,t.length),h=new Map,i=(n.forEach(e=>{t=l.serializer;var t,r,n,i,s,a,o="found"in(e=e)?(r=t,k(!!(n=e).found,43571),n.found.name,n.found.updateTime,i=Hb(r,n.found.name),s=jb(n.found.updateTime),o=n.found.createTime?jb(n.found.createTime):P.min(),a=new jy({mapValue:{fields:n.found.fields}}),By.newFoundDocument(i,s,o,a)):"missing"in e?(r=t,k(!!(n=e).missing,3894),k(!!n.readTime,22933),i=Hb(r,n.missing),s=jb(n.readTime),By.newNoDocument(i,s)):S(7234,{result:e});h.set(o.key.toString(),o)}),[]);return t.forEach(e=>{var t=h.get(e.toString());k(!!t,55234,{key:e}),i.push(t)}),i})(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new db(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var r=x.fromPath(t);this.mutations.push(new pb(r,this.precondition(r)))});{var r=this.datastore,n=this.mutations;let t=r,e={writes:n.map(e=>Zb(t.serializer,e))};await t.Qo("Commit",t.serializer.databaseId,D.emptyPath(),e)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S(50498,{xu:e.constructor.name});t=P.min()}var r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(P.min())?tb.exists(!1):tb.updateTime(t):tb.none()}preconditionForUpdate(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return tb.exists(!0);if(t.isEqual(P.min()))throw new N(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return tb.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class wC{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.Ou=r.maxAttempts,this.y_=new $0(this.asyncQueue,"transaction_retry")}Nu(){--this.Ou,this.Bu()}Bu(){this.y_.E_(async()=>{let t=new yC(this.datastore),e=this.Lu(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ku(e)}))}).catch(e=>{this.ku(e)})})}Lu(e){try{var t=this.updateFunction(e);return!xv(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ku(e){0<this.Ou&&this.qu(e)?(--this.Ou,this.asyncQueue.enqueueAndForget(()=>(this.Bu(),Promise.resolve()))):this.deferred.reject(e)}qu(e){var t;return"FirebaseError"===e.name&&("aborted"===(t=e.code)||"failed-precondition"===t||"already-exists"===t||!_b(t))}}let bC="FirestoreClient";class IC{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=Nm.UNAUTHENTICATED,this.clientId=Gm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{C(bC,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(C(bC,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let r=new Fm;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),r.resolve()}catch(e){var t=TE(e,"Failed to shutdown persistence");r.reject(t)}}),r.promise}}async function TC(e,t){e.asyncQueue.verifyOperationInProgress(),C(bC,"Initializing OfflineComponentProvider");var r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await u0(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function EC(e,r){e.asyncQueue.verifyOperationInProgress();var t=await CC(e);C(bC,"Initializing OnlineComponentProvider"),await r.initialize(t,e.configuration),e.setCredentialChangeListener(e=>_E(r.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>_E(r.remoteStore,t)),e._onlineComponents=r}async function CC(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){C(bC,"Using user provided OfflineComponentProvider");try{await TC(t,t._uninitializedComponentsProvider._offline)}catch(e){var r=e;if(!("FirebaseError"===(n=r).name?n.code===A.FAILED_PRECONDITION||n.code===A.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;Om("Error using user provided cache. Falling back to memory cache: "+r),await TC(t,new cC)}}else C(bC,"Using default OfflineComponentProvider"),await TC(t,new dC(void 0));var n;return t._offlineComponents}async function SC(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(C(bC,"Using user provided OnlineComponentProvider"),await EC(e,e._uninitializedComponentsProvider._online)):(C(bC,"Using default OnlineComponentProvider"),await EC(e,new gC))),e._onlineComponents}function kC(e){return CC(e).then(e=>e.persistence)}function AC(e){return CC(e).then(e=>e.localStore)}function NC(e){return SC(e).then(e=>e.remoteStore)}function RC(e){return SC(e).then(e=>e.syncEngine)}async function PC(e){var t=await SC(e),r=t.eventManager;return r.onListen=(async function(e,t,r=!0){var n=lC(e);let i;var s=n.ru.get(t);return i=s?(n.sharedClientState.addLocalQueryTarget(s.targetId),s.view.eu()):await WE(n,t,r,!0)}).bind(null,t.syncEngine),r.onUnlisten=(async function(e,t,r){let n=e,i=n.ru.get(t),s=n.iu.get(i.targetId);1<s.length?(n.iu.set(i.targetId,s.filter(e=>!Cw(e,t))),n.ru.delete(t)):n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await m0(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&aE(n.remoteStore,i.targetId),eC(n,i.targetId)}).catch(mv)):(eC(n,i.targetId),await m0(n.localStore,i.targetId,!0))}).bind(null,t.syncEngine),r.onFirstRemoteStoreListen=(async function(e,t){await WE(lC(e),t,!0,!1)}).bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=(async function(e,t){var r=e,n=r.ru.get(t),i=r.iu.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),aE(r.remoteStore,n.targetId))}).bind(null,t.syncEngine),r}function DC(r){return r.asyncQueue.enqueue(async()=>{var e=await kC(r),t=await NC(r);return e.setNetworkEnabled(!1),(async e=>{var t=e;t.aa.add(0),await iE(t),t.la.set("Offline")})(t)})}function xC(e,t){let r=new Fm;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await((e,t)=>{let r=e;return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))})(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new N(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){n=TE(e,`Failed to get document '${t} from cache`);r.reject(n)}})(await AC(e),t,r)),r.promise}function OC(e,t,h={}){let u=new Fm;return e.asyncQueue.enqueueAndForget(async()=>{{var i=await PC(e),s=e.asyncQueue,a=t,o=h,l=u;let r=new vC({next:e=>{r.yu(),s.enqueueAndForget(()=>PE(i,n));var t=e.docs.has(a);!t&&e.fromCache?l.reject(new N(A.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?l.reject(new N(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(e)},error:e=>l.reject(e)}),n=new xE(_w(a.path),r,{includeMetadataChanges:!0,Fa:!0});return RE(i,n)}}),u.promise}function MC(e,t){let r=new Fm;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await v0(e,t,!0),i=new qE(t,n.Ns),s=i.Ga(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(e){n=TE(e,`Failed to execute query '${t} against cache`);r.reject(n)}})(await AC(e),t,r)),r.promise}function LC(o,l,h={}){let u=new Fm;return o.asyncQueue.enqueueAndForget(async()=>{{var n=await PC(o),i=o.asyncQueue,e=l,s=h,a=u;let t=new vC({next:e=>{t.yu(),i.enqueueAndForget(()=>PE(n,r)),e.fromCache&&"server"===s.source?a.reject(new N(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(e)},error:e=>a.reject(e)}),r=new xE(e,t,{includeMetadataChanges:!0,Fa:!0});return RE(n,r)}}),u.promise}function FC(r,e){let n=new vC(e);return r.asyncQueue.enqueueAndForget(async()=>{return e=await PC(r),t=n,e.fa.add(t),void t.next();var e,t}),()=>{n.yu(),r.asyncQueue.enqueueAndForget(async()=>{var e,t;e=await PC(r),t=n,e.fa.delete(t)})}}function UC(e,t,r,n){r=r,t=G0(t),s="string"==typeof r?Hm().encode(r):r,r=((e,t)=>{if(e instanceof Uint8Array)return mC(e,t);if(e instanceof ArrayBuffer)return mC(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(s),t=t;let i=new _C(r,t);var s;e.asyncQueue.enqueueAndForget(async()=>{uC(await RC(e),i,n)})}function VC(n,i){return n.asyncQueue.enqueue(async()=>{{var e=await AC(n),r=i;let t=e;return t.persistence.runTransaction("Get named query","readonly",e=>t.ci.getNamedQuery(e,r))}})}function qC(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let jC=new Map;function BC(e,t,r){if(!r)throw new N(A.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function zC(e,t,r,n){if(!0===t&&!0===n)throw new N(A.INVALID_ARGUMENT,e+` and ${r} cannot be used together.`)}function KC(e){if(!x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function WC(e){if(x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function HC(e){var t,r;return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"==typeof e?e instanceof Array?"an array":(t=(r=e).constructor?r.constructor.name:null)?`a custom ${t} object`:"an object":"function"==typeof e?"a function":S(12329,{type:typeof e})}function q(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new N(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var r=HC(e);throw new N(A.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+r)}function GC(e,t){if(t<=0)throw new N(A.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let $C="firestore.googleapis.com";class QC{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new N(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$C,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new N(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qC(null!=(t=e.experimentalLongPollingOptions)?t:{});var r=this.experimentalLongPollingOptions;if(void 0!==r.timeoutSeconds){if(isNaN(r.timeoutSeconds))throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(30<r.timeoutSeconds)throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,r}}class YC{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new QC({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(this._app)return this._app;throw new N(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new QC(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=(e=>{if(!e)return new Vm;switch(e.type){case"firstParty":return new zm(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new N(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,se("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return e=this,(t=jC.get(e))&&(C("ComponentProvider","Removing Datastore"),jC.delete(e),t.terminate()),Promise.resolve();var e,t}}class JC{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new JC(this.firestore,e,this._query)}}class XC{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ZC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new XC(this.firestore,e,this._key)}}class ZC extends JC{constructor(e,t,r){super(e,t,_w(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){var e=this._path.popLast();return e.isEmpty()?null:new XC(this.firestore,null,new x(e))}withConverter(e){return new ZC(this.firestore,e,this._path)}}function eS(e,t,...r){var n;if(e=w(e),BC("collection","path",t),e instanceof YC)return WC(n=D.fromString(t,...r)),new ZC(e,null,n);if(e instanceof XC||e instanceof ZC)return WC(n=e._path.child(D.fromString(t,...r))),new ZC(e.firestore,null,n);throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function tS(e,t,...r){var n;if(e=w(e),BC("doc","path",t=1===arguments.length?Gm.newId():t),e instanceof YC)return KC(n=D.fromString(t,...r)),new XC(e,null,new x(n));if(e instanceof XC||e instanceof ZC)return KC(n=e._path.child(D.fromString(t,...r))),new XC(e.firestore,e instanceof ZC?e.converter:null,new x(n));throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function rS(e,t){return e=w(e),t=w(t),(e instanceof XC||e instanceof ZC)&&(t instanceof XC||t instanceof ZC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function nS(e,t){return e=w(e),t=w(t),e instanceof JC&&t instanceof JC&&e.firestore===t.firestore&&Cw(e._query,t._query)&&e.converter===t.converter}let iS="AsyncQueue";class sS{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new $0(this,"async_queue_retry"),this.ju=()=>{var e=H0();e&&C(iS,"Visibility state changed to "+e.visibilityState),this.y_.A_()},this.Hu=e;var t=H0();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){var t;this.$u||(this.$u=!0,this.Gu=e||!1,(t=H0())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ju))}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new Fm;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(0!==this.Qu.length){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!Tv(e))throw e;C(iS,"Operation failed with retryable error: "+e)}0<this.Qu.length&&this.y_.E_(()=>this.Zu())}}Yu(e){var t=this.Hu.then(()=>(this.Wu=!0,e().catch(e=>{throw this.Ku=e,this.Wu=!1,xm("INTERNAL UNHANDLED ERROR: ",aS(e)),e}).then(e=>(this.Wu=!1,e))));return this.Hu=t}enqueueAfterDelay(e,t,r){this.Ju(),-1<this.zu.indexOf(e)&&(t=0);var n=IE.createAndSchedule(this,e,t,r,e=>this.Xu(e));return this.Uu.push(n),n}Ju(){this.Ku&&S(47125,{ec:aS(this.Ku)})}verifyOperationInProgress(){}async tc(){for(var e;await(e=this.Hu),e!==this.Hu;);}nc(e){for(var t of this.Uu)if(t.timerId===e)return!0;return!1}rc(t){return this.tc().then(()=>{this.Uu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(var e of this.Uu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){var t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function aS(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}function oS(t){var r=t,t=["next","error","complete"];if("object"==typeof r&&null!==r){var n=r;for(let e of t)if(e in n&&"function"==typeof n[e])return 1}}class lS{constructor(){this._progressObserver={},this._taskCompletionResolver=new Fm,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var hS,uS;class cS extends YC{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new sS,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){var e;this._firestoreClient&&(e=this._firestoreClient.terminate(),this._queue=new sS(e),this._firestoreClient=void 0,await e)}}function dS(e){if(e._terminated)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||pS(e),e._firestoreClient}function pS(e){var t,r,n,i,s,a=e._freezeSettings(),o=(i=e._databaseId,t=(null==(o=e._app)?void 0:o.options.appId)||"",r=e._persistenceKey,n=a,new py(i,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,qC(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator));e._componentsProvider||null!=(s=a.localCache)&&s._offlineComponentProvider&&null!=(s=a.localCache)&&s._onlineComponentProvider&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new IC(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(i=e._componentsProvider,s=null==i?void 0:i._online.build(),{_offline:null==i?void 0:i._offline.build(s),_online:s}))}function fS(e,t,r){if((e=q(e,cS))._firestoreClient||e._terminated)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new N(A.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},pS(e)}function gS(r){if(r._initialized&&!r._terminated)throw new N(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let n=new Fm;return r._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{e=r0(r._databaseId,r._persistenceKey),await(yv.C()?(t=e+"main",void await yv.delete(t)):Promise.resolve()),n.resolve()}catch(e){n.reject(e)}var e,t}),n.promise}function mS(e){return(r=dS(e=q(e,cS))).asyncQueue.enqueue(async()=>{var e=await kC(r),t=await NC(r);return e.setNetworkEnabled(!0),(e=t).aa.delete(0),nE(e)});var r}class vS{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vS(ty.fromBase64String(e))}catch(e){throw new N(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vS(ty.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class _S{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new N(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nv(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class yS{constructor(e){this._methodName=e}}class wS{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new N(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new N(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return R(this._lat,e._lat)||R(this._long,e._long)}}class bS{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){var t=this._values,r=e._values;if(t.length!==r.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==r[n])return!1;return!0}}let IS=/^__.*__$/;class TS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new lb(e,this.data,this.fieldMask,t,this.fieldTransforms):new ob(e,this.data,t,this.fieldTransforms)}}class ES{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new lb(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function CS(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw S(40011,{oc:e})}}class SS{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this._c(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new SS(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t=null==(t=this.path)?void 0:t.child(e),t=this.ac({path:t,cc:!1});return t.lc(e),t}hc(e){var t=null==(t=this.path)?void 0:t.child(e),t=this.ac({path:t,cc:!1});return t._c(),t}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return HS(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(0===e.length)throw this.Tc("Document fields must not be empty");if(CS(this.oc)&&IS.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class kS{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||G0(e)}dc(e,t,r,n=!1){return new SS({oc:e,methodName:t,Ec:r,path:nv.emptyPath(),cc:!1,Ic:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function AS(e){var t=e._freezeSettings(),r=G0(e._databaseId);return new kS(e._databaseId,!!t.ignoreUndefinedProperties,r)}function NS(e,n,i,t,r,s={}){var a=e.dc(s.merge||s.mergeFields?2:0,n,i,r),o=(BS("Data must be an object, but it was:",a,t),qS(t,a));let l,h;if(s.merge)l=new Z_(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){let t=[];for(let r of s.mergeFields){let e=zS(n,r,i);if(!a.contains(e))throw new N(A.INVALID_ARGUMENT,`Field '${e}' is specified in your field mask but missing from your input data.`);GS(t,e)||t.push(e)}l=new Z_(t),h=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,h=a.fieldTransforms;return new TS(new jy(o),l,h)}class RS extends yS{_toFieldTransform(e){if(2!==e.oc)throw 1===e.oc?e.Tc(this._methodName+"() can only appear at the top level of your update data"):e.Tc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof RS}}function PS(e,t,r){return new SS({oc:3,Ec:t.settings.Ec,methodName:e._methodName,cc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class DS extends yS{_toFieldTransform(e){return new Zw(e.path,new Ww)}isEqual(e){return e instanceof DS}}class xS extends yS{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=PS(this,e,!0),r=this.Ac.map(e=>VS(e,t)),n=new Hw(r);return new Zw(e.path,n)}isEqual(e){return e instanceof xS&&Ae(this.Ac,e.Ac)}}class OS extends yS{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=PS(this,e,!0),r=this.Ac.map(e=>VS(e,t)),n=new $w(r);return new Zw(e.path,n)}isEqual(e){return e instanceof OS&&Ae(this.Ac,e.Ac)}}class MS extends yS{constructor(e,t){super(e),this.Rc=t}_toFieldTransform(e){var t=new Yw(e.serializer,Bw(e.serializer,this.Rc));return new Zw(e.path,t)}isEqual(e){return e instanceof MS&&this.Rc===e.Rc}}function LS(e,i,s,t){let a=e.dc(1,i,s),o=(BS("Data must be an object, but it was:",a,t),[]),l=jy.empty();G_(t,(e,t)=>{var r=WS(i,e,s),n=(t=w(t),a.hc(r));if(t instanceof RS)o.push(r);else{let e=VS(t,n);null!=e&&(o.push(r),l.set(r,e))}});var r=new Z_(o);return new ES(l,r,a.fieldTransforms)}function FS(e,t,r,n,i,s){var a=e.dc(1,t,r),o=[zS(t,n,r)],l=[i];if(s.length%2!=0)throw new N(A.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(zS(t,s[p])),l.push(s[p+1]);var h=[],u=jy.empty();for(let f=o.length-1;0<=f;--f)if(!GS(h,o[f])){let t=o[f];var c=w(l[f]);let r=a.hc(t);if(c instanceof RS)h.push(t);else{let e=VS(c,r);null!=e&&(h.push(t),u.set(t,e))}}var d=new Z_(h);return new ES(u,d,a.fieldTransforms)}function US(e,t,r,n=!1){return VS(r,e.dc(n?4:3,t))}function VS(e,r){if(jS(e=w(e)))return BS("Unsupported field value:",r,e),qS(e,r);if(e instanceof yS){{var t=e;var n=r;if(!CS(n.oc))throw n.Tc(t._methodName+"() can only be used with update() and set()");if(!n.path)throw n.Tc(t._methodName+"() is not currently supported inside arrays");var i=t._toFieldTransform(n);i&&n.fieldTransforms.push(i)}return null}if(void 0===e&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),e instanceof Array){if(r.settings.cc&&4!==r.oc)throw r.Tc("Nested arrays are not supported");{var s,a=r,o=[];let t=0;for(s of e){let e=VS(s,a.Pc(t));null==e&&(e={nullValue:"NULL_VALUE"}),o.push(e),t++}return{arrayValue:{values:o}}}}var l,t=e,n=r;if(null===(t=w(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Bw(n.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date)return h=Zm.fromDate(t),{timestampValue:Vb(n.serializer,h)};if(t instanceof Zm)return h=new Zm(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Vb(n.serializer,h)};if(t instanceof wS)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof vS)return{bytesValue:qb(n.serializer,t._byteString)};if(t instanceof XC){var h=n.databaseId,i=t.firestore._databaseId;if(i.isEqual(h))return{referenceValue:Bb(t.firestore._databaseId||n.databaseId,t._key.path)};throw n.Tc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${h.projectId}/`+h.database)}if(t instanceof bS)return e=t,l=n,{mapValue:{fields:{[my]:{stringValue:yy},[wy]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw l.Tc("VectorValues must only contain numeric values.");return qw(l.serializer,e)})}}}}};throw n.Tc("Unsupported field value: "+HC(t))}function qS(e,n){let i={};return $_(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):G_(e,(e,t)=>{var r=VS(t,n.uc(e));null!=r&&(i[e]=r)}),{mapValue:{fields:i}}}function jS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Zm||e instanceof wS||e instanceof vS||e instanceof XC||e instanceof yS||e instanceof bS)}function BS(e,t,r){var n,i;if(!jS(r)||"object"!=typeof(i=r)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))throw"an object"===(n=HC(r))?t.Tc(e+" a custom object"):t.Tc(e+" "+n)}function zS(e,t,r){if((t=w(t))instanceof _S)return t._internalPath;if("string"==typeof t)return WS(e,t);throw HS("Field path arguments must be of type string or ",e,!1,void 0,r)}let KS=new RegExp("[~\\*/\\[\\]]");function WS(t,r,n){if(0<=r.search(KS))throw HS(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new _S(...r.split("."))._internalPath}catch(e){throw HS(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function HS(e,t,r,n,i){var s=n&&!n.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,l=(r&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(l+=" (found",s&&(l+=" in field "+n),a&&(l+=" in document "+i),l+=")"),new N(A.INVALID_ARGUMENT,o+e+l)}function GS(e,t){return e.some(e=>e.isEqual(t))}class $S{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new XC(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new QS(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){var t=this._document.data.field(YS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class QS extends $S{data(){return super.data()}}function YS(e,t){return"string"==typeof t?WS(e,t):(t instanceof _S?t:t._delegate)._internalPath}function JS(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new N(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class XS{}class ZS extends XS{}function ek(e,t,...r){let n=[];t instanceof XS&&n.push(t);var t=n=n.concat(r),i=t.filter(e=>!1).length,s=t.filter(e=>e instanceof tk).length;if(1<i||0<i&&0<s)throw new N(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(let t of n)e=t._apply(e);return e}class tk extends ZS{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new tk(e,t,r)}_apply(e){var t=this._parse(e);return hk(e._query,t),new JC(e.firestore,e.converter,Tw(e._query,t))}_parse(e){var t=AS(e.firestore);{var n=e._query,i="where",s=t,a=e.firestore._databaseId,o=(e=this._field,this._op),l=this._value;let r;if(e.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new N(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){lk(l,o);let e=[];for(let t of l)e.push(ok(a,n,t));r={arrayValue:{values:e}}}else r=ok(a,n,l)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||lk(l,o),r=US(s,i,l,"in"===o||"not-in"===o);return F.create(e,o,r)}}}(class extends XS{});class rk extends ZS{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new rk(e,t)}_apply(e){var t=((e,t,r)=>{if(null!==e.startAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Hy(t,r)})(e._query,this._field,this._direction);return new JC(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new mw(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class nk extends ZS{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new nk(e,t,r)}_apply(e){return new JC(e.firestore,e.converter,Ew(e._query,this._limit,this._limitType))}}class ik extends ZS{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ik(e,t,r)}_apply(e){var t,r=ak(e,this.type,this._docOrFields,this._inclusive);return new JC(e.firestore,e.converter,(e=e._query,t=r,new mw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class sk extends ZS{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new sk(e,t,r)}_apply(e){var t,r=ak(e,this.type,this._docOrFields,this._inclusive);return new JC(e.firestore,e.converter,(e=e._query,t=r,new mw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function ak(e,r,n,i){if(n[0]=w(n[0]),n[0]instanceof $S){var s=e._query,a=e.firestore._databaseId,o=r,l=n[0]._document,h=i;if(!l)throw new N(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);var u=[];for(let t of bw(s))if(t.field.isKeyField())u.push(Ny(a,l.key));else{let e=l.data.field(t.field);if(uy(e))throw new N(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+t.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=t.field.canonicalString();throw new N(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}u.push(e)}return new zy(u,h)}var t=AS(e.firestore),c=e._query,d=e.firestore._databaseId,p=t,f=r,g=n,o=i,m=c.explicitOrderBy;if(g.length>m.length)throw new N(A.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);var v=[];for(let y=0;y<g.length;y++){var _=g[y];if(m[y].field.isKeyField()){if("string"!=typeof _)throw new N(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a `+typeof _);if(!ww(c)&&-1!==_.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${_}' contains a slash.`);let e=c.path.child(D.fromString(_));if(!x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${e}' is not because it contains an odd number of segments.`);let t=new x(e);v.push(Ny(d,t))}else{let e=US(p,f,_);v.push(e)}}return new zy(v,o)}function ok(e,t,r){if("string"==typeof(r=w(r))){if(""===r)throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ww(t)&&-1!==r.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);var n=t.path.child(D.fromString(r));if(x.isDocumentKey(n))return Ny(e,new x(n));throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`)}if(r instanceof XC)return Ny(e,r._key);throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${HC(r)}.`)}function lk(e,t){if(!Array.isArray(e)||0===e.length)throw new N(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hk(e,t){var r=((t,r)=>{for(var n of t)for(let e of n.getFlattenedFilters())if(0<=r.indexOf(e.op))return e.op;return null})(e.filters,(e=>{switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(null!==r)throw r===t.op?new N(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class uk{convertValue(e,t="none"){switch(Iy(e)){case 0:return null;case 1:return e.booleanValue;case 2:return iy(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sy(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw S(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,r="none"){let n={};return G_(e,(e,t)=>{n[e]=this.convertValue(t,r)}),n}convertVectorValue(e){var t=null==(t=null==(t=null==(t=e.fields)?void 0:t[wy].arrayValue)?void 0:t.values)?void 0:t.map(e=>iy(e.doubleValue));return new bS(t)}convertGeoPoint(e){return new wS(iy(e.latitude),iy(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var r=cy(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(dy(e));default:return null}}convertTimestamp(e){var t=ny(e);return new Zm(t.seconds,t.nanos)}convertDocumentKey(e,t){var r=D.fromString(e),n=(k(uI(r),9688,{name:e}),new gy(r.get(1),r.get(3))),r=new x(r.popFirst(5));return n.isEqual(t)||xm(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function ck(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class dk extends uk{constructor(e){super(),this.firestore=e}convertBytes(e){return new vS(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new XC(this.firestore,null,t)}}class pk{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fk extends $S{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new gk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){var r=this._document.data.field(YS("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class gk extends fk{data(e={}){return super.data(e)}}class mk{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new pk(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,r){this._snapshot.docs.forEach(e=>{t.call(r,new gk(this._firestore,this._userDataWriter,e.key,e,new pk(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=((s,t)=>{if(s._snapshot.oldDocs.isEmpty()){let r=0;return s._snapshot.docChanges.map(e=>{var t=new gk(s._firestore,s._userDataWriter,e.doc.key,e.doc,new pk(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new gk(s._firestore,s._userDataWriter,e.doc.key,e.doc,new pk(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let r=-1,n=-1;return 0!==e.type&&(r=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),n=i.indexOf(e.doc.key)),{type:(e=>{switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S(61501,{type:e})}})(e.type),doc:t,oldIndex:r,newIndex:n}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function vk(e,t){return e instanceof fk&&t instanceof fk?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof mk&&t instanceof mk&&e._firestore===t._firestore&&nS(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class _k extends uk{constructor(e){super(),this.firestore=e}convertBytes(e){return new vS(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new XC(this.firestore,null,t)}}function yk(e,t,r){e=q(e,XC);var n=q(e.firestore,cS),i=ck(e.converter,t,r);return Ik(n,[NS(AS(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,tb.none())])}function wk(e,t,r,...n){e=q(e,XC);var i=q(e.firestore,cS),s=AS(i);return Ik(i,[("string"==typeof(t=w(t))||t instanceof _S?FS(s,"updateDoc",e._key,t,r,n):LS(s,"updateDoc",e._key,t)).toMutation(e._key,tb.exists(!0))])}function bk(n,...i){var t,r;n=w(n);let e={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof i[s]||oS(i[s])||(e=i[s],s++);var a={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(oS(i[s])){let e=i[s];i[s]=null==(r=e.next)?void 0:r.bind(e),i[s+1]=null==(t=e.error)?void 0:t.bind(e),i[s+2]=null==(r=e.complete)?void 0:r.bind(e)}let o,l,h;if(n instanceof XC)l=q(n.firestore,cS),h=_w(n._key.path),o={next:e=>{i[s]&&i[s](Tk(l,n,e))},error:i[s+1],complete:i[s+2]};else{let t=q(n,JC),r=(l=q(t.firestore,cS),h=t._query,new _k(l));o={next:e=>{i[s]&&i[s](new mk(l,r,t,e))},error:i[s+1],complete:i[s+2]},JS(n._query)}{var u=dS(l),c=h,d=a,p=o;let e=new vC(p),t=new xE(c,e,d);return u.asyncQueue.enqueueAndForget(async()=>RE(await PC(u),t)),()=>{e.yu(),u.asyncQueue.enqueueAndForget(async()=>PE(await PC(u),t))}}}function Ik(t,r){{var n=dS(t),i=r;let e=new Fm;return n.asyncQueue.enqueueAndForget(async()=>GE(await RC(n),i,e)),e.promise}}function Tk(e,t,r){var n=r.docs.get(t._key),i=new _k(e);return new fk(e,i,t._key,n,new pk(r.hasPendingWrites,r.fromCache),t.converter)}let Ek={maxAttempts:5};class Ck{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=AS(e)}set(e,t,r){this._verifyNotCommitted();var n=Sk(e,this._firestore),i=ck(n.converter,t,r),i=NS(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(i.toMutation(n._key,tb.none())),this}update(e,t,r,...n){this._verifyNotCommitted();var i=Sk(e,this._firestore),s="string"==typeof(t=w(t))||t instanceof _S?FS(this._dataReader,"WriteBatch.update",i._key,t,r,n):LS(this._dataReader,"WriteBatch.update",i._key,t);return this._mutations.push(s.toMutation(i._key,tb.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Sk(e,this._firestore);return this._mutations=this._mutations.concat(new db(t._key,tb.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Sk(e,t){if((e=w(e)).firestore!==t)throw new N(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class kk extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=AS(e)}get(e){let r=Sk(e,this._firestore),n=new dk(this._firestore);return this._transaction.lookup([r._key]).then(e=>{if(!e||1!==e.length)return S(24041);var t=e[0];if(t.isFoundDocument())return new $S(this._firestore,n,t.key,t,r.converter);if(t.isNoDocument())return new $S(this._firestore,n,r._key,null,r.converter);throw S(18433,{doc:t})})}set(e,t,r){var n=Sk(e,this._firestore),i=ck(n.converter,t,r),i=NS(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,i),this}update(e,t,r,...n){var i=Sk(e,this._firestore),s="string"==typeof(t=w(t))||t instanceof _S?FS(this._dataReader,"Transaction.update",i._key,t,r,n):LS(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=Sk(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Sk(e,this._firestore),r=new _k(this._firestore);return super.get(e).then(e=>new fk(this._firestore,r,t._key,e._document,new pk(!1,!1),t.converter))}}function Ak(r,n,e){r=q(r,cS);var i=Object.assign(Object.assign({},Ek),e);if(i.maxAttempts<1)throw new N(A.INVALID_ARGUMENT,"Max attempts must be at least 1");{var s=dS(r),a=e=>n(new kk(r,e)),o=i;let t=new Fm;return s.asyncQueue.enqueueAndForget(async()=>{var e=await SC(s).then(e=>e.datastore);new wC(s.asyncQueue,e,o,a,t).Nu()}),t.promise}}hS=!0,rD=Ut,Rm=rD,Pt(new u("firestore",(e,{instanceIdentifier:t,options:r})=>{var n=e.getProvider("app").getImmediate(),n=new cS(new jm(e.getProvider("auth-internal")),new Wm(n,e.getProvider("app-check-internal")),((e,t)=>{if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new gy(e.options.projectId,t);throw new N(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')})(n,t),n);return r=Object.assign({useFetchStreams:hS},r),n._setSettings(r),n},"PUBLIC").setMultipleInstances(!0)),d(Am,"4.7.14",sN),d(Am,"4.7.14","esm2017");function Nk(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new N("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Rk(){if("undefined"==typeof Uint8Array)throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function Pk(){if("undefined"==typeof atob)throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Dk{constructor(e){this._delegate=e}static fromBase64String(e){return Pk(),new Dk(vS.fromBase64String(e))}static fromUint8Array(e){return Rk(),new Dk(vS.fromUint8Array(e))}toBase64(){return Pk(),this._delegate.toBase64()}toUint8Array(){return Rk(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function xk(e){var t=["next","error","complete"];if("object"==typeof e&&null!==e){var r,n=e;for(r of t)if(r in n&&"function"==typeof n[r])return 1}}class Ok{enableIndexedDbPersistence(e,r){{e=e._delegate;var n={forceOwnership:r};Om("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();return fS(e,gC.provider,{build:e=>new pC(e,t.cacheSizeBytes,null==n?void 0:n.forceOwnership)}),Promise.resolve()}}enableMultiTabIndexedDbPersistence(e){return(async e=>{Om("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();fS(e,gC.provider,{build:e=>new fC(e,t.cacheSizeBytes)})})(e._delegate)}clearIndexedDbPersistence(e){return gS(e._delegate)}}class Mk{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof gy||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Om("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(i,s,a={}){{var[i,s,a,o={}]=[this._delegate,i,s,a];i=q(i,YC);let e=ee(s),t=i._getSettings(),r=Object.assign(Object.assign({},t),{emulatorOptions:i._getEmulatorOptions()}),n=s+":"+a;t.host!==$C&&t.host!==n&&Om("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");var l=Object.assign(Object.assign({},t),{host:n,ssl:e,emulatorOptions:o});if(!Ae(l,r)&&(i._setSettings(l),e&&(te("https://"+n),se("Firestore",!0)),o.mockUserToken)){let t,r;if("string"==typeof o.mockUserToken)t=o.mockUserToken,r=Nm.MOCK_USER;else{t=re(o.mockUserToken,null==(l=i._app)?void 0:l.options.projectId);let e=o.mockUserToken.sub||o.mockUserToken.user_id;if(!e)throw new N(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new Nm(e)}i._authCredentials=new qm(new Um(t,r))}}}enableNetwork(){return mS(this._delegate)}disableNetwork(){return DC(dS(q(this._delegate,cS)))}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,zC("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var t=this._delegate;{var r=dS(t=q(t,cS));let e=new Fm;return r.asyncQueue.enqueueAndForget(async()=>JE(await RC(r),e)),e.promise}}onSnapshotsInSync(e){return t=this._delegate,e=e,FC(dS(t=q(t,cS)),oS(e)?e:{next:e});var t}get app(){if(this._appCompat)return this._appCompat;throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new Qk(this,eS(this._delegate,e))}catch(e){throw jk(e,"collection()","Firestore.collection()")}}doc(e){try{return new qk(this,tS(this._delegate,e))}catch(e){throw jk(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Hk(this,((e,t)=>{if(e=q(e,YC),BC("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new JC(e,null,(e=t,new mw(D.emptyPath(),e)))})(this._delegate,e))}catch(e){throw jk(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Ak(this._delegate,e=>t(new Fk(this,e)))}batch(){return dS(this._delegate),new Uk(new Ck(this._delegate,e=>Ik(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,r=dS(t=q(t,cS)),n=new lS,UC(r,t._databaseId,e,n),n;var t,r,n}namedQuery(e){return t=this._delegate,e=e,VC(dS(t=q(t,cS)),e).then(e=>e?new JC(t,null,e.query):null).then(e=>e?new Hk(this,e):null);var t}}class Lk extends uk{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dk(new vS(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return qk.forKey(t,this.firestore,null)}}class Fk{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Lk(e)}get(e){let t=Yk(e);return this._delegate.get(t).then(e=>new Kk(this._firestore,new fk(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,r){var n=Yk(e);return r?(Nk("Transaction.set",r),this._delegate.set(n,t,r)):this._delegate.set(n,t),this}update(e,t,r,...n){var i=Yk(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){var t=Yk(e);return this._delegate.delete(t),this}}class Uk{constructor(e){this._delegate=e}set(e,t,r){var n=Yk(e);return r?(Nk("WriteBatch.set",r),this._delegate.set(n,t,r)):this._delegate.set(n,t),this}update(e,t,r,...n){var i=Yk(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){var t=Yk(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Vk{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){var r=new gk(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Wk(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){var r=Vk.INSTANCES;let n=r.get(e),i=(n||(n=new WeakMap,r.set(e,n)),n.get(t));return i||(i=new Vk(e,new Lk(e),t),n.set(t,i)),i}}Vk.INSTANCES=new WeakMap;class qk{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Lk(e)}static forPath(e,t,r){if(e.length%2!=0)throw new N("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new qk(t,new XC(t._delegate,r,new x(e)))}static forKey(e,t,r){return new qk(t,new XC(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Qk(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Qk(this.firestore,eS(this._delegate,e))}catch(e){throw jk(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=w(e))instanceof XC&&rS(this._delegate,e)}set(e,t){t=Nk("DocumentReference.set",t);try{return t?yk(this._delegate,e,t):yk(this._delegate,e)}catch(e){throw jk(e,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?wk(this._delegate,e):wk(this._delegate,e,t,...r)}catch(e){throw jk(e,"updateDoc()","DocumentReference.update()")}}delete(){return Ik(q((e=this._delegate).firestore,cS),[new db(e._key,tb.none())]);var e}onSnapshot(...e){var t=Bk(e),r=zk(e,e=>new Kk(this.firestore,new fk(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return bk(this._delegate,t,r)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?t=>{t=q(t,XC);let r=q(t.firestore,cS),e=dS(r),n=new _k(r);return xC(e,t._key).then(e=>new fk(r,n,t._key,e,new pk(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?t=>{t=q(t,XC);let r=q(t.firestore,cS);return OC(dS(r),t._key,{source:"server"}).then(e=>Tk(r,t,e))}:t=>{t=q(t,XC);let r=q(t.firestore,cS);return OC(dS(r),t._key).then(e=>Tk(r,t,e))})(this._delegate)).then(e=>new Kk(this.firestore,new fk(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new qk(this.firestore,e?this._delegate.withConverter(Vk.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function jk(e,t,r){return e.message=e.message.replace(t,r),e}function Bk(e){for(var t of e)if("object"==typeof t&&!xk(t))return t;return{}}function zk(e,t){let r,n,i;return i=xk(e[0])?e[0]:xk(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null==(r=i.error)?void 0:r.bind(i),complete:null==(n=i.complete)?void 0:n.bind(i)}}class Kk{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new qk(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vk(this._delegate,e._delegate)}}class Wk extends Kk{data(e){var t=this._delegate.data(e);return this._delegate._converter||(e="Document in a QueryDocumentSnapshot should exist",void 0!==t)||S(57014,e),t}}class Hk{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Lk(e)}where(e,t,r){try{return new Hk(this.firestore,ek(this._delegate,(n=r,i=t,s=YS("where",e),tk._create(s,i,n))))}catch(e){throw jk(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,i,s}orderBy(e,t){try{return new Hk(this.firestore,ek(this._delegate,([r,n="asc"]=[e,t],i=n,s=YS("orderBy",r),rk._create(s,i))))}catch(e){throw jk(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,n,i,s}limit(e){try{return new Hk(this.firestore,ek(this._delegate,(GC("limit",t=e),nk._create("limit",t,"F"))))}catch(e){throw jk(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Hk(this.firestore,ek(this._delegate,(GC("limitToLast",t=e),nk._create("limitToLast",t,"L"))))}catch(e){throw jk(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Hk(this.firestore,ek(this._delegate,([...t]=[...e],ik._create("startAt",t,!0))))}catch(e){throw jk(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new Hk(this.firestore,ek(this._delegate,([...t]=[...e],ik._create("startAfter",t,!1))))}catch(e){throw jk(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new Hk(this.firestore,ek(this._delegate,([...t]=[...e],sk._create("endBefore",t,!1))))}catch(e){throw jk(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new Hk(this.firestore,ek(this._delegate,([...t]=[...e],sk._create("endAt",t,!0))))}catch(e){throw jk(e,"endAt()","Query.endAt()")}var t}isEqual(e){return nS(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?t=>{t=q(t,JC);let r=q(t.firestore,cS),e=dS(r),n=new _k(r);return MC(e,t._query).then(e=>new mk(r,n,t,e))}:"server"===(null==e?void 0:e.source)?t=>{t=q(t,JC);let r=q(t.firestore,cS),e=dS(r),n=new _k(r);return LC(e,t._query,{source:"server"}).then(e=>new mk(r,n,t,e))}:t=>{t=q(t,JC);let r=q(t.firestore,cS),e=dS(r),n=new _k(r);return JS(t._query),LC(e,t._query).then(e=>new mk(r,n,t,e))})(this._delegate)).then(e=>new $k(this.firestore,new mk(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=Bk(e),r=zk(e,e=>new $k(this.firestore,new mk(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return bk(this._delegate,t,r)}withConverter(e){return new Hk(this.firestore,e?this._delegate.withConverter(Vk.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Gk{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Wk(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class $k{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Hk(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Wk(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Gk(this._firestore,e))}forEach(t,r){this._delegate.forEach(e=>{t.call(r,new Wk(this._firestore,e))})}isEqual(e){return vk(this._delegate,e._delegate)}}class Qk extends Hk{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new qk(this.firestore,e):null}doc(e){try{return void 0===e?new qk(this.firestore,tS(this._delegate)):new qk(this.firestore,tS(this._delegate,e))}catch(e){throw jk(e,"doc()","CollectionReference.doc()")}}add(e){return((e,t)=>{let r=q(e.firestore,cS),n=tS(e),i=ck(e.converter,t);return Ik(r,[NS(AS(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,tb.exists(!1))]).then(()=>n)})(this._delegate,e).then(e=>new qk(this.firestore,e))}isEqual(e){return rS(this._delegate,e._delegate)}withConverter(e){return new Qk(this.firestore,e?this._delegate.withConverter(Vk.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Yk(e){return q(e,XC)}class Jk{static serverTimestamp(){var e=new DS("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Jk(e)}static delete(){var e=new RS("deleteField");return e._methodName="FieldValue.delete",new Jk(e)}static arrayUnion(...e){[...e]=[...e];var t=new xS("arrayUnion",e);return t._methodName="FieldValue.arrayUnion",new Jk(t)}static arrayRemove(...e){[...e]=[...e];var t=new OS("arrayRemove",e);return t._methodName="FieldValue.arrayRemove",new Jk(t)}static increment(e){e=e;var t=new MS("increment",e);return t._methodName="FieldValue.increment",new Jk(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}}let Xk={Firestore:Mk,GeoPoint:wS,Timestamp:Zm,Blob:Dk,Transaction:Fk,WriteBatch:Uk,DocumentReference:qk,DocumentSnapshot:Kk,Query:Hk,QueryDocumentSnapshot:Wk,QuerySnapshot:$k,CollectionReference:Qk,FieldPath:class Sx{constructor(...e){this._delegate=new _S(...e)}static documentId(){return new Sx(nv.keyField().canonicalString())}isEqual(e){return(e=w(e))instanceof _S&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:Jk,setLogLevel:function(e){e=e,Pm.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};t=or,uS=(e,t)=>new Mk(e,t,new Ok),t.INTERNAL.registerComponent(new u("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return uS(t,r)},"PUBLIC").setServiceProps(Object.assign({},Xk))),t.registerVersion("@firebase/firestore-compat","0.3.49");let Zk="type.googleapis.com/google.protobuf.Int64Value",e1="type.googleapis.com/google.protobuf.UInt64Value";function t1(e,t){var r,n={};for(r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function r1(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>r1(e));if("function"==typeof e||"object"==typeof e)return t1(e,e=>r1(e));throw new Error("Data cannot be encoded in JSON: "+e)}function n1(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case Zk:case e1:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>n1(e)):"function"==typeof e||"object"==typeof e?t1(e,e=>n1(e)):e}let i1="functions",s1={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class a1 extends _e{constructor(e,t,r){super(i1+"/"+e,t||""),this.details=r,Object.setPrototypeOf(this,a1.prototype)}}function o1(e,t){let r=(e=>{if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"})(e),n=r,i=void 0;try{var s=t&&t.error;if(s){let e=s.status;if("string"==typeof e){if(!s1[e])return new a1("internal","internal");r=s1[e],n=e}var a=s.message;"string"==typeof a&&(n=a),void 0!==(i=s.details)&&(i=n1(i))}}catch(e){}return"ok"===r?null:new a1(r,n,i)}class l1{constructor(e,t,r,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,h(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||r.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null!=n&&n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){}}async getAppCheckToken(e){var t;return this.serverAppAppCheckToken||(!this.appCheck||(t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken()).error?null:t.token)}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let h1="us-central1",u1=/^data: (.*?)(?:\n|$)/;class c1{constructor(e,t,r,n,i=h1,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new l1(e,t,r,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin+("/"===a.pathname?"":a.pathname),this.region=h1}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/`+e:null!==this.customDomain?this.customDomain+"/"+e:`https://${this.region}-${t}.cloudfunctions.net/`+e}}function d1(i,s,a){var e=e=>{return e=e,r=a||{},n=(t=i)._url(s),f1(t,n,e,r);var t,r,n};return e.stream=(e,t)=>{return e=e,t=t,n=(r=i)._url(s),g1(r,n,e,t||{});var r,n},e}async function p1(e,t){var r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),null!==n.appCheckToken&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}async function f1(e,t,r,n){var i={data:r=r1(r)},s=await p1(e,n),a=(r=>{let n=null;return{promise:new Promise((e,t)=>{n=setTimeout(()=>{t(new a1("deadline-exceeded","deadline-exceeded"))},r)}),cancel:()=>{n&&clearTimeout(n)}}})(n.timeout||7e4),i=await Promise.race([(async(e,t,r,n)=>{r["Content-Type"]="application/json";let i;try{i=await n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}})(t,i,s,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!i)throw new a1("cancelled","Firebase Functions instance was deleted.");s=o1(i.status,i.json);if(s)throw s;if(!i.json)throw new a1("internal","Response is not valid JSON object.");let o=i.json.data;if(void 0===(o=void 0===o?i.json.result:o))throw new a1("internal","Response is missing data field.");return{data:n1(o)}}async function g1(e,t,r,n){var i={data:r=r1(r)},s=await p1(e,n);s["Content-Type"]="application/json",s.Accept="text/event-stream";let a;try{a=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(i),headers:s,signal:null==n?void 0:n.signal})}catch(e){if(e instanceof Error&&"AbortError"===e.name){let e=new a1("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(e)}}}}}}let t=o1(0,null);return{data:Promise.reject(t),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(t)}}}}}}let o,l;i=new Promise((e,t)=>{o=e,l=t}),null!=(s=null==n?void 0:n.signal)&&s.addEventListener("abort",()=>{var e=new a1("cancelled","Request was cancelled.");l(e)}),s=a.body.getReader();let h=((a,s,o,l)=>{let h=(e,t)=>{var r=e.match(u1);if(r){r=r[1];try{var n,i=JSON.parse(r);"result"in i?s(n1(i.result)):"message"in i?t.enqueue(n1(i.message)):"error"in i&&(n=o1(0,i),t.error(n),o(n))}catch(e){e instanceof a1&&(t.error(e),o(e))}}},u=new TextDecoder;return new ReadableStream({start(i){let s="";return async function r(){if(null!=l&&l.aborted){let e=new a1("cancelled","Request was cancelled");return i.error(e),o(e),Promise.resolve()}try{let{value:t,done:e}=await a.read();if(e)s.trim()&&h(s.trim(),i),i.close();else{if(null==l||!l.aborted){let e=(s+=u.decode(t,{stream:!0})).split("\n");s=e.pop()||"";for(var n of e)n.trim()&&h(n.trim(),i);return r()}{let e=new a1("cancelled","Request was cancelled");i.error(e),o(e),void await a.cancel()}}}catch(e){let t=e instanceof a1?e:o1(0,null);i.error(t),o(t)}}()},cancel(){return a.cancel()}})})(s,o,l,null==n?void 0:n.signal);return{stream:{[Symbol.asyncIterator](){let r=h.getReader();return{async next(){var{value:e,done:t}=await r.read();return{value:e,done:t}},async return(){return await r.cancel(),{done:!0,value:void 0}}}}},data:i}}let m1="@firebase/functions";function v1(e,t,r){var n;e=w(e),r=r,n=ee(t=t),e.emulatorOrigin=`http${n?"s":""}://${t}:`+r,n&&(te(e.emulatorOrigin),se("Functions",!0))}function _1(e,t,r){return n=w(e),i=t,s=r,(a=e=>f1(n,i,e,s||{})).stream=(e,t)=>g1(n,i,e,t||{}),a;var n,i,s,a}Pt(new u(i1,(e,{instanceIdentifier:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new c1(r,n,i,s,t)},"PUBLIC").setMultipleInstances(!0)),d(m1,"0.12.6",r),d(m1,"0.12.6","esm2017");var y1,w1,b1;class I1{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return d1(w(this._delegate),e,t)}httpsCallableFromURL(e,t){return _1(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new _e("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new _e("functions","Port missing in origin provided to useFunctionsEmulator()");return v1(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return v1(this._delegate,e,t)}}let T1="us-central1",E1=(e,{instanceIdentifier:t})=>{var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("functions").getImmediate({identifier:null!=t?t:T1});return new I1(r,n)};sr={Functions:I1},or.INTERNAL.registerComponent(new u("functions-compat",E1,"PUBLIC").setServiceProps(sr).setMultipleInstances(!0)),or.registerVersion("@firebase/functions-compat","0.3.23");let C1="/firebase-messaging-sw.js",S1="/firebase-cloud-messaging-push-scope",k1="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",A1="https://fcmregistrations.googleapis.com/v1",N1="google.c.a.c_id",R1="google.c.a.c_l",P1="google.c.a.ts",D1="google.c.a.e",x1=1e4;function O1(e){var t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(rD=y1=y1||{}).PUSH_RECEIVED="push-received",rD.NOTIFICATION_CLICKED="notification-clicked";let M1="fcm_token_details_db",L1=5,F1="fcm_token_object_Store";async function U1(o){if("databases"in indexedDB&&!(await indexedDB.databases()).map(e=>e.name).includes(M1))return null;let l=null;return(await ft(M1,L1,{upgrade:async(e,t,r,n)=>{var i,s,a;t<2||e.objectStoreNames.contains(F1)&&(i=await(a=n.objectStore(F1)).index("fcmSenderId").get(o),await a.clear(),i)&&(2===t?(a=i).auth&&a.p256dh&&a.endpoint&&(l={token:a.fcmToken,createTime:null!=(s=a.createTime)?s:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:"string"==typeof a.vapidKey?a.vapidKey:O1(a.vapidKey)}}):3===t?(s=i,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:O1(s.auth),p256dh:O1(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:O1(s.vapidKey)}}):4===t&&(a=i,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:O1(a.auth),p256dh:O1(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:O1(a.vapidKey)}}))}})).close(),await gt(M1),await gt("fcm_vapid_details_db"),await gt("undefined"),(e=>{var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length})(l)?l:null}let V1="firebase-messaging-database",q1=1,j1="firebase-messaging-store",B1=null;function z1(){return B1=B1||ft(V1,q1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(j1)}})}async function K1(e){var t=H1(e),t=await(await z1()).transaction(j1).objectStore(j1).get(t);return t||((t=await U1(e.appConfig.senderId))?(await W1(e,t),t):void 0)}async function W1(e,t){var r=H1(e),n=(await z1()).transaction(j1,"readwrite");return await n.objectStore(j1).put(t,r),await n.done,t}function H1({appConfig:e}){return e.appId}let G1=new ye("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function $1(e,t){var r={method:"DELETE",headers:await Y1(e)};try{var n,i=await(await fetch(Q1(e.appConfig)+"/"+t,r)).json();if(i.error)throw n=i.error.message,G1.create("token-unsubscribe-failed",{errorInfo:n})}catch(e){throw G1.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function Q1({projectId:e}){return A1+`/projects/${e}/registrations`}async function Y1({appConfig:e,installations:t}){var r=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+r})}function J1({p256dh:e,auth:t,endpoint:r,vapidKey:n}){var i={web:{endpoint:r,auth:t,p256dh:e}};return n!==k1&&(i.web.applicationPubKey=n),i}let X1=6048e5;async function Z1(e){var t,r,n,i,s,a=await(async(e,t)=>{var r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(e=>{var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n})(t)})})(e.swRegistration,e.vapidKey),a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:a.endpoint,auth:O1(a.getKey("auth")),p256dh:O1(a.getKey("p256dh"))},o=await K1(e.firebaseDependencies);if(o){if(t=o.subscriptionOptions,r=a.vapidKey===t.vapidKey,n=a.endpoint===t.endpoint,i=a.auth===t.auth,s=a.p256dh===t.p256dh,r&&n&&i&&s)return Date.now()>=o.createTime+X1?(async(e,t)=>{try{var r=await(async(e,t)=>{var r=await Y1(e),n=J1(t.subscriptionOptions),r={method:"PATCH",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(Q1(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw G1.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,G1.create("token-update-failed",{errorInfo:n});if(i.token)return i.token;throw G1.create("token-update-no-token")})(e.firebaseDependencies,t),n=Object.assign(Object.assign({},t),{token:r,createTime:Date.now()});return await W1(e.firebaseDependencies,n),r}catch(e){throw e}})(e,{token:o.token,createTime:Date.now(),subscriptionOptions:a}):o.token;try{await $1(e.firebaseDependencies,o.token)}catch(e){console.warn(e)}}return tA(e.firebaseDependencies,a)}async function eA(e){var t,r=await K1(e.firebaseDependencies),r=(r&&(await $1(e.firebaseDependencies,r.token),r=H1(e.firebaseDependencies),await(t=(await z1()).transaction(j1,"readwrite")).objectStore(j1).delete(r),await t.done),await e.swRegistration.pushManager.getSubscription());return!r||r.unsubscribe()}async function tA(e,t){var r={token:await(async(e,t)=>{var r=await Y1(e),n=J1(t),r={method:"POST",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(Q1(e.appConfig),r);i=await s.json()}catch(e){throw G1.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,G1.create("token-subscribe-failed",{errorInfo:n});if(i.token)return i.token;throw G1.create("token-subscribe-no-token")})(e,t),createTime:Date.now(),subscriptionOptions:t};return await W1(e,r),r.token}function rA(e){var t,r,n,i,s={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return n=s,(r=e).notification&&(n.notification={},(t=r.notification.title)&&(n.notification.title=t),(t=r.notification.body)&&(n.notification.body=t),(t=r.notification.image)&&(n.notification.image=t),t=r.notification.icon)&&(n.notification.icon=t),r=s,(n=e).data&&(r.data=n.data),r=s,((n=e).fcmOptions||null!=(i=n.notification)&&i.click_action)&&(r.fcmOptions={},(i=null!=(i=null==(i=n.fcmOptions)?void 0:i.link)?i:null==(i=n.notification)?void 0:i.click_action)&&(r.fcmOptions.link=i),i=null==(i=n.fcmOptions)?void 0:i.analytics_label)&&(r.fcmOptions.analyticsLabel=i),s}var nA="AzSCbw63g1R0nCw85jG8",iA="Iaya3yLKwmgvh7cF0q4",sA=[];for(let kx=0;kx<nA.length;kx++)sA.push(nA.charAt(kx)),kx<iA.length&&sA.push(iA.charAt(kx));function aA(e){return G1.create("missing-app-config-values",{valueName:e})}sA.join("");class oA{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var n=(e=>{if(!e||!e.options)throw aA("App Configuration Object");if(!e.name)throw aA("App Name");var t,r=e.options;for(t of["projectId","apiKey","appId","messagingSenderId"])if(!r[t])throw aA(t);return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}})(e);this.firebaseDependencies={app:e,appConfig:n,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}async function lA(e){try{e.swRegistration=await navigator.serviceWorker.register(C1,{scope:S1}),e.swRegistration.update().catch(()=>{}),t=e.swRegistration,await new Promise((r,e)=>{let n=setTimeout(()=>e(new Error(`Service worker not registered after ${x1} ms`)),x1),i=t.installing||t.waiting;t.active?(clearTimeout(n),r()):i?i.onstatechange=e=>{var t;"activated"===(null==(t=e.target)?void 0:t.state)&&(i.onstatechange=null,clearTimeout(n),r())}:(clearTimeout(n),e(new Error("No incoming service worker found.")))})}catch(e){throw G1.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}var t}async function hA(e,t){if(!navigator)throw G1.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw G1.create("permission-blocked");n=e,await!((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=k1));var r=e,n=null==t?void 0:t.serviceWorkerRegistration;if(n||r.swRegistration||await lA(r),n||!r.swRegistration){if(!(n instanceof ServiceWorkerRegistration))throw G1.create("invalid-sw-registration");r.swRegistration=n}return await 0,Z1(e)}async function uA(e,t,r){var n=(e=>{switch(e){case y1.NOTIFICATION_CLICKED:return"notification_open";case y1.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}})(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(n,{message_id:r[N1],message_name:r[R1],message_time:r[P1],message_device_time:Math.floor(Date.now()/1e3)})}async function cA(e,t){var r,n=t.data;n.isFirebaseMessaging&&(e.onMessageHandler&&n.messageType===y1.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(rA(n)):e.onMessageHandler.next(rA(n))),"object"==typeof(t=r=n.data))&&t&&N1 in t&&"1"===r[D1]&&await uA(e,n.messageType,r)}let dA="@firebase/messaging",pA="0.12.20",fA=e=>{let t=new oA(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>cA(t,e)),t},gA=e=>{let t=e.getProvider("messaging").getImmediate();return{getToken:e=>hA(t,e)}};function mA(e){return(async e=>{if(navigator)return e.swRegistration||await lA(e),eA(e);throw G1.create("only-available-in-window")})(e=w(e))}function vA(e,t){var r=e=w(e),e=t;if(navigator)return r.onMessageHandler=e,()=>{r.onMessageHandler=null};throw G1.create("only-available-in-window")}Pt(new u("messaging",fA,"PUBLIC")),Pt(new u("messaging-internal",gA,"PRIVATE")),d(dA,pA),d(dA,pA,"esm2017");let _A="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",yA="https://fcmregistrations.googleapis.com/v1",wA="FCM_MSG",bA="google.c.a.c_id",IA=3,TA=1;function EA(e){var t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(sN=w1=w1||{})[sN.DATA_MESSAGE=1]="DATA_MESSAGE",sN[sN.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(t=b1=b1||{}).PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked";let CA="fcm_token_details_db",SA=5,kA="fcm_token_object_Store";async function AA(o){if("databases"in indexedDB&&!(await indexedDB.databases()).map(e=>e.name).includes(CA))return null;let l=null;return(await ft(CA,SA,{upgrade:async(e,t,r,n)=>{var i,s,a;t<2||e.objectStoreNames.contains(kA)&&(i=await(a=n.objectStore(kA)).index("fcmSenderId").get(o),await a.clear(),i)&&(2===t?(a=i).auth&&a.p256dh&&a.endpoint&&(l={token:a.fcmToken,createTime:null!=(s=a.createTime)?s:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:"string"==typeof a.vapidKey?a.vapidKey:EA(a.vapidKey)}}):3===t?(s=i,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:EA(s.auth),p256dh:EA(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:EA(s.vapidKey)}}):4===t&&(a=i,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:EA(a.auth),p256dh:EA(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:EA(a.vapidKey)}}))}})).close(),await gt(CA),await gt("fcm_vapid_details_db"),await gt("undefined"),(e=>{var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length})(l)?l:null}let NA="firebase-messaging-database",RA=1,PA="firebase-messaging-store",DA=null;function xA(){return DA=DA||ft(NA,RA,{upgrade:(e,t)=>{0===t&&e.createObjectStore(PA)}})}async function OA(e){var t=LA(e),t=await(await xA()).transaction(PA).objectStore(PA).get(t);return t||((t=await AA(e.appConfig.senderId))?(await MA(e,t),t):void 0)}async function MA(e,t){var r=LA(e),n=(await xA()).transaction(PA,"readwrite");return await n.objectStore(PA).put(t,r),await n.done,t}function LA({appConfig:e}){return e.appId}let FA=new ye("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function UA(e,t){var r={method:"DELETE",headers:await qA(e)};try{var n,i=await(await fetch(VA(e.appConfig)+"/"+t,r)).json();if(i.error)throw n=i.error.message,FA.create("token-unsubscribe-failed",{errorInfo:n})}catch(e){throw FA.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function VA({projectId:e}){return yA+`/projects/${e}/registrations`}async function qA({appConfig:e,installations:t}){var r=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+r})}function jA({p256dh:e,auth:t,endpoint:r,vapidKey:n}){var i={web:{endpoint:r,auth:t,p256dh:e}};return n!==_A&&(i.web.applicationPubKey=n),i}let BA=6048e5;async function zA(e){var t,r,n,i,s,a=await(async(e,t)=>{var r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(e=>{var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n})(t)})})(e.swRegistration,e.vapidKey),a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:a.endpoint,auth:EA(a.getKey("auth")),p256dh:EA(a.getKey("p256dh"))},o=await OA(e.firebaseDependencies);if(o){if(t=o.subscriptionOptions,r=a.vapidKey===t.vapidKey,n=a.endpoint===t.endpoint,i=a.auth===t.auth,s=a.p256dh===t.p256dh,r&&n&&i&&s)return Date.now()>=o.createTime+BA?(async(e,t)=>{try{var r=await(async(e,t)=>{var r=await qA(e),n=jA(t.subscriptionOptions),r={method:"PATCH",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(VA(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw FA.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,FA.create("token-update-failed",{errorInfo:n});if(i.token)return i.token;throw FA.create("token-update-no-token")})(e.firebaseDependencies,t),n=Object.assign(Object.assign({},t),{token:r,createTime:Date.now()});return await MA(e.firebaseDependencies,n),r}catch(e){throw e}})(e,{token:o.token,createTime:Date.now(),subscriptionOptions:a}):o.token;try{await UA(e.firebaseDependencies,o.token)}catch(e){console.warn(e)}}return WA(e.firebaseDependencies,a)}async function KA(e){var t,r=await OA(e.firebaseDependencies),r=(r&&(await UA(e.firebaseDependencies,r.token),r=LA(e.firebaseDependencies),await(t=(await xA()).transaction(PA,"readwrite")).objectStore(PA).delete(r),await t.done),await e.swRegistration.pushManager.getSubscription());return!r||r.unsubscribe()}async function WA(e,t){var r={token:await(async(e,t)=>{var r=await qA(e),n=jA(t),r={method:"POST",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(VA(e.appConfig),r);i=await s.json()}catch(e){throw FA.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,FA.create("token-subscribe-failed",{errorInfo:n});if(i.token)return i.token;throw FA.create("token-subscribe-no-token")})(e,t),createTime:Date.now(),subscriptionOptions:t};return await MA(e,r),r.token}var HA="AzSCbw63g1R0nCw85jG8",GA="Iaya3yLKwmgvh7cF0q4",$A=[];for(let Ax=0;Ax<HA.length;Ax++)$A.push(HA.charAt(Ax)),Ax<GA.length&&$A.push(GA.charAt(Ax));async function QA(e,t){var r=((e,t)=>{var r,n={};return e.from&&(n.project_number=e.from),e.fcmMessageId&&(n.message_id=e.fcmMessageId),n.instance_id=t,n.message_type=(e.notification?w1.DISPLAY_NOTIFICATION:w1.DATA_MESSAGE).toString(),n.sdk_platform=IA.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=TA.toString(),null!=(r=e.fcmOptions)&&r.analytics_label&&(n.analytics_label=null==(r=e.fcmOptions)?void 0:r.analytics_label),n})(t,await e.firebaseDependencies.installations.getId()),n=r,t=t.productId,r={};r.event_time_ms=Math.floor(Date.now()).toString(),r.source_extension_json_proto3=JSON.stringify({messaging_client_event:n}),t&&(r.compliance_data=(e=>({privacy_context:{prequest:{origin_associated_product_id:e}}}))(t)),e.logEvents.push(r)}async function YA(e,t){var r=(({data:e})=>{if(!e)return null;try{return e.json()}catch(e){return null}})(e);if(r){t.deliveryMetricsExportedToBigQueryEnabled&&await QA(t,r);var n,i,s,a=await XA();if(a.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))){var o,e=a,l=r;l.isFirebaseMessaging=!0,l.messageType=b1.PUSH_RECEIVED;for(o of e)o.postMessage(l)}else r.notification&&await(e=>{var t=e.actions,r=Notification.maxActions;return t&&r&&t.length>r&&console.warn(`This browser only supports ${r} actions. The remaining actions will not be displayed.`),self.registration.showNotification(null!=(t=e.title)?t:"",e)})((e=r,(a=Object.assign({},e.notification)).data={[wA]:e},a)),t&&t.onBackgroundMessageHandler&&(a={from:(e=r).from,collapseKey:e.collapse_key,messageId:e.fcmMessageId},i=a,(n=e).notification&&(i.notification={},(r=n.notification.title)&&(i.notification.title=r),(r=n.notification.body)&&(i.notification.body=r),(r=n.notification.image)&&(i.notification.image=r),r=n.notification.icon)&&(i.notification.icon=r),n=a,(i=e).data&&(n.data=i.data),n=a,((i=e).fcmOptions||null!=(s=i.notification)&&s.click_action)&&(n.fcmOptions={},(s=null!=(s=null==(s=i.fcmOptions)?void 0:s.link)?s:null==(s=i.notification)?void 0:s.click_action)&&(n.fcmOptions.link=s),s=null==(s=i.fcmOptions)?void 0:s.analytics_label)&&(n.fcmOptions.analyticsLabel=s),r=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(r):t.onBackgroundMessageHandler.next(r))}}async function JA(e){var t=null==(t=null==(t=e.notification)?void 0:t.data)?void 0:t[wA];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var r=(e=>{var t=null!=(t=null==(t=e.fcmOptions)?void 0:t.link)?t:null==(t=e.notification)?void 0:t.click_action;return t||((e=>"object"==typeof e&&e&&bA in e)(e.data)?self.location.origin:null)})(t);if(r){var n,i=new URL(r,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await(async e=>{var t;for(t of await XA()){var r=new URL(t.url,self.location.href);if(e.host===r.host)return t}return null})(i);if(e?e=await e.focus():(e=await self.clients.openWindow(r),n=3e3,await new Promise(e=>{setTimeout(e,n)})),e)return t.messageType=b1.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function XA(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function ZA(e){return FA.create("missing-app-config-values",{valueName:e})}$A.join("");class eN{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var n=(e=>{if(!e||!e.options)throw ZA("App Configuration Object");if(!e.name)throw ZA("App Name");var t,r=e.options;for(t of["projectId","apiKey","appId","messagingSenderId"])if(!r[t])throw ZA(t);return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}})(e);this.firebaseDependencies={app:e,appConfig:n,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}let tN=e=>{let t=new eN(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(YA(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil((async(e,t)=>{var r;(r=e.newSubscription)?(r=await OA(t.firebaseDependencies),await KA(t),t.vapidKey=null!=(r=null==(r=null==r?void 0:r.subscriptionOptions)?void 0:r.vapidKey)?r:_A,await zA(t)):await KA(t)})(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(JA(e))}),t};function rN(e,t){var r=e=w(e),e=t;if(void 0!==self.document)throw FA.create("only-available-in-sw");return r.onBackgroundMessageHandler=e,()=>{r.onBackgroundMessageHandler=null}}Pt(new u("messaging-sw",tN,"PUBLIC"));var nN,iN,sN;class aN{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return(async(e,t)=>hA(e=w(e),t))(this._delegate,e)}async deleteToken(){return mA(this._delegate)}onMessage(e){return vA(this._delegate,e)}onBackgroundMessage(e){return rN(this._delegate,e)}}let oN=e=>self&&"ServiceWorkerGlobalScope"in self?new aN(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new aN(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),lN={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?ge()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&ge()&&ve()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};or.INTERNAL.registerComponent(new u("messaging-compat",oN,"PUBLIC").setServiceProps(lN)),or.registerVersion("@firebase/messaging-compat","0.2.20");let hN="firebasestorage.googleapis.com",uN="storageBucket";class cN extends _e{constructor(e,t,r=0){super(dN(e),`Firebase Storage: ${t} (${dN(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,cN.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return dN(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+`
`+this.customData.serverResponse:this.message=this._baseMessage}}function dN(e){return"storage/"+e}function pN(){return new cN(nN.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function fN(){return new cN(nN.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function gN(){return new cN(nN.CANCELED,"User canceled the upload/download.")}function mN(){return new cN(nN.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function vN(e){return new cN(nN.INVALID_ARGUMENT,e)}function _N(){return new cN(nN.APP_DELETED,"The Firebase app was deleted.")}function yN(e){return new cN(nN.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function wN(e,t){return new cN(nN.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function bN(e){throw new cN(nN.INTERNAL_ERROR,"Internal error: "+e)}(r=nN=nN||{}).UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class IN{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let r;try{r=IN.makeFromUrl(t,e)}catch(e){return new IN(t,"")}if(""===r.path)return r;throw e=t,new cN(nN.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null;var n="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),a=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),o=t===hN?"(?:storage.googleapis.com|storage.cloud.google.com)":t,l=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${o}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let d=0;d<l.length;d++){var h=l[d],u=h.regex.exec(e);if(u){var c=u[h.indices.bucket];let e=u[h.indices.path];e=e||"",r=new IN(c,e),h.postModify(r);break}}if(null==r)throw t=e,new cN(nN.INVALID_URL,"Invalid URL '"+t+"'.");return r}}class TN{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function EN(e){return"string"==typeof e||e instanceof String}function CN(e){return SN()&&e instanceof Blob}function SN(){return"undefined"!=typeof Blob}function kN(e,t,r,n){if(n<t)throw vN(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r<n)throw vN(`Invalid value for '${e}'. Expected ${r} or less.`)}function AN(e,t,r){let n=null==r?"https://"+t:t;return`${r}://${n}/v0`+e}function NN(e){var t,r,n=encodeURIComponent;let i="?";for(t in e)e.hasOwnProperty(t)&&(r=n(t)+"="+n(e[t]),i=i+r+"&");return i=i.slice(0,-1)}function RN(e,t){var r=500<=e&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}(rD=iN=iN||{})[rD.NO_ERROR=0]="NO_ERROR",rD[rD.NETWORK_ERROR=1]="NETWORK_ERROR",rD[rD.ABORT=2]="ABORT";class PN{constructor(e,t,r,n,i,s,a,o,l,h,u,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(i,e)=>{if(e)i(!1,new DN(!1,null,!0));else{let r=this.connectionFactory_(),n=(this.pendingConnection_=r,e=>{var t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)});null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;var e=r.getErrorCode()===iN.NO_ERROR,t=r.getStatus();!e||RN(t,this.additionalRetryCodes_)&&this.retry?(e=r.getErrorCode()===iN.ABORT,i(!1,new DN(!1,null,e))):(e=-1!==this.successCodes_.indexOf(t),i(!0,new DN(e,r)))})}},t=(e,t)=>{var r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?r(s):r()}catch(e){n(e)}else null!==i?((s=pN()).serverResponse=i.getErrorText(),this.errorCallback_?n(this.errorCallback_(i,s)):n(s)):t.canceled?n((this.appDelete_?_N:gN)()):n(fN())};this.canceled_?t(0,new DN(!1,null,!0)):this.backoffId_=((t,r,e)=>{let n=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let h=!1;function u(...e){h||(h=!0,r.apply(null,e))}function c(e){i=setTimeout(()=>{i=null,t(p,l())},e)}function d(){s&&clearTimeout(s)}function p(e,...t){if(h)d();else if(e)d(),u.call(null,e,...t);else if(l()||a)d(),u.call(null,e,...t);else{n<64&&(n*=2);let e;c(e=1===o?(o=2,0):1e3*(n+Math.random()))}}let f=!1;function g(e){f||(f=!0,d(),h)||(null!==i?(e||(o=2),clearTimeout(i),c(0)):e||(o=1))}return c(0),s=setTimeout(()=>{g(a=!0)},e),g})(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class DN{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function xN(...t){var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==r){var n=new r;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(SN())return new Blob(t);throw new cN(nN.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function ON(e){if("undefined"==typeof atob)throw new cN(nN.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}let MN={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class LN{constructor(e,t){this.data=e,this.contentType=t||null}}function FN(e,t){switch(e){case MN.RAW:return new LN(UN(t));case MN.BASE64:case MN.BASE64URL:return new LN(VN(e,t));case MN.DATA_URL:return new LN((r=t,(n=new qN(r)).base64?VN(MN.BASE64,n.rest):(e=>{let t;try{t=decodeURIComponent(e)}catch(e){throw wN(MN.DATA_URL,"Malformed data URL.")}return UN(t)})(n.rest)),(r=t,new qN(r).contentType))}var r,n;throw pN()}function UN(t){var r,n,i=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);e<=127?i.push(e):e<=2047?i.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,n=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&n,i.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):i.push(239,191,189):56320==(64512&e)?i.push(239,191,189):i.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(i)}function VN(t,e){switch(t){case MN.BASE64:var r=-1!==e.indexOf("-"),n=-1!==e.indexOf("_");if(r||n)throw wN(t,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break;case MN.BASE64URL:n=-1!==e.indexOf("+"),r=-1!==e.indexOf("/");if(n||r)throw wN(t,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=ON(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw wN(t,"Invalid character found")}var s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class qN{constructor(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw wN(MN.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var r,n,t=t[1]||null;null!=t&&(this.base64=(n=";base64",(r=t).length>=n.length&&r.substring(r.length-n.length)===n),this.contentType=this.base64?t.substring(0,t.length-";base64".length):t),this.rest=e.substring(e.indexOf(",")+1)}}class jN{constructor(e,t){let r=0,n="";CN(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){var r,n,i,s;return CN(this.data_)?(r=this.data_,i=e,s=t,null===(r=(n=r).webkitSlice?n.webkitSlice(i,s):n.mozSlice?n.mozSlice(i,s):n.slice?n.slice(i,s):null)?null:new jN(r)):(r=new Uint8Array(this.data_.buffer,e,t-e),new jN(r,!0))}static getBlob(...e){if(SN())return i=e.map(e=>e instanceof jN?e.data_:e),new jN(xN.apply(null,i));{var i=e.map(e=>EN(e)?FN(MN.RAW,e).data:e.data_);let t=0,r=(i.forEach(e=>{t+=e.byteLength}),new Uint8Array(t)),n=0;return i.forEach(e=>{for(let t=0;t<e.length;t++)r[n++]=e[t]}),new jN(r,!0)}}uploadData(){return this.data_}}function BN(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function zN(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function KN(e,t){return t}class WN{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||KN}}let HN=null;function GN(){var e,t;return HN||((e=[]).push(new WN("bucket")),e.push(new WN("generation")),e.push(new WN("metageneration")),e.push(new WN("name","fullPath",!0)),(t=new WN("name")).xform=function(e,t){return!EN(t=t)||t.length<2?t:zN(t)},e.push(t),(t=new WN("size")).xform=function(e,t){return void 0!==t?Number(t):t},e.push(t),e.push(new WN("timeCreated")),e.push(new WN("updated")),e.push(new WN("md5Hash",null,!0)),e.push(new WN("cacheControl",null,!0)),e.push(new WN("contentDisposition",null,!0)),e.push(new WN("contentEncoding",null,!0)),e.push(new WN("contentLanguage",null,!0)),e.push(new WN("contentType",null,!0)),e.push(new WN("metadata","customMetadata",!0)),HN=e),HN}function $N(r,n){Object.defineProperty(r,"ref",{get:function(){var e=r.bucket,t=r.fullPath,e=new IN(e,t);return n._makeStorageReference(e)}})}function QN(e,t,r){var n=BN(t);if(null===n)return null;var t=e,i=n,s=r,a={type:"file"},o=s.length;for(let h=0;h<o;h++){var l=s[h];a[l.local]=l.xform(a,i[l.server])}return $N(a,t),a}function YN(e,t){var r={},n=t.length;for(let s=0;s<n;s++){var i=t[s];i.writable&&(r[i.server]=e[i.local])}return JSON.stringify(r)}let JN="prefixes",XN="items";function ZN(e,t,r){var n=BN(r);if(null===n)return null;var i=e,s=t,r=n,a={prefixes:[],items:[],nextPageToken:r.nextPageToken};if(r[JN])for(var o of r[JN]){o=o.replace(/\/$/,""),o=i._makeStorageReference(new IN(s,o));a.prefixes.push(o)}if(r[XN])for(var l of r[XN]){l=i._makeStorageReference(new IN(s,l.name));a.items.push(l)}return a}class eR{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function tR(e){if(!e)throw pN()}function rR(n,i){return function(e,t){var r=QN(n,t,i);return tR(null!==r),r}}function nR(n,i){return function(e,t){var r=ZN(n,i,t);return tR(null!==r),r}}function iR(o,n){return function(e,t){var r=QN(o,t,n);tR(null!==r);{var i=r,s=o.host,a=o._protocol;if(null===(r=BN(t)))return null;if(!EN(r.downloadTokens))return null;if(0===(r=r.downloadTokens).length)return null;let n=encodeURIComponent;return r.split(",").map(e=>{var t=i.bucket,r=i.fullPath;return AN("/b/"+n(t)+"/o/"+n(r),s,a)+NN({alt:"media",token:e})})[0]}}}function sR(i){return function(e,t){let r;var n;return(r=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new cN(nN.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new cN(nN.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(n=i.bucket,new cN(nN.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(n=i.path,new cN(nN.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")):t).status=e.getStatus(),r.serverResponse=t.serverResponse,r}}function aR(n){let i=sR(n);return function(e,t){let r=i(e,t);return(r=404===e.getStatus()?(e=n.path,new cN(nN.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")):r).serverResponse=t.serverResponse,r}}function oR(e,t,r){var n=AN(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,n=new eR(n,"GET",rR(e,r),i);return n.errorHandler=aR(t),n}function lR(e,t,r){var n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=(r=t,(e=null)&&e.contentType||r&&r.type()||"application/octet-stream")),n}function hR(e,t,r,n,i){var s=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var o=(()=>{let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e})(),l=(a["Content-Type"]="multipart/related; boundary="+o,lR(t,n,i)),h="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+YN(l,r)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",o="\r\n--"+o+"--",h=jN.getBlob(h,n,o);if(null===h)throw mN();o={name:l.fullPath},l=AN(s,e.host,e._protocol),s=e.maxUploadRetryTime,l=new eR(l,"POST",rR(e,r),s);return l.urlParams=o,l.headers=a,l.body=h.uploadData(),l.errorHandler=sR(t),l}class uR{constructor(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null}}function cR(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){tR(!1)}return tR(!!r&&-1!==(t||["active"]).indexOf(r)),r}function dR(e,t,r,n,i){var s=t.bucketOnlyServerUrl(),a=lR(t,n,i),o={name:a.fullPath},s=AN(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+n.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},a=YN(a,r),h=e.maxUploadRetryTime;s=new eR(s,"POST",function(e){cR(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){tR(!1)}return tR(EN(t)),t},h);return s.urlParams=o,s.headers=l,s.body=a,s.errorHandler=sR(t),s}function pR(e,t,r,i){var n=e.maxUploadRetryTime,n=new eR(r,"POST",function(e){var t=cR(e,["active","final"]);let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){tR(!1)}r||tR(!1);var n=Number(r);return tR(!isNaN(n)),new uR(n,i.size(),"final"===t)},n);return n.headers={"X-Goog-Upload-Command":"query"},n.errorHandler=sR(t),n}function fR(e,a,t,o,r,l,n,i){let h=new uR(0,0);if(n?(h.current=n.current,h.total=n.total):(h.current=0,h.total=o.size()),o.size()!==h.total)throw new cN(nN.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var s=h.total-h.current;let u=s;0<r&&(u=Math.min(u,r));var c=h.current,d=c+u;let p="";s={"X-Goog-Upload-Command":p=0===u?"finalize":s===u?"upload, finalize":"upload","X-Goog-Upload-Offset":""+h.current},c=o.slice(c,d);if(null===c)throw mN();d=a.maxUploadRetryTime,d=new eR(t,"POST",function(e,t){var r=cR(e,["active","final"]),n=h.current+u,i=o.size();let s;return s="final"===r?rR(a,l)(e,t):null,new uR(n,i,"final"===r,s)},d);return d.headers=s,d.body=c.uploadData(),d.progressCallback=i||null,d.errorHandler=sR(e),d}let gR={STATE_CHANGED:"state_changed"},mR={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function vR(e){switch(e){case"running":case"pausing":case"canceling":return mR.RUNNING;case"paused":return mR.PAUSED;case"success":return mR.SUCCESS;case"canceled":return mR.CANCELED;default:return mR.ERROR}}class _R{constructor(e,t,r){var n;"function"==typeof e||null!=t||null!=r?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0):(this.next=(n=e).next,this.error=n.error,this.complete=n.complete)}}function yR(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class wR extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=iN.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=iN.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=iN.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,n,i){if(this.sent_)throw bN("cannot .send() more than once");if(ee(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(var s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(this.sent_)return this.errorCode_;throw bN("cannot .getErrorCode() before sending")}getStatus(){if(!this.sent_)throw bN("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(this.sent_)return this.xhr_.response;throw bN("cannot .getResponse() before sending")}getErrorText(){if(this.sent_)return this.xhr_.statusText;throw bN("cannot .getErrorText() before sending")}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function bR(){return new wR}class IR{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=GN(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(nN.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(RN(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=fN()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(nN.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){let t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(r){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":r(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var r=dR(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(r,bR,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let n=this._uploadUrl;this._resolveToken((e,t)=>{var r=pR(this._ref.storage,this._ref._location,n,this._blob),r=this._ref.storage._makeRequest(r,bR,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let i=262144*this._chunkMultiplier,s=new uR(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let r;try{r=fR(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}var n=this._ref.storage._makeRequest(r,bR,e,t,!1);(this._request=n).getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(262144*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var r=oR(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(r,bR,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var r=hR(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(r,bR,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=gN(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=vR(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,n){let i=new _R(t||void 0,r||void 0,n||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(vR(this._state)){case mR.SUCCESS:yR(this._resolve.bind(null,this.snapshot))();break;case mR.CANCELED:case mR.ERROR:yR(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(vR(this._state)){case mR.RUNNING:case mR.PAUSED:e.next&&yR(e.next.bind(e,this.snapshot))();break;case mR.SUCCESS:e.complete&&yR(e.complete.bind(e))();break;case mR.CANCELED:case mR.ERROR:default:e.error&&yR(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class TR{constructor(e,t){this._service=e,t instanceof IN?this._location=t:this._location=IN.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new TR(e,t)}get root(){var e=new IN(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return zN(this._location.path)}get storage(){return this._service}get parent(){var e,t,r=0===(e=this._location.path).length?null:-1===(r=e.lastIndexOf("/"))?"":e.slice(0,r);return null===r?null:(t=new IN(this._location.bucket,r),new TR(this._service,t))}_throwIfRoot(e){if(""===this._location.path)throw yN(e)}}function ER(e){let t={prefixes:[],items:[]};return async function e(t,r,n){let i={pageToken:n};let s=await CR(t,i);r.prefixes.push(...s.prefixes);r.items.push(...s.items);null!=s.nextPageToken&&await e(t,r,s.nextPageToken)}(e,t).then(()=>t)}function CR(e,t){null!=t&&"number"==typeof t.maxResults&&kN("options.maxResults",1,1e3,t.maxResults);var r,n,i,s,a,o=t||{},l=(t=e.storage,r=e._location,n="/",i=o.pageToken,s=o.maxResults,o={},r.isRoot?o.prefix="":o.prefix=r.path+"/",n&&0<n.length&&(o.delimiter=n),i&&(o.pageToken=i),s&&(o.maxResults=s),a=AN(a=r.bucketOnlyServerUrl(),t.host,t._protocol),l=t.maxOperationRetryTime,(a=new eR(a,"GET",nR(t,r.bucket),l)).urlParams=o,a.errorHandler=sR(r),a);return e.storage.makeRequestWithTokens(l,bR)}function SR(e,t){e._throwIfRoot("updateMetadata");r=e.storage,n=e._location,t=t,i=GN(),s=AN(n.fullServerUrl(),r.host,r._protocol),a=YN(t,i),o=r.maxOperationRetryTime,(s=new eR(s,"PATCH",rR(r,i),o)).headers={"Content-Type":"application/json; charset=utf-8"},s.body=a,s.errorHandler=aR(n);var r,n,i,s,a,o=s;return e.storage.makeRequestWithTokens(o,bR)}function kR(e){e._throwIfRoot("getDownloadURL");t=e.storage,r=e._location,n=GN(),i=AN(r.fullServerUrl(),t.host,t._protocol),s=t.maxOperationRetryTime,(i=new eR(i,"GET",iR(t,n),s)).errorHandler=aR(r);var t,r,n,i,s=i;return e.storage.makeRequestWithTokens(s,bR).then(e=>{if(null===e)throw new cN(nN.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function AR(e){e._throwIfRoot("deleteObject");t=e.storage,n=AN((r=e._location).fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,(n=new eR(n,"DELETE",function(e,t){},i)).successCodes=[200,204],n.errorHandler=aR(r);var t,r,n,i=n;return e.storage.makeRequestWithTokens(i,bR)}function NR(e,t){r=e._location.path,n=t.split("/").filter(e=>0<e.length).join("/");var r,n=0===r.length?n:r+"/"+n,n=new IN(e._location.bucket,n);return new TR(e.storage,n)}function RR(e,t){if(e instanceof xR){var r=e;if(null==r._bucket)throw new cN(nN.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+uN+"' property when initializing the app?");r=new TR(r,r._bucket);return null!=t?RR(r,t):r}return void 0!==t?NR(e,t):e}function PR(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof xR)return r=e,n=t,new TR(r,n);throw vN("To use ref(service, url), the first argument must be a Storage instance.")}return RR(e,t);var r,n}function DR(e,t){var r=null==t?void 0:t[uN];return null==r?null:IN.makeFromBucketSpec(r,e)}class xR{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=hN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=n?IN.makeFromBucketSpec(n,this._host):DR(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=IN.makeFromBucketSpec(this._url,e):this._bucket=DR(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){kN("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){kN("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;var e=this._authProvider.getImmediate({optional:!0});if(e){e=await e.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){var e;return h(this.app)&&this.app.settings.appCheckToken?this.app.settings.appCheckToken:(e=this._appCheckProvider.getImmediate({optional:!0}))?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new TR(this,e)}_makeRequest(t,r,n,i,s=!0){if(this._deleted)return new TN(_N());{[t,n,i,r,s,a,o=!0,l=!1]=[t,this._appId,n,i,r,this._firebaseVersion,s,this._isUsingEmulator],u=NN(t.urlParams),u=t.url+u,c=Object.assign({},t.headers),h=c,(n=n)&&(h["X-Firebase-GMPID"]=n),h=c,null!==(n=i)&&0<n.length&&(h.Authorization="Firebase "+n),i=a,c["X-Firebase-Storage-Version"]="webjs/"+(null!=i?i:"AppManager"),h=c,null!==(n=r)&&(h["X-Firebase-AppCheck"]=n);let e=new PN(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,l);return this._requests.add(e),e.getPromise().then(()=>this._requests.delete(e),()=>this._requests.delete(e)),e}var a,o,l,h,u,c}async makeRequestWithTokens(e,t){var[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let OR="@firebase/storage",MR="0.13.10";function LR(e,t,r){return e=w(e),t=t,r=r,(e=e)._throwIfRoot("uploadBytesResumable"),new IR(e,new jN(t),r)}function FR(e){return e=w(e),(e=e)._throwIfRoot("getMetadata"),t=oR(e.storage,e._location,GN()),e.storage.makeRequestWithTokens(t,bR);var t}function UR(e,t){return PR(e=w(e),t)}function VR(e,t,r,n={}){var i;[e,t,r,n={}]=[e,t,r,n],e.host=t+":"+r,(i=((i=ee(t))&&(te("https://"+e.host),se("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http",n).mockUserToken)&&(e._overrideAuthToken="string"==typeof i?i:re(i,e.app.options.projectId))}function qR(e,{instanceIdentifier:t}){var r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new xR(r,n,i,t,Ut)}Pt(new u("storage",qR,"PUBLIC").setMultipleInstances(!0)),d(OR,MR,""),d(OR,MR,"esm2017");class jR{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class BR{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new jR(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new jR(e,this,this._ref))},e)}on(e,t,r,n){let i=void 0;return t&&(i="function"==typeof t?e=>t(new jR(e,this,this._ref)):{next:t.next?e=>t.next(new jR(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,r||void 0,n||void 0)}}class zR{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new KR(e,this._service))}get items(){return this._delegate.items.map(e=>new KR(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class KR{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=NR(this._delegate,e);return new KR(t,this.storage)}get root(){return new KR(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new KR(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new BR(LR(this._delegate,e,t),this)}putString(e,t=MN.RAW,r){this._throwIfRoot("putString");var n=FN(t,e),i=Object.assign({},r);return null==i.contentType&&null!=n.contentType&&(i.contentType=n.contentType),new BR(new IR(this._delegate,new jN(n.data,!0),i),this)}listAll(){return ER(w(this._delegate)).then(e=>new zR(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,CR(t=w(t),e).then(e=>new zR(e,this.storage));var t}getMetadata(){return FR(this._delegate)}updateMetadata(e){return SR(w(this._delegate),e)}getDownloadURL(){return kR(w(this._delegate))}delete(){return this._throwIfRoot("delete"),AR(w(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw yN(e)}}class WR{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(HR(e))throw vN("ref() expected a child path but got a URL, use refFromURL instead.");return new KR(UR(this._delegate,e),this)}refFromURL(e){if(!HR(e))throw vN("refFromURL() expected a full URL but got a child path, use ref() instead.");try{IN.makeFromUrl(e,this._delegate.host)}catch(e){throw vN("refFromUrl() expected a valid full URL but got an invalid one.")}return new KR(UR(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){VR(this._delegate,e,t,r)}}function HR(e){return/^[A-Za-z]+:\/\//.test(e)}function GR(e,{instanceIdentifier:t}){var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("storage").getImmediate({identifier:t});return new WR(r,n)}sN=or,Sm={TaskState:mR,TaskEvent:gR,StringFormat:MN,Storage:WR,Reference:KR},sN.INTERNAL.registerComponent(new u("storage-compat",GR,"PUBLIC").setServiceProps(Sm).setMultipleInstances(!0)),sN.registerVersion("@firebase/storage-compat","0.3.20");function $R(e){if("loading"===document.readyState)return"loading";var t=iP();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"}function QR(e,t){var r="";try{for(;e&&9!==e.nodeType;){var n=e,i=n.id?"#"+n.id:sP(n)+(n.classList&&n.classList.value&&n.classList.value.trim()&&n.classList.value.trim().length?"."+n.classList.value.trim().replace(/\s+/g,"."):"");if(r.length+i.length>(t||100)-1)return r||i;if(r=r?i+">"+r:i,n.id)break;e=n.parentNode}}catch(e){}return r}function YR(i,e){var a,o,s,l;a=function(e){r={},(e=e).entries.length&&(t=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t}))&&t.sources&&t.sources.length&&(n=(n=t.sources).find(function(e){return e.node&&1===e.node.nodeType})||n[0])&&(r={largestShiftTarget:QR(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:$R(t.startTime)});var t,r,n=Object.assign(e,{attribution:r});i(n)},o=e||{},s=gP(function(){function e(e){e.forEach(function(e){var t,r;e.hadRecentInput||(t=i[0],r=i[i.length-1],n&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(n+=e.value,i.push(e)):(n=e.value,i=[e]))}),n>r.value&&(r.value=n,r.entries=i,t())}var t,r=uP("CLS",0),n=0,i=[],s=cP("layout-shift",e);s&&(t=dP(a,r,EP,o.reportAllChanges),fP(function(){e(s.takeRecords()),t(!0)}),lP(function(){r=uP("CLS",n=0),t=dP(a,r,EP,o.reportAllChanges),pP(function(){return t()})}),setTimeout(t,0))}),l=l||{},IP(function(){var t,r=bP(),n=uP("FCP"),i=cP("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime)&&(n.value=Math.max(e.startTime-hP(),0),n.entries.push(e),t(!0))})});i&&(t=dP(s,n,TP,l.reportAllChanges),lP(function(e){n=uP("FCP"),t=dP(s,n,TP,l.reportAllChanges),pP(function(){n.value=performance.now()-e.timeStamp,t(!0)})}))})}function JR(s,a){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(a=a||{},IP(function(){var e;RP();function t(t){FP(function(){t.forEach(LP);var e=OP();e&&e.latency!==r.value&&(r.value=e.latency,r.entries=e.entries,i())})}var r=uP("INP"),n=cP("event",t,{durationThreshold:null!=(e=a.durationThreshold)?e:40}),i=dP(s,r,UP,a.reportAllChanges);n&&(n.observe({type:"first-input",buffered:!0}),fP(function(){t(n.takeRecords()),i(!0)}),lP(function(){xP=NP(),PP.length=0,DP.clear(),r=uP("INP"),i=dP(s,r,UP,a.reportAllChanges)}))}))}function XR(e){VP=VP.concat(e),WP()}function ZR(){10<zP.size&&zP.forEach(function(e,t){DP.has(t)||zP.delete(t)});var r=PP.map(function(e){return BP.get(e.entries[0])}),n=qP.length-50;qP=qP.filter(function(e,t){return n<=t||r.includes(e)});for(var i=new Set,e=0;e<qP.length;e++){var t=qP[e];HP(t.startTime,t.processingEnd).forEach(function(e){i.add(e)})}var s=VP.length-1-50;VP=VP.filter(function(e,t){return e.startTime>jP&&s<t||i.has(e)}),KP=-1}function eP(l,e){nP=nP||cP("long-animation-frame",XR),JR(function(e){t=(e=e).entries[0],o=BP.get(t),r=t.processingStart,n=o.processingEnd,o=o.entries.sort(function(e,t){return e.processingStart-t.processingStart}),i=HP(t.startTime,n),s=(s=e.entries.find(function(e){return e.target}))&&s.target||zP.get(t.interactionId),a=[t.startTime+t.duration,n].concat(i.map(function(e){return e.startTime+e.duration})),a=Math.max.apply(Math,a),s={interactionTarget:QR(s),interactionTargetElement:s,interactionType:t.name.startsWith("key")?"keyboard":"pointer",interactionTime:t.startTime,nextPaintTime:a,processedEventEntries:o,longAnimationFrameEntries:i,inputDelay:r-t.startTime,processingDuration:n-r,presentationDelay:Math.max(a-n,0),loadState:$R(t.startTime)};var t,r,n,i,s,a,o=Object.assign(e,{attribution:s});l(o)},e)}function tP(h,e){var a,o;a=function(e){o={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:(e=e).value},e.entries.length&&(t=iP())&&(a=t.activationStart||0,n=(r=e.entries[e.entries.length-1]).url&&performance.getEntriesByType("resource").filter(function(e){return e.name===r.url})[0],l=Math.max(0,t.responseStart-a),i=Math.max(l,n?(n.requestStart||n.startTime)-a:0),s=Math.max(i,n?n.responseEnd-a:0),a=Math.max(s,r.startTime-a),o={element:QR(r.element),timeToFirstByte:l,resourceLoadDelay:i-l,resourceLoadDuration:s-i,elementRenderDelay:a-s,navigationEntry:t,lcpEntry:r},r.url&&(o.url=r.url),n)&&(o.lcpResourceEntry=n);var t,r,n,i,s,a,o,l=Object.assign(e,{attribution:o});h(l)},o=e||{},IP(function(){function e(e){(e=o.reportAllChanges?e:e.slice(-1)).forEach(function(e){e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-hP(),0),i.entries=[e],t())})}var t,r,n=bP(),i=uP("LCP"),s=cP("largest-contentful-paint",e);s&&(t=dP(a,i,GP,o.reportAllChanges),r=gP(function(){$P[i.id]||(e(s.takeRecords()),s.disconnect(),$P[i.id]=!0,t(!0))}),["keydown","click"].forEach(function(e){addEventListener(e,function(){return FP(r)},{once:!0,capture:!0})}),fP(r),lP(function(e){i=uP("LCP"),t=dP(a,i,GP,o.reportAllChanges),pP(function(){i.value=performance.now()-e.timeStamp,$P[i.id]=!0,t(!0)})}))})}var rP,nP,iP=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&0<e.responseStart&&e.responseStart<performance.now())return e},sP=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},aP=-1,oP=function(){return aP},lP=function(t){addEventListener("pageshow",function(e){e.persisted&&(aP=e.timeStamp,t(e))},!0)},hP=function(){var e=iP();return e&&e.activationStart||0},uP=function(e,t){var r=iP(),n="navigate";return 0<=oP()?n="back-forward-cache":r&&(document.prerendering||0<hP()?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},cP=function(e,t,r){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(e))return(n=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},r||{})),n}catch(e){}},dP=function(t,r,n,i){var s,a;return function(e){0<=r.value&&(e||i)&&((a=r.value-(s||0))||void 0===s)&&(s=r.value,r.delta=a,r.rating=(e=r.value)>n[1]?"poor":e>n[0]?"needs-improvement":"good",t(r))}},pP=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},fP=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},gP=function(e){var t=!1;return function(){t||(e(),t=!0)}},mP=-1,vP=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},_P=function(e){"hidden"===document.visibilityState&&-1<mP&&(mP="visibilitychange"===e.type?e.timeStamp:0,wP())},yP=function(){addEventListener("visibilitychange",_P,!0),addEventListener("prerenderingchange",_P,!0)},wP=function(){removeEventListener("visibilitychange",_P,!0),removeEventListener("prerenderingchange",_P,!0)},bP=function(){return mP<0&&(mP=vP(),yP(),lP(function(){setTimeout(function(){mP=vP(),yP()},0)})),{get firstHiddenTime(){return mP}}},IP=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},TP=[1800,3e3],EP=[.1,.25],CP=0,SP=1/0,kP=0,AP=function(e){e.forEach(function(e){e.interactionId&&(SP=Math.min(SP,e.interactionId),kP=Math.max(kP,e.interactionId),CP=kP?(kP-SP)/7+1:0)})},NP=function(){return rP?CP:performance.interactionCount||0},RP=function(){"interactionCount"in performance||(rP=rP||cP("event",AP,{type:"event",buffered:!0,durationThreshold:0}))},PP=[],DP=new Map,xP=0,OP=function(){var e=Math.min(PP.length-1,Math.floor((NP()-xP)/50));return PP[e]},MP=[],LP=function(t){var e,r;MP.forEach(function(e){return e(t)}),!t.interactionId&&"first-input"!==t.entryType||(r=PP[PP.length-1],((e=DP.get(t.interactionId))||PP.length<10||t.duration>r.latency)&&(e?t.duration>e.latency?(e.entries=[t],e.latency=t.duration):t.duration===e.latency&&t.startTime===e.entries[0].startTime&&e.entries.push(t):(r={id:t.interactionId,latency:t.duration,entries:[t]},DP.set(r.id,r),PP.push(r)),PP.sort(function(e,t){return t.latency-e.latency}),10<PP.length)&&PP.splice(10).forEach(function(e){return DP.delete(e.id)}))},FP=function(e){var t=self.requestIdleCallback||self.setTimeout,r=-1;return e=gP(e),"hidden"===document.visibilityState?e():(r=t(e),fP(e)),r},UP=[200,500],VP=[],qP=[],jP=0,BP=new WeakMap,zP=new Map,KP=-1,WP=function(){KP<0&&(KP=FP(ZR))},HP=(MP.push(function(e){e.interactionId&&e.target&&!zP.has(e.interactionId)&&zP.set(e.interactionId,e.target)},function(e){var t,r=e.startTime+e.duration;jP=Math.max(jP,e.processingEnd);for(var n=qP.length-1;0<=n;n--){var i=qP[n];if(Math.abs(r-i.renderTime)<=8){(t=i).startTime=Math.min(e.startTime,t.startTime),t.processingStart=Math.min(e.processingStart,t.processingStart),t.processingEnd=Math.max(e.processingEnd,t.processingEnd),t.entries.push(e);break}}t||(t={startTime:e.startTime,processingStart:e.processingStart,processingEnd:e.processingEnd,renderTime:r,entries:[e]},qP.push(t)),!e.interactionId&&"first-input"!==e.entryType||BP.set(e,t),WP()}),function(e,t){for(var r,n=[],i=0;r=VP[i];i++)if(!(r.startTime+r.duration<e)){if(r.startTime>t)break;n.push(r)}return n}),GP=[2500,4e3],$P={};let QP="@firebase/performance",YP="0.7.5",JP=YP,XP="FB-PERF-TRACE-MEASURE",ZP="@firebase/performance/config",eD="@firebase/performance/configexpire";var tD,t,r,rD,e="Performance";let nD=new ye("performance",e,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),iD=new et(e);iD.logLevel=c.INFO;let sD,aD;class oD{constructor(e){if(!(this.window=e))throw nD.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=tP,this.onINP=eP,this.onCLS=YR}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,r){this.performance&&this.performance.measure&&this.performance.measure(e,t,r)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&ve()?!!ge()||(iD.info("IndexedDB is not supported by current browser"),!1):(iD.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,r){this.PerformanceObserver&&new this.PerformanceObserver(e=>{for(var t of e.getEntries())r(t)}).observe({entryTypes:[e]})}static getInstance(){return sD=void 0===sD?new oD(aD):sD}}let lD;function hD(e,t){var r=e.length-t.length;if(r<0||1<r)throw nD.create("invalid String merger input");var n=[];for(let i=0;i<e.length;i++)n.push(e.charAt(i)),t.length>i&&n.push(t.charAt(i));return n.join("")}let uD;class cD{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=hD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=hD("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return uD=void 0===uD?new cD:uD}}(t=tD=tD||{})[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN";let dD=["firebase_","google_","ga_"],pD=new RegExp("^[a-zA-Z]\\w*$");function fD(e){var t=null==(t=e.options)?void 0:t.appId;if(t)return t;throw nD.create("no app id")}let gD="0.0.1",mD={loggingEnabled:!0},vD="FIREBASE_INSTALLATIONS_AUTH";function _D(e,t){var n,i,r=(()=>{var e=oD.getInstance().localStorage;if(e){var t=e.getItem(eD);if(t&&(e=>Number(e)>Date.now())(t)){t=e.getItem(ZP);if(t)try{return JSON.parse(t)}catch(e){}}}})();return r?(wD(r),Promise.resolve()):(i=t,(e=>{var t=e.getToken();return t.then(e=>{}),t})((n=e).installations).then(e=>{var t=(e=>{var t=null==(t=e.options)?void 0:t.projectId;if(t)return t;throw nD.create("no project id")})(n.app),r=(e=>{var t=null==(t=e.options)?void 0:t.apiKey;if(t)return t;throw nD.create("no api key")})(n.app),t=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=`+r,{method:"POST",headers:{Authorization:vD+" "+e},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:fD(n.app),app_version:JP,sdk_version:gD})});return fetch(t).then(e=>{if(e.ok)return e.json();throw nD.create("RC response not ok")})}).catch(()=>{iD.info(yD)}).then(wD).then(e=>{var t;e=e,t=oD.getInstance().localStorage,e&&t&&(t.setItem(ZP,JSON.stringify(e)),t.setItem(eD,String(Date.now()+60*cD.getInstance().configTimeToLive*60*1e3)))},()=>{}))}let yD="Could not fetch config, will use default configs";function wD(e){var t,r;return e&&(t=cD.getInstance(),void 0!==(r=e.entries||{}).fpr_enabled?t.loggingEnabled="true"===String(r.fpr_enabled):t.loggingEnabled=mD.loggingEnabled,r.fpr_log_source?t.logSource=Number(r.fpr_log_source):mD.logSource&&(t.logSource=mD.logSource),r.fpr_log_endpoint_url?t.logEndPointUrl=r.fpr_log_endpoint_url:mD.logEndPointUrl&&(t.logEndPointUrl=mD.logEndPointUrl),r.fpr_log_transport_key?t.transportKey=r.fpr_log_transport_key:mD.transportKey&&(t.transportKey=mD.transportKey),void 0!==r.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(r.fpr_vc_network_request_sampling_rate):void 0!==mD.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=mD.networkRequestsSamplingRate),void 0!==r.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(r.fpr_vc_trace_sampling_rate):void 0!==mD.tracesSamplingRate&&(t.tracesSamplingRate=mD.tracesSamplingRate),t.logTraceAfterSampling=bD(t.tracesSamplingRate),t.logNetworkAfterSampling=bD(t.networkRequestsSamplingRate)),e}function bD(e){return Math.random()<=e}let ID=1,TD;function ED(e){var r;return ID=2,TD=TD||(r=e,(()=>{let r=oD.getInstance().document;return new Promise(t=>{if(r&&"complete"!==r.readyState){let e=()=>{"complete"===r.readyState&&(r.removeEventListener("readystatechange",e),t())};r.addEventListener("readystatechange",e)}else t()})})().then(()=>{return e=r.installations,(t=e.getId()).then(e=>{lD=e}),t;var e,t}).then(e=>_D(r,e)).then(()=>CD(),()=>CD()))}function CD(){ID=3}let SD=1e4,kD=1e3,AD=3,ND=AD,RD=[],PD=!1;function DD(e){setTimeout(()=>{ND<=0||(0<RD.length&&xD(),DD(SD))},e)}function xD(){let e=RD.splice(0,kD);var t,r,n=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:cD.getInstance().logSource,log_event:n};t=n,n=cD.getInstance().getFlTransportFullUrl(),r=JSON.stringify(t),(navigator.sendBeacon&&navigator.sendBeacon(n,r)?Promise.resolve():fetch(n,{method:"POST",body:r,keepalive:!0}).then()).then(()=>{ND=AD}).catch(()=>{RD=[...e,...RD],ND--,iD.info(`Tries left: ${ND}.`),DD(SD)})}function OD(t){return(...e)=>{e={message:t(...e),eventTime:Date.now()};if(!e.eventTime||!e.message)throw nD.create("invalid cc log");RD=[...RD,e]}}function MD(){for(;0<RD.length;)xD()}let LD;function FD(e,t){(LD=LD||{send:OD(qD),flush:MD}).send(e,t)}function UD(e){var t=cD.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&oD.getInstance().requiredApisAvailable()&&(3===ID?VD(e):ED(e.performanceController).then(()=>VD(e),()=>VD(e)))}function VD(e){var t;lD&&(t=cD.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&FD(e,1)}function qD(e,t){var r,n;return 0===t?(r={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},r={application_info:jD(e.performanceController.app),network_request_metric:r},JSON.stringify(r)):(r={name:(t=e).name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs},0!==Object.keys(t.counters).length&&(r.counters=t.counters),n=t.getAttributes(),0!==Object.keys(n).length&&(r.custom_attributes=n),n={application_info:jD(t.performanceController.app),trace_metric:r},JSON.stringify(n))}function jD(e){return{google_app_id:fD(e),app_instance_id:lD,web_app_info:{sdk_version:JP,page_url:oD.getInstance().getUrl(),service_worker_status:null!=(t=oD.getInstance().navigator)&&t.serviceWorker?t.serviceWorker.controller?2:3:1,visibility_state:(()=>{switch(oD.getInstance().document.visibilityState){case"visible":return tD.VISIBLE;case"hidden":return tD.HIDDEN;default:return tD.UNKNOWN}})(),effective_connection_type:(()=>{var e=oD.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}})()},application_process_state:0};var t}function BD(e,t){var r,n,i,s=t;s&&void 0!==s.responseStart&&(i=oD.getInstance().getTimeOrigin(),i=Math.floor(1e3*(s.startTime+i)),r=s.responseStart?Math.floor(1e3*(s.responseStart-s.startTime)):void 0,n=Math.floor(1e3*(s.responseEnd-s.startTime)),s={performanceController:e,url:s.name&&s.name.split("?")[0],responsePayloadBytes:s.transferSize,startTimeUs:i,timeToResponseInitiatedUs:r,timeToResponseCompletedUs:n},t=s,(i=cD.getInstance()).instrumentationEnabled)&&(r=t.url,n=i.logEndPointUrl.split("?")[0],s=i.flTransportEndpointUrl.split("?")[0],r!==n)&&r!==s&&i.loggingEnabled&&i.logNetworkAfterSampling&&FD(t,0)}let zD=["_fp","_fcp","_fid","_lcp","_cls","_inp"];class KD{constructor(e,t,r=!1,n){this.performanceController=e,this.name=t,this.isAuto=r,this.state=1,this.customAttributes={},this.counters={},this.api=oD.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-`+this.name,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-`+this.name,this.traceMeasure=n||`${XP}-${this.randomId}-`+this.name,n&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw nD.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw nD.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),UD(this)}record(e,t,r){if(e<=0)throw nD.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw nD.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),r&&r.attributes&&(this.customAttributes=Object.assign({},r.attributes)),r&&r.metrics)for(var n of Object.keys(r.metrics))isNaN(Number(r.metrics[n]))||(this.counters[n]=Math.floor(Number(r.metrics[n])));UD(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,i=this.name,0===n.length||100<n.length||!(i&&i.startsWith("_wt_")&&-1<zD.indexOf(n))&&n.startsWith("_"))throw nD.create("invalid custom metric name",{customMetricName:e});var r,n,i;this.counters[e]=(i=null!=t?t:0,(r=Math.floor(i))<i&&iD.info(`Metric value should be an Integer, setting the value as : ${r}.`),r)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var r,n,i=!(0===(r=e).length||40<r.length||dD.some(e=>r.startsWith(e))||!r.match(pD)),s=0!==(n=t).length&&n.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw nD.create("invalid attribute name",{attributeName:e});if(!s)throw nD.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,r,n,i){var s=oD.getInstance().getUrl();if(s){var s=new KD(e,"_wt_"+s,!0),a=Math.floor(1e3*oD.getInstance().getTimeOrigin());s.setStartTime(a),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));r&&((a=r.find(e=>"first-paint"===e.name))&&a.startTime&&s.putMetric("_fp",Math.floor(1e3*a.startTime)),(a=r.find(e=>"first-contentful-paint"===e.name))&&a.startTime&&s.putMetric("_fcp",Math.floor(1e3*a.startTime)),i)&&s.putMetric("_fid",Math.floor(1e3*i)),this.addWebVitalMetric(s,"_lcp","lcp_element",n.lcp),this.addWebVitalMetric(s,"_cls","cls_largestShiftTarget",n.cls),this.addWebVitalMetric(s,"_inp","inp_interactionTarget",n.inp),UD(s),LD&&LD.flush()}}static addWebVitalMetric(e,t,r,n){n&&(e.putMetric(t,Math.floor(1e3*n.value)),n.elementAttribution)&&e.putAttribute(r,n.elementAttribution)}static createUserTimingTrace(e,t){UD(new KD(e,t,!1,t))}}let WD={},HD=!1,GD;function $D(n){lD&&(setTimeout(()=>{{var t=n;let e=oD.getInstance();"onpagehide"in window?e.document.addEventListener("pagehide",()=>YD(t)):e.document.addEventListener("unload",()=>YD(t)),e.document.addEventListener("visibilitychange",()=>{"hidden"===e.document.visibilityState&&YD(t)}),e.onFirstInputDelay&&e.onFirstInputDelay(e=>{GD=e}),e.onLCP(e=>{var t;WD.lcp={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.element}}),e.onCLS(e=>{var t;WD.cls={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.largestShiftTarget}}),e.onINP(e=>{var t;WD.inp={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.interactionTarget}})}},0),setTimeout(()=>{var e,t=n,r=oD.getInstance();for(e of r.getEntriesByType("resource"))BD(t,e);r.setupObserver("resource",e=>BD(t,e))},0),setTimeout(()=>{var e,t=n,r=oD.getInstance();for(e of r.getEntriesByType("measure"))QD(t,e);r.setupObserver("measure",e=>QD(t,e))},0))}function QD(e,t){var r=t.name;r.substring(0,XP.length)!==XP&&KD.createUserTimingTrace(e,r)}function YD(r){if(!HD){HD=!0;var n=oD.getInstance();let e=n.getEntriesByType("navigation"),t=n.getEntriesByType("paint");setTimeout(()=>{KD.createOobTrace(r,e,t,WD,GD)},0)}}class JD{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),oD.getInstance().requiredApisAvailable()?me().then(e=>{e&&(PD||(DD(5500),PD=!0),ED(this).then(()=>$D(this),()=>$D(this)),this.initialized=!0)}).catch(e=>{iD.info("Environment doesn't support IndexedDB: "+e)}):iD.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){cD.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return cD.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){cD.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return cD.getInstance().dataCollectionEnabled}}let XD="[DEFAULT]";let ZD=(e,{options:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(r.name!==XD)throw nD.create("FB not default");if("undefined"==typeof window)throw nD.create("no window");e=window,aD=e;r=new JD(r,n);return r._init(t),r};Pt(new u("performance",ZD,"PUBLIC")),d(QP,YP),d(QP,YP,"esm2017");class ex{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=w(t),new KD(t,e);var t}}function tx(e){var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("performance").getImmediate();return new ex(t,r)}(r=or).INTERNAL.registerComponent(new u("performance-compat",tx,"PUBLIC")),r.registerVersion("@firebase/performance-compat","0.2.18");let rx="@firebase/remote-config";class nx{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let ix=new ye("remoteconfig","Remote Config",{"already-initialized":"Remote Config already initialized","registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser","custom-signal-max-allowed-signals":"Setting more than {$maxSignals} custom signals is not supported."});let sx=["1","true","t","yes","y","on"];class ax{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=sx.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return e=isNaN(e)?0:e}getSource(){return this._source}}async function ox(e){var t=w(e),[r,n]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(r&&r.config&&r.eTag&&r.eTag!==n)&&(await Promise.all([t._storageCache.setActiveConfig(r.config),t._storage.setActiveConfigEtag(r.eTag)]),!0)}function lx(e){let t=w(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function hx(t){var r=w(t);let e=new nx;setTimeout(async()=>{e.abort()},r.settings.fetchTimeoutMillis);var n,i=r._storageCache.getCustomSignals();i&&r._logger.debug("Fetching config with custom signals: "+JSON.stringify(i));try{await r._client.fetch({cacheMaxAgeMillis:r.settings.minimumFetchIntervalMillis,signal:e,customSignals:i}),await r._storageCache.setLastFetchStatus("success")}catch(e){t="fetch-throttle";i=(n=e)instanceof _e&&-1!==n.code.indexOf(t)?"throttle":"failure";throw await r._storageCache.setLastFetchStatus(i),e}}function ux(r){var e,t,n=w(r);return[e={},t={}]=[n._storageCache.getActiveConfig(),n.defaultConfig],Object.keys(Object.assign(Object.assign({},e),t)).reduce((e,t)=>(e[t]=cx(r,t),e),{})}function cx(e,t){var r=w(e),n=(r._isInitializationComplete||r._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value."),r._storageCache.getActiveConfig());return n&&void 0!==n[t]?new ax("remote",n[t]):r.defaultConfig&&void 0!==r.defaultConfig[t]?new ax("default",String(r.defaultConfig[t])):(r._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new ax("static"))}class dx{constructor(e,t,r,n){this.client=e,this.storage=t,this.storageCache=r,this.logger=n}isCachedDataFresh(e,t){var r;return t?(r=Date.now()-t,this.logger.debug("Config fetch cache check."+` Cache age millis: ${r}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r=r<=e}.`),r):(this.logger.debug("Config fetch cache check. Cache unpopulated."),!1)}async fetch(e){var[t,r]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(r&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return r;e.eTag=r&&r.eTag;t=await this.client.fetch(e),r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===t.status&&r.push(this.storage.setLastSuccessfulFetchResponse(t)),await Promise.all(r),t}}class px{constructor(e,t,r,n,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=r,this.projectId=n,this.apiKey=i,this.appId=s}async fetch(r){var e,[t,n]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=`+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":r.eTag||"*"},t={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:n,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language,custom_signals:r.customSignals},n={method:"POST",headers:s,body:JSON.stringify(t)},s=fetch(i,n),t=new Promise((e,t)=>{r.signal.addEventListener(()=>{var e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([s,t]),a=await s}catch(e){let t="fetch-client-network";throw"AbortError"===(null==e?void 0:e.name)&&(t="fetch-timeout"),ix.create(t,{originalErrorMessage:null==e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let l,h;if(200===a.status){let e;try{e=await a.json()}catch(e){throw ix.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}l=e.entries,h=e.state}if("INSTANCE_STATE_UNSPECIFIED"===h?o=500:"NO_CHANGE"===h?o=304:"NO_TEMPLATE"!==h&&"EMPTY_CONFIG"!==h||(l={}),304!==o&&200!==o)throw ix.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:l}}}class fx{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:r}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var r=Math.max(s-Date.now(),0);let n=setTimeout(e,r);i.addEventListener(()=>{clearTimeout(n),t(ix.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var n=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),n}catch(e){if((e=>{var t;return e instanceof _e&&e.customData&&(429===(t=Number(e.customData.httpStatus))||500===t||503===t||504===t)})(e))return n={throttleEndTimeMillis:Date.now()+We(r),backoffCount:r+1},await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n);throw e}}}class gx{get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}constructor(e,t,r,n,i){this.app=e,this._client=t,this._storageCache=r,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}}function mx(e,t){var r=e.target.error||void 0;return ix.create(t,{originalErrorMessage:r&&(null==r?void 0:r.message)})}let vx="app_namespace_store";class _x{getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}getCustomSignals(){return this.get("custom_signals")}}class yx extends _x{constructor(e,t,r,n=(()=>new Promise((t,r)=>{try{var e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{r(mx(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{var t=e.target.result;0===e.oldVersion&&t.createObjectStore(vx,{keyPath:"compositeKey"})}}catch(e){r(ix.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}))()){super(),this.appId=e,this.appName=t,this.namespace=r,this.openDbPromise=n}async setCustomSignals(e){var t=(await this.openDbPromise).transaction([vx],"readwrite"),r=bx(e,await this.getWithTransaction("custom_signals",t)||{});return await this.setWithTransaction("custom_signals",r,t),r}async getWithTransaction(s,a){return new Promise((r,t)=>{var e=a.objectStore(vx),n=this.createCompositeKey(s);try{var i=e.get(n);i.onerror=e=>{t(mx(e,"storage-get"))},i.onsuccess=e=>{var t=e.target.result;r(t?t.value:void 0)}}catch(e){t(ix.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async setWithTransaction(s,a,o){return new Promise((e,t)=>{var r=o.objectStore(vx),n=this.createCompositeKey(s);try{var i=r.put({compositeKey:n,value:a});i.onerror=e=>{t(mx(e,"storage-set"))},i.onsuccess=()=>{e()}}catch(e){t(ix.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async get(e){var t=(await this.openDbPromise).transaction([vx],"readonly");return this.getWithTransaction(e,t)}async set(e,t){var r=(await this.openDbPromise).transaction([vx],"readwrite");return this.setWithTransaction(e,t,r)}async delete(s){let a=await this.openDbPromise;return new Promise((e,t)=>{var r=a.transaction([vx],"readwrite").objectStore(vx),n=this.createCompositeKey(s);try{var i=r.delete(n);i.onerror=e=>{t(mx(e,"storage-delete"))},i.onsuccess=()=>{e()}}catch(e){t(ix.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class wx extends _x{constructor(){super(...arguments),this.storage={}}async get(e){return Promise.resolve(this.storage[e])}async set(e,t){return this.storage[e]=t,Promise.resolve(void 0)}async delete(e){return this.storage[e]=void 0,Promise.resolve()}async setCustomSignals(e){var t=this.storage.custom_signals||{};return this.storage.custom_signals=bx(e,t),Promise.resolve(this.storage.custom_signals)}}function bx(e,t){var r=Object.assign(Object.assign({},t),e),r=Object.fromEntries(Object.entries(r).filter(([,e])=>null!==e).map(([e,t])=>"number"==typeof t?[e,t.toString()]:[e,t]));if(100<Object.keys(r).length)throw ix.create("custom-signal-max-allowed-signals",{maxSignals:100});return r}class Ix{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}getCustomSignals(){return this.customSignals}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),n=this.storage.getCustomSignals(),e=await e,e=(e&&(this.lastFetchStatus=e),await t),t=(e&&(this.lastSuccessfulFetchTimestampMillis=e),await r),e=(t&&(this.activeConfig=t),await n);e&&(this.customSignals=e)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}async setCustomSignals(e){this.customSignals=await this.storage.setCustomSignals(e)}}async function Tx(){if(!ge())return!1;try{return await me()}catch(e){return!1}}Pt(new u("remote-config",function(e,{options:t}){var r=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate(),{projectId:i,apiKey:s,appId:a}=r.options;if(!i)throw ix.create("registration-project-id");if(!s)throw ix.create("registration-api-key");if(!a)throw ix.create("registration-app-id");var o=(null==t?void 0:t.templateId)||"firebase",l=ge()?new yx(a,r.name,o):new wx,h=new Ix(l),u=new et(rx),n=(u.logLevel=c.ERROR,new px(n,Ut,o,i,s,a)),o=new fx(n,l),i=new dx(o,l,h,u),s=new gx(r,i,h,l,u);return lx(s),s},"PUBLIC").setMultipleInstances(!0)),d(rx,"0.6.3"),d(rx,"0.6.3","esm2017");class Ex{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return ox(this._delegate)}ensureInitialized(){return lx(this._delegate)}fetch(){return hx(this._delegate)}fetchAndActivate(){return(async e=>(await hx(e=w(e)),ox(e)))(this._delegate)}getAll(){return ux(this._delegate)}getBoolean(e){return cx(w(this._delegate),e).asBoolean()}getNumber(e){return cx(w(this._delegate),e).asNumber()}getString(e){return cx(w(this._delegate),e).asString()}getValue(e){return cx(this._delegate,e)}setLogLevel(e){var t=this._delegate,r=w(t);switch(e){case"debug":r._logger.logLevel=c.DEBUG;break;case"silent":r._logger.logLevel=c.SILENT;break;default:r._logger.logLevel=c.ERROR}}}function Cx(e,{instanceIdentifier:t}){var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("remote-config").getImmediate({identifier:t});return new Ex(r,n)}return(rD=or).INTERNAL.registerComponent(new u("remoteConfig-compat",Cx,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:Tx})),rD.registerVersion("@firebase/remote-config-compat","0.2.16"),console.warn(`
=======
((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()})(this,function(){let n=()=>{},i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},g=function(e,t){if(!e)throw j(t)},j=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},s=function(t){var r=[];let n=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?r[n++]=e:(e<2048?r[n++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),r[n++]=e>>18|240,r[n++]=e>>12&63|128):r[n++]=e>>12|224,r[n++]=e>>6&63|128),r[n++]=63&e|128)}return r},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let u=0;u<r.length;u+=3){var s=r[u],a=u+1<r.length,o=a?r[u+1]:0,l=u+2<r.length,h=l?r[u+2]:0;let e=(15&o)<<2|h>>6,t=63&h;l||(t=64,a)||(e=64),i.push(n[s>>2],n[(3&s)<<4|o>>4],n[e],n[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(r,n){if(this.HAS_NATIVE_SUPPORT&&!n)return atob(r);{var i=this.decodeStringToByteArray(r,n);var s=[];let e=0,t=0;for(;e<i.length;){var a,o,l,h=i[e++];h<128?s[t++]=String.fromCharCode(h):191<h&&h<224?(a=i[e++],s[t++]=String.fromCharCode((31&h)<<6|63&a)):239<h&&h<365?(a=((7&h)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,s[t++]=String.fromCharCode(55296+(a>>10)),s[t++]=String.fromCharCode(56320+(1023&a))):(o=i[e++],l=i[e++],s[t++]=String.fromCharCode((15&h)<<12|(63&o)<<6|63&l))}return s.join("");return}},decodeStringToByteArray(e,t){this.init_();var r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let l=0;l<e.length;){var i=r[e.charAt(l++)],s=l<e.length?r[e.charAt(l)]:0,a=++l<e.length?r[e.charAt(l)]:64,o=++l<e.length?r[e.charAt(l)]:64;if(++l,null==i||null==s||null==a||null==o)throw new B;n.push(i<<2|s>>4),64!==a&&(n.push(s<<4&240|a>>2),64!==o)&&n.push(a<<6&192|o)}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class B extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function o(e){var t=s(e);return a.encodeByteArray(t,!0)}let z=function(e){return o(e).replace(/\./g,"")},K=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function W(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=W(e[r],t[r]));return e}function H(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}let G=()=>H().__FIREBASE_DEFAULTS__,$=()=>{var e;return"undefined"!=typeof process&&void 0!==process.env&&(e=process.env.__FIREBASE_DEFAULTS__)?JSON.parse(e):void 0},Q=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&K(e[1]);return t&&JSON.parse(t)}},Y=()=>{try{return n()||G()||$()||Q()}catch(e){console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},J=()=>{var e;return null==(e=Y())?void 0:e.config};var c,X;class Z{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(r){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof r&&(this.promise.catch(()=>{}),1===r.length?r(e):r(e,t))}}}function ee(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(i)return r=Object.assign({iss:"https://securetoken.google.com/"+r,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[z(JSON.stringify({alg:"none",type:"JWT"})),z(JSON.stringify(r)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}function te(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function re(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(te())}function ne(){var e=null==(e=Y())?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ie(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function se(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ae(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function oe(){var e=te();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function le(){return!0===i.NODE_ADMIN}function he(){return!ne()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ue(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ce(){return new Promise((n,i)=>{try{let e=!0,t="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(t);r.onsuccess=()=>{r.result.close(),e||self.indexedDB.deleteDatabase(t),n(!0)},r.onupgradeneeded=()=>{e=!1},r.onerror=()=>{var e;i((null==(e=r.error)?void 0:e.message)||"")}}catch(e){i(e)}})}function de(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class pe extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,pe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fe.prototype.create)}}class fe{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,r=t[0]||{},i=this.service+"/"+e,s=this.errors[e],s=s?(n=r,s.replace(ge,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",s=this.serviceName+`: ${s} (${i}).`;return new pe(i,s,r)}}let ge=/\{\$([^}]+)}/g;function me(e){return JSON.parse(e)}function ve(e){return JSON.stringify(e)}function _e(e){let t={},r={},n={},i="";try{var s=e.split(".");t=me(K(s[0])||""),r=me(K(s[1])||""),i=s[2],n=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:n,signature:i}}function ye(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function we(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function be(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ie(e,t,r){var n,i={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=t.call(r,e[n],n,e));return i}function Te(e,t){if(e!==t){var r,n,i=Object.keys(e),s=Object.keys(t);for(r of i){if(!s.includes(r))return!1;var a=e[r],o=t[r];if(Ee(a)&&Ee(o)){if(!Te(a,o))return!1}else if(a!==o)return!1}for(n of s)if(!i.includes(n))return!1}return!0}function Ee(e){return null!==e&&"object"==typeof e}function Ce(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function ke(e){let n={};return e.replace(/^\?/,"").split("&").forEach(e=>{var t,r;e&&([t,r]=e.split("="),n[decodeURIComponent(t)]=decodeURIComponent(r))}),n}function Se(e){var t,r=e.indexOf("?");return r?(t=e.indexOf("#",r),e.substring(r,0<t?t:void 0)):""}class Ae{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(r,n){n=n||0;var i=this.W_;if("string"==typeof r)for(let e=0;e<16;e++)i[e]=r.charCodeAt(n)<<24|r.charCodeAt(n+1)<<16|r.charCodeAt(n+2)<<8|r.charCodeAt(n+3),n+=4;else for(let t=0;t<16;t++)i[t]=r[n]<<24|r[n+1]<<16|r[n+2]<<8|r[n+3],n+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],l=this.chain_[4],h,u;for(let p=0;p<80;p++){u=p<40?p<20?(h=o^s&(a^o),1518500249):(h=s^a^o,1859775393):p<60?(h=s&a|o&(s|a),2400959708):(h=s^a^o,3395469782);var c=(t<<5|t>>>27)+h+l+u+i[p]&4294967295;l=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=c}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(r,n){if(null!=r){var i=(n=void 0===n?r.length:n)-this.blockSize;let e=0;var s=this.buf_;let t=this.inbuf_;for(;e<n;){if(0===t)for(;e<=i;)this.compress_(r,e),e+=this.blockSize;if("string"==typeof r){for(;e<n;)if(s[t]=r.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<n;)if(s[t]=r[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=n}}digest(){var t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[r]=this.chain_[i]>>e&255,++r;return t}}function Ne(e,t){var r=new Re(e,t);return r.subscribe.bind(r)}class Re{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");void 0===(n=((e,t)=>{if("object"==typeof e&&null!==e)for(var r of t)if(r in e&&"function"==typeof e[r])return 1})(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=Pe),void 0===n.error&&(n.error=Pe),void 0===n.complete&&(n.complete=Pe);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount)&&void 0!==this.onNoObservers&&this.onNoObservers(this)}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Pe(){}function l(e,t,r,n){let i;var s;if(n<t?i="at least "+t:r<n&&(i=0===r?"none":"no more than "+r),i)throw s=e+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+i+".",new Error(s)}function De(e,t){return e+` failed: ${t} argument `}function xe(e,t,r,n){if((!n||r)&&"function"!=typeof r)throw new Error(De(e,t)+"must be a valid function.")}function Oe(e,t,r,n){if((!n||r)&&("object"!=typeof r||null===r))throw new Error(De(e,t)+"must be a valid context object.")}let Le=function(e){let t=0;for(let n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t},Me=1e3,Fe=2,Ue=144e5,Ve=.5;function qe(e,t=Me,r=Fe){var n=t*Math.pow(r,e),i=Math.round(Ve*n*(Math.random()-.5)*2);return Math.min(Ue,n+i)}function w(e){return e&&e._delegate?e._delegate:e}class u{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let je="[DEFAULT]";class Be{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var r=new Z;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(r=null==e?void 0:e.optional)&&r;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:je})}catch(e){}for(var[t,r]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var n=this.getOrInitializeService({instanceIdentifier:t});r.resolve(n)}catch(e){}}}}clearInstance(e=je){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){var e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=je){return this.instances.has(e)}getOptions(e=je){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(this.name+`(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var n,i,s=this.getOrInitializeService({instanceIdentifier:r,options:t});for([n,i]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(n)&&i.resolve(s);return s}onInit(e,t){var r=this.normalizeInstanceIdentifier(t);let n=null!=(i=this.onInitCallbacks.get(r))?i:new Set;n.add(e),this.onInitCallbacks.set(r,n);var i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){var r=this.onInitCallbacks.get(t);if(r)for(var n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===je?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=je){return!this.component||this.component.multipleInstances?e:je}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ze{constructor(e){this.name=e,this.providers=new Map}addComponent(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with `+this.name);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){var t;return this.providers.has(e)?this.providers.get(e):(t=new Be(e,this),this.providers.set(e,t),t)}getProviders(){return Array.from(this.providers.values())}}let Ke=[],We=((t=c=c||{})[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",{debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT}),He=c.INFO,Ge={[c.DEBUG]:"log",[c.VERBOSE]:"log",[c.INFO]:"info",[c.WARN]:"warn",[c.ERROR]:"error"},$e=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=Ge[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};class Qe{constructor(e){this.name=e,this._logLevel=He,this._logHandler=$e,this._userLogHandler=null,Ke.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in c))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?We[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,c.DEBUG,...e),this._logHandler(this,c.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,c.VERBOSE,...e),this._logHandler(this,c.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,c.INFO,...e),this._logHandler(this,c.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,c.WARN,...e),this._logHandler(this,c.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,c.ERROR,...e),this._logHandler(this,c.ERROR,...e)}}let Ye=(t,e)=>e.some(e=>t instanceof e),Je,Xe;let Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,rt=new WeakMap,nt=new WeakMap;let it={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return et.get(e);if("objectStoreNames"===t)return e.objectStoreNames||tt.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ot(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function st(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Xe=Xe||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(lt(this),e),ot(Ze.get(this))}:function(...e){return ot(n.apply(lt(this),e))}:function(e,...t){var r=n.call(lt(this),e,...t);return tt.set(r,e.sort?e.sort():[e]),ot(r)}}function at(e){var s,t;return"function"==typeof e?st(e):(e instanceof IDBTransaction&&(s=e,et.has(s)||(t=new Promise((e,t)=>{let r=()=>{s.removeEventListener("complete",n),s.removeEventListener("error",i),s.removeEventListener("abort",i)},n=()=>{e(),r()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",n),s.addEventListener("error",i),s.addEventListener("abort",i)}),et.set(s,t))),Ye(e,Je=Je||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,it):e)}function ot(e){var s,t;return e instanceof IDBRequest?(s=e,(t=new Promise((e,t)=>{let r=()=>{s.removeEventListener("success",n),s.removeEventListener("error",i)},n=()=>{e(ot(s.result)),r()},i=()=>{t(s.error),r()};s.addEventListener("success",n),s.addEventListener("error",i)})).then(e=>{e instanceof IDBCursor&&Ze.set(e,s)}).catch(()=>{}),nt.set(t,s),t):rt.has(e)?rt.get(e):((t=at(e))!==e&&(rt.set(e,t),nt.set(t,e)),t)}let lt=e=>nt.get(e);function ht(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t);var o=ot(a);return n&&a.addEventListener("upgradeneeded",e=>{n(ot(a.result),e.oldVersion,e.newVersion,ot(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}function ut(e,{blocked:t}={}){var r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",e=>t(e.oldVersion,e)),ot(r).then(()=>{})}let ct=["get","getKey","getAll","getAllKeys","count"],dt=["put","add","delete","clear"],pt=new Map;function ft(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(pt.get(t))return pt.get(t);let i=t.replace(/FromIndex$/,""),s=t!==i,a=dt.includes(i);var r;return i in(s?IDBIndex:IDBObjectStore).prototype&&(a||ct.includes(i))?(r=async function(e,...t){var r=this.transaction(e,a?"readwrite":"readonly");let n=r.store;return s&&(n=n.index(t.shift())),(await Promise.all([n[i](...t),a&&r.done]))[0]},pt.set(t,r),r):void 0}}it={...X=it,get:(e,t,r)=>ft(e,t)||X.get(e,t,r),has:(e,t)=>!!ft(e,t)||X.has(e,t)};class gt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{var t;return"VERSION"===(null==(t=e.getComponent())?void 0:t.type)?(t=e.getImmediate()).library+"/"+t.version:null}).filter(e=>e).join(" ")}}let mt="@firebase/app",vt="0.11.2",_t=new Qe("@firebase/app");let yt="[DEFAULT]",wt={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},bt=new Map,It=new Map,Tt=new Map;function Et(t,r){try{t.container.addComponent(r)}catch(e){_t.debug(`Component ${r.name} failed to register with FirebaseApp `+t.name,e)}}function Ct(e,t){e.container.addOrOverwriteComponent(t)}function kt(e){var t,r,n=e.name;if(Tt.has(n))return _t.debug(`There were multiple attempts to register component ${n}.`),!1;Tt.set(n,e);for(t of bt.values())Et(t,e);for(r of It.values())Et(r,e);return!0}function St(e,t){var r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function At(e){return void 0!==e.options}function h(e){return null!=e&&void 0!==e.settings}let Nt=new fe("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Rt{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new u("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}function Pt(e,t){var r=K(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-(new Date).getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class Dt extends Rt{constructor(e,t,r,n){var i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._serverConfig.authIdToken&&Pt(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&Pt(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,d(mt,vt,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){Mt(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Nt.create("server-app-deleted")}}let xt="11.4.0";function Ot(e,t={}){let r=e;if("object"!=typeof t){let e=t;t={name:e}}var n=Object.assign({name:yt,automaticDataCollectionEnabled:!1},t);let i=n.name;if("string"!=typeof i||!i)throw Nt.create("bad-app-name",{appName:String(i)});if(!(r=r||J()))throw Nt.create("no-options");var s=bt.get(i);if(s){if(Te(r,s.options)&&Te(n,s.config))return s;throw Nt.create("duplicate-app",{appName:i})}var a,o=new ze(i);for(a of Tt.values())o.addComponent(a);s=new Rt(r,n,o);return bt.set(i,s),s}function Lt(e=yt){var t=bt.get(e);if(!t&&e===yt&&J())return Ot();if(t)return t;throw Nt.create("no-app",{appName:e})}async function Mt(e){let t=!1;var r=e.name;bt.has(r)?(t=!0,bt.delete(r)):It.has(r)&&e.decRefCount()<=0&&(It.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function d(e,t,r){let n,i=null!=(n=wt[e])?n:e;r&&(i+="-"+r);var s,a=i.match(/\s|\//),o=t.match(/\s|\//);a||o?(s=[`Unable to register library "${i}" with version "${t}":`],a&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&s.push("and"),o&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),_t.warn(s.join(" "))):kt(new u(i+"-version",()=>({library:i,version:t}),"VERSION"))}function Ft(e,t){if(null!==e&&"function"!=typeof e)throw Nt.create("invalid-log-argument");var r,s=e,n=t;for(r of Ke){let i=null;n&&n.level&&(i=We[n.level]),r.userLogHandler=null===s?null:(e,t,...r)=>{var n=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!=i?i:e.logLevel)&&s({level:c[t].toLowerCase(),message:n,args:r,type:e.name})}}}function Ut(e){var t;t=e,Ke.forEach(e=>{e.setLogLevel(t)})}let Vt="firebase-heartbeat-database",qt=1,jt="firebase-heartbeat-store",Bt=null;function zt(){return Bt=Bt||ht(Vt,qt,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(jt)}catch(e){console.warn(e)}}}).catch(e=>{throw Nt.create("idb-open",{originalErrorMessage:e.message})})}async function Kt(e,t){try{var r=(await zt()).transaction(jt,"readwrite");await r.objectStore(jt).put(t,Wt(e)),await r.done}catch(e){e instanceof pe?_t.warn(e.message):(r=Nt.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),_t.warn(r.message))}}function Wt(e){return e.name+"!"+e.options.appId}class Ht{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new $t(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){var e,r;try{var n,i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString();let t=Gt();if(null!=(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null==(r=this._heartbeatsCache)?void 0:r.heartbeats)))if(this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some(e=>e.date===t))return this._heartbeatsCache.heartbeats.push({date:t,agent:i}),30<this._heartbeatsCache.heartbeats.length&&(n=(e=>{if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t})(this._heartbeatsCache.heartbeats),this._heartbeatsCache.heartbeats.splice(n,1)),this._storage.overwrite(this._heartbeatsCache)}catch(e){_t.warn(e)}}async getHeartbeatsHeader(){var e,t,r,n,i;try{return(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)?"":(t=Gt(),{heartbeatsToSend:r,unsentEntries:n}=((e,t=1024)=>{let r=[],n=e.slice();for(let s of e){var i=r.find(e=>e.agent===s.agent);if(i){if(i.dates.push(s.date),Qt(r)>t){i.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),Qt(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}})(this._heartbeatsCache.heartbeats),i=z(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i)}catch(e){return _t.warn(e),""}}}function Gt(){return(new Date).toISOString().substring(0,10)}class $t{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ue()&&ce().then(()=>!0).catch(()=>!1)}async read(){var e;return await this._canUseIndexedDBPromise&&null!=(e=await(async e=>{try{var t=(await zt()).transaction(jt),r=await t.objectStore(jt).get(Wt(e));return await t.done,r}catch(e){e instanceof pe?_t.warn(e.message):(t=Nt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),_t.warn(t.message))}})(this.app))&&e.heartbeats?e:{heartbeats:[]}}async overwrite(e){var t,r;if(await this._canUseIndexedDBPromise)return r=await this.read(),Kt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}async add(e){var t,r;if(await this._canUseIndexedDBPromise)return r=await this.read(),Kt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}function Qt(e){return z(JSON.stringify({version:2,heartbeats:e})).length}t="",kt(new u("platform-logger",e=>new gt(e),"PRIVATE")),kt(new u("heartbeat",e=>new Ht(e),"PRIVATE")),d(mt,vt,t),d(mt,vt,"esm2017"),d("fire-js","");var Yt=Object.freeze({__proto__:null,SDK_VERSION:xt,_DEFAULT_ENTRY_NAME:yt,_addComponent:Et,_addOrOverwriteComponent:Ct,_apps:bt,_clearComponents:function(){Tt.clear()},_components:Tt,_getProvider:St,_isFirebaseApp:At,_isFirebaseServerApp:h,_registerComponent:kt,_removeServiceInstance:function(e,t,r=yt){St(e,t).clearInstance(r)},_serverApps:It,deleteApp:Mt,getApp:Lt,getApps:function(){return Array.from(bt.values())},initializeApp:Ot,initializeServerApp:function(e,t){if(("undefined"!=typeof window||ie())&&!ie())throw Nt.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1);let r;r=At(e)?e.options:e;var n=Object.assign(Object.assign({},t),r);if(void 0!==n.releaseOnDeref&&delete n.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw Nt.create("finalization-registry-not-supported",{});var n=""+[...JSON.stringify(n)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),i=It.get(n);if(i)i.incRefCount(t.releaseOnDeref);else{var s,a=new ze(n);for(s of Tt.values())a.addComponent(s);i=new Dt(r,t,n,a),It.set(n,i)}return i},onLog:Ft,registerVersion:d,setLogLevel:Ut,FirebaseError:pe});class Jt{constructor(e,t){this._delegate=e,this.firebase=t,Et(e,new u("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Mt(this._delegate)))}_getService(e,t=yt){this._delegate.checkDestroyed();var r,n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null==(r=n.getComponent())?void 0:r.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=yt){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Et(this._delegate,e)}_addOrOverwriteComponent(e){Ct(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}let Xt=new fe("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function Zt(i){let s={},a={__esModule:!0,initializeApp:function(e,t={}){var r=Ot(e,t);if(ye(s,r.name))return s[r.name];var n=new i(r,a);return s[r.name]=n},app:o,registerVersion:d,setLogLevel:Ut,onLog:Ft,apps:null,SDK_VERSION:xt,INTERNAL:{registerComponent:function(t){let r=t.name,n=r.replace("-compat","");{var e;kt(t)&&"PUBLIC"===t.type&&(e=(e=o())=>{if("function"!=typeof e[n])throw Xt.create("invalid-app-argument",{appName:r});return e[n]()},void 0!==t.serviceProps&&W(e,t.serviceProps),a[n]=e,i.prototype[n]=function(...e){return this._getService.bind(this,r).apply(this,t.multipleInstances?e:[])})}return"PUBLIC"===t.type?a[n]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var r=t;return r},modularAPIs:Yt}};function o(e){if(e=e||yt,ye(s,e))return s[e];throw Xt.create("no-app",{appName:e})}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var er=function e(){let t=Zt(Jt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){W(t,e)},createSubscribe:Ne,ErrorFactory:fe,deepExtend:W}),t}(),e=new Qe("@firebase/app-compat");try{var tr=H();void 0!==tr.firebase&&(e.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `),nr=tr.firebase.SDK_VERSION)&&0<=nr.indexOf("LITE")&&e.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}catch(e){}let rr=er;d("@firebase/app-compat","0.2.51",void 0);rr.registerVersion("firebase","11.4.0","app-compat");var tr="@firebase/installations",nr="0.6.13";let ir=1e4,sr="w:"+nr,ar="FIS_v2",or="https://firebaseinstallations.googleapis.com/v1",lr=36e5;let hr=new fe("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ur(e){return e instanceof pe&&e.code.includes("request-failed")}function cr({projectId:e}){return or+`/projects/${e}/installations`}function dr(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function pr(e,t){var r=(await t.json()).error;return hr.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function fr({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function gr(e,{refreshToken:t}){var r=fr(e);return r.append("Authorization",(e=t,ar+" "+e)),r}async function mr(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function vr(t){return new Promise(e=>{setTimeout(e,t)})}let _r=/^[cdef][\w-]{21}$/,yr="";function wr(){try{var e=new Uint8Array(17),t=((self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16,(e=>btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_"))(e).substr(0,22));return _r.test(t)?t:yr}catch(e){return yr}}function br(e){return e.appName+"!"+e.appId}let Ir=new Map;function Tr(e,t){var r=br(e),e=(Er(r,t),r),r=(()=>(!Cr&&"BroadcastChannel"in self&&((Cr=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{Er(e.data.key,e.data.fid)}),Cr))();r&&r.postMessage({key:e,fid:t}),0===Ir.size&&Cr&&(Cr.close(),Cr=null)}function Er(e,t){var r=Ir.get(e);if(r)for(var n of r)n(t)}let Cr=null;let kr="firebase-installations-database",Sr=1,Ar="firebase-installations-store",Nr=null;function Rr(){return Nr=Nr||ht(kr,Sr,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ar)}})}async function Pr(e,t){var r=br(e),n=(await Rr()).transaction(Ar,"readwrite"),i=n.objectStore(Ar),s=await i.get(r);return await i.put(t,r),await n.done,s&&s.fid===t.fid||Tr(e,t.fid),t}async function Dr(e){var t=br(e),r=(await Rr()).transaction(Ar,"readwrite");await r.objectStore(Ar).delete(t),await r.done}async function xr(e,t){var r=br(e),n=(await Rr()).transaction(Ar,"readwrite"),i=n.objectStore(Ar),s=await i.get(r),a=t(s);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,!a||s&&s.fid===a.fid||Tr(e,a.fid),a}async function Or(r){let n;var e=await xr(r.appConfig,e=>{var t=Mr(e||{fid:wr(),registrationStatus:0}),t=((e,t)=>{var r,n;return 0===t.registrationStatus?navigator.onLine?(r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=(async(t,r)=>{try{var e=await(async({appConfig:e,heartbeatServiceProvider:t},{fid:r})=>{let n=cr(e);var i=fr(e),s=((s=t.getImmediate({optional:!0}))&&(s=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",s),{fid:r,authVersion:ar,appId:e.appId,sdkVersion:sr});let a={method:"POST",headers:i,body:JSON.stringify(s)};if((i=await mr(()=>fetch(n,a))).ok)return{fid:(s=await i.json()).fid||r,registrationStatus:2,refreshToken:s.refreshToken,authToken:dr(s.authToken)};throw await pr("Create Installation",i)})(t,r);return Pr(t.appConfig,e)}catch(e){throw ur(e)&&409===e.customData.serverCode?await Dr(t.appConfig):await Pr(t.appConfig,{fid:r.fid,registrationStatus:0}),e}})(e,r),{installationEntry:r,registrationPromise:n}):(r=Promise.reject(hr.create("app-offline")),{installationEntry:t,registrationPromise:r}):1===t.registrationStatus?{installationEntry:t,registrationPromise:(async e=>{let t=await Lr(e.appConfig);for(;1===t.registrationStatus;)await vr(100),t=await Lr(e.appConfig);var r,n;return 0!==t.registrationStatus?t:({installationEntry:r,registrationPromise:n}=await Or(e),n||r)})(e)}:{installationEntry:t}})(r,t);return n=t.registrationPromise,t.installationEntry});return e.fid===yr?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function Lr(e){return xr(e,e=>{if(e)return Mr(e);throw hr.create("installation-not-found")})}function Mr(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+ir<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function Fr({appConfig:e,heartbeatServiceProvider:t},r){[i,s]=[e,r.fid];let n=cr(i)+`/${s}/authTokens:generate`;var i,s,a=gr(e,r),o=t.getImmediate({optional:!0}),o=(o&&(o=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",o),{installation:{sdkVersion:sr,appId:e.appId}});let l={method:"POST",headers:a,body:JSON.stringify(o)};a=await mr(()=>fetch(n,l));if(a.ok)return dr(await a.json());throw await pr("Generate Auth Token",a)}async function Ur(n,i=!1){let s;var e=await xr(n.appConfig,e=>{if(!qr(e))throw hr.create("not-registered");var t,r=e.authToken;if(i||2!==(t=r).requestStatus||(e=>{var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+lr})(t)){if(1===r.requestStatus)return s=(async(e,t)=>{let r=await Vr(e.appConfig);for(;1===r.authToken.requestStatus;)await vr(100),r=await Vr(e.appConfig);var n=r.authToken;return 0===n.requestStatus?Ur(e,t):n})(n,i),e;if(navigator.onLine)return t=e,r={requestStatus:1,requestTime:Date.now()},r=Object.assign(Object.assign({},t),{authToken:r}),s=(async(t,r)=>{try{var e=await Fr(t,r),n=Object.assign(Object.assign({},r),{authToken:e});return await Pr(t.appConfig,n),e}catch(e){var i;throw!ur(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(i=Object.assign(Object.assign({},r),{authToken:{requestStatus:0}}),await Pr(t.appConfig,i)):await Dr(t.appConfig),e}})(n,r),r;throw hr.create("app-offline")}return e});return s?await s:e.authToken}function Vr(e){return xr(e,e=>{var t,r;if(qr(e))return t=e.authToken,1===(r=t).requestStatus&&r.requestTime+ir<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;throw hr.create("not-registered")})}function qr(e){return void 0!==e&&2===e.registrationStatus}async function jr(e,t=!1){var r=e,n=(await(!(n=(await Or(r)).registrationPromise)||!await n),await Ur(r,t));return n.token}function Br(e){return hr.create("missing-app-config-values",{valueName:e})}let zr="installations",Kr=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:(e=>{if(!e||!e.options)throw Br("App Configuration");if(!e.name)throw Br("App Name");var t;for(t of["projectId","apiKey","appId"])if(!e.options[t])throw Br(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}})(t),heartbeatServiceProvider:St(t,"heartbeat"),_delete:()=>Promise.resolve()}},Wr=e=>{let t=St(e.getProvider("app").getImmediate(),zr).getImmediate();return{getId:()=>(async e=>{var t=e,{installationEntry:r,registrationPromise:n}=await Or(t);return(n||Ur(t)).catch(console.error),r.fid})(t),getToken:e=>jr(t,e)}};kt(new u(zr,Kr,"PUBLIC")),kt(new u("installations-internal",Wr,"PRIVATE")),d(tr,nr),d(tr,nr,"esm2017");let Hr="analytics",Gr="firebase_id",$r="origin",Qr=6e4,Yr="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Jr="https://www.googletagmanager.com/gtag/js",Xr=new Qe("@firebase/analytics"),Zr=new fe("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function en(e){var t;return e.startsWith(Jr)?e:(t=Zr.create("invalid-gtag-resource",{gtagURL:e}),Xr.warn(t.message),"")}function tn(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function rn(e,t){var r=((e,t)=>{let r;return r=window.trustedTypes?window.trustedTypes.createPolicy(e,t):r})("firebase-js-sdk-policy",{createScriptURL:en}),n=document.createElement("script"),i=Jr+`?l=${e}&id=`+t;n.src=r?null==r?void 0:r.createScriptURL(i):i,n.async=!0,document.head.appendChild(n)}function nn(S,A,N,R){return async function(e,...t){try{if("event"===e){var[r,n]=t,i=S,s=A,a=N,o=r,l=n;try{let r=[];if(l&&l.send_to){let e=l.send_to;Array.isArray(e)||(e=[e]);var h=await tn(a);for(let t of e){var u=h.find(e=>e.measurementId===t),c=u&&s[u.appId];if(!c){r=[];break}r.push(c)}}0===r.length&&(r=Object.values(s)),await Promise.all(r),i("event",o,l||{})}catch(e){Xr.error(e)}}else if("config"===e){var d,[p,f]=t,g=S,m=A,v=N,_=p,y=f,w=R[_];try{w?await m[w]:(d=(await tn(v)).find(e=>e.measurementId===_))&&await m[d.appId]}catch(e){Xr.error(e)}g("config",_,y)}else{var b,I,T,E,C,k;"consent"===e?([b,I]=t,S("consent",b,I)):"get"===e?([T,E,C]=t,S("get",T,E,C)):"set"===e?([k]=t,S("set",k)):S(e,...t)}}catch(e){Xr.error(e)}}}let sn=30;let an=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function on(e){var t,{appId:r,apiKey:n}=e,n={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":n})},r=Yr.replace("{app-id}",r),r=await fetch(r,n);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!=(t=i.error)&&t.message&&(e=i.error.message)}catch(e){}throw Zr.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}async function ln(e,t=an,r){var{appId:n,apiKey:i,measurementId:s}=e.options;if(!n)throw Zr.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:n};throw Zr.create("no-api-key")}var a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()};let o=new cn;return setTimeout(async()=>{o.abort()},void 0!==r?r:Qr),async function i(s,{throttleEndTimeMillis:e,backoffCount:a},o,l=an){var h;let{appId:u,measurementId:c}=s;try{await hn(o,e)}catch(e){if(c)return Xr.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:u,measurementId:c};throw e}try{let e=await on(s);return l.deleteThrottleMetadata(u),e}catch(e){let t=e;if(!un(t)){if(l.deleteThrottleMetadata(u),c)return Xr.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:u,measurementId:c};throw e}let r=503===Number(null==(h=null==t?void 0:t.customData)?void 0:h.httpStatus)?qe(a,l.intervalMillis,sn):qe(a,l.intervalMillis),n={throttleEndTimeMillis:Date.now()+r,backoffCount:a+1};return l.setThrottleMetadata(u,n),Xr.debug(`Calling attemptFetch again in ${r} millis`),i(s,n,o,l)}}({appId:n,apiKey:i,measurementId:s},a,o,t)}function hn(i,s){return new Promise((e,t)=>{var r=Math.max(s-Date.now(),0);let n=setTimeout(e,r);i.addEventListener(()=>{clearTimeout(n),t(Zr.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function un(e){var t;return!!(e instanceof pe&&e.customData)&&(429===(t=Number(e.customData.httpStatus))||500===t||503===t||504===t)}class cn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function dn(t,e,r,n,i,s,a){var o=ln(t),l=(o.then(e=>{r[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Xr.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Xr.error(e)),e.push(o),(async()=>{if(!ue())return Xr.warn(Zr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await ce()}catch(e){return Xr.warn(Zr.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0})().then(e=>{if(e)return n.getId()})),[o,l]=await Promise.all([o,l]),h=((e=>{var t,r=window.document.getElementsByTagName("script");for(t of Object.values(r))if(t.src&&t.src.includes(Jr)&&t.src.includes(e))return t})(s)||rn(s,o.measurementId),i("js",new Date),null!=(h=null==a?void 0:a.config)?h:{});return h[$r]="firebase",h.update=!0,null!=l&&(h[Gr]=l),i("config",o.measurementId,h),o.measurementId}class pn{constructor(e){this.app=e}_delete(){return delete fn[this.app.options.appId],Promise.resolve()}}let fn={},gn=[],mn={},vn="dataLayer",_n="gtag",yn,wn,bn=!1;function In(e){if(bn)throw Zr.create("already-initialized");e.dataLayerName&&(vn=e.dataLayerName),e.gtagName&&(_n=e.gtagName)}function Tn(e,t,r){n=[],se()&&n.push("This is a browser extension environment."),de()||n.push("Cookies are not available."),0<n.length&&(n=n.map((e,t)=>`(${t+1}) `+e).join(" "),n=Zr.create("invalid-analytics-context",{errorInfo:n}),Xr.warn(n.message));var n=e.options.appId;if(!n)throw Zr.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Zr.create("no-api-key");Xr.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=fn[n])throw Zr.create("already-exists",{id:n});if(!bn){{var i=vn;let e=[];Array.isArray(window[i])?e=window[i]:window[i]=e,e}var{wrappedGtag:s,gtagCore:a}=((e,t,r,n,i)=>{let s=function(){window[n].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=nn(s,e,t,r),{gtagCore:s,wrappedGtag:window[i]}})(fn,gn,mn,vn,_n);wn=s,yn=a,bn=!0}return fn[n]=dn(e,gn,mn,t,yn,vn,r),new pn(e)}async function En(){if(se())return!1;if(!de())return!1;if(!ue())return!1;try{return await ce()}catch(e){return!1}}function Cn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global)return e("set",{screen_name:r}),Promise.resolve();e("config",await t,{update:!0,screen_name:r})})(wn,fn[e.app.options.appId],t,r).catch(e=>Xr.error(e))}function kn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global)return e("set",{user_id:r}),Promise.resolve();e("config",await t,{update:!0,user_id:r})})(wn,fn[e.app.options.appId],t,r).catch(e=>Xr.error(e))}function Sn(e,t,r){e=w(e),(async(e,t,r,n)=>{if(n&&n.global){var i,s={};for(i of Object.keys(r))s["user_properties."+i]=r[i];return e("set",s),Promise.resolve()}e("config",await t,{update:!0,user_properties:r})})(wn,fn[e.app.options.appId],t,r).catch(e=>Xr.error(e))}function An(e,t){e=w(e),(async(e,t)=>{var r=await e;window["ga-disable-"+r]=!t})(fn[e.app.options.appId],t).catch(e=>Xr.error(e))}function Nn(e,t,r,n){e=w(e),(async(e,t,r,n,i)=>{var s;i&&i.global?e("event",r,n):(s=await t,e("event",r,Object.assign(Object.assign({},n),{send_to:s})))})(wn,fn[e.app.options.appId],t,r,n).catch(e=>Xr.error(e))}let Rn="@firebase/analytics",Pn="0.10.12";kt(new u(Hr,(e,{options:t})=>Tn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),kt(new u("analytics-internal",function(e){try{let n=e.getProvider(Hr).getImmediate();return{logEvent:(e,t,r)=>Nn(n,e,t,r)}}catch(e){throw Zr.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),d(Rn,Pn),d(Rn,Pn,"esm2017");class Dn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,r){Nn(this._delegate,e,t,r)}setCurrentScreen(e,t){Cn(this._delegate,e,t)}setUserId(e,t){kn(this._delegate,e,t)}setUserProperties(e,t){Sn(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){An(this._delegate,e)}}(t=wm=wm||{}).ADD_SHIPPING_INFO="add_shipping_info",t.ADD_PAYMENT_INFO="add_payment_info",t.ADD_TO_CART="add_to_cart",t.ADD_TO_WISHLIST="add_to_wishlist",t.BEGIN_CHECKOUT="begin_checkout",t.CHECKOUT_PROGRESS="checkout_progress",t.EXCEPTION="exception",t.GENERATE_LEAD="generate_lead",t.LOGIN="login",t.PAGE_VIEW="page_view",t.PURCHASE="purchase",t.REFUND="refund",t.REMOVE_FROM_CART="remove_from_cart",t.SCREEN_VIEW="screen_view",t.SEARCH="search",t.SELECT_CONTENT="select_content",t.SELECT_ITEM="select_item",t.SELECT_PROMOTION="select_promotion",t.SET_CHECKOUT_OPTION="set_checkout_option",t.SHARE="share",t.SIGN_UP="sign_up",t.TIMING_COMPLETE="timing_complete",t.VIEW_CART="view_cart",t.VIEW_ITEM="view_item",t.VIEW_ITEM_LIST="view_item_list",t.VIEW_PROMOTION="view_promotion",t.VIEW_SEARCH_RESULTS="view_search_results";let xn=e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("analytics").getImmediate();return new Dn(t,r)};e={Analytics:Dn,settings:In,isSupported:En,EventName:wm},rr.INTERNAL.registerComponent(new u("analytics-compat",xn,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),rr.registerVersion("@firebase/analytics-compat","0.2.18");let On=new Map,Ln={activated:!1,tokenObservers:[]},Mn={initialized:!1,enabled:!1};function Fn(e){return On.get(e)||Object.assign({},Ln)}let Un="https://content-firebaseappcheck.googleapis.com/v1",Vn="exchangeDebugToken",qn={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class jn{constructor(e,t,r,n,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=n,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=n))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Z,this.pending.promise.catch(e=>{}),t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new Z,this.pending.promise.catch(e=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){var t;return e?(this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration()):(t=this.nextErrorWaitInterval,this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t)}}let Bn=new fe("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function zn(e=!1){var t;return e?null==(t=self.grecaptcha)?void 0:t.enterprise:self.grecaptcha}function Kn(e){if(!Fn(e).activated)throw Bn.create("use-before-activation",{appName:e.name})}function Wn(e){var t=Math.round(e/1e3),r=Math.floor(t/86400),n=Math.floor((t-3600*r*24)/3600),i=Math.floor((t-3600*r*24-3600*n)/60),t=t-3600*r*24-3600*n-60*i;let s="";return r&&(s+=Hn(r)+"d:"),n&&(s+=Hn(n)+"h:"),s+=Hn(i)+"m:"+Hn(t)+"s"}function Hn(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function Gn({url:e,body:t},r){var n={"Content-Type":"application/json"},i=r.getImmediate({optional:!0}),i=(i&&(i=await i.getHeartbeatsHeader())&&(n["X-Firebase-Client"]=i),{method:"POST",body:JSON.stringify(t),headers:n});let s;try{s=await fetch(e,i)}catch(e){throw Bn.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==s.status)throw Bn.create("fetch-status-error",{httpStatus:s.status});let a;try{a=await s.json()}catch(e){throw Bn.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var n=a.ttl.match(/^([\d.]+)(s)$/);if(n&&n[2]&&!isNaN(Number(n[1])))return i=1e3*Number(n[1]),n=Date.now(),{token:a.token,expireTimeMillis:n+i,issuedAtTimeMillis:n};throw Bn.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+a.ttl})}function $n(e,t){var{projectId:r,appId:n,apiKey:i}=e.options;return{url:`${Un}/projects/${r}/apps/${n}:${Vn}?key=`+i,body:{debug_token:t}}}let Qn="firebase-app-check-database",Yn=1,Jn="firebase-app-check-store",Xn="debug-token",Zn=null;function ei(){return Zn=Zn||new Promise((t,r)=>{try{var e=indexedDB.open(Qn,Yn);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;r(Bn.create("storage-open",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))},e.onupgradeneeded=e=>{var t=e.target.result;0===e.oldVersion&&t.createObjectStore(Jn,{keyPath:"compositeKey"})}}catch(e){r(Bn.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}async function ti(e,t){let n=(await ei()).transaction(Jn,"readwrite"),i=n.objectStore(Jn).put({compositeKey:e,value:t});return new Promise((t,r)=>{i.onsuccess=e=>{t()},n.onerror=e=>{var t;r(Bn.create("storage-set",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))}})}async function ri(e){let t=(await ei()).transaction(Jn,"readonly"),i=t.objectStore(Jn).get(e);return new Promise((r,n)=>{i.onsuccess=e=>{var t=e.target.result;r(t?t.value:void 0)},t.onerror=e=>{var t;n(Bn.create("storage-get",{originalErrorMessage:null==(t=e.target.error)?void 0:t.message}))}})}function ni(e){return e.options.appId+"-"+e.name}let ii=new Qe("@firebase/app-check");async function si(t){if(ue()){let e=void 0;try{e=await ri(ni(t))}catch(e){ii.warn("Failed to read token from IndexedDB. Error: "+e)}return e}}function ai(e,t){return ue()?ti(ni(e),t).catch(e=>{ii.warn("Failed to write token to IndexedDB. Error: "+e)}):Promise.resolve()}async function oi(){let e=void 0;try{e=await ri(Xn)}catch(e){}var t,r;return e||(t=crypto.randomUUID(),r=t,ti(Xn,r).catch(e=>ii.warn("Failed to persist debug token to IndexedDB. Error: "+e)),t)}function li(){return Mn.enabled}async function hi(){var e=Mn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}let ui={error:"UNKNOWN_ERROR"};async function ci(e,t=!1){var r,n=e.app;Kn(n);let i=Fn(n),s=i.token,a=void 0;if(s&&!mi(s)&&(i.token=void 0,s=void 0),s||(r=await i.cachedTokenPromise)&&(mi(r)?s=r:await ai(n,void 0)),!t&&s&&mi(s))return{token:s.token};let o=!1;if(li())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Gn($n(n,await hi()),e.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);var l=await i.exchangeTokenPromise;return await ai(n,l),{token:(i.token=l).token}}catch(e){return"appCheck/throttled"===e.code?ii.warn(e.message):ii.error(e),vi(e)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=await Fn(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?ii.warn(e.message):ii.error(e),a=e}let h;return s?a?h=mi(s)?{token:s.token,internalError:a}:vi(a):(h={token:s.token},await ai(n,i.token=s)):h=vi(a),o&&gi(n,h),h}function di(t,e,r,n){var i=t.app,i=Fn(i),s={next:r,error:n,type:e};if(i.tokenObservers=[...i.tokenObservers,s],i.token&&mi(i.token)){let e=i.token;Promise.resolve().then(()=>{r({token:e.token}),fi(t)}).catch(()=>{})}i.cachedTokenPromise.then(()=>fi(t))}function pi(e,t){var r=Fn(e),n=r.tokenObservers.filter(e=>e.next!==t);0===n.length&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=n}function fi(e){var t=e.app,t=Fn(t);let r=t.tokenRefresher;r||(r=(r=>{let n=r.app;return new jn(async()=>{var e=Fn(n);let t;if((t=e.token?await ci(r,!0):await ci(r)).error)throw t.error;if(t.internalError)throw t.internalError},()=>!0,()=>{var e,t=Fn(n);return t.token?(e=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,t=t.token.expireTimeMillis-3e5,e=Math.min(e,t),Math.max(0,e-Date.now())):0},qn.RETRIAL_MIN_WAIT,qn.RETRIAL_MAX_WAIT)})(e),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function gi(e,t){var r;for(r of Fn(e).tokenObservers)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch(e){}}function mi(e){return 0<e.expireTimeMillis-Date.now()}function vi(e){return{token:(t=ui,a.encodeString(JSON.stringify(t),!1)),error:e};var t}class _i{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e,t=Fn(this.app).tokenObservers;for(e of t)pi(this.app,e.next);return Promise.resolve()}}function yi(t){return{getToken:e=>ci(t,e),getLimitedUseToken:()=>(async e=>{var t=e.app,r=(Kn(t),Fn(t)).provider;return li()?{token:t=(await Gn($n(t,await hi()),e.heartbeatServiceProvider)).token}:{token:t=(await r.getToken()).token}})(t),addTokenListener:e=>di(t,"INTERNAL",e),removeTokenListener:e=>pi(t.app,e)}}let wi="https://www.google.com/recaptcha/api.js",bi="https://www.google.com/recaptcha/enterprise.js";function Ii(t,r){let n=new Z;Fn(t).reCAPTCHAState={initialized:n};let i=Ci(t);var e,s=zn(!1);return s?Ei(t,r,s,i,n):(e=()=>{var e=zn(!1);if(!e)throw new Error("no recaptcha");Ei(t,r,e,i,n)},(s=document.createElement("script")).src=wi,s.onload=e,document.head.appendChild(s)),n.promise}function Ti(t,r){let n=new Z;Fn(t).reCAPTCHAState={initialized:n};let i=Ci(t);var e,s=zn(!0);return s?Ei(t,r,s,i,n):(e=()=>{var e=zn(!0);if(!e)throw new Error("no recaptcha");Ei(t,r,e,i,n)},(s=document.createElement("script")).src=bi,s.onload=e,document.head.appendChild(s)),n.promise}function Ei(n,i,s,a,o){s.ready(()=>{var e,t,r;e=n,t=s.render(a,{sitekey:i,size:"invisible",callback:()=>{Fn(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{Fn(e).reCAPTCHAState.succeeded=!1}}),(r=Fn(e)).reCAPTCHAState=Object.assign(Object.assign({},r.reCAPTCHAState),{widgetId:t}),o.resolve(s)})}function Ci(e){var t="fire_app_check_"+e.name,r=document.createElement("div");return r.id=t,r.style.display="none",document.body.appendChild(r),t}async function ki(n){Kn(n);let i=await Fn(n).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{let r=Fn(n).reCAPTCHAState;i.ready(()=>{e(i.execute(r.widgetId,{action:"fire_app_check"}))})})}class Si{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Pi(this._throttleData);var t,r=await ki(this._app).catch(e=>{throw Bn.create("recaptcha-error")});if(null==(t=Fn(this._app).reCAPTCHAState)||!t.succeeded)throw Bn.create("recaptcha-error");let e;try{e=await Gn(((e,t)=>{var{projectId:r,appId:n,apiKey:i}=e.options;return{url:Un+`/projects/${r}/apps/${n}:exchangeRecaptchaV3Token?key=`+i,body:{recaptcha_v3_token:t}}})(this._app,r),this._heartbeatServiceProvider)}catch(e){throw null!=(t=e.code)&&t.includes("fetch-status-error")?(this._throttleData=Ri(Number(null==(r=e.customData)?void 0:r.httpStatus),this._throttleData),Bn.create("throttled",{time:Wn(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=St(e,"heartbeat"),Ii(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Si&&this._siteKey===e._siteKey}}class Ai{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Pi(this._throttleData);var t,r=await ki(this._app).catch(e=>{throw Bn.create("recaptcha-error")});if(null==(t=Fn(this._app).reCAPTCHAState)||!t.succeeded)throw Bn.create("recaptcha-error");let e;try{e=await Gn(((e,t)=>{var{projectId:r,appId:n,apiKey:i}=e.options;return{url:Un+`/projects/${r}/apps/${n}:exchangeRecaptchaEnterpriseToken?key=`+i,body:{recaptcha_enterprise_token:t}}})(this._app,r),this._heartbeatServiceProvider)}catch(e){throw null!=(t=e.code)&&t.includes("fetch-status-error")?(this._throttleData=Ri(Number(null==(r=e.customData)?void 0:r.httpStatus),this._throttleData),Bn.create("throttled",{time:Wn(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=St(e,"heartbeat"),Ti(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Ai&&this._siteKey===e._siteKey}}class Ni{constructor(e){this._customProviderOptions=e}async getToken(){var e,t=await this._customProviderOptions.getToken(),r=(e=t.token,"object"==typeof(r=_e(e).claims)&&r.hasOwnProperty("iat")?r.iat:null),r=null!==r&&r<Date.now()&&0<r?1e3*r:Date.now();return Object.assign(Object.assign({},t),{issuedAtTimeMillis:r})}initialize(e){this._app=e}isEqual(e){return e instanceof Ni&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Ri(e,t){var r,n;return 404===e||403===e?{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e}:(n=qe(r=t?t.backoffCount:0,1e3,2),{backoffCount:r+1,allowRequestsAfter:Date.now()+n,httpStatus:e})}function Pi(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Bn.create("throttled",{time:Wn(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Di(e=Lt(),r){var t=St(e=w(e),"app-check");if(Mn.initialized||(i=H(),(n=Mn).initialized=!0,"string"!=typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==i.FIREBASE_APPCHECK_DEBUG_TOKEN)||(n.enabled=!0,s=new Z,n.token=s,"string"==typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN?s.resolve(i.FIREBASE_APPCHECK_DEBUG_TOKEN):s.resolve(oi())),li()&&hi().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){var n=t.getImmediate(),i=t.getOptions();if(i.isTokenAutoRefreshEnabled===r.isTokenAutoRefreshEnabled&&i.provider.isEqual(r.provider))return n;throw Bn.create("already-initialized",{appName:e.name})}var s=t.initialize({options:r});{var a=e,o=r.provider;r=r.isTokenAutoRefreshEnabled;let t=((e,t)=>(On.set(e,t),On.get(e)))(a,Object.assign({},Ln));t.activated=!0,t.provider=o,t.cachedTokenPromise=si(a).then(e=>(e&&mi(e)&&(t.token=e,gi(a,{token:e.token})),e)),t.isTokenAutoRefreshEnabled=void 0===r?a.automaticDataCollectionEnabled:r,t.provider.initialize(a)}return Fn(e).isTokenAutoRefreshEnabled&&di(s,"INTERNAL",()=>{}),s}let xi="app-check-internal";kt(new u("app-check",e=>{var t,r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");return e=r,t=n,new _i(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider(xi).initialize()})),kt(new u(xi,e=>yi(e.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),d("@firebase/app-check","0.8.12");let Oi=new fe("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Li{constructor(e){this.app=e}activate(e,t){let r;r="string"==typeof e?new Si(e):e instanceof Ai||e instanceof Si||e instanceof Ni?e:new Ni({getToken:e.getToken}),this._delegate=Di(this.app,{provider:r,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Oi.create("use-before-activation",{appName:this.app.name});var t,r;t=this._delegate,e=e,(r=Fn(t.app)).tokenRefresher&&(!0===e?r.tokenRefresher.start():r.tokenRefresher.stop()),r.isTokenAutoRefreshEnabled=e}getToken(e){if(this._delegate)return(async(e,t)=>{var r=await ci(e,t);if(r.error)throw r.error;return{token:r.token}})(this._delegate,e);throw Oi.create("use-before-activation",{appName:this.app.name})}onTokenChanged(r,n,e){if(this._delegate){var i=this._delegate;let e=()=>{},t=()=>{};return e=null!=r.next?r.next.bind(r):r,null!=r.error?t=r.error.bind(r):n&&(t=n),di(i,"EXTERNAL",e,t),()=>pi(i.app,e)}throw Oi.create("use-before-activation",{appName:this.app.name})}}let Mi=e=>{var t=e.getProvider("app-compat").getImmediate();return new Li(t)};function Fi(e,t){var r={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}rr.INTERNAL.registerComponent(new u("appCheck-compat",Mi,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Ai,ReCaptchaV3Provider:Si,CustomProvider:Ni})),rr.registerVersion("@firebase/app-check-compat","0.3.19");let Ui={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Vi={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function qi(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function ji(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}let Bi=qi,zi=new fe("auth","Firebase",qi()),Ki=new Qe("@firebase/auth");function Wi(e,...t){Ki.logLevel<=c.ERROR&&Ki.error(`Auth (${xt}): `+e,...t)}function Hi(e,...t){throw Ji(e,...t)}function Gi(e,...t){return Ji(e,...t)}function $i(e,t,r){var n=Object.assign(Object.assign({},Bi()),{[t]:r});return new fe("auth","Firebase",n).create(t,{appName:e.name})}function Qi(e){return $i(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Yi(e,t,r){var n=r;if(!(t instanceof n))throw n.name!==t.constructor.name&&Hi(e,"argument-error"),$i(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function Ji(e,...t){var r,n;return"string"!=typeof e?(r=t[0],(n=[...t.slice(1)])[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)):zi.create(e,...t)}function m(e,t,...r){if(!e)throw Ji(t,...r)}function Xi(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Wi(t),new Error(t)}function Zi(e,t){e||Xi(t)}function es(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function ts(){return"http:"===rs()||"https:"===rs()}function rs(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class ns{constructor(e,t){Zi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=re()||ae()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ts()||se()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function is(e,t){Zi(e.emulator,"Emulator should always be set here");var r=e.emulator.url;return t?""+r+(t.startsWith("/")?t.slice(1):t):r}class ss{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Xi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Xi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Xi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}let as={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},os=new ns(3e4,6e4);function ls(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function hs(i,s,a,o,e={}){return us(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var r=Ce(Object.assign({key:i.config.apiKey},t)).slice(1),n=await i._getAdditionalHeaders(),n=(n["Content-Type"]="application/json",i.languageCode&&(n["X-Firebase-Locale"]=i.languageCode),Object.assign({method:s,headers:n},e));return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(n.referrerPolicy="no-referrer"),ss.fetch()(ds(i,i.config.apiHost,a,r),n)})}async function us(t,e,r){t._canInitEmulator=!1;var n=Object.assign(Object.assign({},as),e);try{var i=new ps(t),s=await Promise.race([r(),i.promise]),a=(i.clearNetworkTimeout(),await s.json());if("needConfirmation"in a)throw fs(t,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;var[o,l]=(s.ok?a.errorMessage:a.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===o)throw fs(t,"credential-already-in-use",a);if("EMAIL_EXISTS"===o)throw fs(t,"email-already-in-use",a);if("USER_DISABLED"===o)throw fs(t,"user-disabled",a);var h=n[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw $i(t,h,l);Hi(t,h)}catch(e){if(e instanceof pe)throw e;Hi(t,"network-request-failed",{message:String(e)})}}async function cs(e,t,r,n,i={}){var s=await hs(e,t,r,n,i);return"mfaPendingCredential"in s&&Hi(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ds(e,t,r,n){var i=""+t+r+"?"+n;return e.config.emulator?is(e.config,i):e.config.apiScheme+"://"+i}class ps{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Gi(this.auth,"network-request-failed")),os.get())})}}function fs(e,t,r){var n={appName:e.name},n=(r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber),Gi(e,t,n));return n.customData._tokenResponse=r,n}function gs(e){return void 0!==e&&void 0!==e.getResponse}function ms(e){return void 0!==e&&void 0!==e.enterprise}class vs{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(t){if(this.recaptchaEnforcementState&&0!==this.recaptchaEnforcementState.length)for(let e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t){switch(e.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function _s(e,t){return hs(e,"GET","/v2/recaptchaConfig",ls(e,t))}async function ys(e,t){return hs(e,"POST","/v1/accounts:lookup",t)}function ws(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function bs(e){return 1e3*Number(e)}function Is(e){var[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return Wi("JWT malformed, contained fewer than 3 sections"),null;try{var i=K(r);return i?JSON.parse(i):(Wi("Failed to decode base64 JWT payload"),null)}catch(e){return Wi("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Ts(e){var t=Is(e);return m(t,"internal-error"),m(void 0!==t.exp,"internal-error"),m(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Es(t,e,r=!1){if(r)return e;try{return await e}catch(e){throw e instanceof pe&&(r=[e.code][0],"auth/user-disabled"===r||"auth/user-token-expired"===r)&&(t.auth.currentUser===t&&await t.auth.signOut()),e}}class Cs{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId)&&clearTimeout(this.timerId)}getInterval(e){var t;return e?(t=this.errorBackoff,this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t):(this.errorBackoff=3e4,t=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5,Math.max(0,t))}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ks{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ws(this.lastLoginAt),this.creationTime=ws(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ss(e){var t,r,n=e.auth,i=await e.getIdToken(),i=await Es(e,ys(n,{idToken:i})),n=(m(null==i?void 0:i.users.length,n,"internal-error"),i.users[0]),i=(e._notifyReloadListener(n),null!=(i=n.providerUserInfo)&&i.length?As(n.providerUserInfo):[]),i=(t=e.providerData,r=i,[...t.filter(t=>!r.some(e=>e.providerId===t.providerId)),...r]),s=!(e.email&&n.passwordHash||null!==i&&i.length),s=!!e.isAnonymous&&s,i={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new ks(n.createdAt,n.lastLoginAt),isAnonymous:s};Object.assign(e,i)}function As(e){return e.map(e=>{var t=e.providerId,r=Fi(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}class Ns{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){m(e.idToken,"internal-error"),m(void 0!==e.idToken,"internal-error"),m(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ts(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){m(0!==e.length,"internal-error");var t=Ts(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(m(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){i=t;var n,i,{accessToken:r,refreshToken:s,expiresIn:a}=await{accessToken:(r=await us(n=e,{},async()=>{var e=Ce({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:r}=n.config,t=ds(n,t,"/v1/token","key="+r),r=await n._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",ss.fetch()(t,{method:"POST",headers:r,body:e})})).access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token};this.updateTokensAndExpiration(r,s,Number(a))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){var{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new Ns;return r&&(m("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(m("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(m("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ns,this.toJSON())}_performRefresh(){return Xi("not implemented")}}function Rs(e,t){m("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ps{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=Fi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Cs(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ks(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Es(this,this.stsTokenManager.getToken(this.auth,e));return m(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return(async(e,t=!1)=>{var r=w(e),n=await r.getIdToken(t),i=Is(n),s=(m(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error"),null==(r="object"==typeof i.firebase?i.firebase:void 0)?void 0:r.sign_in_provider);return{claims:i,token:n,authTime:ws(bs(i.auth_time)),issuedAtTime:ws(bs(i.iat)),expirationTime:ws(bs(i.exp)),signInProvider:s||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}})(this,e)}reload(){return(async e=>{var t=w(e);await Ss(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})(this)}_assign(e){this!==e&&(m(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){var t=new Ps(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){m(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ss(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e;return h(this.auth.app)?Promise.reject(Qi(this.auth)):(e=await this.getIdToken(),await Es(this,(async(e,t)=>hs(e,"POST","/v1/accounts:delete",t))(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut())}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r=null!=(r=t.displayName)?r:void 0,n=null!=(n=t.email)?n:void 0,i=null!=(i=t.phoneNumber)?i:void 0,s=null!=(s=t.photoURL)?s:void 0,a=null!=(a=t.tenantId)?a:void 0,o=null!=(o=t._redirectEventId)?o:void 0,l=null!=(l=t.createdAt)?l:void 0,h=null!=(h=t.lastLoginAt)?h:void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:p,stsTokenManager:f}=t,f=(m(u&&f,e,"internal-error"),Ns.fromJSON(this.name,f)),u=(m("string"==typeof u,e,"internal-error"),Rs(r,e.name),Rs(n,e.name),m("boolean"==typeof c,e,"internal-error"),m("boolean"==typeof d,e,"internal-error"),Rs(i,e.name),Rs(s,e.name),Rs(a,e.name),Rs(o,e.name),Rs(l,e.name),Rs(h,e.name),new Ps({uid:u,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:f,createdAt:l,lastLoginAt:h}));return p&&Array.isArray(p)&&(u.providerData=p.map(e=>Object.assign({},e))),o&&(u._redirectEventId=o),u}static async _fromIdTokenResponse(e,t,r=!1){var n=new Ns,n=(n.updateFromServerResponse(t),new Ps({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r}));return await Ss(n),n}static async _fromGetAccountInfoResponse(e,t,r){var n=t.users[0],i=(m(void 0!==n.localId,"internal-error"),void 0!==n.providerUserInfo?As(n.providerUserInfo):[]),s=!(n.email&&n.passwordHash||null!=i&&i.length),a=new Ns,a=(a.updateFromIdToken(r),new Ps({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s})),s={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new ks(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||null!=i&&i.length)};return Object.assign(a,s),a}}let Ds=new Map;function xs(e){Zi(e instanceof Function,"Expected a class definition");var t=Ds.get(e);return t?Zi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Ds.set(e,t)),t}class Os{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Os.type="NONE";let Ls=Os;function Ms(e,t,r){return`firebase:${e}:${t}:`+r}class Fs{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;var{config:n,name:i}=this.auth;this.fullUserKey=Ms(this.userKey,n.apiKey,i),this.fullPersistenceKey=Ms("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Ps._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){var t;if(this.persistence!==e)return t=await this.getCurrentUser(),await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Fs(xs(Ls),e,r);var n,i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||xs(Ls),a=Ms(r,e.config.apiKey,e.name),o=null;for(n of t)try{var l=await n._get(a);if(l){var h=Ps._fromJSON(e,l);n!==s&&(o=h),s=n;break}}catch(e){}i=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&i.length&&(s=i[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(a)}catch(e){}}))),new Fs(s,e,r)}}function Us(e){var t=e.toLowerCase();return t.includes("opera/")||t.includes("opr/")||t.includes("opios/")?"Opera":Bs(t)?"IEMobile":t.includes("msie")||t.includes("trident/")?"IE":t.includes("edge/")?"Edge":Vs(t)?"Firefox":t.includes("silk/")?"Silk":Ks(t)?"Blackberry":Ws(t)?"Webos":qs(t)?"Safari":!t.includes("chrome/")&&!js(t)||t.includes("edge/")?zs(t)?"Android":2===(null==(t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))?void 0:t.length)?t[1]:"Other":"Chrome"}function Vs(e=te()){return/firefox\//i.test(e)}function qs(e=te()){var t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function js(e=te()){return/crios\//i.test(e)}function Bs(e=te()){return/iemobile/i.test(e)}function zs(e=te()){return/android/i.test(e)}function Ks(e=te()){return/blackberry/i.test(e)}function Ws(e=te()){return/webos/i.test(e)}function Hs(e=te()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Gs(e=te()){return Hs(e)||zs(e)||Ws(e)||Ks(e)||/windows phone/i.test(e)||Bs(e)}function $s(e,t=[]){let r;switch(e){case"Browser":r=Us(te());break;case"Worker":r=Us(te())+"-"+e;break;default:r=e}var n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${xt}/`+n}class Qs{constructor(e){this.auth=e,this.queue=[]}pushCallback(n,e){var t=r=>new Promise((e,t)=>{try{e(n(r))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){var t=[];try{for(var r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){t.reverse();for(var n of t)try{n()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class Ys{constructor(e){var t,r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=r.minPasswordLength)?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(t=e.allowedNonAlphanumericCharacters)?void 0:t.join(""))?r:"",this.forceUpgradeOnSignin=null!=(t=e.forceUpgradeOnSignin)&&t,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,r),this.validatePasswordCharacterOptions(e,r),r.isValid&&(r.isValid=null==(t=r.meetsMinPasswordLength)||t),r.isValid&&(r.isValid=null==(t=r.meetsMaxPasswordLength)||t),r.isValid&&(r.isValid=null==(t=r.containsLowercaseLetter)||t),r.isValid&&(r.isValid=null==(t=r.containsUppercaseLetter)||t),r.isValid&&(r.isValid=null==(t=r.containsNumericCharacter)||t),r.isValid&&(r.isValid=null==(t=r.containsNonAlphanumericCharacter)||t),r}validatePasswordLengthOptions(e,t){var r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){var r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,"a"<=r&&r<="z","A"<=r&&r<="Z","0"<=r&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&!e.containsLowercaseLetter&&(e.containsLowercaseLetter=t),this.customStrengthOptions.containsUppercaseLetter&&!e.containsUppercaseLetter&&(e.containsUppercaseLetter=r),this.customStrengthOptions.containsNumericCharacter&&!e.containsNumericCharacter&&(e.containsNumericCharacter=n),this.customStrengthOptions.containsNonAlphanumericCharacter&&!e.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter=i)}}class Js{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Zs(this),this.idTokenSubscription=new Zs(this),this.beforeStateQueue=new Qs(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zi,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=xs(r)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Fs.create(this,t),!this._deleted)){if(null!=(e=this._popupRedirectResolver)&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(r),this.lastNotifiedUid=(null==(e=this.currentUser)?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){var e;!this._deleted&&(e=await this.assertedPersistence.getCurrentUser(),this.currentUser||e)&&(this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),await this.currentUser.getIdToken()):await this._updateCurrentUser(e,!0))}async initializeCurrentUserFromIdToken(e){try{var t=await ys(this,{idToken:e}),r=await Ps._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(h(this.app)){let t=this.app.settings.authIdToken;return t?new Promise(e=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(t).then(e,e))}):this.directlySetCurrentUser(null)}var t,r,n,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null==(t=this.redirectUser)?void 0:t._redirectEventId,r=null==s?void 0:s._redirectEventId,n=await this.tryRedirectSignIn(e),t&&t!==r||null==n||!n.user||(s=n.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return m(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ss(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){var e;this.languageCode="undefined"!=typeof navigator&&((e=navigator).languages&&e.languages[0]||e.language)||null}async _delete(){this._deleted=!0}async updateCurrentUser(e){var t;return h(this.app)?Promise.reject(Qi(this)):((t=e?w(e):null)&&m(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this)))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&m(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return h(this.app)?Promise.reject(Qi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return h(this.app)?Promise.reject(Qi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xs(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();var t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){var e,t=await hs(e=this,"GET","/v2/passwordPolicy",ls(e,{})),t=new Ys(t);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new fe("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((t,r)=>{if(this.currentUser)t();else{let e=this.onAuthStateChanged(()=>{e(),t()},r)}})}async revokeAccessToken(e){var t;this.currentUser&&(t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()},null!=this.tenantId&&(t.tenantId=this.tenantId),await hs(e=this,"POST","/v2/accounts:revokeToken",ls(e,t)))}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){var r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(m(t=e&&xs(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Fs.create(this,[xs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(t=this.redirectUser)?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:`+this.name}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!=(e=null==(e=this.currentUser)?void 0:e.uid)?e:null,this.lastNotifiedUid!==e)&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,n,i){if(this._deleted)return()=>{};let e="function"==typeof r?r:r.next.bind(r),s=!1;var a=this._isInitialized?Promise.resolve():this._initializationPromise;if(m(a,this,"internal-error"),a.then(()=>{s||e(this.currentUser)}),"function"==typeof r){let e=t.addObserver(r,n,i);return()=>{s=!0,e()}}{let e=t.addObserver(r);return()=>{s=!0,e()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return m(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$s(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e={"X-Client-Version":this.clientVersion},t=(this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),await(null==(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:t.getHeartbeatsHeader())),t=(t&&(e["X-Firebase-Client"]=t),await this._getAppCheckToken());return t&&(e["X-Firebase-AppCheck"]=t),e}async _getAppCheckToken(){var e,t,r;return h(this.app)&&this.app.settings.appCheckToken?this.app.settings.appCheckToken:(null!=(e=await(null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken()))&&e.error&&(t="Error while retrieving App Check token: "+e.error,r=[],Ki.logLevel<=c.WARN)&&Ki.warn(`Auth (${xt}): `+t,...r),null==e?void 0:e.token)}}function Xs(e){return w(e)}class Zs{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ne(e=>this.observer=e)}get next(){return m(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ea={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ta(e){return ea.loadJS(e)}function ra(e){return"__"+e+Math.floor(1e6*Math.random())}class na{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var r=this.counter;return this._widgets.set(r,new aa(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t,r=e||1e12;null!=(t=this._widgets.get(r))&&t.delete(),this._widgets.delete(r)}getResponse(e){var t;return(null==(t=this._widgets.get(e||1e12))?void 0:t.getResponse())||""}async execute(e){var t;return null!=(t=this._widgets.get(e||1e12))&&t.execute(),""}}class ia{constructor(){this.enterprise=new sa}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class sa{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class aa{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var n="string"==typeof e?document.getElementById(e):e;m(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=(e=>{var t=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t.push(r.charAt(Math.floor(Math.random()*r.length)));return t.join("")})(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}let oa="NO_RECAPTCHA";class la{constructor(e){this.type="recaptcha-enterprise",this.auth=Xs(e)}async verify(i="verify",e=!1){function s(e,t,r){let n=window.grecaptcha;ms(n)?n.enterprise.ready(()=>{n.enterprise.execute(e,{action:i}).then(e=>{t(e)}).catch(()=>{t(oa)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new ia).execute("siteKey",{action:"verify"}):new Promise((r,n)=>{(async i=>{if(!e){if(null==i.tenantId&&null!=i._agentRecaptchaConfig)return i._agentRecaptchaConfig.siteKey;if(null!=i.tenantId&&void 0!==i._tenantRecaptchaConfigs[i.tenantId])return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(r,n)=>{_s(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(e=>{var t;if(void 0!==e.recaptchaKey)return t=new vs(e),null==i.tenantId?i._agentRecaptchaConfig=t:i._tenantRecaptchaConfigs[i.tenantId]=t,r(t.siteKey);n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(t=>{if(!e&&ms(window.grecaptcha))s(t,r,n);else if("undefined"==typeof window)n(new Error("RecaptchaVerifier is only supported in browser"));else{let e=ea.recaptchaEnterpriseScript;0!==e.length&&(e+=t),ta(e).then(()=>{s(t,r,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function ha(e,t,r,n=!1,i=!1){var s=new la(e);let a;if(i)a=oa;else try{a=await s.verify(r)}catch(e){a=await s.verify(r,!0)}var o,l,s=Object.assign({},t);return"mfaSmsEnrollment"===r||"mfaSmsSignIn"===r?"phoneEnrollmentInfo"in s?(l=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.recaptchaToken,Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:o,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})):"phoneSignInInfo"in s&&(l=s.phoneSignInInfo.recaptchaToken,Object.assign(s,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})):(n?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"})),s}async function ua(r,n,i,s,e){var t;return"EMAIL_PASSWORD_PROVIDER"===e?null!=(t=r._getRecaptchaConfig())&&t.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")?(t=await ha(r,n,i,"getOobCode"===i),s(r,t)):s(r,n).catch(async e=>{var t;return"auth/missing-recaptcha-token"===e.code?(console.log(i+" is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."),t=await ha(r,n,i,"getOobCode"===i),s(r,t)):Promise.reject(e)}):"PHONE_PROVIDER"===e?null!=(t=r._getRecaptchaConfig())&&t.isProviderEnabled("PHONE_PROVIDER")?(t=await ha(r,n,i),s(r,t).catch(async e=>{var t;if("AUDIT"===(null==(t=r._getRecaptchaConfig())?void 0:t.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===e.code||"auth/invalid-app-credential"===e.code))return console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${i} flow.`),t=await ha(r,n,i,!1,!0),s(r,t);return Promise.reject(e)})):(t=await ha(r,n,i,!1,!0),s(r,t)):Promise.reject(e+" provider is not supported.")}function ca(e,t,r){var n=Xs(e),i=(m(/^https?:\/\//.test(t),n,"invalid-emulator-scheme"),!(null==r||!r.disableWarnings)),s=da(t),{host:a,port:o}=(e=>{var t,r=da(e);return(r=/(\/\/)?([^?#/]+)/.exec(e.substr(r.length)))?(r=r[2].split("@").pop()||"",(t=/^(\[[^\]]+\])(:|$)/.exec(r))?{host:t=t[1],port:pa(r.substr(t.length+1))}:([t,r]=r.split(":"),{host:t,port:pa(r)})):{host:"",port:null}})(t),l={url:s+`//${a}${null===o?"":":"+o}/`},a=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});function h(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}n._canInitEmulator?(n.config.emulator=l,n.emulatorConfig=a,n.settings.appVerificationDisabledForTesting=!0,i||("undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",h):h()))):(m(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),m(Te(l,n.config.emulator)&&Te(a,n.emulatorConfig),n,"emulator-config-failed"))}function da(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function pa(e){var t;return!e||(t=Number(e),isNaN(t))?null:t}class fa{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xi("not implemented")}_getIdTokenResponse(e){return Xi("not implemented")}_linkToIdToken(e,t){return Xi("not implemented")}_getReauthenticationResolver(e){return Xi("not implemented")}}async function ga(e,t){return hs(e,"POST","/v1/accounts:resetPassword",ls(e,t))}async function ma(e,t){return hs(e,"POST","/v1/accounts:signUp",t)}async function va(e,t){return cs(e,"POST","/v1/accounts:signInWithPassword",ls(e,t))}async function _a(e,t){return hs(e,"POST","/v1/accounts:sendOobCode",ls(e,t))}async function ya(e,t){return _a(e,t)}async function wa(e,t){return _a(e,t)}class ba extends fa{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new ba(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ba(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ua(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",va,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return(async(e,t)=>cs(e,"POST","/v1/accounts:signInWithEmailLink",ls(e,t)))(e,{email:this._email,oobCode:this._password});default:Hi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ua(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ma,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return(async(e,t)=>cs(e,"POST","/v1/accounts:signInWithEmailLink",ls(e,t)))(e,{idToken:t,email:this._email,oobCode:this._password});default:Hi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ia(e,t){return cs(e,"POST","/v1/accounts:signInWithIdp",ls(e,t))}class Ta extends fa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){var t=new Ta(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,t=Fi(t,["providerId","signInMethod"]);return r&&n?((r=new Ta(r,n)).idToken=t.idToken||void 0,r.accessToken=t.accessToken||void 0,r.secret=t.secret,r.nonce=t.nonce,r.pendingToken=t.pendingToken||null,r):null}_getIdTokenResponse(e){return Ia(e,this.buildRequest())}_linkToIdToken(e,t){var r=this.buildRequest();return r.idToken=t,Ia(e,r)}_getReauthenticationResolver(e){var t=this.buildRequest();return t.autoCreate=!1,Ia(e,t)}buildRequest(){var e,t={requestUri:"http://localhost",returnSecureToken:!0};return this.pendingToken?t.pendingToken=this.pendingToken:(e={},this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Ce(e)),t}}async function Ea(e,t){return hs(e,"POST","/v1/accounts:sendVerificationCode",ls(e,t))}let Ca={USER_NOT_FOUND:"user-not-found"};class ka extends fa{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ka({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ka({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return(async(e,t)=>cs(e,"POST","/v1/accounts:signInWithPhoneNumber",ls(e,t)))(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return(async(e,t)=>{var r=await cs(e,"POST","/v1/accounts:signInWithPhoneNumber",ls(e,t));if(r.temporaryProof)throw fs(e,"account-exists-with-different-credential",r);return r})(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return(async(e,t)=>cs(e,"POST","/v1/accounts:signInWithPhoneNumber",ls(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ca))(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return r||t||n||i?new ka({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class Sa{constructor(e){var t=ke(Se(e)),r=null!=(r=t.apiKey)?r:null,n=null!=(n=t.oobCode)?n:null,i=(e=>{switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}})(null!=(i=t.mode)?i:null);m(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=null!=(r=t.continueUrl)?r:null,this.languageCode=null!=(i=t.languageCode)?i:null,this.tenantId=null!=(n=t.tenantId)?n:null}static parseLink(e){t=ke(Se(e=e)).link,r=t?ke(Se(t)).deep_link_id:null;var t,r,n=((n=ke(Se(e)).deep_link_id)?ke(Se(n)).link:null)||n||r||t||e;try{return new Sa(n)}catch(e){return null}}}class Aa{constructor(){this.providerId=Aa.PROVIDER_ID}static credential(e,t){return ba._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var r=Sa.parseLink(t);return m(r,"argument-error"),ba._fromEmailAndCode(e,r.code,r.tenantId)}}Aa.PROVIDER_ID="password",Aa.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Aa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Na{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ra extends Na{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Pa extends Ra{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return m("providerId"in t&&"signInMethod"in t,"argument-error"),Ta._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return m(e.idToken||e.accessToken,"argument-error"),Ta._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Pa.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Pa.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:n,pendingToken:i,nonce:s,providerId:a}=e;if(!(r||n||t||i))return null;if(!a)return null;try{return new Pa(a)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:i})}catch(e){return null}}}class Da extends Ra{constructor(){super("facebook.com")}static credential(e){return Ta._fromParams({providerId:Da.PROVIDER_ID,signInMethod:Da.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Da.credentialFromTaggedObject(e)}static credentialFromError(e){return Da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Da.credential(e.oauthAccessToken)}catch(e){return null}}}Da.FACEBOOK_SIGN_IN_METHOD="facebook.com",Da.PROVIDER_ID="facebook.com";class xa extends Ra{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ta._fromParams({providerId:xa.PROVIDER_ID,signInMethod:xa.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return xa.credentialFromTaggedObject(e)}static credentialFromError(e){return xa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return xa.credential(t,r)}catch(e){return null}}}xa.GOOGLE_SIGN_IN_METHOD="google.com",xa.PROVIDER_ID="google.com";class Oa extends Ra{constructor(){super("github.com")}static credential(e){return Ta._fromParams({providerId:Oa.PROVIDER_ID,signInMethod:Oa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Oa.credentialFromTaggedObject(e)}static credentialFromError(e){return Oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Oa.credential(e.oauthAccessToken)}catch(e){return null}}}Oa.GITHUB_SIGN_IN_METHOD="github.com",Oa.PROVIDER_ID="github.com";class La extends fa{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Ia(e,this.buildRequest())}_linkToIdToken(e,t){var r=this.buildRequest();return r.idToken=t,Ia(e,r)}_getReauthenticationResolver(e){var t=this.buildRequest();return t.autoCreate=!1,Ia(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:r,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return t&&r&&n&&t===r?new La(t,n):null}static _create(e,t){return new La(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ma extends Na{constructor(e){m(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Ma.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ma.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=La.fromJSON(e);return m(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return La._create(r,t)}catch(e){return null}}}class Fa extends Ra{constructor(){super("twitter.com")}static credential(e,t){return Ta._fromParams({providerId:Fa.PROVIDER_ID,signInMethod:Fa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Fa.credentialFromTaggedObject(e)}static credentialFromError(e){return Fa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Fa.credential(t,r)}catch(e){return null}}}async function Ua(e,t){return cs(e,"POST","/v1/accounts:signUp",ls(e,t))}Fa.TWITTER_SIGN_IN_METHOD="twitter.com",Fa.PROVIDER_ID="twitter.com";class Va{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){var i=await Ps._fromIdTokenResponse(e,r,n),s=qa(r);return new Va({user:i,providerId:s,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);var n=qa(r);return new Va({user:e,providerId:n,_tokenResponse:r,operationType:t})}}function qa(e){return e.providerId||("phoneNumber"in e?"phone":null)}class ja extends pe{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,ja.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new ja(e,t,r,n)}}function Ba(t,r,e,n){return("reauthenticate"===r?e._getReauthenticationResolver(t):e._getIdTokenResponse(t)).catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw ja._fromErrorAndOperation(t,e,r,n);throw e})}function za(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ka(e,t){var r=w(e),n=(await Ha(!0,r,t),e=r.auth,t={idToken:await r.getIdToken(),deleteProvider:[t]},await hs(e,"POST","/v1/accounts:update",t)).providerUserInfo;let i=za(n||[]);return r.providerData=r.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(r.phoneNumber=null),await r.auth._persistUserIfCurrent(r),r}async function Wa(e,t,r=!1){var n=await Es(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Va._forOperation(e,"link",n)}async function Ha(e,t,r){await Ss(t);var n=!1===e?"provider-already-linked":"no-such-provider";m(za(t.providerData).has(r)===e,t.auth,n)}async function Ga(e,t,r=!1){var n=e.auth;if(h(n.app))return Promise.reject(Qi(n));var i="reauthenticate";try{var s=await Es(e,Ba(n,i,t,e),r),a=(m(s.idToken,n,"internal-error"),Is(s.idToken)),o=(m(a,n,"internal-error"),a).sub;return m(e.uid===o,n,"user-mismatch"),Va._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Hi(n,"user-mismatch"),e}}async function $a(e,t,r=!1){var n;return h(e.app)?Promise.reject(Qi(e)):(n=await Ba(e,"signIn",t),n=await Va._fromIdTokenResponse(e,"signIn",n),r||await e._updateCurrentUser(n.user),n)}async function Qa(e,t){return $a(Xs(e),t)}async function Ya(e,t){var r=w(e);return await Ha(!1,r,t.providerId),Wa(r,t)}async function Ja(e,t){return Ga(w(e),t)}async function Xa(e,t){var r,n;return h(e.app)?Promise.reject(Qi(e)):(n=await cs(r=Xs(e),"POST","/v1/accounts:signInWithCustomToken",ls(r,{token:t,returnSecureToken:!0})),n=await Va._fromIdTokenResponse(r,"signIn",n),await r._updateCurrentUser(n.user),n)}class Za{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?eo._fromServerResponse(e,t):"totpInfo"in t?to._fromServerResponse(e,t):Hi(e,"internal-error")}}class eo extends Za{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new eo(t)}}class to extends Za{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new to(t)}}function ro(e,t,r){var n;m(0<(null==(n=r.url)?void 0:n.length),e,"invalid-continue-uri"),m(void 0===r.dynamicLinkDomain||0<r.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),m(void 0===r.linkDomain||0<r.linkDomain.length,e,"invalid-hosting-link-domain"),t.continueUrl=r.url,t.dynamicLinkDomain=r.dynamicLinkDomain,t.linkDomain=r.linkDomain,t.canHandleCodeInApp=r.handleCodeInApp,r.iOS&&(m(0<r.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=r.iOS.bundleId),r.android&&(m(0<r.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=r.android.installApp,t.androidMinimumVersionCode=r.android.minimumVersion,t.androidPackageName=r.android.packageName)}async function no(e){var t=Xs(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function io(e,t){await hs(e=w(e),"POST","/v1/accounts:update",ls(e,{oobCode:t}))}async function so(e,t){var r=w(e),n=await ga(r,{oobCode:t}),i=n.requestType;switch(m(i,r,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":m(n.newEmail,r,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":m(n.mfaInfo,r,"internal-error");default:m(n.email,r,"internal-error")}let s=null;return n.mfaInfo&&(s=Za._fromServerResponse(Xs(r),n.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.newEmail:n.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===n.requestType?n.email:n.newEmail)||null,multiFactorInfo:s},operation:i}}async function ao(e,t){var r=ts()?es():"http://localhost",r=(await hs(e=w(e),"POST","/v1/accounts:createAuthUri",ls(e,{identifier:t,continueUri:r}))).signinMethods;return r||[]}async function oo(e,t){var r=w(e),n={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()},r=(t&&ro(r.auth,n,t),await _a(r.auth,n)).email;r!==e.email&&await e.reload()}async function lo(e,t,r){var n=w(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t},n=(r&&ro(n.auth,i,r),await _a(n.auth,i)).email;n!==e.email&&await e.reload()}async function ho(e,{displayName:t,photoURL:r}){var n,i,s;void 0===t&&void 0===r||(i=await(n=w(e)).getIdToken(),i=await Es(n,(async(e,t)=>hs(e,"POST","/v1/accounts:update",t))(n.auth,{idToken:i,displayName:t,photoUrl:r,returnSecureToken:!0})),n.displayName=i.displayName||null,n.photoURL=i.photoUrl||null,(s=n.providerData.find(({providerId:e})=>"password"===e))&&(s.displayName=n.displayName,s.photoURL=n.photoURL),await n._updateTokensIfNecessary(i))}async function uo(e,t,r){var n=e.auth,i={idToken:await e.getIdToken(),returnSecureToken:!0},n=(t&&(i.email=t),r&&(i.password=r),await Es(e,(async(e,t)=>hs(e,"POST","/v1/accounts:update",t))(n,i)));await e._updateTokensIfNecessary(n,!0)}class co{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class po extends co{constructor(e,t,r,n){super(e,t,r),this.username=n}}class fo extends co{constructor(e,t){super(e,"facebook.com",t)}}class go extends po{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class mo extends co{constructor(e,t){super(e,"google.com",t)}}class vo extends po{constructor(e,t,r){super(e,"twitter.com",t,r)}}function _o(e){var{user:t,_tokenResponse:r}=e;if(t.isAnonymous&&!r)return{providerId:null,isNewUser:!1,profile:null};var n=r;if(!n)return null;var i=n.providerId,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},a=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!i&&null!=n&&n.idToken){t=null==(t=null==(t=Is(n.idToken))?void 0:t.firebase)?void 0:t.sign_in_provider;if(t)return t="anonymous"!==t&&"custom"!==t?t:null,new co(a,t)}if(!i)return null;switch(i){case"facebook.com":return new fo(a,s);case"github.com":return new go(a,s);case"google.com":return new mo(a,s);case"twitter.com":return new vo(a,s,n.screenName||null);case"custom":case"anonymous":return new co(a,null);default:return new co(a,i,s)}}class yo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new yo("enroll",e,t)}static _fromMfaPendingCredential(e){return new yo("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!=(t=e.multiFactorSession)&&t.pendingCredential)return yo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!=(t=e.multiFactorSession)&&t.idToken)return yo._fromIdtoken(e.multiFactorSession.idToken)}return null}}class wo{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,i){let s=Xs(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>Za._fromServerResponse(s,e));m(a.mfaPendingCredential,s,"internal-error");let o=yo._fromMfaPendingCredential(a.mfaPendingCredential);return new wo(o,t,async e=>{var t=await e._process(s,o),r=(delete a.mfaInfo,delete a.mfaPendingCredential,Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken}));switch(i.operationType){case"signIn":var n=await Va._fromIdTokenResponse(s,i.operationType,r);return await s._updateCurrentUser(n.user),n;case"reauthenticate":return m(i.user,s,"internal-error"),Va._forOperation(i.user,i.operationType,r);default:Hi(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}function bo(e,t){return hs(e,"POST","/v2/accounts/mfaEnrollment:start",ls(e,t))}class Io{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Za._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Io(e)}async getSession(){return yo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){var r=e,n=await this.getSession(),r=await Es(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid;var r,n,i=await this.user.getIdToken();try{var s=await Es(this.user,(r=this.user.auth,n={idToken:i,mfaEnrollmentId:t},hs(r,"POST","/v2/accounts/mfaEnrollment:withdraw",ls(r,n))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}let To=new WeakMap;let Eo="__sak";class Co{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Eo,"1"),this.storage.removeItem(Eo),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ko extends Co{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Gs(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(var t of Object.keys(this.listeners)){var r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,r=!1){if(e.key){let t=e.key;r?this.detachListener():this.stopPolling();var n=()=>{var e=this.storage.getItem(t);!r&&this.localCache[t]===e||this.notifyListeners(t,e)},i=this.storage.getItem(t);oe()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)})}notifyListeners(e,t){this.localCache[e]=t;var r=this.listeners[e];if(r)for(var n of Array.from(r))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size)&&delete this.listeners[e],0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ko.type="LOCAL";let So=ko;class Ao extends Co{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ao.type="SESSION";let No=Ao;class Ro{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));return e||(e=new Ro(t),this.receivers.push(e),e)}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:r,eventType:n,data:i}=t.data;var s=this.handlersMap[n];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:r,eventType:n}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:r,eventType:n,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Po(e="",t=10){let r="";for(let n=0;n<t;n++)r+=Math.floor(10*Math.random());return e+r}Ro.receivers=[];class Do{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){let o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let l,h;return new Promise((r,n)=>{let i=Po("",20),s=(o.port1.start(),setTimeout(()=>{n(new Error("unsupported_event"))},a));h={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),l=setTimeout(()=>{n(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),r(t.data.response);break;default:clearTimeout(s),clearTimeout(l),n(new Error("invalid_response"))}}},this.handlers.add(h),o.port1.addEventListener("message",h.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{h&&this.removeMessageHandler(h)})}}function xo(){return window}function Oo(){return void 0!==xo().WorkerGlobalScope&&"function"==typeof xo().importScripts}let Lo="firebaseLocalStorageDb",Mo="firebaseLocalStorage",Fo="fbase_key";class Uo{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Vo(e,t){return e.transaction([Mo],t?"readwrite":"readonly").objectStore(Mo)}function qo(){let n=indexedDB.open(Lo,1);return new Promise((t,r)=>{n.addEventListener("error",()=>{r(n.error)}),n.addEventListener("upgradeneeded",()=>{var e=n.result;try{e.createObjectStore(Mo,{keyPath:Fo})}catch(e){r(e)}}),n.addEventListener("success",async()=>{var e=n.result;e.objectStoreNames.contains(Mo)?t(e):(e.close(),e=indexedDB.deleteDatabase(Lo),await new Uo(e).toPromise(),t(await qo()))})})}async function jo(e,t,r){var n=Vo(e,!0).put({fbase_key:t,value:r});return new Uo(n).toPromise()}function Bo(e,t){var r=Vo(e,!0).delete(t);return new Uo(r).toPromise()}class zo{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await qo()),this.db}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Oo()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ro._getInstance(Oo()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;this.activeServiceWorker=await(async()=>{if(null==navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}})(),this.activeServiceWorker&&(this.sender=new Do(this.activeServiceWorker),t=await this.sender._send("ping",{},800))&&null!=(e=t[0])&&e.fulfilled&&null!=(e=t[0])&&e.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{var e;return indexedDB?(await jo(e=await qo(),Eo,"1"),await Bo(e,Eo),!0):!1}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(e=>jo(e,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>(async(e,t)=>{var r=Vo(e,!1).get(t);return void 0===(r=await new Uo(r).toPromise())?null:r.value})(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Bo(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e=await this._withRetries(e=>{var t=Vo(e,!1).getAll();return new Uo(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];var t,r=[],n=new Set;if(0!==e.length)for(var{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),r.push(i));for(t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),r.push(t));return r}notifyListeners(e,t){this.localCache[e]=t;var r=this.listeners[e];if(r)for(var n of Array.from(r))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size)&&delete this.listeners[e],0===Object.keys(this.listeners).length&&this.stopPolling()}}zo.type="LOCAL";let Ko=zo;function Wo(e,t){return hs(e,"POST","/v2/accounts/mfaSignIn:start",ls(e,t))}let Ho=ra("rcb"),Go=new ns(3e4,6e4);class $o{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null==(e=xo().grecaptcha)||!e.render)}load(i,s=""){var e;return m((e=s).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),i,"argument-error"),this.shouldResolveImmediately(s)&&gs(xo().grecaptcha)?Promise.resolve(xo().grecaptcha):new Promise((t,r)=>{let n=xo().setTimeout(()=>{r(Gi(i,"network-request-failed"))},Go.get());xo()[Ho]=()=>{xo().clearTimeout(n),delete xo()[Ho];var e=xo().grecaptcha;if(e&&gs(e)){let n=e.render;e.render=(e,t)=>{var r=n(e,t);return this.counter++,r},this.hostLanguage=s,t(e)}else r(Gi(i,"internal-error"))},ta(ea.recaptchaV2Script+"?"+Ce({onload:Ho,render:"explicit",hl:s})).catch(()=>{clearTimeout(n),r(Gi(i,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null==(t=xo().grecaptcha)||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Qo{async load(e){return new na(e)}clearedOneInstance(){}}let Yo="recaptcha",Jo={theme:"light",type:"image"};class Xo{constructor(e,t,r=Object.assign({},Jo)){this.parameters=r,this.type=Yo,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Xs(e),this.isInvisible="invisible"===this.parameters.size,m("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var n="string"==typeof t?document.getElementById(t):t;m(n,this.auth,"argument-error"),this.container=n,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Qo:$o),this.validateStartingState()}async verify(){this.assertNotDestroyed();let e=await this.render(),n=this.getAssertedRecaptcha();var t=n.getResponse(e);return t||new Promise(t=>{let r=e=>{e&&(this.tokenChangeListeners.delete(r),t(e))};this.tokenChangeListeners.add(r),this.isInvisible&&n.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){m(!this.parameters.sitekey,this.auth,"argument-error"),m(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),m("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(r){return t=>{var e;this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof r?r(t):"string"==typeof r&&"function"==typeof(e=xo()[r])&&e(t)}}assertNotDestroyed(){m(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){m(ts()&&!Oo(),this.auth,"internal-error"),await(()=>{let t=null;return new Promise(e=>{"complete"===document.readyState?e():(t=()=>e(),window.addEventListener("load",t))}).catch(e=>{throw t&&window.removeEventListener("load",t),e})})(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await hs(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");m(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return m(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Zo{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=ka._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function el(t,r,n){var i,e,s,a,o,l,h,u;if(!t._getRecaptchaConfig())try{e=Xs(t),s=await _s(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),s=new vs(s),null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,await(!s.isAnyProviderEnabled()||!new la(e).verify())}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let e;return("session"in(e="string"==typeof r?{phoneNumber:r}:r)?(a=e.session,"phoneNumber"in e?(m("enroll"===a.type,t,"internal-error"),o={idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},(await ua(t,o,"mfaSmsEnrollment",async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===oa?(m((null==n?void 0:n.type)===Yo,e,"argument-error"),bo(e,await tl(e,t,n))):bo(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e))).phoneSessionInfo):(m("signin"===a.type,t,"internal-error"),m(l=(null==(i=e.multiFactorHint)?void 0:i.uid)||e.multiFactorUid,t,"missing-multi-factor-info"),h={mfaPendingCredential:a.credential,mfaEnrollmentId:l,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},(await ua(t,h,"mfaSmsSignIn",async(e,t)=>t.phoneSignInInfo.captchaResponse===oa?(m((null==n?void 0:n.type)===Yo,e,"argument-error"),Wo(e,await tl(e,t,n))):Wo(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e))).phoneResponseInfo)):(u={phoneNumber:e.phoneNumber,clientType:"CLIENT_TYPE_WEB"},await ua(t,u,"sendVerificationCode",async(e,t)=>t.captchaResponse===oa?(m((null==n?void 0:n.type)===Yo,e,"argument-error"),Ea(e,await tl(e,t,n))):Ea(e,t),"PHONE_PROVIDER").catch(e=>Promise.reject(e)))).sessionInfo}finally{null!=n&&n._reset()}}async function tl(e,t,r){m(r.type===Yo,e,"argument-error");var n,i,s,a,o=await r.verify(),l=(m("string"==typeof o,e,"argument-error"),Object.assign({},t));return"phoneEnrollmentInfo"in l?(i=l.phoneEnrollmentInfo.phoneNumber,s=l.phoneEnrollmentInfo.captchaResponse,a=l.phoneEnrollmentInfo.clientType,n=l.phoneEnrollmentInfo.recaptchaVersion,Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:o,captchaResponse:s,clientType:a,recaptchaVersion:n}})):"phoneSignInInfo"in l?(i=l.phoneSignInInfo.captchaResponse,s=l.phoneSignInInfo.clientType,a=l.phoneSignInInfo.recaptchaVersion,Object.assign(l,{phoneSignInInfo:{recaptchaToken:o,captchaResponse:i,clientType:s,recaptchaVersion:a}})):Object.assign(l,{recaptchaToken:o}),l}class rl{constructor(e){this.providerId=rl.PROVIDER_ID,this.auth=Xs(e)}verifyPhoneNumber(e,t){return el(this.auth,e,w(t))}static credential(e,t){return ka._fromVerification(e,t)}static credentialFromResult(e){var t=e;return rl.credentialFromTaggedObject(t)}static credentialFromError(e){return rl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){var t,r;return e&&({phoneNumber:t,temporaryProof:r}=e,t)&&r?ka._fromTokenResponse(t,r):null}}function nl(e,t){return t?xs(t):(m(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}rl.PROVIDER_ID="phone",rl.PHONE_SIGN_IN_METHOD="phone";class il extends fa{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ia(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ia(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ia(e,this._buildIdpRequest())}_buildIdpRequest(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sl(e){return $a(e.auth,new il(e),e.bypassAuthState)}function al(e){var{auth:t,user:r}=e;return m(r,t,"internal-error"),Ga(r,new il(e),e.bypassAuthState)}async function ol(e){var{auth:t,user:r}=e;return m(r,t,"internal-error"),Wa(r,new il(e),e.bypassAuthState)}class ll{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{s={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(s))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sl;case"linkViaPopup":case"linkViaRedirect":return ol;case"reauthViaPopup":case"reauthViaRedirect":return al;default:Hi(this.auth,"internal-error")}}resolve(e){Zi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let hl=new ns(2e3,1e4);class ul extends ll{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,ul.currentPopupAction&&ul.currentPopupAction.cancel(),ul.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return m(e,this.auth,"internal-error"),e}async onExecution(){Zi(1===this.filter.length,"Popup operations only handle one event");var e=Po();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Gi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Gi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ul.currentPopupAction=null}pollUserCancellation(){let t=()=>{var e;null!=(e=null==(e=this.authWindow)?void 0:e.window)&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gi(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,hl.get())};t()}}ul.currentPopupAction=null;let cl="pendingRedirect",dl=new Map;class pl extends ll{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let t=dl.get(this.auth._key());if(!t){try{let e=await(async(e,t)=>{var r,n=vl(t),i=ml(e);return!!await i._isAvailable()&&(r="true"===await i._get(n),await i._remove(n),r)})(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}dl.set(this.auth._key(),t)}return this.bypassAuthState||dl.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)this.resolve(null);else if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function fl(e,t){return ml(e)._set(vl(t),"true")}function gl(e,t){dl.set(e._key(),t)}function ml(e){return xs(e._redirectPersistence)}function vl(e){return Ms(cl,e.config.apiKey,e.name)}function _l(e,t,r){return(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(Qi(e)):(n=Xs(e),Yi(e,t,Na),await n._initializationPromise,await fl(i=nl(n,r),n),i._openRedirect(n,t,"signInViaRedirect"))})(e,t,r)}function yl(e,t,r){return(async(e,t,r)=>{var n=w(e);if(Yi(n.auth,t,Na),h(n.auth.app))return Promise.reject(Qi(n.auth));await n.auth._initializationPromise;var i=nl(n.auth,r),s=(await fl(i,n.auth),await Il(n));return i._openRedirect(n.auth,t,"reauthViaRedirect",s)})(e,t,r)}function wl(e,t,r){return(async(e,t,r)=>{var n=w(e),i=(Yi(n.auth,t,Na),await n.auth._initializationPromise,nl(n.auth,r)),s=(await Ha(!1,n,t.providerId),await fl(i,n.auth),await Il(n));return i._openRedirect(n.auth,t,"linkViaRedirect",s)})(e,t,r)}async function bl(e,t,r=!1){var n,i;return h(e.app)?Promise.reject(Qi(e)):(i=nl(n=Xs(e),t),(i=await new pl(n,i,r).execute())&&!r&&(delete i.user._redirectEventId,await n._persistUserIfCurrent(i.user),await n._setRedirectUser(null,t)),i)}async function Il(e){var t=Po(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Tl{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(r=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!(e=>{switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return 1;case"unknown":return Cl(e);default:return}})(t)||(this.hasHandledPotentialRedirect=!0,r)||(this.queuedRedirectEvent=t,r=!0),r}sendToConsumer(e,t){var r;e.error&&!Cl(e)?(r=(null==(r=e.error.code)?void 0:r.split("auth/")[1])||"internal-error",t.onError(Gi(this.auth,r))):t.onAuthEvent(e)}isEventForConsumer(e,t){var r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(El(e))}saveEventToCache(e){this.cachedEventUids.add(El(e)),this.lastProcessedEventTime=Date.now()}}function El(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Cl({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function kl(e,t={}){return hs(e,"GET","/v1/projects",t)}let Sl=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Al=/^https?/;async function Nl(e){if(!e.config.emulator){var t,r=(await kl(e)).authorizedDomains;for(t of r)try{if((e=>{var t,r=es(),{protocol:n,hostname:i}=new URL(r);return e.startsWith("chrome-extension://")?""===(t=new URL(e)).hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===r.replace("chrome-extension://",""):"chrome-extension:"===n&&t.hostname===i:Al.test(n)&&(Sl.test(e)?i===e:(r=e.replace(/\./g,"\\."),(t=new RegExp("^(.+\\."+r+"|"+r+")$","i")).test(i)))})(t))return}catch(e){}Hi(e,"unauthorized-domain")}}let Rl=new ns(3e4,6e4);function Pl(){var t=xo().___jsl;if(null!=t&&t.H)for(var r of Object.keys(t.H))if(t.H[r].r=t.H[r].r||[],t.H[r].L=t.H[r].L||[],t.H[r].r=[...t.H[r].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}function Dl(i){return new Promise((e,t)=>{var r;function n(){Pl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Pl(),t(Gi(i,"network-request-failed"))},timeout:Rl.get()})}if(null!=(r=null==(r=xo().gapi)?void 0:r.iframes)&&r.Iframe)e(gapi.iframes.getContext());else{if(null==(r=xo().gapi)||!r.load)return r=ra("iframefcb"),xo()[r]=()=>{gapi.load?n():t(Gi(i,"network-request-failed"))},ta(ea.gapiScript+"?onload="+r).catch(e=>t(e));n()}}).catch(e=>{throw xl=null,e})}let xl=null;let Ol=new ns(5e3,15e3),Ll="__/auth/iframe",Ml="emulator/auth/iframe",Fl={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ul=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Vl(a){e=a;var e,t,r,n=await(xl=xl||Dl(e)),i=xo().gapi;return m(i,a,"internal-error"),n.open({where:document.body,url:(m((n=(e=a).config).authDomain,e,"auth-domain-config-required"),t=n.emulator?is(n,Ml):`https://${e.config.authDomain}/`+Ll,n={apiKey:n.apiKey,appName:e.name,v:xt},(r=Ul.get(e.config.apiHost))&&(n.eid=r),(r=e._getFrameworks()).length&&(n.fw=r.join(",")),t+"?"+Ce(n).slice(1)),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Fl,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});let r=Gi(a,"network-request-failed"),n=xo().setTimeout(()=>{t(r)},Ol.get());function i(){xo().clearTimeout(n),e(s)}s.ping(i).then(i,()=>{t(r)})}))}let ql={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class jl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Bl(e,t,r,n=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let o="";var l,s=Object.assign(Object.assign({},ql),{width:n.toString(),height:i.toString(),top:s,left:a}),a=te().toLowerCase(),s=(r&&(o=js(a)?"_blank":r),Vs(a)&&(t=t||"http://localhost",s.scrollbars="yes"),Object.entries(s).reduce((e,[t,r])=>""+e+t+`=${r},`,""));if([n=te()]=[a],Hs(n)&&null!=(a=window.navigator)&&a.standalone&&"_self"!==o)return i=t||"",r=o,(a=document.createElement("a")).href=i,a.target=r,(l=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l),new jl(null);a=window.open(t||"",o,s);m(a,e,"popup-blocked");try{a.focus()}catch(e){}return new jl(a)}let zl="__/auth/handler",Kl="emulator/auth/handler",Wl=encodeURIComponent("fac");async function Hl(e,t,r,n,i,s){m(e.config.authDomain,e,"auth-domain-config-required"),m(e.config.apiKey,e,"invalid-api-key");var a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:xt,eventId:i};if(t instanceof Na){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",be(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,l]of Object.entries(s||{}))a[o]=l}t instanceof Ra&&0<(c=t.getScopes().filter(e=>""!==e)).length&&(a.scopes=c.join(",")),e.tenantId&&(a.tid=e.tenantId);var h,u=a;for(h of Object.keys(u))void 0===u[h]&&delete u[h];var c=await e._getAppCheckToken(),c=c?`#${Wl}=`+encodeURIComponent(c):"";return`${r=[e.config][0],r.emulator?is(r,Kl):`https://${r.authDomain}/`+zl}?`+Ce(u).slice(1)+c}let Gl="webStorageSupport";class $l{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=No,this._completeRedirectFn=bl,this._overrideRedirectResult=gl}async _openPopup(e,t,r,n){Zi(null==(i=this.eventManagers[e._key()])?void 0:i.manager,"_initialize() not called before _openPopup()");var i=await Hl(e,t,r,es(),n);return Bl(e,i,Po())}async _openRedirect(e,t,r,n){await this._originValidation(e);var i=await Hl(e,t,r,es(),n);return xo().location.href=i,new Promise(()=>{})}_initialize(e){let r=e._key();if(this.eventManagers[r]){let{manager:e,promise:t}=this.eventManagers[r];return e?Promise.resolve(e):(Zi(t,"If manager is not set, promise should be"),t)}let t=this.initAndGetManager(e);return this.eventManagers[r]={promise:t},t.catch(()=>{delete this.eventManagers[r]}),t}async initAndGetManager(t){var e=await Vl(t);let r=new Tl(t);return e.register("authEvent",e=>(m(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:r.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=e,r}_isIframeWebStorageSupported(r,n){this.iframes[r._key()].send(Gl,{type:Gl},e=>{var t=null==(t=null==e?void 0:e[0])?void 0:t[Gl];void 0!==t&&n(!!t),Hi(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Nl(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Gs()||qs()||Hs()}}let Ql=$l;class Yl extends class{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Xi("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Yl(e)}_finalizeEnroll(e,t,r){return e=e,t={idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()},hs(e,"POST","/v2/accounts/mfaEnrollment:finalize",ls(e,t))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},hs(e,"POST","/v2/accounts/mfaSignIn:finalize",ls(e,t))}}class Jl{constructor(){}static assertion(e){return Yl._fromCredential(e)}}Jl.FACTOR_ID="phone";er="@firebase/auth";class Xl{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){m(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var Zl;function eh(){return window}t="authIdTokenMaxAge",null!=(tr=Y())&&tr["_"+t],ea={loadJS(i){return new Promise((e,r)=>{var t,n=document.createElement("script");n.setAttribute("src",i),n.onload=e,n.onerror=e=>{var t=Gi("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(null!=(t=null==(t=document.getElementsByTagName("head"))?void 0:t[0])?t:document).appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Zl="Browser",kt(new u("auth",(e,{options:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options,s=(m(s&&!s.includes(":"),"invalid-api-key",{appName:r.name}),{apiKey:s,authDomain:a,clientPlatform:Zl,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$s(Zl)}),a=new Js(r,n,i,s);return e=a,r=(null==(t=t)?void 0:t.persistence)||[],r=(Array.isArray(r)?r:[r]).map(xs),null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver),a},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),kt(new u("auth-internal",e=>{var t=Xs(e.getProvider("auth").getImmediate());return e=t,new Xl(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),d(er,"1.9.1",(e=>{switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}})(Zl)),d(er,"1.9.1","esm2017");async function th(e,t,r){var n=eh().BuildInfo,i=(Zi(t.sessionId,"AuthEvent did not contain a session ID"),i=(e=>{if(Zi(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);var t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r})(t.sessionId),i=await crypto.subtle.digest("SHA-256",i),await(i=Array.from(new Uint8Array(i))).map(e=>e.toString(16).padStart(2,"0")).join("")),s={};return Hs()?s.ibi=n.packageName:zs()?s.apn=n.packageName:Hi(e,"operation-not-supported-in-this-environment"),n.displayName&&(s.appDisplayName=n.displayName),s.sessionId=i,Hl(e,r,t.type,void 0,null!=(n=t.eventId)?n:void 0,s)}function rh(n){let i=eh().cordova;return new Promise(r=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(n):t=i.InAppBrowser.open(n,(e=te(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),r(t)})})}let nh=20;class ih extends Tl{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInitialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function sh(e,t,r=null){return{type:t,eventId:r,urlResponse:null,sessionId:(()=>{var e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<nh;n++){var r=Math.floor(Math.random()*t.length);e.push(t.charAt(r))}return e.join("")})(),postBody:null,tenantId:e.tenantId,error:Gi(e,"no-auth-event")}}async function ah(e){var t=await lh()._get(hh(e));return t&&await lh()._remove(hh(e)),t}function oh(e,t){i=uh(t=t),n=i.link?decodeURIComponent(i.link):void 0,r=uh(n).link,i=i.deep_link_id?decodeURIComponent(i.deep_link_id):void 0;var r,n,i=uh(i).link||i||r||n||t;return i.includes("/__/auth/callback")?(n=(r=null==(n=null==(r=null==(n=(r=uh(i)).firebaseError?(e=>{try{return JSON.parse(e)}catch(e){return null}})(decodeURIComponent(r.firebaseError)):null)?void 0:n.code)?void 0:r.split("auth/"))?void 0:n[1])?Gi(r):null)?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:n,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}:null}function lh(){return xs(So)}function hh(e){return Ms("authEvent",e.config.apiKey,e.name)}function uh(e){var t,r;return null!=e&&e.includes("?")?([t,...r]=e.split("?"),ke(r.join("?"))):{}}class ch{constructor(){this._redirectPersistence=No,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=bl,this._overrideRedirectResult=gl}async _initialize(e){var t=e._key();let r=this.eventManagers.get(t);return r||(r=new ih(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){Hi(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,n){i=e,a=eh(),m("function"==typeof(null==(s=null==a?void 0:a.universalLinks)?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),m(void 0!==(null==(s=null==a?void 0:a.BuildInfo)?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),m("function"==typeof(null==(s=null==(s=null==(s=null==a?void 0:a.cordova)?void 0:s.plugins)?void 0:s.browsertab)?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),m("function"==typeof(null==(s=null==(s=null==(s=null==a?void 0:a.cordova)?void 0:s.plugins)?void 0:s.browsertab)?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),m("function"==typeof(null==(a=null==(s=null==a?void 0:a.cordova)?void 0:s.InAppBrowser)?void 0:a.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});var i,s=await this._initialize(e),a=(await s.initialized(),s.resetRedirect(),dl.clear(),await this._originValidation(e),sh(e,r,n)),a=(i=e,r=a,await lh()._set(hh(i),r),await th(e,a,t));return(async(a,o,l)=>{let h=eh().cordova,u=()=>{};try{await new Promise((t,e)=>{let r=null;function n(){t();var e=null==(e=h.plugins.browsertab)?void 0:e.close;"function"==typeof e&&e(),"function"==typeof(null==l?void 0:l.close)&&l.close()}function i(){r=r||window.setTimeout(()=>{e(Gi(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null==document?void 0:document.visibilityState)&&i()}o.addPassiveListener(n),document.addEventListener("resume",i,!1),zs()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(n),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),r&&window.clearTimeout(r)}})}finally{u()}})(e,s,await rh(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=(async e=>{var t=eh().BuildInfo,r={};Hs()?r.iosBundleId=t.packageName:zs()?r.androidPackageName=t.packageName:Hi(e,"operation-not-supported-in-this-environment"),await kl(e,r)})(e)),this.originValidationPromises[t]}attachCallbackListeners(n,i){var{universalLinks:e,handleOpenURL:t,BuildInfo:r}=eh();let s=setTimeout(async()=>{await ah(n),i.onEvent(ph())},500),a=async e=>{clearTimeout(s);var t=await ah(n);let r=null;t&&null!=e&&e.url&&(r=oh(t,e.url)),i.onEvent(r||ph())},o=(void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a),t),l=r.packageName.toLowerCase()+"://";eh().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(l)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}}let dh=ch;function ph(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Gi("no-auth-event")}}function fh(){var e;return(null==(e=null==self?void 0:self.location)?void 0:e.protocol)||null}function gh(e=te()){return!("file:"!==fh()&&"ionic:"!==fh()&&"capacitor:"!==fh()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function mh(e=te()){return oe()&&11===(null==document?void 0:document.documentMode)||([e=te()]=[e],/Edge\/\d+/.test(e))}function vh(){try{var e=self.localStorage,t=Po();if(e)return e.setItem(t,"1"),e.removeItem(t),!mh()||ue()}catch(e){return _h()&&ue()}return!1}function _h(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function yh(){return("http:"===fh()||"https:"===fh()||se()||gh())&&!(ae()||ne())&&vh()&&!_h()}function wh(){return gh()&&"undefined"!=typeof document}let bh={LOCAL:"local",NONE:"none",SESSION:"session"},Ih=m,Th="persistence";async function Eh(e){await e._initializationPromise;var t=Ch(),r=Ms(Th,e.config.apiKey,e.name);t&&t.setItem(r,e._getPersistence())}function Ch(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}let kh=m;class Sh{constructor(){this.browserResolver=xs(Ql),this.cordovaResolver=xs(dh),this.underlyingResolver=null,this._redirectPersistence=No,this._completeRedirectFn=bl,this._overrideRedirectResult=gl}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,n)}async _openRedirect(e,t,r,n){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,n)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return wh()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return kh(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!wh()&&new Promise(e=>{let t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Ah(e){return e.unwrap()}function Nh(e,t){var r,n,i,s,a=null==(a=t.customData)?void 0:a._tokenResponse;"auth/multi-factor-auth-required"===(null==t?void 0:t.code)?t.resolver=new xh(e,(r=t,i=w(e),m((s=r).customData.operationType,i,"argument-error"),m(null==(n=s.customData._serverResponse)?void 0:n.mfaPendingCredential,i,"argument-error"),wo._fromError(i,s))):a&&(i=Rh(n=t))&&(n.credential=i,n.tenantId=a.tenantId||void 0,n.email=a.email||void 0,n.phoneNumber=a.phoneNumber||void 0)}function Rh(e){var t=(e instanceof pe?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof pe)&&"temporaryProof"in t&&"phoneNumber"in t)return rl.credentialFromResult(e);var r=t.providerId;if(!r||r===Ui.PASSWORD)return null;let n;switch(r){case Ui.GOOGLE:n=xa;break;case Ui.FACEBOOK:n=Da;break;case Ui.GITHUB:n=Oa;break;case Ui.TWITTER:n=Fa;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:l}=t;return s||a||i||o?o?r.startsWith("saml.")?La._create(r,o):Ta._fromParams({providerId:r,signInMethod:r,pendingToken:o,idToken:i,accessToken:s}):new Pa(r).credential({idToken:i,accessToken:s,rawNonce:l}):null}return e instanceof pe?n.credentialFromError(e):n.credentialFromResult(e)}function Ph(t,e){return e.catch(e=>{throw e instanceof pe&&Nh(t,e),e}).then(e=>{var t=e.operationType,r=e.user;return{operationType:t,credential:Rh(e),additionalUserInfo:_o(e),user:Oh.getOrCreate(r)}})}async function Dh(t,e){let r=await e;return{verificationId:r.verificationId,confirm:e=>Ph(t,r.confirm(e))}}class xh{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ph(Ah(this.auth),this.resolver.resolveSignIn(e))}}class Oh{constructor(e){var t;this._delegate=e,this.multiFactor=(t=w(e),To.has(t)||To.set(t,Io._fromUser(t)),To.get(t))}static getOrCreate(e){return Oh.USER_MAP.has(e)||Oh.USER_MAP.set(e,new Oh(e)),Oh.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ph(this.auth,Ya(this._delegate,e))}async linkWithPhoneNumber(e,t){return Dh(this.auth,(async(e,t,r)=>{let n=w(e);await Ha(!1,n,"phone");var i=await el(n.auth,t,w(r));return new Zo(i,e=>Ya(n,e))})(this._delegate,e,t))}async linkWithPopup(e){return Ph(this.auth,(async(e,t,r)=>{var n=w(e),i=(Yi(n.auth,t,Na),nl(n.auth,r));return new ul(n.auth,"linkViaPopup",t,i,n).executeNotNull()})(this._delegate,e,Sh))}async linkWithRedirect(e){return await Eh(Xs(this.auth)),wl(this._delegate,e,Sh)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ph(this.auth,Ja(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Dh(this.auth,(async(e,t,r)=>{let n=w(e);var i;return h(n.auth.app)?Promise.reject(Qi(n.auth)):(i=await el(n.auth,t,w(r)),new Zo(i,e=>Ja(n,e)))})(this._delegate,e,t))}reauthenticateWithPopup(e){return Ph(this.auth,(async(e,t,r)=>{var n=w(e);if(h(n.auth.app))return Promise.reject(Gi(n.auth,"operation-not-supported-in-this-environment"));Yi(n.auth,t,Na);var i=nl(n.auth,r);return new ul(n.auth,"reauthViaPopup",t,i,n).executeNotNull()})(this._delegate,e,Sh))}async reauthenticateWithRedirect(e){return await Eh(Xs(this.auth)),yl(this._delegate,e,Sh)}sendEmailVerification(e){return oo(this._delegate,e)}async unlink(e){return await Ka(this._delegate,e),this}updateEmail(e){return t=this._delegate,e=e,h((r=w(t)).auth.app)?Promise.reject(Qi(r.auth)):uo(r,e,null);var t,r}updatePassword(e){return uo(w(this._delegate),null,e)}updatePhoneNumber(e){return(async(e,t)=>{var r=w(e);if(h(r.auth.app))return Promise.reject(Qi(r.auth));await Wa(r,t)})(this._delegate,e)}updateProfile(e){return ho(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return lo(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Oh.USER_MAP=new WeakMap;let Lh=m;class Mh{constructor(e,t){var r,n;this.app=e,t.isInitialized()?this._delegate=t.getImmediate():(r=e.options.apiKey,Lh(r,"invalid-api-key",{appName:e.name}),Lh(r,"invalid-api-key",{appName:e.name}),n="undefined"!=typeof window?Sh:void 0,this._delegate=t.initialize({options:{persistence:((e,t)=>{var r=((e,t)=>{var r=Ch();if(!r)return[];var n=Ms(Th,e,t);switch(r.getItem(n)){case bh.NONE:return[Ls];case bh.LOCAL:return[Ko,No];case bh.SESSION:return[No];default:return[]}})(e,t);if("undefined"==typeof self||r.includes(Ko)||r.push(Ko),"undefined"!=typeof window)for(var n of[So,No])r.includes(n)||r.push(n);return r.includes(Ls)||r.push(Ls),r})(r,e.name),popupRedirectResolver:n}}),this._delegate._updateErrorMap(ji)),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Oh.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){ca(this._delegate,e,t)}applyActionCode(e){return io(this._delegate,e)}checkActionCode(e){return so(this._delegate,e)}confirmPasswordReset(e,t){return(async(t,e,r)=>{await ga(w(t),{oobCode:e,newPassword:r}).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&no(t),e})})(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ph(this._delegate,(async(t,e,r)=>{var n,i;return h(t.app)?Promise.reject(Qi(t)):(i=await ua(n=Xs(t),{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ua,"EMAIL_PASSWORD_PROVIDER").catch(e=>{throw"auth/password-does-not-meet-requirements"===e.code&&no(t),e}),i=await Va._fromIdTokenResponse(n,"signIn",i),await n._updateCurrentUser(i.user),i)})(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return ao(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=Sa.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){Lh(yh(),this._delegate,"operation-not-supported-in-this-environment");e=this._delegate,t=Sh,await Xs(e)._initializationPromise;var e,t,r=await bl(e,t,!1);return r?Ph(this._delegate,Promise.resolve(r)):{credential:null,user:null}}addFrameworkForLogging(e){Xs(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,r){var{next:n,error:i,complete:s}=Fh(e,t,r);return this._delegate.onAuthStateChanged(n,i,s)}onIdTokenChanged(e,t,r){var{next:n,error:i,complete:s}=Fh(e,t,r);return this._delegate.onIdTokenChanged(n,i,s)}sendSignInLinkToEmail(e,t){return(async(e,t,r)=>{let n=Xs(e);var i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};e=i,m((t=r).handleCodeInApp,n,"argument-error"),t&&ro(n,e,t),await ua(n,i,"getOobCode",wa,"EMAIL_PASSWORD_PROVIDER")})(this._delegate,e,t)}sendPasswordResetEmail(e,t){return(async(e,t,r)=>{var n=Xs(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};r&&ro(n,i,r),await ua(n,i,"getOobCode",ya,"EMAIL_PASSWORD_PROVIDER")})(this._delegate,e,t||void 0)}async setPersistence(e){var t,r;t=this._delegate,r=e,Ih(Object.values(bh).includes(r),t,"invalid-persistence-type"),ae()?Ih(r!==bh.SESSION,t,"unsupported-persistence-type"):ne()?Ih(r===bh.NONE,t,"unsupported-persistence-type"):_h()?Ih(r===bh.NONE||r===bh.LOCAL&&ue(),t,"unsupported-persistence-type"):Ih(r===bh.NONE||vh(),t,"unsupported-persistence-type");let n;switch(e){case bh.SESSION:n=No;break;case bh.LOCAL:var i=await xs(Ko)._isAvailable();n=i?Ko:So;break;case bh.NONE:n=Ls;break;default:return Hi("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(n)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ph(this._delegate,(async e=>{var t,r;return h(e.app)?Promise.reject(Qi(e)):(await(t=Xs(e))._initializationPromise,null!=(r=t.currentUser)&&r.isAnonymous?new Va({user:t.currentUser,providerId:null,operationType:"signIn"}):(r=await Ua(t,{returnSecureToken:!0}),r=await Va._fromIdTokenResponse(t,"signIn",r,!0),await t._updateCurrentUser(r.user),r))})(this._delegate))}signInWithCredential(e){return Ph(this._delegate,Qa(this._delegate,e))}signInWithCustomToken(e){return Ph(this._delegate,Xa(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ph(this._delegate,(r=this._delegate,e=e,t=t,h(r.app)?Promise.reject(Qi(r)):Qa(w(r),Aa.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&no(r),e})));var r}signInWithEmailLink(e,t){return Ph(this._delegate,(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(Qi(e)):(n=w(e),m((i=Aa.credentialWithLink(t,r||es()))._tenantId===(n.tenantId||null),n,"tenant-id-mismatch"),Qa(n,i))})(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Dh(this._delegate,(async(e,t,r)=>{if(h(e.app))return Promise.reject(Qi(e));let n=Xs(e);var i=await el(n,t,w(r));return new Zo(i,e=>Qa(n,e))})(this._delegate,e,t))}async signInWithPopup(e){return Lh(yh(),this._delegate,"operation-not-supported-in-this-environment"),Ph(this._delegate,(async(e,t,r)=>{var n,i;return h(e.app)?Promise.reject(Gi(e,"operation-not-supported-in-this-environment")):(n=Xs(e),Yi(e,t,Na),i=nl(n,r),new ul(n,"signInViaPopup",t,i).executeNotNull())})(this._delegate,e,Sh))}async signInWithRedirect(e){return Lh(yh(),this._delegate,"operation-not-supported-in-this-environment"),await Eh(this._delegate),_l(this._delegate,e,Sh)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return(async(e,t)=>{var r=(await so(w(e),t)).data;return r.email})(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Fh(e,t,r){let n=e,i=("function"!=typeof e&&({next:n,error:t,complete:r}=e),n);return{next:e=>i(e&&Oh.getOrCreate(e)),error:t,complete:r}}Mh.Persistence=bh;class Uh{static credential(e,t){return rl.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new rl(Ah(rr.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Uh.PHONE_SIGN_IN_METHOD=rl.PHONE_SIGN_IN_METHOD,Uh.PROVIDER_ID=rl.PROVIDER_ID;let Vh=m;class qh{constructor(e,t,r=rr.app()){var n;Vh(null==(n=r.options)?void 0:n.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new Xo(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(t=rr).INTERNAL.registerComponent(new u("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new Mh(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Vi.EMAIL_SIGNIN,PASSWORD_RESET:Vi.PASSWORD_RESET,RECOVER_EMAIL:Vi.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Vi.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Vi.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Vi.VERIFY_EMAIL}},EmailAuthProvider:Aa,FacebookAuthProvider:Da,GithubAuthProvider:Oa,GoogleAuthProvider:xa,OAuthProvider:Pa,SAMLAuthProvider:Ma,PhoneAuthProvider:Uh,PhoneMultiFactorGenerator:Jl,RecaptchaVerifier:qh,TwitterAuthProvider:Fa,Auth:Mh,AuthCredential:fa,Error:pe}).setInstantiationMode("LAZY").setMultipleInstances(!1)),t.registerVersion("@firebase/auth-compat","0.5.19");let jh="@firebase/database",Bh="";function zh(e){Bh=e}class Kh{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ve(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:me(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Wh{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return ye(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}function Hh(e){try{var t;if("undefined"!=typeof window&&void 0!==window[e])return(t=window[e]).setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Kh(t)}catch(e){}return new Wh}var Gh;function $h(e){var t=(t=>{var r,n,i=[];let s=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);55296<=e&&e<=56319&&(r=e-55296,a++,g(a<t.length,"Surrogate pair missing trail surrogate."),n=t.charCodeAt(a)-56320,e=65536+(r<<10)+n),e<128?i[s++]=e:(e<2048?i[s++]=e>>6|192:(e<65536?i[s++]=e>>12|224:(i[s++]=e>>18|240,i[s++]=e>>12&63|128),i[s++]=e>>6&63|128),i[s++]=63&e|128)}return i})(e),r=new Ae,t=(r.update(t),r.digest());return a.encodeByteArray(t)}function Qh(t){return function(...e){hu(t,...e)}}function Yh(...e){var t="FIREBASE INTERNAL ERROR: "+su(...e);nu.error(t)}function Jh(e,t){return e===t?0:e<t?-1:1}function Xh(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+ve(t))}function Zh(e){if("object"!=typeof e||null===e)return ve(e);var t,r=[];for(t in e)r.push(t);r.sort();let n="{";for(let i=0;i<r.length;i++)0!==i&&(n+=","),n=(n=n+ve(r[i])+":")+Zh(e[r[i]]);return n+="}"}function eu(e,t){var r=e.length;if(r<=t)return[e];var n=[];for(let i=0;i<r;i+=t)i+t>r?n.push(e.substring(i,r)):n.push(e.substring(i,i+t));return n}let tu=Hh("localStorage"),ru=Hh("sessionStorage"),nu=new Qe("@firebase/database"),iu=(()=>{let e=1;return function(){return e++}})(),su=function(...e){let t="";for(let n=0;n<e.length;n++){var r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=su.apply(null,r):t+="object"==typeof r?ve(r):r,t+=" "}return t},au=null,ou=!0,lu=function(e,t){g(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(nu.logLevel=c.VERBOSE,au=nu.log.bind(nu),t&&ru.set("logging_enabled",!0)):"function"==typeof e?au=e:(au=null,ru.remove("logging_enabled"))},hu=function(...e){var t;!0===ou&&(ou=!1,null===au)&&!0===ru.get("logging_enabled")&&lu(!0),au&&(t=su.apply(null,e),au(t))},uu=function(...e){var t="FIREBASE FATAL ERROR: "+su(...e);throw nu.error(t),new Error(t)},cu=function(...e){var t="FIREBASE WARNING: "+su(...e);nu.warn(t)},du=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&cu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},pu=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},fu="[MIN_NAME]",gu="[MAX_NAME]",mu=function(e,t){var r,n;return e===t?0:e===fu||t===gu?-1:t===fu||e===gu?1:(r=yu(e),n=yu(t),null!==r?null!==n?r-n==0?e.length-t.length:r-n:-1:null===n&&e<t?-1:1)};function vu(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}function _u(e){g(!pu(e),"Invalid JSON number");let t,r,n,i,s;0===e?(r=0,n=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),n=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),r=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(r=0,Math.round(e/Math.pow(2,-1074))));var a=[];for(s=52;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);for(s=11;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);a.push(t?1:0),a.reverse();var o=a.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()}function yu(e){if(bu.test(e)){var t=Number(e);if(t>=Iu&&t<=Tu)return t}return null}function wu(e,t){var r=setTimeout(e,t);return"number"==typeof r&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(r):"object"==typeof r&&r.unref&&r.unref(),r}let bu=new RegExp("^-?(0*)\\d{1,10}$"),Iu=-2147483648,Tu=2147483647,Eu=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw cu("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Cu{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,h(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(r){if(this.serverAppAppCheckToken){if(r)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(r):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(r).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!=(e=this.appCheckProvider)&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){cu(`Provided AppCheck credentials for the app named "${this.appName}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class ku{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(e=>this.auth_=e)}getToken(r){return this.auth_?this.auth_.getToken(r).catch(e=>e&&"auth/token-not-initialized"===e.code?(hu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(r).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',cu(e)}}class Su{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Su.OWNER="owner";let Au=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Nu="websocket",Ru="long_polling";class Pu{constructor(e,t,r,n,i=!1,s="",a=!1,o=!1,l=null){this.secure=t,this.namespace=r,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tu.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost())&&tu.set("host:"+this._host,this.internalHost)}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t}}function Du(e,t,r){g("string"==typeof t,"typeof type must == string"),g("object"==typeof r,"typeof params must == object");let n;if(t===Nu)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Ru)throw new Error("Unknown connection type: "+t);n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(r.ns=e.namespace);let i=[];return vu(r,(e,t)=>{i.push(e+"="+t)}),n+i.join("&")}class xu{constructor(){this.counters_={}}incrementCounter(e,t=1){ye(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return W(void 0,this.counters_)}}let Ou={},Lu={};function Mu(e){var t=e.toString();return Ou[t]||(Ou[t]=new xu),Ou[t]}class Fu{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Eu(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Uu{constructor(e,t,r,n,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Qh(e),this.stats_=Mu(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Du(t,Ru,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Fu(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4));var r=()=>{var e;this.isClosed_||(this.scriptTagHolder=new Vu((...e)=>{var[t,r,n,,,]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=r,this.password=n;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);r?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(r,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,r]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,r)},()=>{this.onClosed_()},this.urlFn),(e={start:"t"}).ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Au.test(location.hostname)&&(e.r="f"),e=this.urlFn(e),this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{}))};if("complete"===document.readyState)r();else{let e=!1,t=function(){document.body?e||(e=!0,r()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Uu.forceAllow_=!0}static forceDisallow(){Uu.forceDisallow_=!0}static isAvailable(){return!!Uu.forceAllow_||!(Uu.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=ve(e),t=(this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length),o(t)),r=eu(t,1840);for(let n=0;n<r.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[n]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");var r={dframe:"t"};r.id=e,r.pw=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=ve(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Vu{constructor(t,r,e,n){this.onDisconnect=e,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=iu(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=r,this.myIFrame=Vu.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){hu("frame writing exception"),e.stack&&hu(e.stack),hu(e)}}}static createIFrame_(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||hu("No IE domain setting required")}catch(e){var r=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var r={},r=(r.id=this.myID,r.pw=this.myPW,r.ser=this.currentSerial,this.urlFn(r));let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var n=this.pendingSegs.shift();e=e+"&seg"+t+"="+n.seg+"&ts"+t+"="+n.ts+"&d"+t+"="+n.d,t++}return r+=e,this.addLongPollTag_(r,this.currentSerial),!0}return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(r,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),r()})}addTag(e,r){setTimeout(()=>{try{if(this.sendNewPolls){let t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),r())},t.onerror=()=>{hu("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}}catch(e){}},Math.floor(1))}}let qu=null;"undefined"!=typeof MozWebSocket?qu=MozWebSocket:"undefined"!=typeof WebSocket&&(qu=WebSocket);class ju{constructor(e,t,r,n,i,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Qh(this.connId),this.stats_=Mu(t),this.connURL=ju.connectionURL_(t,s,a,n,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,n,i){var s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Au.test(location.hostname)&&(s.r="f"),t&&(s.s=t),r&&(s.ls=r),n&&(s.ac=n),i&&(s.p=i),Du(e,Nu,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tu.set("previous_websocket_failure",!0);try{le(),this.mySock=new qu(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var r=e.message||e.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ju.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return!(e="undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4?!0:e)&&null!==qu&&!ju.forceDisallow_}static previouslyFailed(){return tu.isInMemoryStorage||!0===tu.get("previous_websocket_failure")}markConnectionHealthy(){tu.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=me(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(g(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=ve(e),r=(this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length),eu(t,16384));1<r.length&&this.sendString_(String(r.length));for(let n=0;n<r.length;n++)this.sendString_(r[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ju.responsesRequiredToBeHealthy=2,ju.healthyTimeout=3e4;class Bu{static get ALL_TRANSPORTS(){return[Uu,ju]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){var t=ju&&ju.isAvailable();let r=t&&!ju.previouslyFailed();if(e.webSocketOnly&&(t||cu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ju];else{var n,i=this.transports_=[];for(n of Bu.ALL_TRANSPORTS)n&&n.isAvailable()&&i.push(n);Bu.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Bu.globalTransportInitialized_=!1;class zu{constructor(e,t,r,n,i,s,a,o,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Qh("c:"+this.id+":"),this.transportManager_=new Bu(t),this.log_("Connection created"),this.start_()}start_(){var e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));e=e.healthyTimeout||0;0<e&&(this.healthyTimeout_=wu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(e)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=Xh("t",e),r=Xh("d",e);if("c"===t)this.onSecondaryControl_(r);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=Xh("t",e),r=Xh("d",e);"c"===t?this.onControl_(r):"d"===t&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=Xh("t",e);if("d"in e){var r=e.d;if("h"===t){var n=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(n.h=this.repoInfo_.host),this.onHandshake_(n)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(r):"r"===t?this.onReset_(r):"e"===t?Yh("Server Error: "+r):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Yh("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,r=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==r&&cu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),wu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):wu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_)&&(this.onDisconnect_(),this.onDisconnect_=null)}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ku{put(e,t,r,n){}merge(e,t,r,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class Wu{constructor(e){this.allowedEvents_=e,this.listeners_={},g(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...r){if(Array.isArray(this.listeners_[t])){var n=[...this.listeners_[t]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,r)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});var n=this.getInitialEvent(e);n&&t.apply(r,n)}off(e,t,r){this.validateEventType_(e);var n=this.listeners_[e]||[];for(let i=0;i<n.length;i++)if(n[i].callback===t&&(!r||r===n[i].context))return void n.splice(i,1)}validateEventType_(t){g(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Hu extends Wu{static getInstance(){return new Hu}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||re()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return g("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}let Gu=32,$u=768;class f{constructor(r,e){if(void 0===e){this.pieces_=r.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=r,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function v(){return new f("")}function _(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Qu(e){return e.pieces_.length-e.pieceNum_}function y(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new f(e.pieces_,t)}function Yu(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ju(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Xu(e){if(e.pieceNum_>=e.pieces_.length)return null;var t=[];for(let r=e.pieceNum_;r<e.pieces_.length-1;r++)t.push(e.pieces_[r]);return new f(t,0)}function Zu(e,t){var r=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)r.push(e.pieces_[i]);if(t instanceof f)for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);else{var n=t.split("/");for(let e=0;e<n.length;e++)0<n[e].length&&r.push(n[e])}return new f(r,0)}function b(e){return e.pieceNum_>=e.pieces_.length}function ec(e,t){var r=_(e),n=_(t);if(null===r)return t;if(r===n)return ec(y(e),y(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function tc(e,t){var r=Ju(e,0),n=Ju(t,0);for(let s=0;s<r.length&&s<n.length;s++){var i=mu(r[s],n[s]);if(0!==i)return i}return r.length===n.length?0:r.length<n.length?-1:1}function rc(e,t){if(Qu(e)!==Qu(t))return!1;for(let r=e.pieceNum_,n=t.pieceNum_;r<=e.pieces_.length;r++,n++)if(e.pieces_[r]!==t.pieces_[n])return!1;return!0}function nc(e,t){let r=e.pieceNum_,n=t.pieceNum_;if(Qu(e)>Qu(t))return!1;for(;r<e.pieces_.length;){if(e.pieces_[r]!==t.pieces_[n])return!1;++r,++n}return!0}class ic{constructor(e,t){this.errorPrefix_=t,this.parts_=Ju(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Le(this.parts_[r]);sc(this)}}function sc(e){if(e.byteLength_>$u)throw new Error(e.errorPrefix_+"has a key path longer than "+$u+" bytes ("+e.byteLength_+").");if(e.parts_.length>Gu)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Gu+") or object contains a cycle "+ac(e))}function ac(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class oc extends Wu{static getInstance(){return new oc}constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}getInitialEvent(e){return g("visible"===e,"Unknown event type: "+e),[this.visible_]}}class lc extends Ku{constructor(e,t,r,n,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=lc.nextPersistentConnectionId_++,this.log_=Qh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!le())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");oc.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Hu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){var n=++this.requestNumber_,i={r:n,a:e,b:t};this.log_(ve(i)),g(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[n]=r)}get(e){this.initConnection_();let r=new Z;var t={p:e._path.toString(),q:e._queryObject},t=(this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?r.resolve(t):r.reject(t)}}),this.outstandingGetCount_++,this.outstandingGets_.length-1);return this.connected_&&this.sendGet_(t),r.promise}listen(e,t,r,n){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g(!this.listens.get(s).has(i),"listen() called twice for same path/queryId."),{onComplete:n,hashFn:t,query:e,tag:r});this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(e)})}sendListen_(i){let s=i.query,a=s._path.toString(),o=s._queryIdentifier;this.log_("Listen on "+a+" for "+o);var e={p:a};i.tag&&(e.q=s._queryObject,e.t=i.tag),e.h=i.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,r=e.s,n=(lc.warnOnListenWarnings_(t,s),this.listens.get(a)&&this.listens.get(a).get(o));n===i&&(this.log_("listen response",e),"ok"!==r&&this.removeListen_(a,o),i.onComplete)&&i.onComplete(r,t)})}static warnOnListenWarnings_(e,t){var r,n;e&&"object"==typeof e&&ye(e,"w")&&(r=we(e,"w"),Array.isArray(r))&&~r.indexOf("no_index")&&(r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString(),cu("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${r} at `+n+" to your security rules for better performance."))}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=_e(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_;r=n;var e=!!(e=_e(r).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")?"auth":"gauth",t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,r=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,r))})}var r,e}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,r=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){var r=e._path.toString(),n=e._queryIdentifier,i=(this.log_("Unlisten called for "+r+" "+n),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,n));i&&this.connected_&&this.sendUnlisten_(r,n,e._queryObject,t)}sendUnlisten_(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);var i={p:e};n&&(i.q=r,i.t=n),this.sendRequest("n",i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,n){var i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,r,n){this.putInternal("p",e,t,r,n)}merge(e,t,r,n){this.putInternal("m",e,t,r,n)}putInternal(e,t,r,n,i){this.initConnection_();var s={p:t,d:r},s=(void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++,this.outstandingPuts_.length-1);this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(t){let r=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;let n=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,e,e=>{this.log_(r+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+ve(e));var t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Yh("Unrecognized action received from server: "+ve(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){g(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_),e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this);let e=this.onRealtimeDisconnect_.bind(this);var s=this.id+":"+lc.nextConnectionId_++,a=this.lastSessionId;let t=!1,r=null;var o=function(){r?r.close():(t=!0,e())},l=(this.realtime_={close:o,sendRequest:function(e){g(r,"sendRequest call when we're not connected not allowed."),r.sendRequest(e)}},this.forceTokenRefresh_);this.forceTokenRefresh_=!1;try{var[h,u]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);t?hu("getToken() completed but was canceled"):(hu("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=u&&u.token,r=new zu(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,i,e,e=>{cu(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},a))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&cu(e),o())}}}interrupt(e){hu("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){hu("Resuming connection for reason: "+e),delete this.interruptReasons_[e],be(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;r=t?t.map(e=>Zh(e)).join("$"):"default";var n=this.removeListen_(e,r);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){var r,n=new f(e).toString();let i;return this.listens.has(n)?(r=this.listens.get(n),i=r.get(t),r.delete(t),0===r.size&&this.listens.delete(n)):i=void 0,i}onAuthRevoked_(e,t){hu("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){hu("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(var e of this.listens.values())for(var t of e.values())this.sendListen_(t);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){var r=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(r.action,r.pathString,r.data,r.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){var e={};e["sdk.js."+Bh.replace(/\./g,"-")]=1,re()?e["framework.cordova"]=1:ae()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Hu.getInstance().currentlyOnline();return be(this.interruptReasons_)&&e}}lc.nextPersistentConnectionId_=0,lc.nextConnectionId_=0;class p{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new p(e,t)}}class hc{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var r=new p(fu,e),n=new p(fu,t);return 0!==this.compare(r,n)}minPost(){return p.MIN}}let uc;class cc extends hc{static get __EMPTY_NODE(){return uc}static set __EMPTY_NODE(e){uc=e}compare(e,t){return mu(e.name,t.name)}isDefinedOn(e){throw j("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return p.MIN}maxPost(){return new p(gu,uc)}makePost(e,t){return g("string"==typeof e,"KeyIndex indexValue must always be a string."),new p(e,uc)}toString(){return".key"}}let dc=new cc;class pc{constructor(e,t,r,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){var e;return 0===this.nodeStack_.length?null:(e=this.nodeStack_[this.nodeStack_.length-1],this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value})}}class fc{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:fc.RED,this.left=null!=n?n:mc.EMPTY_NODE,this.right=null!=i?i:mc.EMPTY_NODE}copy(e,t,r,n,i){return new fc(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;var i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp_()}removeMin_(){if(this.left.isEmpty())return mc.EMPTY_NODE;let e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let r,n;if(t(e,(r=this).key)<0)r=(r=r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()?r:r.moveRedLeft_()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed_()?r.rotateRight_():r).right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()?r:r.moveRedRight_()).key)){if(r.right.isEmpty())return mc.EMPTY_NODE;n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e=(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e}moveRedLeft_(){let e=this.colorFlip_();return e=e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e}moveRedRight_(){let e=this.colorFlip_();return e=e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e}rotateLeft_(){var e=this.copy(null,null,fc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,fc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}fc.RED=!0,fc.BLACK=!1;class gc{copy(e,t,r,n,i){return this}insert(e,t,r){return new fc(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class mc{constructor(e,t=mc.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new mc(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fc.BLACK,null,null))}remove(e){return new mc(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fc.BLACK,null,null))}get(e){var t;let r=this.root_;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key)))return r.value;t<0?r=r.left:0<t&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,n=null;for(;!r.isEmpty();){if(0===(t=this.comparator_(e,r.key))){if(r.left.isEmpty())return n?n.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}t<0?r=r.left:0<t&&(r=(n=r).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new pc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new pc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new pc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new pc(this.root_,null,this.comparator_,!0,e)}}function vc(e,t){return mu(e.name,t.name)}function _c(e,t){return mu(e,t)}mc.EMPTY_NODE=new gc;let yc;function wc(e){return"number"==typeof e?"number:"+_u(e):"string:"+e}function bc(e){var t;e.isLeafNode()?(t=e.val(),g("string"==typeof t||"number"==typeof t||"object"==typeof t&&ye(t,".sv"),"Priority must be a string or number.")):g(e===yc||e.isEmpty(),"priority of unexpected type."),g(e===yc||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Ic;class Tc{static set __childrenNodeConstructor(e){Ic=e}static get __childrenNodeConstructor(){return Ic}constructor(e,t=Tc.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,g(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),bc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Tc(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Tc.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return b(e)?this:".priority"===_(e)?this.priorityNode_:Tc.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Tc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var r=_(e);return null===r?t:t.isEmpty()&&".priority"!==r?this:(g(".priority"!==r||1===Qu(e),".priority must be the last token in a path"),this.updateImmediateChild(r,Tc.__childrenNodeConstructor.EMPTY_NODE.updateChild(y(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+wc(this.priorityNode_.val())+":");var t=typeof this.value_;e=(e+=t+":")+("number"==t?_u(this.value_):this.value_),this.lazyHash_=$h(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Tc.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Tc.__childrenNodeConstructor?-1:(g(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,r=typeof this.value_,n=Tc.VALUE_TYPE_ORDER.indexOf(t),i=Tc.VALUE_TYPE_ORDER.indexOf(r);return g(0<=n,"Unknown leaf type: "+t),g(0<=i,"Unknown leaf type: "+r),n===i?"object"==r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}Tc.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Ec,Cc;class kc extends hc{compare(e,t){var r=e.node.getPriority(),n=t.node.getPriority(),r=r.compareTo(n);return 0===r?mu(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return p.MIN}maxPost(){return new p(gu,new Tc("[PRIORITY-POST]",Cc))}makePost(e,t){var r=Ec(e);return new p(t,new Tc("[PRIORITY-POST]",r))}toString(){return".priority"}}let I=new kc,Sc=Math.log(2);class Ac{constructor(e){this.count=(t=e+1,parseInt(Math.log(t)/Sc,10)),this.current_=this.count-1,t=this.count;var t,r=parseInt(Array(t+1).join("1"),2);this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Nc(l,e,h,t){l.sort(e);let u=function(e,t){var r,n,i=t-e;let s,a;return 0==i?null:1==i?(s=l[e],a=h?h(s):s,new fc(a,s.node,fc.BLACK,null,null)):(i=parseInt(i/2,10)+e,r=u(e,i),n=u(i+1,t),s=l[i],a=h?h(s):s,new fc(a,s.node,fc.BLACK,r,n))};var r=(e=>{let s=null,a=null,o=l.length;function t(e,t){var r=o-e,n=o,n=(o-=e,u(1+r,n)),r=l[r],i=h?h(r):r,e=new fc(i,r.node,t,null,n);s=(s?s.left=e:a=e,e)}for(let i=0;i<e.count;++i){var r=e.nextBitIsOne(),n=Math.pow(2,e.count-(i+1));r?t(n,fc.BLACK):(t(n,fc.BLACK),t(n,fc.RED))}return a})(new Ac(l.length));return new mc(t||e,r)}let Rc,Pc={};class Dc{static get Default(){return g((Pc,I),"ChildrenNode.ts has not been loaded"),Rc=Rc||new Dc({".priority":Pc},{".priority":I})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){var t=we(this.indexes_,e);if(t)return t instanceof mc?t:null;throw new Error("No index defined for "+e)}hasIndex(e){return ye(this.indexSet_,e.toString())}addIndex(e,t){g(e!==dc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var r=[];let n=!1;var i=t.getIterator(p.Wrap);let s=i.getNext();for(;s;)n=n||e.isDefinedOn(s.node),r.push(s),s=i.getNext();let a;a=n?Nc(r,e.getCompare()):Pc;var o=e.toString(),l=Object.assign({},this.indexSet_),h=(l[o]=e,Object.assign({},this.indexes_));return h[o]=a,new Dc(h,l)}addToIndexes(s,a){var e=Ie(this.indexes_,(t,e)=>{var r=we(this.indexSet_,e);if(g(r,"Missing index implementation for "+e),t===Pc){if(r.isDefinedOn(s.node)){var n=[],i=a.getIterator(p.Wrap);let e=i.getNext();for(;e;)e.name!==s.name&&n.push(e),e=i.getNext();return n.push(s),Nc(n,r.getCompare())}return Pc}{r=a.get(s.name);let e=t;return(e=r?e.remove(new p(s.name,r)):e).insert(s,s.node)}});return new Dc(e,this.indexSet_)}removeFromIndexes(r,n){var e=Ie(this.indexes_,e=>{var t;return e!==Pc&&(t=n.get(r.name))?e.remove(new p(r.name,t)):e});return new Dc(e,this.indexSet_)}}let xc;class T{static get EMPTY_NODE(){return xc=xc||new T(new mc(_c),null,Dc.Default)}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&bc(this.priorityNode_),this.children_.isEmpty()&&g(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xc}updatePriority(e){return this.children_.isEmpty()?this:new T(this.children_,e,this.indexMap_)}getImmediateChild(e){var t;return".priority"===e?this.getPriority():null===(t=this.children_.get(e))?xc:t}getChild(e){var t=_(e);return null===t?this:this.getImmediateChild(t).getChild(y(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(r,n){if(g(n,"We should always be passing snapshot nodes"),".priority"===r)return this.updatePriority(n);{var i=new p(r,n);let e,t;t=n.isEmpty()?(e=this.children_.remove(r),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(r,n),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?xc:this.priorityNode_;return new T(e,i,t)}}updateChild(e,t){var r,n=_(e);return null===n?t:(g(".priority"!==_(e)||1===Qu(e),".priority must be the last token in a path"),r=this.getImmediateChild(n).updateChild(y(e),t),this.updateImmediateChild(n,r))}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(r){if(this.isEmpty())return null;let n={},i=0,s=0,a=!0;if(this.forEachChild(I,(e,t)=>{n[e]=t.val(r),i++,a&&T.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!r&&a&&s<2*i){var e,t=[];for(e in n)t[e]=n[e];return t}return r&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+wc(this.getPriority().val())+":"),this.forEachChild(I,(e,t)=>{var r=t.hash();""!==r&&(n+=":"+e+":"+r)}),this.lazyHash_=""===n?"":$h(n)}return this.lazyHash_}getPredecessorChildName(e,t,r){var n=this.resolveIndex_(r);return n?(n=n.getPredecessorKey(new p(e,t)))?n.name:null:this.children_.getPredecessorKey(e)}getFirstChildName(e){var t=this.resolveIndex_(e);return t?(t=t.minKey())&&t.name:this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new p(t,this.children_.get(t)):null}getLastChildName(e){var t=this.resolveIndex_(e);return t?(t=t.maxKey())&&t.name:this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new p(t,this.children_.get(t)):null}forEachChild(e,t){var r=this.resolveIndex_(e);return r?r.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,r){var e=this.resolveIndex_(r);if(e)return e.getIteratorFrom(t,e=>e);{var n=this.children_.getIteratorFrom(t.name,p.Wrap);let e=n.peek();for(;null!=e&&r.compare(e,t)<0;)n.getNext(),e=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,r){var e=this.resolveIndex_(r);if(e)return e.getReverseIteratorFrom(t,e=>e);{var n=this.children_.getReverseIteratorFrom(t.name,p.Wrap);let e=n.peek();for(;null!=e&&0<r.compare(e,t);)n.getNext(),e=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Lc?-1:0}withIndex(e){var t;return e===dc||this.indexMap_.hasIndex(e)?this:(t=this.indexMap_.addIndex(e,this.children_),new T(this.children_,this.priorityNode_,t))}isIndexed(e){return e===dc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(!e.isLeafNode()){var r=e;if(this.getPriority().equals(r.getPriority())){if(this.children_.count()!==r.children_.count())return!1;{var n=this.getIterator(I),i=r.getIterator(I);let e=n.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=n.getNext(),t=i.getNext()}return null===e&&null===t}}}return!1}resolveIndex_(e){return e===dc?null:this.indexMap_.get(e.toString())}}T.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Oc extends T{constructor(){super(new mc(_c),T.EMPTY_NODE,Dc.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return T.EMPTY_NODE}isEmpty(){return!1}}let Lc=new Oc,Mc=(Object.defineProperties(p,{MIN:{value:new p(fu,T.EMPTY_NODE)},MAX:{value:new p(gu,Lc)}}),cc.__EMPTY_NODE=T.EMPTY_NODE,Tc.__childrenNodeConstructor=T,t=Lc,yc=t,t=Lc,Cc=t,!0);function Fc(s,e=null){if(null===s)return T.EMPTY_NODE;var t,r;if("object"==typeof s&&".priority"in s&&(e=s[".priority"]),g(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(s="object"==typeof s&&".value"in s&&null!==s[".value"]?s[".value"]:s)||".sv"in s)return t=s,new Tc(t,Fc(e));if(s instanceof Array||!Mc){let n=T.EMPTY_NODE;return vu(s,(e,t)=>{var r;!ye(s,e)||"."===e.substring(0,1)||!(r=Fc(t)).isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(e,r))}),n.updatePriority(Fc(e))}{let n=[],i=!1;return vu(s,(e,t)=>{var r;"."===e.substring(0,1)||(r=Fc(t)).isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new p(e,r)))}),0===n.length?T.EMPTY_NODE:(t=Nc(n,vc,e=>e.name,_c),i?(r=Nc(n,I.getCompare()),new T(t,Fc(e),new Dc({".priority":r},{".priority":I}))):new T(t,Fc(e),Dc.Default))}}Ec=Fc;class Uc extends hc{constructor(e){super(),this.indexPath_=e,g(!b(e)&&".priority"!==_(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){var r=this.extractChild(e.node),n=this.extractChild(t.node),r=r.compareTo(n);return 0===r?mu(e.name,t.name):r}makePost(e,t){var r=Fc(e),r=T.EMPTY_NODE.updateChild(this.indexPath_,r);return new p(t,r)}maxPost(){var e=T.EMPTY_NODE.updateChild(this.indexPath_,Lc);return new p(gu,e)}toString(){return Ju(this.indexPath_,0).join("/")}}class Vc extends hc{compare(e,t){var r=e.node.compareTo(t.node);return 0===r?mu(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return p.MIN}maxPost(){return p.MAX}makePost(e,t){var r=Fc(e);return new p(t,r)}toString(){return".value"}}let qc=new Vc;function jc(e){return{type:"value",snapshotNode:e}}function Bc(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function zc(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Kc(e,t,r){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:r}}class Wc{constructor(e){this.index_=e}updateChild(e,t,r,n,i,s){g(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(n).equals(r.getChild(n))&&a.isEmpty()===r.isEmpty()||(null!=s&&(r.isEmpty()?e.hasChild(t)?s.trackChildChange(zc(t,a)):g(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Bc(t,r)):s.trackChildChange(Kc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(n,r,i){return null!=i&&(n.isLeafNode()||n.forEachChild(I,(e,t)=>{r.hasChild(e)||i.trackChildChange(zc(e,t))}),r.isLeafNode()||r.forEachChild(I,(e,t)=>{var r;n.hasChild(e)?(r=n.getImmediateChild(e)).equals(t)||i.trackChildChange(Kc(e,t,r)):i.trackChildChange(Bc(e,t))})),r.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?T.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Hc{constructor(e){this.indexedFilter_=new Wc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Hc.getStartPost_(e),this.endPost_=Hc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,n,i,s){return this.matches(new p(t,r))||(r=T.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,n,i,s)}updateFullNode(e,t,r){let n=(t=t.isLeafNode()?T.EMPTY_NODE:t).withIndex(this.index_),i=(n=n.updatePriority(T.EMPTY_NODE),this);return t.forEachChild(I,(e,t)=>{i.matches(new p(e,t))||(n=n.updateImmediateChild(e,T.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){var t;return e.hasStart()?(t=e.getIndexStartName(),e.getIndex().makePost(e.getIndexStartValue(),t)):e.getIndex().minPost()}static getEndPost_(e){var t;return e.hasEnd()?(t=e.getIndexEndName(),e.getIndex().makePost(e.getIndexEndValue(),t)):e.getIndex().maxPost()}}class Gc{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Hc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,n,i,s){return this.rangedFilter_.matches(new p(t,r))||(r=T.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,n,i,s):this.fullLimitUpdateChild_(e,t,r,i,s)}updateFullNode(e,r,t){let n;if(r.isLeafNode()||r.isEmpty())n=T.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<r.numChildren()&&r.isIndexed(this.index_)){n=T.EMPTY_NODE.withIndex(this.index_);let e,t=(e=this.reverse_?r.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_),0);for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;n=n.updateImmediateChild(i.name,i.node),t++}}}else{n=(n=r.withIndex(this.index_)).updatePriority(T.EMPTY_NODE);let e,t=(e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_),0);for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:n=n.updateImmediateChild(s.name,T.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,n,i){let s;if(this.reverse_){let r=this.index_.getCompare();s=(e,t)=>r(t,e)}else s=this.index_.getCompare();var a=e,o=(g(a.numChildren()===this.limit_,""),new p(t,r)),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=n.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=n.getChildAfterChild(this.index_,e,this.reverse_);var c=null==e?1:s(e,o);return h&&!r.isEmpty()&&0<=c?(null!=i&&i.trackChildChange(Kc(t,r,u)),a.updateImmediateChild(t,r)):(null!=i&&i.trackChildChange(zc(t,u)),c=a.updateImmediateChild(t,T.EMPTY_NODE),null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Bc(e.name,e.node)),c.updateImmediateChild(e.name,e.node)):c)}return!r.isEmpty()&&h&&0<=s(l,o)?(null!=i&&(i.trackChildChange(zc(l.name,l.node)),i.trackChildChange(Bc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(l.name,T.EMPTY_NODE)):e}}class $c{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=I}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return g(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return g(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fu}hasEnd(){return this.endSet_}getIndexEndValue(){return g(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return g(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:gu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return g(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===I}copy(){var e=new $c;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Qc(e,t,r){var n=e.copy();return n.startSet_=!0,n.indexStartValue_=t=void 0===t?null:t,null!=r?(n.startNameSet_=!0,n.indexStartName_=r):(n.startNameSet_=!1,n.indexStartName_=""),n}function Yc(e,t,r){var n=e.copy();return n.endSet_=!0,n.indexEndValue_=t=void 0===t?null:t,void 0!==r?(n.endNameSet_=!0,n.indexEndName_=r):(n.endNameSet_=!1,n.indexEndName_=""),n}function Jc(e,t){var r=e.copy();return r.index_=t,r}function Xc(t){var r,n={};if(!t.isDefault()){let e;e=t.index_===I?"$priority":t.index_===qc?"$value":t.index_===dc?"$key":(g(t.index_ instanceof Uc,"Unrecognized index type!"),t.index_.toString()),n.orderBy=ve(e),t.startSet_&&(n[r=t.startAfterSet_?"startAfter":"startAt"]=ve(t.indexStartValue_),t.startNameSet_)&&(n[r]+=","+ve(t.indexStartName_)),t.endSet_&&(n[r=t.endBeforeSet_?"endBefore":"endAt"]=ve(t.indexEndValue_),t.endNameSet_)&&(n[r]+=","+ve(t.indexEndName_)),t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_)}return n}function Zc(t){var r={};if(t.startSet_&&(r.sp=t.indexStartValue_,t.startNameSet_&&(r.sn=t.indexStartName_),r.sin=!t.startAfterSet_),t.endSet_&&(r.ep=t.indexEndValue_,t.endNameSet_&&(r.en=t.indexEndName_),r.ein=!t.endBeforeSet_),t.limitSet_){r.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),r.vf=e}return t.index_!==I&&(r.i=t.index_.toString()),r}class ed extends Ku{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(g(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=n,this.log_=Qh("p:rest:"),this.listens_={}}listen(e,t,n,i){let s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+e._queryIdentifier),ed.getListenId_(e,n)),o={};this.listens_[a]=o;var r=Xc(e._queryParams);this.restRequest_(s+".json",r,(t,e)=>{let r=e;if(null===(t=404===t?r=null:t)&&this.onDataUpdate_(s,r,!1,n),we(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var r=ed.getListenId_(e,t);delete this.listens_[r]}get(e){var t=Xc(e._queryParams);let n=e._path.toString(),i=new Z;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;null===(e=404===e?r=null:e)?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);let r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+Ce(s),n=(this.log_("Sending REST request for "+r),new XMLHttpRequest);n.onreadystatechange=()=>{if(a&&4===n.readyState){this.log_("REST Response for "+r+" received. status:",n.status,"response:",n.responseText);let e=null;if(200<=n.status&&n.status<300){try{e=me(n.responseText)}catch(e){cu("Failed to parse JSON response for "+r+": "+n.responseText)}a(null,e)}else 401!==n.status&&404!==n.status&&cu("Got unsuccessful REST response for "+r+" Status: "+n.status),a(n.status);a=null}},n.open("GET",r,!0),n.send()})}}class td{constructor(){this.rootNode_=T.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function rd(){return{value:null,children:new Map}}function nd(e,t,r){var n;b(t)?(e.value=r,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,r):(n=_(t),e.children.has(n)||e.children.set(n,rd()),nd(e.children.get(n),t=y(t),r))}function id(e,r,n){var i;null!==e.value?n(r,e.value):(i=(e,t)=>{id(t,new f(r.toString()+"/"+e),n)},e.children.forEach((e,t)=>{i(t,e)}))}class sd{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();let r=Object.assign({},e);return this.last_&&vu(this.last_,(e,t)=>{r[e]=r[e]-t}),this.last_=e,r}}class ad{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sd(e);var r=1e4+2e4*Math.random();wu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){var e=this.statsListener_.get();let r={},n=!1;vu(e,(e,t)=>{0<t&&ye(this.statsToReport_,e)&&(r[e]=t,n=!0)}),n&&this.server_.reportStats(r),wu(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function od(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ld(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function hd(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(t=Gh=Gh||{})[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class ud{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Gh.ACK_USER_WRITE,this.source=od()}operationForChild(e){var t;return b(this.path)?null!=this.affectedTree.value?(g(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this):(t=this.affectedTree.subtree(new f(e)),new ud(v(),t,this.revert)):(g(_(this.path)===e,"operationForChild called for unrelated child."),new ud(y(this.path),this.affectedTree,this.revert))}}class cd{constructor(e,t){this.source=e,this.path=t,this.type=Gh.LISTEN_COMPLETE}operationForChild(e){return b(this.path)?new cd(this.source,v()):new cd(this.source,y(this.path))}}class dd{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Gh.OVERWRITE}operationForChild(e){return b(this.path)?new dd(this.source,v(),this.snap.getImmediateChild(e)):new dd(this.source,y(this.path),this.snap)}}class pd{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Gh.MERGE}operationForChild(e){var t;return b(this.path)?(t=this.children.subtree(new f(e))).isEmpty()?null:t.value?new dd(this.source,v(),t.value):new pd(this.source,v(),t):(g(_(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new pd(this.source,y(this.path),this.children))}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fd{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){var t;return b(e)?this.isFullyInitialized()&&!this.filtered_:(t=_(e),this.isCompleteForChild(t))}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class gd{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function md(r,e,t,n){var i=[];let s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),vd(r,i,"child_removed",e,n,t),vd(r,i,"child_added",e,n,t),vd(r,i,"child_moved",s,n,t),vd(r,i,"child_changed",e,n,t),vd(r,i,"value",e,n,t),i}function vd(s,a,t,e,o,l){var r=e.filter(e=>e.type===t);r.sort((e,t)=>{var r=s;if(null==e.childName||null==t.childName)throw j("Should only compare child_ events.");var n=new p(e.childName,e.snapshotNode),i=new p(t.childName,t.snapshotNode);return r.index_.compare(n,i)}),r.forEach(t=>{e=s,i=l,"value"!==(n=t).type&&"child_removed"!==n.type&&(n.prevName=i.getPredecessorChildName(n.childName,n.snapshotNode,e.index_));let r=n;var e,n,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(r,s.query_))})})}function _d(e,t){return{eventCache:e,serverCache:t}}function yd(e,t,r,n){return _d(new fd(t,r,n),e.serverCache)}function wd(e,t,r,n){return _d(e.eventCache,new fd(t,r,n))}function bd(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Id(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Td;class E{static fromObject(e){let r=new E(null);return vu(e,(e,t)=>{r=r.set(new f(e),t)}),r}constructor(e,t=Td=Td||new mc(Jh)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){var r,n;return null!=this.value&&t(this.value)?{path:v(),value:this.value}:!b(e)&&(r=_(e),null!==(n=this.children.get(r)))&&null!=(n=n.findRootMostMatchingPathAndValue(y(e),t))?{path:Zu(new f(r),n.path),value:n.value}:null}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){var t;return b(e)?this:(t=_(e),null!==(t=this.children.get(t))?t.subtree(y(e)):new E(null))}set(e,t){var r,n;return b(e)?new E(t,this.children):(n=_(e),r=(this.children.get(n)||new E(null)).set(y(e),t),n=this.children.insert(n,r),new E(this.value,n))}remove(t){if(b(t))return this.children.isEmpty()?new E(null):new E(null,this.children);var r=_(t),n=this.children.get(r);if(n){n=n.remove(y(t));let e;return e=n.isEmpty()?this.children.remove(r):this.children.insert(r,n),null===this.value&&e.isEmpty()?new E(null):new E(this.value,e)}return this}get(e){var t;return b(e)?this.value:(t=_(e),(t=this.children.get(t))?t.get(y(e)):null)}setTree(t,r){if(b(t))return r;{var n=_(t),i=(this.children.get(n)||new E(null)).setTree(y(t),r);let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new E(this.value,e)}}fold(e){return this.fold_(v(),e)}fold_(r,n){let i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(Zu(r,e),n)}),n(r,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,v(),t)}findOnPath_(e,t,r){var n,i=!!this.value&&r(t,this.value);return i||(!b(e)&&(i=_(e),n=this.children.get(i))?n.findOnPath_(y(e),Zu(t,i),r):null)}foreachOnPath(e,t){return this.foreachOnPath_(e,v(),t)}foreachOnPath_(e,t,r){var n,i;return b(e)?this:(this.value&&r(t,this.value),n=_(e),(i=this.children.get(n))?i.foreachOnPath_(y(e),Zu(t,n),r):new E(null))}foreach(e){this.foreach_(v(),e)}foreach_(r,n){this.children.inorderTraversal((e,t)=>{t.foreach_(Zu(r,e),n)}),this.value&&n(r,this.value)}foreachChild(r){this.children.inorderTraversal((e,t)=>{t.value&&r(e,t.value)})}}class Ed{constructor(e){this.writeTree_=e}static empty(){return new Ed(new E(null))}}function Cd(t,r,n){if(b(r))return new Ed(new E(n));var i=t.writeTree_.findRootMostValueAndPath(r);if(null==i)return s=new E(n),s=t.writeTree_.setTree(r,s),new Ed(s);{var s=i.path;let e=i.value;i=ec(s,r);return e=e.updateChild(i,n),new Ed(t.writeTree_.set(s,e))}}function kd(e,r,t){let n=e;return vu(t,(e,t)=>{n=Cd(n,Zu(r,e),t)}),n}function Sd(e,t){var r;return b(t)?Ed.empty():(r=e.writeTree_.setTree(t,new E(null)),new Ed(r))}function Ad(e,t){return null!=Nd(e,t)}function Nd(e,t){var r=e.writeTree_.findRootMostValueAndPath(t);return null!=r?e.writeTree_.get(r.path).getChild(ec(r.path,t)):null}function Rd(e){let r=[];var t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(I,(e,t)=>{r.push(new p(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&r.push(new p(e,t.value))}),r}function Pd(e,t){var r;return b(t)?e:null!=(r=Nd(e,t))?new Ed(new E(r)):new Ed(e.writeTree_.subtree(t))}function Dd(e){return e.writeTree_.isEmpty()}function xd(e,t){return function n(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let r=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(g(null!==t.value,"Priority writes must always be leaf nodes"),r=t.value):s=n(Zu(i,e),t,s)}),s=s.getChild(i).isEmpty()||null===r?s:s.updateChild(Zu(i,".priority"),r)}}}(v(),e.writeTree_,t)}function Od(e,t){return Hd(t,e)}function Ld(t,r){var e,n=t.allWrites.findIndex(e=>e.writeId===r);g(0<=n,"removeWrite called with nonexistent writeId.");let i=t.allWrites[n],s=(t.allWrites.splice(n,1),i.visible),a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var l=t.allWrites[o];l.visible&&(o>=n&&((e,t)=>{if(e.snap)return nc(e.path,t);for(var r in e.children)if(e.children.hasOwnProperty(r)&&nc(Zu(e.path,r),t))return 1})(l,i.path)?s=!1:nc(i.path,l.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=Fd(e.allWrites,Md,v()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Sd(t.visibleWrites,i.path):vu(i.children,e=>{t.visibleWrites=Sd(t.visibleWrites,Zu(i.path,e))}),!0)}function Md(e){return e.visible}function Fd(e,t,r){let n=Ed.empty();for(let a=0;a<e.length;++a){var i=e[a];if(t(i)){var s=i.path;let e;if(i.snap)nc(r,s)?(e=ec(r,s),n=Cd(n,e,i.snap)):nc(s,r)&&(e=ec(s,r),n=Cd(n,v(),i.snap.getChild(e)));else{if(!i.children)throw j("WriteRecord should have .snap or .children");nc(r,s)?(e=ec(r,s),n=kd(n,e,i.children)):nc(s,r)&&(b(e=ec(s,r))?n=kd(n,v(),i.children):(s=we(i.children,_(e)))&&(i=s.getChild(y(e)),n=Cd(n,v(),i)))}}}return n}function Ud(e,t,r,n,i){var s;return n||i?(s=Pd(e.visibleWrites,t),!i&&Dd(s)?r:i||null!=r||Ad(s,v())?xd(Fd(e.allWrites,function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(nc(e.path,t)||nc(t,e.path))},t),r||T.EMPTY_NODE):null):null!=(s=Nd(e.visibleWrites,t))?s:Dd(s=Pd(e.visibleWrites,t))?r:null!=r||Ad(s,v())?xd(s,r||T.EMPTY_NODE):null}function Vd(e,t,r,n){return Ud(e.writeTree,e.treePath,t,r,n)}function qd(e,t){{var r=e.writeTree;e=e.treePath;let i=T.EMPTY_NODE;var n=Nd(r.visibleWrites,e);if(n)n.isLeafNode()||n.forEachChild(I,(e,t)=>{i=i.updateImmediateChild(e,t)});else if(t){let n=Pd(r.visibleWrites,e);t.forEachChild(I,(e,t)=>{var r=xd(Pd(n,new f(e)),t);i=i.updateImmediateChild(e,r)}),Rd(n).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)})}else Rd(Pd(r.visibleWrites,e)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)});return i}}function jd(e,t,r,n){return i=e.writeTree,e=e.treePath,t=t,r=r,n=n,g(r||n,"Either existingEventSnap or existingServerSnap must exist"),s=Zu(e,t),Ad(i.visibleWrites,s)?null:Dd(s=Pd(i.visibleWrites,s))?n.getChild(t):xd(s,n.getChild(t));var i,s}function Bd(e,t){return r=e.writeTree,e=Zu(e.treePath,t),Nd(r.visibleWrites,e);var r}function zd(e,r,n,i,s,a){{var o=e.writeTree,l=(e=e.treePath,n),h=i;n=s,i=a;let t;var u=Pd(o.visibleWrites,e),c=Nd(u,v());if(null!=c)t=c;else{if(null==r)return[];t=xd(u,r)}if((t=t.withIndex(i)).isEmpty()||t.isLeafNode())return[];{var d=[],p=i.getCompare(),f=n?t.getReverseIteratorFrom(l,i):t.getIteratorFrom(l,i);let e=f.getNext();for(;e&&d.length<h;)0!==p(e,l)&&d.push(e),e=f.getNext();return d}}}function Kd(e,t,r){return n=e.writeTree,r=r,i=Zu(e.treePath,e=t),null!=(s=Nd(n.visibleWrites,i))?s:r.isCompleteForChild(e)?xd(Pd(n.visibleWrites,i),r.getNode().getImmediateChild(e)):null;var n,i,s}function Wd(e,t){return Hd(Zu(e.treePath,t),e.writeTree)}function Hd(e,t){return{treePath:e,writeTree:t}}class Gd{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,r=e.childName,n=(g("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),g(".priority"!==r,"Only non-priority child changes can be tracked."),this.changeMap.get(r));if(n){var i=n.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(r,Kc(r,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(r);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(r,zc(r,n.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(r,Bc(r,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw j("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap.set(r,Kc(r,e.snapshotNode,n.oldSnap))}}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}let $d=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}};class Qd{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){var t=this.viewCache_.eventCache;return t.isCompleteForChild(e)?t.getNode().getImmediateChild(e):(t=null!=this.optCompleteServerCache_?new fd(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache,Kd(this.writes_,e,t))}getChildAfterChild(e,t,r){var n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Id(this.viewCache_),n=zd(this.writes_,n,t,1,r,e);return 0===n.length?null:n[0]}}function Yd(e,t,r,n,i){var s=new Gd;let a,o;if(r.type===Gh.OVERWRITE){var l=r;a=l.source.fromUser?Zd(e,t,l.path,l.snap,n,i,s):(g(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered()&&!b(l.path),Xd(e,t,l.path,l.snap,n,i,o,s))}else if(r.type===Gh.MERGE){var l=r;a=l.source.fromUser?((n,i,s,e,a,o,l)=>{let h=i;return e.foreach((e,t)=>{var r=Zu(s,e);ep(i,_(r))&&(h=Zd(n,h,r,t,a,o,l))}),e.foreach((e,t)=>{var r=Zu(s,e);ep(i,_(r))||(h=Zd(n,h,r,t,a,o,l))}),h})(e,t,l.path,l.children,n,i,s):(g(l.source.fromServer,"Unknown source."),o=l.source.tagged||t.serverCache.isFiltered(),rp(e,t,l.path,l.children,n,i,o,s))}else if(r.type===Gh.ACK_USER_WRITE){l=r;a=l.revert?((r,n,i,s,e,a)=>{let o;if(null!=Bd(s,i))return n;{var l=new Qd(s,n,e),h=n.eventCache.getNode();let t;if(b(i)||".priority"===_(i)){let e;e=e=n.serverCache.isFullyInitialized()?Vd(s,Id(n)):(u=n.serverCache.getNode(),g(u instanceof T,"serverChildren would be complete if leaf node"),qd(s,u)),t=r.filter.updateFullNode(h,e,a)}else{var u=_(i);let e=Kd(s,u,n.serverCache);null==e&&n.serverCache.isCompleteForChild(u)&&(e=h.getImmediateChild(u)),(t=null!=e?r.filter.updateChild(h,u,e,y(i),l,a):n.eventCache.getNode().hasChild(u)?r.filter.updateChild(h,u,T.EMPTY_NODE,y(i),l,a):h).isEmpty()&&n.serverCache.isFullyInitialized()&&(o=Vd(s,Id(n))).isLeafNode()&&(t=r.filter.updateFullNode(t,o,a))}return o=n.serverCache.isFullyInitialized()||null!=Bd(s,v()),yd(n,t,o,r.filter.filtersNodes())}})(e,t,l.path,n,i,s):((e,t,i,r,s,a,o)=>{if(null!=Bd(s,i))return t;let l=t.serverCache.isFiltered(),h=t.serverCache;if(null!=r.value){if(b(i)&&h.isFullyInitialized()||h.isCompleteForPath(i))return Xd(e,t,i,h.getNode().getChild(i),s,a,l,o);if(b(i)){let r=new E(null);return h.getNode().forEachChild(dc,(e,t)=>{r=r.set(new f(e),t)}),rp(e,t,i,r,s,a,l,o)}return t}{let n=new E(null);return r.foreach((e,t)=>{var r=Zu(i,e);h.isCompleteForPath(r)&&(n=n.set(e,h.getNode().getChild(r)))}),rp(e,t,i,n,s,a,l,o)}})(e,t,l.path,l.affectedTree,n,i,s)}else{if(r.type!==Gh.LISTEN_COMPLETE)throw j("Unknown operation type: "+r.type);a=(i=e,e=r.path,r=n,n=s,l=t.serverCache,l=wd(t,l.getNode(),l.isFullyInitialized()||b(e),l.isFiltered()),Jd(i,l,e,r,$d,n))}var h,u,s=s.getChanges(),i=t,e=a,r=s,c=e.eventCache;return c.isFullyInitialized()&&(h=c.getNode().isLeafNode()||c.getNode().isEmpty(),u=bd(i),0<r.length||!i.eventCache.isFullyInitialized()||h&&!c.getNode().equals(u)||!c.getNode().getPriority().equals(u.getPriority()))&&r.push(jc(bd(e))),{viewCache:a,changes:s}}function Jd(n,i,s,a,o,l){var h=i.eventCache;if(null!=Bd(a,s))return i;{let t,r;if(b(s))g(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(u=qd(a,(u=Id(i))instanceof T?u:T.EMPTY_NODE),n.filter.updateFullNode(i.eventCache.getNode(),u,l)):(u=Vd(a,Id(i)),n.filter.updateFullNode(i.eventCache.getNode(),u,l));else{var u=_(s);if(".priority"===u){g(1===Qu(s),"Can't have a priority with additional path components");var c=h.getNode(),d=jd(a,s,c,r=i.serverCache.getNode());t=null!=d?n.filter.updatePriority(c,d):h.getNode()}else{c=y(s);let e;e=h.isCompleteForChild(u)?(r=i.serverCache.getNode(),null!=(d=jd(a,s,h.getNode(),r))?h.getNode().getImmediateChild(u).updateChild(c,d):h.getNode().getImmediateChild(u)):Kd(a,u,i.serverCache),t=null!=e?n.filter.updateChild(h.getNode(),u,e,c,o,l):h.getNode()}}return yd(i,t,h.isFullyInitialized()||b(s),n.filter.filtersNodes())}}function Xd(e,t,r,n,i,s,a,o){var l=t.serverCache;let h;var u=a?e.filter:e.filter.getIndexedFilter();if(b(r))h=u.updateFullNode(l.getNode(),n,null);else if(u.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(r,n);h=u.updateFullNode(l.getNode(),c,null)}else{c=_(r);if(!l.isCompleteForPath(r)&&1<Qu(r))return t;var d=y(r),p=l.getNode().getImmediateChild(c).updateChild(d,n);h=".priority"===c?u.updatePriority(l.getNode(),p):u.updateChild(l.getNode(),c,p,d,$d,null)}c=wd(t,h,l.isFullyInitialized()||b(r),u.filtersNodes());return Jd(e,c,r,i,new Qd(i,c,s),o)}function Zd(t,r,n,i,e,s,a){var o=r.eventCache;let l,h;var u=new Qd(e,r,s);if(b(n))h=t.filter.updateFullNode(r.eventCache.getNode(),i,a),l=yd(r,h,!0,t.filter.filtersNodes());else{var c=_(n);if(".priority"===c)h=t.filter.updatePriority(r.eventCache.getNode(),i),l=yd(r,h,o.isFullyInitialized(),o.isFiltered());else{var d,p=y(n),f=o.getNode().getImmediateChild(c);let e;e=b(p)?i:null!=(d=u.getCompleteChild(c))?".priority"===Yu(p)&&d.getChild(Xu(p)).isEmpty()?d:d.updateChild(p,i):T.EMPTY_NODE,l=f.equals(e)?r:yd(r,t.filter.updateChild(o.getNode(),c,e,p,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return l}function ep(e,t){return e.eventCache.isCompleteForChild(t)}function tp(e,r,t){return t.foreach((e,t)=>{r=r.updateChild(e,t)}),r}function rp(n,i,e,t,s,a,o,l){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let h=i,r,u=(r=b(e)?t:new E(null).setTree(e,t),i.serverCache.getNode());return r.children.inorderTraversal((e,t)=>{var r;u.hasChild(e)&&(r=tp(0,i.serverCache.getNode().getImmediateChild(e),t),h=Xd(n,h,new f(e),r,s,a,o,l))}),r.children.inorderTraversal((e,t)=>{var r=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||r||(r=tp(0,i.serverCache.getNode().getImmediateChild(e),t),h=Xd(n,h,new f(e),r,s,a,o,l))}),h}class np{constructor(e,t){this.query_=e,this.eventRegistrations_=[];var r=this.query_._queryParams,n=new Wc(r.getIndex()),r=(e=r).loadsAllData()?new Wc(e.getIndex()):new(e.hasLimit()?Gc:Hc)(e),i=(this.processor_={filter:r},t.serverCache),s=t.eventCache,a=n.updateFullNode(T.EMPTY_NODE,i.getNode(),null),o=r.updateFullNode(T.EMPTY_NODE,s.getNode(),null),a=new fd(a,i.isFullyInitialized(),n.filtersNodes()),i=new fd(o,s.isFullyInitialized(),r.filtersNodes());this.viewCache_=_d(i,a),this.eventGenerator_=new gd(this.query_)}get query(){return this.query_}}function ip(e){return 0===e.eventRegistrations_.length}function sp(n,i,s){let a=[];if(s){g(null==i,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(s,r);t&&a.push(t)})}if(i){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){var r=n.eventRegistrations_[t];if(r.matches(i)){if(i.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(r)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return a}function ap(e,t,r,n){t.type===Gh.MERGE&&null!==t.source.queryId&&(g(Id(e.viewCache_),"We should always have a full cache before handling merges"),g(bd(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_,s=Yd(e.processor_,i,t,r,n);return t=e.processor_,r=s.viewCache,g(r.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),g(r.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed"),g(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,op(e,s.changes,s.viewCache.eventCache.getNode(),null)}function op(e,t,r,n){var i=n?[n]:e.eventRegistrations_;return md(e.eventGenerator_,t,r,i)}let lp;class hp{constructor(){this.views=new Map}}function up(t,r,n,i){var e=r.source.queryId;if(null!==e)return e=t.views.get(e),g(null!=e,"SyncTree gave us an op for an invalid query."),ap(e,r,n,i);{let e=[];for(var s of t.views.values())e=e.concat(ap(s,r,n,i));return e}}function cp(e,r,n,i,s){var a=r._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=Vd(n,s?i:null),t=!1;t=!!e||(e=i instanceof T?qd(n,i):T.EMPTY_NODE,!1);a=_d(new fd(e,t,!1),new fd(i,s,!1));return new np(r,a)}}function dp(e,t,n,i,s,r){var a=cp(e,t,i,s,r);e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n);{s=n,a=(i=a).viewCache_.eventCache;let r=[];return a.getNode().isLeafNode()||a.getNode().forEachChild(I,(e,t)=>{r.push(Bc(e,t))}),a.isFullyInitialized()&&r.push(jc(a.getNode())),op(i,r,a.getNode(),s)}}function pp(e,t,r,n){var i=t._queryIdentifier,s=[];let a=[];var o=_p(e);if("default"===i)for(var[l,h]of e.views.entries())a=a.concat(sp(h,r,n)),ip(h)&&(e.views.delete(l),h.query._queryParams.loadsAllData()||s.push(h.query));else{var u=e.views.get(i);u&&(a=a.concat(sp(u,r,n)),ip(u))&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query))}return o&&!_p(e)&&s.push((g(lp,"Reference.ts has not been loaded"),new lp(t._repo,t._path))),{removed:s,events:a}}function fp(e){var t,r=[];for(t of e.views.values())t.query._queryParams.loadsAllData()||r.push(t);return r}function gp(e,t){let r=null;for(var n of e.views.values())r=r||(i=n,s=t,n=void 0,(n=Id(i.viewCache_))&&(i.query._queryParams.loadsAllData()||!b(s)&&!n.getImmediateChild(_(s)).isEmpty())?n.getChild(s):null);var i,s;return r}function mp(e,t){var r;return t._queryParams.loadsAllData()?yp(e):(r=t._queryIdentifier,e.views.get(r))}function vp(e,t){return null!=mp(e,t)}function _p(e){return null!=yp(e)}function yp(e){for(var t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let wp;let bp=1;class Ip{constructor(e){this.listenProvider_=e,this.syncPointTree_=new E(null),this.pendingWriteTree_={visibleWrites:Ed.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Tp(e,t,r,n,i){var s,a,o,l;return s=e.pendingWriteTree_,a=t,o=r,n=n,l=i,g(n>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:n,visible:l=void 0===l?!0:l}),l&&(s.visibleWrites=Cd(s.visibleWrites,a,o)),s.lastWriteId=n,i?Dp(e,new dd(od(),t,r)):[]}function Ep(e,t,r,n){i=e.pendingWriteTree_,s=t,a=r,n=n,g(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:n,visible:!0}),i.visibleWrites=kd(i.visibleWrites,s,a),i.lastWriteId=n;var i,s,a,o=E.fromObject(r);return Dp(e,new pd(od(),t,o))}function Cp(e,t,r=!1){var n=((e,t)=>{for(let n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null})(e.pendingWriteTree_,t);if(Ld(e.pendingWriteTree_,t)){let t=new E(null);return null!=n.snap?t=t.set(v(),!0):vu(n.children,e=>{t=t.set(new f(e),!0)}),Dp(e,new ud(n.path,t,r))}return[]}function kp(e,t,r){return Dp(e,new dd(ld(),t,r))}function Sp(r,t,n,i,s=!1){var a=t._path,o=r.syncPointTree_.get(a);let l=[];if(o&&("default"===t._queryIdentifier||vp(o,t))){var h=pp(o,t,n,i),o=(0===o.views.size&&(r.syncPointTree_=r.syncPointTree_.remove(a)),h.removed);if(l=h.events,!s){var h=-1!==o.findIndex(e=>e._queryParams.loadsAllData()),u=r.syncPointTree_.findOnPath(a,(e,t)=>_p(t));if(h&&!u){a=r.syncPointTree_.subtree(a);if(!a.isEmpty()){var c=a.fold((e,t,n)=>{if(t&&_p(t))return[yp(t)];{let r=[];return t&&(r=fp(t)),vu(n,(e,t)=>{r=r.concat(t)}),r}});for(let e=0;e<c.length;++e){var d=c[e],p=d.query,d=Op(r,d);r.listenProvider_.startListening(qp(p),Lp(r,p),d.hashFn,d.onComplete)}}}!u&&0<o.length&&!i&&(h?r.listenProvider_.stopListening(qp(t),null):o.forEach(e=>{var t=r.queryToTagMap.get(Mp(e));r.listenProvider_.stopListening(qp(e),t)}))}var f=r,g=o;for(let e=0;e<g.length;++e){var m,v=g[e];v._queryParams.loadsAllData()||(v=Mp(v),m=f.queryToTagMap.get(v),f.queryToTagMap.delete(v),f.tagToQueryMap.delete(m))}}return l}function Ap(e,t,r,n){var i,s,a=Fp(e,n);return null!=a?(i=(a=Up(a)).path,a=a.queryId,s=ec(i,t),Vp(e,i,new dd(hd(a),s,r))):[]}function Np(e,t,r,n=!1){let i=t._path,s=null,a=!1,o=(e.syncPointTree_.foreachOnPath(i,(e,t)=>{var r=ec(e,i);s=s||gp(t,r),a=a||_p(t)}),e.syncPointTree_.get(i));o?(a=a||_p(o),s=s||gp(o,v())):(o=new hp,e.syncPointTree_=e.syncPointTree_.set(i,o));let l;null!=s?l=!0:(l=!1,s=T.EMPTY_NODE,e.syncPointTree_.subtree(i).foreachChild((e,t)=>{var r=gp(t,v());r&&(s=s.updateImmediateChild(e,r))}));var h,u=vp(o,t),c=(u||t._queryParams.loadsAllData()||(h=Mp(t),g(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),c=bp++,e.queryToTagMap.set(h,c),e.tagToQueryMap.set(c,h)),Od(e.pendingWriteTree_,i));let d=dp(o,t,r,c,s,l);return u||a||n||(h=mp(o,t),d=d.concat(((t,e,r)=>{var n=e._path,i=Lp(t,e),s=Op(t,r),s=t.listenProvider_.startListening(qp(e),i,s.hashFn,s.onComplete),n=t.syncPointTree_.subtree(n);if(i)g(!_p(n.value),"If we're adding a query, it shouldn't be shadowed");else{var a=n.fold((e,t,n)=>{if(!b(e)&&t&&_p(t))return[yp(t).query];{let r=[];return t&&(r=r.concat(fp(t).map(e=>e.query))),vu(n,(e,t)=>{r=r.concat(t)}),r}});for(let e=0;e<a.length;++e){var o=a[e];t.listenProvider_.stopListening(qp(o),Lp(t,o))}}return s})(e,t,h))),d}function Rp(e,n,t){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(n,(e,t)=>{var r=gp(t,ec(e,n));if(r)return r});return Ud(r,n,i,t,!0)}function Pp(e,t){let n=t._path,i=null,r=(e.syncPointTree_.foreachOnPath(n,(e,t)=>{var r=ec(e,n);i=i||gp(t,r)}),e.syncPointTree_.get(n));r?i=i||gp(r,v()):(r=new hp,e.syncPointTree_=e.syncPointTree_.set(n,r));var s=null!=i,a=s?new fd(i,!0,!1):null,o=Od(e.pendingWriteTree_,t._path);return bd(cp(r,t,o,s?a.getNode():T.EMPTY_NODE,s).viewCache_)}function Dp(e,t){return function a(t,o,l,h){{if(b(t.path))return xp(t,o,l,h);{let e=o.get(v()),r=(null==l&&null!=e&&(l=gp(e,v())),[]),n=_(t.path),i=t.operationForChild(n),s=o.children.get(n);if(s&&i){let e=l?l.getImmediateChild(n):null,t=Wd(h,n);r=r.concat(a(i,s,e,t))}return r=e?r.concat(up(e,t,h,l)):r}}}(t,e.syncPointTree_,null,Od(e.pendingWriteTree_,v()))}function xp(s,e,a,o){var t=e.get(v());null==a&&null!=t&&(a=gp(t,v()));let l=[];return e.children.inorderTraversal((e,t)=>{var r=a?a.getImmediateChild(e):null,n=Wd(o,e),i=s.operationForChild(e);i&&(l=l.concat(xp(i,t,r,n)))}),l=t?l.concat(up(t,s,o,a)):l}function Op(o,e){let l=e.query,h=Lp(o,l);return{hashFn:()=>(e.viewCache_.serverCache.getNode()||T.EMPTY_NODE).hash(),onComplete:e=>{var t,r,n,i,s,a;return"ok"===e?h?(t=o,r=l._path,n=h,(a=Fp(t,n))?(i=(a=Up(a)).path,a=a.queryId,s=ec(i,r),Vp(t,i,new cd(hd(a),s))):[]):(n=o,r=l._path,Dp(n,new cd(ld(),r))):(i=((e,t)=>{let r="Unknown Error";"too_big"===e?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?r="Client doesn't have permission to access the desired data.":"unavailable"===e&&(r="The service is unavailable");var n=new Error(e+" at "+t._path.toString()+": "+r);return n.code=e.toUpperCase(),n})(e,l),Sp(o,l,null,i))}}}function Lp(e,t){var r=Mp(t);return e.queryToTagMap.get(r)}function Mp(e){return e._path.toString()+"$"+e._queryIdentifier}function Fp(e,t){return e.tagToQueryMap.get(t)}function Up(e){var t=e.indexOf("$");return g(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new f(e.substr(0,t))}}function Vp(e,t,r){var n=e.syncPointTree_.get(t),i=(g(n,"Missing sync point for query tag that we're tracking"),Od(e.pendingWriteTree_,t));return up(n,r,i,null)}function qp(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(g(wp,"Reference.ts has not been loaded"),new wp(e._repo,e._path)):e}class jp{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new jp(t)}node(){return this.node_}}class Bp{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=Zu(this.path_,e);return new Bp(this.syncTree_,t)}node(){return Rp(this.syncTree_,this.path_)}}let zp=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Kp=function(e,t,r){return e&&"object"==typeof e?(g(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Wp(e[".sv"],t,r):"object"==typeof e[".sv"]?Hp(e[".sv"],t):void g(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Wp=function(e,t,r){if("timestamp"===e)return r.timestamp;g(!1,"Unexpected server value: "+e)},Hp=function(e,t,r){e.hasOwnProperty("increment")||g(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var n=e.increment,i=("number"!=typeof n&&g(!1,"Unexpected increment value: "+n),t.node());return g(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode()||"number"!=typeof(i=i.getValue())?n:i+n},Gp=function(e,t,r,n){return Qp(t,new Bp(r,e),n)},$p=function(e,t,r){return Qp(e,new jp(t),r)};function Qp(e,n,i){var t,r,s=e.getPriority().val(),s=Kp(s,n.getImmediateChild(".priority"),i);let a;return e.isLeafNode()?(r=e,(t=Kp(r.getValue(),n,i))!==r.getValue()||s!==r.getPriority().val()?new Tc(t,Fc(s)):e):(r=e,s!==(a=r).getPriority().val()&&(a=a.updatePriority(new Tc(s))),r.forEachChild(I,(e,t)=>{var r=Qp(t,n.getImmediateChild(e),i);r!==t&&(a=a.updateImmediateChild(e,r))}),a)}class Yp{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Jp(e,t){let r=t instanceof f?t:new f(t),n=e,i=_(r);for(;null!==i;){var s=we(n.node.children,i)||{children:{},childCount:0};n=new Yp(i,n,s),r=y(r),i=_(r)}return n}function Xp(e){return e.node.value}function Zp(e,t){e.node.value=t,nf(e)}function ef(e){return 0<e.node.childCount}function tf(r,n){vu(r.node.children,(e,t)=>{n(new Yp(e,r,t))})}function rf(e){return new f(null===e.parent?e.name:rf(e.parent)+"/"+e.name)}function nf(e){var t,r,n,i;null!==e.parent&&(t=e.parent,r=e.name,n=(e=>void 0===Xp(e)&&!ef(e))(e=e),i=ye(t.node.children,r),n&&i?(delete t.node.children[r],t.node.childCount--,nf(t)):n||i||(t.node.children[r]=e.node,t.node.childCount++,nf(t)))}function sf(e,t,r,n){n&&void 0===t||_f(De(e,"value"),t,r)}function af(e,t,s,r){if(!r||void 0!==t){let n=De(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(n+" must be an object containing the children to replace.");let i=[];vu(t,(e,t)=>{var r=new f(e);if(_f(n,t,Zu(s,r)),".priority"===Yu(r)&&!vf(t))throw new Error(n+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(r)});{var a=n;var o=i;let t,r;for(t=0;t<o.length;t++){var l=Ju(r=o[t]);for(let e=0;e<l.length;e++)if((".priority"!==l[e]||e!==l.length-1)&&!ff(l[e]))throw new Error(a+"contains an invalid key ("+l[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}o.sort(tc);let e=null;for(t=0;t<o.length;t++){if(r=o[t],null!==e&&nc(e,r))throw new Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+r.toString());e=r}}}}function of(e,t,r){if(!r||void 0!==t){if(pu(t))throw new Error(De(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!vf(t))throw new Error(De(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function lf(e,t,r,n){if(!(n&&void 0===r||ff(r)))throw new Error(De(e,t)+'was an invalid key = "'+r+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function hf(e,t,r,n){r=r&&r.replace(/^\/*\.info(\/|$)/,"/"),yf(e,t,r,n)}function uf(e,t){if(".info"===_(t))throw new Error(e+" failed = Can't modify data under /.info/")}let cf=/[\[\].#$\/\u0000-\u001F\u007F]/,df=/[\[\].#$\u0000-\u001F\u007F]/,pf=10485760,ff=function(e){return"string"==typeof e&&0!==e.length&&!cf.test(e)},gf=function(e){return"string"==typeof e&&0!==e.length&&!df.test(e)},mf=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),gf(e)},vf=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!pu(e)||e&&"object"==typeof e&&ye(e,".sv")},_f=function(a,e,t){let o=t instanceof f?new ic(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+ac(o));if("function"==typeof e)throw new Error(a+"contains a function "+ac(o)+" with contents = "+e.toString());if(pu(e))throw new Error(a+"contains "+e.toString()+" "+ac(o));if("string"==typeof e&&e.length>pf/3&&Le(e)>pf)throw new Error(a+"contains a string greater than "+pf+" utf8 bytes "+ac(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(vu(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!ff(e)))throw new Error(a+" contains an invalid key ("+e+") "+ac(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var r,n;r=o,e=e,0<r.parts_.length&&(r.byteLength_+=1),r.parts_.push(e),r.byteLength_+=Le(e),sc(r),_f(a,t,o),e=o,n=e.parts_.pop(),e.byteLength_-=Le(n),0<e.parts_.length&&--e.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+ac(o)+" in addition to actual children.")}},yf=function(e,t,r,n){if(!(n&&void 0===r||gf(r)))throw new Error(De(e,t)+'was an invalid path = "'+r+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},wf=function(e,t){var r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!ff(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&!mf(r))throw new Error(De(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class bf{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function If(e,t){let r=null;for(let s=0;s<t.length;s++){var n=t[s],i=n.getPath();null===r||rc(i,r.path)||(e.eventLists_.push(r),r=null),(r=null===r?{events:[],path:i}:r).events.push(n)}r&&e.eventLists_.push(r)}function Tf(e,t,r){If(e,r),Cf(e,e=>rc(e,t))}function Ef(e,t,r){If(e,r),Cf(e,e=>nc(e,t)||nc(t,e))}function Cf(t,e){t.recursionDepth_++;let r=!0;for(let o=0;o<t.eventLists_.length;o++){var n=t.eventLists_[o];if(n)if(e(n.path)){s=a=i=void 0;var i=t.eventLists_[o];for(let e=0;e<i.events.length;e++){var s,a=i.events[e];null!==a&&(i.events[e]=null,s=a.getEventRunner(),au&&hu("event: "+a.toString()),Eu(s))}t.eventLists_[o]=null}else r=!1}r&&(t.eventLists_=[]),t.recursionDepth_--}let kf="repo_interrupt",Sf=25;class Af{constructor(e,t,r,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rd(),this.transactionQueueTree_=new Yp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Nf(a,e,t){if(a.stats_=Mu(a.repoInfo_),a.forceRestClient_||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))a.server_=new ed(a.repoInfo_,(e,t,r,n)=>{Df(a,e,t,r,n)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>xf(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ve(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new lc(a.repoInfo_,e,(e,t,r,n)=>{Df(a,e,t,r,n)},e=>{xf(a,e)},e=>{var r;r=a,vu(e,(e,t)=>{Of(r,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var r;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=()=>new ad(a.stats_,a.server_),r=a.repoInfo_.toString(),Lu[r]||(Lu[r]=e()),Lu[r]),a.infoData_=new td,a.infoSyncTree_=new Ip({startListening:(e,t,r,n)=>{let i=[];var s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=kp(a.infoSyncTree_,e._path,s),setTimeout(()=>{n("ok")},0)),i},stopListening:()=>{}}),Of(a,"connected",!1),a.serverSyncTree_=new Ip({startListening:(n,e,t,i)=>(a.server_.listen(n,t,e,(e,t)=>{var r=i(e,t);Ef(a.eventQueue_,n._path,r)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Rf(e){var t=e.infoData_.getNode(new f(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Pf(e){return zp({timestamp:Rf(e)})}function Df(e,t,r,n,i){e.dataUpdateCount++;var s,a,o,l,h,u,c=new f(t);r=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,r):r;let d=[],p=c;0<(d=i?n?(u=Ie(r,e=>Fc(e)),t=e.serverSyncTree_,s=c,a=u,(u=Fp(t,i))?(o=(u=Up(u)).path,u=u.queryId,l=ec(o,s),h=E.fromObject(a),Vp(t,o,new pd(hd(u),l,h))):[]):(o=Fc(r),Ap(e.serverSyncTree_,c,o,i)):n?(u=Ie(r,e=>Fc(e)),s=e.serverSyncTree_,a=c,t=u,l=E.fromObject(t),Dp(s,new pd(ld(),a,l))):(h=Fc(r),kp(e.serverSyncTree_,c,h))).length&&(p=Wf(e,c)),Ef(e.eventQueue_,p,d)}function xf(e,t){if(Of(e,"connected",t),!1===t){var a=e;jf(a,"onDisconnectEvents");let n=Pf(a),i=rd(),s=(id(a.onDisconnect_,v(),(e,t)=>{var r=Gp(e,t,a.serverSyncTree_,n);nd(i,e,r)}),[]);id(i,v(),(e,t)=>{s=s.concat(kp(a.serverSyncTree_,e,t));var r=Qf(a,e);Wf(a,r)}),a.onDisconnect_=rd(),Ef(a.eventQueue_,v(),s)}}function Of(e,t,r){var n=new f("/.info/"+t),i=Fc(r),i=(e.infoData_.updateSnapshot(n,i),kp(e.infoSyncTree_,n,i));Ef(e.eventQueue_,n,i)}function Lf(e){return e.nextWriteId_++}function Mf(n,i,e,t,s){jf(n,"set",{path:i.toString(),value:e,priority:t});var r=Pf(n),a=Fc(e,t),o=Rp(n.serverSyncTree_,i),o=$p(a,o,r);let l=Lf(n);r=Tp(n.serverSyncTree_,i,o,l,!0),If(n.eventQueue_,r),n.server_.put(i.toString(),a.val(!0),(e,t)=>{var r="ok"===e,r=(r||cu("set at "+i+" failed: "+e),Cp(n.serverSyncTree_,l,!r));Ef(n.eventQueue_,i,r),Bf(0,s,e,t)}),o=Qf(n,i);Wf(n,o),Ef(n.eventQueue_,o,[])}function Ff(r,n,i){r.server_.onDisconnectCancel(n.toString(),(e,t)=>{"ok"===e&&!function e(r,t){var n;return b(t)?(r.value=null,r.children.clear(),!0):null!==r.value?!r.value.isLeafNode()&&(n=r.value,r.value=null,n.forEachChild(I,(e,t)=>{nd(r,new f(e),t)}),e(r,t)):!(0<r.children.size)||(n=_(t),t=y(t),r.children.has(n)&&e(r.children.get(n),t)&&r.children.delete(n),0===r.children.size)}(r.onDisconnect_,n),Bf(0,i,e,t)})}function Uf(r,n,e,i){let s=Fc(e);r.server_.onDisconnectPut(n.toString(),s.val(!0),(e,t)=>{"ok"===e&&nd(r.onDisconnect_,n,s),Bf(0,i,e,t)})}function Vf(e,t,r){let n;n=".info"===_(t._path)?Sp(e.infoSyncTree_,t,r):Sp(e.serverSyncTree_,t,r),Tf(e.eventQueue_,t._path,n)}function qf(e){e.persistentConnection_&&e.persistentConnection_.interrupt(kf)}function jf(e,...t){let r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),hu(r,...t)}function Bf(e,n,i,s){n&&Eu(()=>{if("ok"===i)n(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);var r=new Error(e);r.code=t,n(r)}})}function zf(e,t,r){return Rp(e.serverSyncTree_,t,r)||T.EMPTY_NODE}function Kf(o,l=o.transactionQueueTree_){if(l||$f(o,l),Xp(l)){var h=Gf(o,l),e=(g(0<h.length,"Sending zero length transaction queue"),h.every(e=>0===e.status));if(e){var u=o;var c=rf(l);var d=h;let e=d.map(e=>e.currentWriteId),t=zf(u,c,e),r=t,n=t.hash();for(let a=0;a<d.length;a++){var p=d[a],f=(g(0===p.status,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++,ec(c,p.path));r=r.updateChild(f,p.currentOutputSnapshotRaw)}let i=r.val(!0),s=c;u.server_.put(s.toString(),i,t=>{jf(u,"transaction put response",{path:s.toString(),status:t});let r=[];if("ok"===t){var n=[];for(let e=0;e<d.length;e++)d[e].status=2,r=r.concat(Cp(u.serverSyncTree_,d[e].currentWriteId)),d[e].onComplete&&n.push(()=>d[e].onComplete(null,!0,d[e].currentOutputSnapshotResolved)),d[e].unwatcher();$f(u,Jp(u.transactionQueueTree_,c)),Kf(u,u.transactionQueueTree_),Ef(u.eventQueue_,c,r);for(let t=0;t<n.length;t++)Eu(n[t])}else{if("datastale"===t)for(let e=0;e<d.length;e++)3===d[e].status?d[e].status=4:d[e].status=0;else{cu("transaction at "+s.toString()+" failed: "+t);for(let e=0;e<d.length;e++)d[e].status=4,d[e].abortReason=t}Wf(u,c)}},n)}}else ef(l)&&tf(l,e=>{Kf(o,e)})}function Wf(e,t){var r=Hf(e,t),n=rf(r),r=Gf(e,r),i=e,s=r,a=n;if(0!==s.length){var o=[];let r=[];var l=s.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){var h=s[n],u=ec(a,h.path);let e=!1,t;if(g(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat(Cp(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Sf)e=!0,t="maxretry",r=r.concat(Cp(i.serverSyncTree_,h.currentWriteId,!0));else{var u=zf(i,h.path,l),c=(h.currentInputSnapshot=u,s[n].update(u.val()));if(void 0!==c){_f("transaction failed: Data returned ",c,h.path);let e=Fc(c);"object"==typeof c&&null!=c&&ye(c,".priority")||(e=e.updatePriority(u.getPriority()));var c=h.currentWriteId,d=Pf(i),u=$p(e,u,d);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=u,h.currentWriteId=Lf(i),l.splice(l.indexOf(c),1),r=(r=r.concat(Tp(i.serverSyncTree_,h.path,u,h.currentWriteId,h.applyLocally))).concat(Cp(i.serverSyncTree_,c,!0))}else e=!0,t="nodata",r=r.concat(Cp(i.serverSyncTree_,h.currentWriteId,!0))}Ef(i.eventQueue_,a,r),r=[],e&&(s[n].status=2,(e=>{setTimeout(e,Math.floor(0))})(s[n].unwatcher),s[n].onComplete)&&("nodata"===t?o.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):o.push(()=>s[n].onComplete(new Error(t),!1,null)))}$f(i,i.transactionQueueTree_);for(let e=0;e<o.length;e++)Eu(o[e]);Kf(i,i.transactionQueueTree_)}return n}function Hf(e,t){let r,n=e.transactionQueueTree_;for(r=_(t);null!==r&&void 0===Xp(n);)n=Jp(n,r),t=y(t),r=_(t);return n}function Gf(e,t){var r=[];return function t(r,e,n){let i=Xp(e);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);tf(e,e=>{t(r,e,n)})}(e,t,r),r.sort((e,t)=>e.order-t.order),r}function $f(t,r){var n=Xp(r);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Zp(r,0<n.length?n:void 0)}tf(r,e=>{$f(t,e)})}function Qf(t,e){var r=rf(Hf(t,e)),n=Jp(t.transactionQueueTree_,e);return((e,t,r)=>{let n=r?e:e.parent;for(;null!==n;){if(t(n))return;n=n.parent}})(n,e=>{Yf(t,e)}),Yf(t,n),function t(e,r,n,i){n&&!i&&r(e),tf(e,e=>{t(e,r,!0,i)}),n&&i&&r(e)}(n,e=>{Yf(t,e)}),r}function Yf(i,s){var a=Xp(s);if(a){var o=[];let e=[],t=-1;for(let r=0;r<a.length;r++)3!==a[r].status&&(1===a[r].status?(g(t===r-1,"All SENT items should be at beginning of queue."),a[t=r].status=3,a[r].abortReason="set"):(g(0===a[r].status,"Unexpected transaction status in abort"),a[r].unwatcher(),e=e.concat(Cp(i.serverSyncTree_,a[r].currentWriteId,!0)),a[r].onComplete&&o.push(a[r].onComplete.bind(null,new Error("set"),!1,null))));-1===t?Zp(s,void 0):a.length=t+1,Ef(i.eventQueue_,rf(s),e);for(let n=0;n<o.length;n++)Eu(o[n])}}let Jf=function(e,t){var r=Xf(e),n=r.namespace,i=("firebase.com"===r.domain&&uu(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===r.domain||uu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||du(),"ws"===r.scheme||"wss"===r.scheme);return{repoInfo:new Pu(r.host,r.secure,n,i,t,"",n!==r.subdomain),path:new f(r.pathString)}},Xf=function(n){let i="",s="",a="",o="",l="",h=!0,u="https",c=443;if("string"==typeof n){let e=n.indexOf("//"),t=(0<=e&&(u=n.substring(0,e-1),n=n.substring(e+2)),n.indexOf("/")),r=(-1===t&&(t=n.length),n.indexOf("?"));-1===r&&(r=n.length),i=n.substring(0,Math.min(t,r)),t<r&&(o=(e=>{let t="";var r=e.split("/");for(let n=0;n<r.length;n++)if(0<r[n].length){let e=r[n];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t})(n.substring(t,r)));var d=(e=>{var t,r,n={};for(t of(e="?"===e.charAt(0)?e.substring(1):e).split("&"))0!==t.length&&(2===(r=t.split("=")).length?n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):cu(`Invalid query segment '${t}' in query '${e}'`));return n})(n.substring(Math.min(n.length,r))),p=(0<=(e=i.indexOf(":"))?(h="https"===u||"wss"===u,c=parseInt(i.substring(e+1),10)):e=i.length,i.slice(0,e));"localhost"===p.toLowerCase()?s="localhost":p.split(".").length<=2?s=p:(p=i.indexOf("."),a=i.substring(0,p).toLowerCase(),s=i.substring(p+1),l=a),"ns"in d&&(l=d.ns)}return{host:i,port:c,domain:s,subdomain:a,secure:h,scheme:u,pathString:o,namespace:l}},Zf="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",eg=(()=>{let s=0,a=[];return function(e){var t=e===s;s=e;let r;var n=new Array(8);for(r=7;0<=r;r--)n[r]=Zf.charAt(e%64),e=Math.floor(e/64);g(0===e,"Cannot push at time == 0");let i=n.join("");if(t){for(r=11;0<=r&&63===a[r];r--)a[r]=0;a[r]++}else for(r=0;r<12;r++)a[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)i+=Zf.charAt(a[r]);return g(20===i.length,"nextPushId: Length should be 20."),i}})();class tg{constructor(e,t,r,n){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=n}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ve(this.snapshot.exportVal())}}class rg{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ng{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return g(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ig{constructor(e,t){this._repo=e,this._path=t}cancel(){var e=new Z;return Ff(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){uf("OnDisconnect.remove",this._path);var e=new Z;return Uf(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){uf("OnDisconnect.set",this._path),sf("OnDisconnect.set",e,this._path,!1);var t=new Z;return Uf(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){uf("OnDisconnect.setWithPriority",this._path),sf("OnDisconnect.setWithPriority",e,this._path,!1),of("OnDisconnect.setWithPriority",t,!1);var n=new Z;{var i=this._repo,s=this._path,a=n.wrapCallback(()=>{});let r=Fc(e,t);i.server_.onDisconnectPut(s.toString(),r.val(!0),(e,t)=>{"ok"===e&&nd(i.onDisconnect_,s,r),Bf(0,a,e,t)})}return n.promise}update(e){uf("OnDisconnect.update",this._path),af("OnDisconnect.update",e,this._path,!1);var n,i,r,s,t=new Z;return n=this._repo,i=this._path,r=e,s=t.wrapCallback(()=>{}),be(r)?(hu("onDisconnect().update() called with empty data.  Don't do anything."),Bf(0,s,"ok",void 0)):n.server_.onDisconnectMerge(i.toString(),r,(e,t)=>{"ok"===e&&vu(r,(e,t)=>{var r=Fc(t);nd(n.onDisconnect_,Zu(i,e),r)}),Bf(0,s,e,t)}),t.promise}}class sg{constructor(e,t,r,n){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=n}get key(){return b(this._path)?null:Yu(this._path)}get ref(){return new hg(this._repo,this._path)}get _queryIdentifier(){var e=Zc(this._queryParams),e=Zh(e);return"{}"===e?"default":e}get _queryObject(){return Zc(this._queryParams)}isEqual(e){var t,r,n;return(e=w(e))instanceof sg&&(t=this._repo===e._repo,r=rc(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier,t)&&r&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+(e=>{let t="";for(let r=e.pieceNum_;r<e.pieces_.length;r++)""!==e.pieces_[r]&&(t+="/"+encodeURIComponent(String(e.pieces_[r])));return t||"/"})(this._path)}}function ag(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function og(e){let t=null,r=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(r=e.getIndexEndValue()),e.getIndex()===dc){var n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==fu)throw new Error(n);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==gu)throw new Error(n);if("string"!=typeof r)throw new Error(i)}}else if(e.getIndex()===I){if(null!=t&&!vf(t)||null!=r&&!vf(r))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(g(e.getIndex()instanceof Uc||e.getIndex()===qc,"unknown index type."),null!=t&&"object"==typeof t||null!=r&&"object"==typeof r)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function lg(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class hg extends sg{constructor(e,t){super(e,t,new $c,!1)}get parent(){var e=Xu(this._path);return null===e?null:new hg(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ug{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new f(e),r=pg(this.ref,e);return new ug(this._node.getChild(t),r,I)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(r){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(e,t)=>r(new ug(t,pg(this.ref,e),I)))}hasChild(e){var t=new f(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function cg(e,t){return(e=w(e))._checkNotDeleted("ref"),void 0!==t?pg(e._root,t):e._root}function dg(e,t){(e=w(e))._checkNotDeleted("refFromURL");var r=Jf(t,e._repo.repoInfo_.nodeAdmin),n=(wf("refFromURL",r),r.repoInfo);return e._repo.repoInfo_.isCustomHost()||n.host===e._repo.repoInfo_.host||uu("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+e._repo.repoInfo_.host+")"),cg(e,r.path.toString())}function pg(e,t){return(null===_((e=w(e))._path)?hf:yf)("child","path",t,!1),new hg(e._repo,Zu(e._path,t))}function fg(e,t){e=w(e),uf("set",e._path),sf("set",t,e._path,!1);var r=new Z;return Mf(e._repo,e._path,t,null,r.wrapCallback(()=>{})),r.promise}function gg(e,t){af("update",t,e._path,!1);var i=new Z;{var a=e._repo,o=e._path,l=(e=t,i.wrapCallback(()=>{}));jf(a,"update",{path:o.toString(),value:e});let r=!0,n=Pf(a),s={};if(vu(e,(e,t)=>{r=!1,s[e]=Gp(Zu(o,e),Fc(t),a.serverSyncTree_,n)}),r)hu("update() called with empty data.  Don't do anything."),Bf(0,l,"ok",void 0);else{let i=Lf(a);var h=Ep(a.serverSyncTree_,o,s,i);If(a.eventQueue_,h),a.server_.merge(o.toString(),e,(e,t)=>{var r="ok"===e,r=(r||cu("update at "+o+" failed: "+e),Cp(a.serverSyncTree_,i,!r)),n=0<r.length?Wf(a,o):o;Ef(a.eventQueue_,n,r),Bf(0,l,e,t)}),vu(e,e=>{var t=Qf(a,Zu(o,e));Wf(a,t)}),Ef(a.eventQueue_,o,[])}}return i.promise}function mg(t){t=w(t);var i,s,a,e=new ng(()=>{}),e=new vg(e);return i=t._repo,s=t,a=e,(null!=(e=Pp(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,r=Fc(e).withIndex(s._queryParams.getIndex());Np(i.serverSyncTree_,s,a,!0);let n;return n=s._queryParams.loadsAllData()?kp(i.serverSyncTree_,s._path,r):(t=Lp(i.serverSyncTree_,s),Ap(i.serverSyncTree_,s._path,r,t)),Ef(i.eventQueue_,s._path,n),Sp(i.serverSyncTree_,s,a,null,!0),r},e=>(jf(i,"get for query "+ve(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new ug(e,new hg(t._repo,t._path),t._queryParams.getIndex()))}class vg{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var r=t._queryParams.getIndex();return new tg("value",this,new ug(e.snapshotNode,new hg(t._repo,t._path),r))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rg(this,e,t):null}matches(e){return e instanceof vg&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class _g{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){var t="children_added"===e?"child_added":e;return this.eventType===("children_removed"===t?"child_removed":t)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rg(this,e,t):null}createEvent(e,t){g(null!=e.childName,"Child events should have a childName.");var r=pg(new hg(t._repo,t._path),e.childName),n=t._queryParams.getIndex();return new tg(e.type,this,new ug(e.snapshotNode,r,n),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof _g&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function yg(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){let r=t;var a=(e,t)=>{Vf(n._repo,n,o),r(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new ng(t,s||void 0);let o="value"===e?new vg(a):new _g(e,a);{r=n._repo,i=n,t=o;let e;e=".info"===_(i._path)?Np(r.infoSyncTree_,i,t):Np(r.serverSyncTree_,i,t),Tf(r.eventQueue_,i._path,e)}return()=>Vf(n._repo,n,o)}function wg(e,t,r,n){return yg(e,"value",t,r,n)}function bg(e,t,r,n){yg(e,"child_added",t,r,n)}function Ig(e,t,r,n){yg(e,"child_changed",t,r,n)}function Tg(e,t,r,n){yg(e,"child_moved",t,r,n)}function Eg(e,t,r,n){yg(e,"child_removed",t,r,n)}function Cg(e,t,r){let n=null;var i=r?new ng(r):null;"value"===t?n=new vg(i):t&&(n=new _g(t,i)),Vf(e._repo,e,n)}class kg{}class Sg extends kg{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){sf("endAt",this._value,e._path,!0);var t=Yc(e._queryParams,this._value,this._key);if(lg(t),og(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new sg(e._repo,e._path,t,e._orderByCalled)}}class Ag extends kg{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){sf("endBefore",this._value,e._path,!1);var t=((e,t,r)=>{let n;return(n=e.index_===dc||r?Yc(e,t,r):Yc(e,t,fu)).endBeforeSet_=!0,n})(e._queryParams,this._value,this._key);if(lg(t),og(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new sg(e._repo,e._path,t,e._orderByCalled)}}class Ng extends kg{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){sf("startAt",this._value,e._path,!0);var t=Qc(e._queryParams,this._value,this._key);if(lg(t),og(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new sg(e._repo,e._path,t,e._orderByCalled)}}class Rg extends kg{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){sf("startAfter",this._value,e._path,!1);var t=((e,t,r)=>{let n;return(n=e.index_===dc||r?Qc(e,t,r):Qc(e,t,gu)).startAfterSet_=!0,n})(e._queryParams,this._value,this._key);if(lg(t),og(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new sg(e._repo,e._path,t,e._orderByCalled)}}class Pg extends kg{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new sg(e._repo,e._path,(t=e._queryParams,r=this._limit,(n=t.copy()).limitSet_=!0,n.limit_=r,n.viewFrom_="l",n),e._orderByCalled);var t,r,n}}class Dg extends kg{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new sg(e._repo,e._path,(t=e._queryParams,r=this._limit,(n=t.copy()).limitSet_=!0,n.limit_=r,n.viewFrom_="r",n),e._orderByCalled);var t,r,n}}class xg extends kg{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ag(e,"orderByChild");var t=new f(this._path);if(b(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Uc(t),t=Jc(e._queryParams,t);return og(t),new sg(e._repo,e._path,t,!0)}}class Og extends kg{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ag(e,"orderByKey");var t=Jc(e._queryParams,dc);return og(t),new sg(e._repo,e._path,t,!0)}}class Lg extends kg{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ag(e,"orderByPriority");var t=Jc(e._queryParams,I);return og(t),new sg(e._repo,e._path,t,!0)}}class Mg extends kg{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ag(e,"orderByValue");var t=Jc(e._queryParams,qc);return og(t),new sg(e._repo,e._path,t,!0)}}class Fg extends kg{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(sf("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Sg(this._value,this._key)._apply(new Ng(this._value,this._key)._apply(e))}}function Ug(e,...t){let r=w(e);for(var n of t)r=n._apply(r);return r}t=hg,g(!lp,"__referenceConstructor has already been defined"),lp=t,t=hg,g(!wp,"__referenceConstructor has already been defined"),wp=t;let Vg="FIREBASE_DATABASE_EMULATOR_HOST",qg={},jg=!1;function Bg(e,t,r,n,i){let s=n||e.options.databaseURL,a=(void 0===s&&(e.options.projectId||uu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),hu("Using default host for project ",e.options.projectId),s=e.options.projectId+"-default-rtdb.firebaseio.com"),Jf(s,i)),o=a.repoInfo,l,h=void 0;(h="undefined"!=typeof process&&process.env?process.env[Vg]:h)?(l=!0,s=`http://${h}?ns=`+o.namespace,a=Jf(s,i),o=a.repoInfo):l=!a.repoInfo.secure;var u=i&&l?new Su(Su.OWNER):new ku(e.name,e.options,t),u=(wf("Invalid Firebase Database URL",a),b(a.path)||uu("Database URL must point to the root of a Firebase Database (not including a child path)."),((e,t,r,n)=>{let i=qg[t.name];var s;return i||(i={},qg[t.name]=i),(s=i[e.toURLString()])&&uu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Af(e,jg,r,n),i[e.toURLString()]=s})(o,e,u,new Cu(e,r)));return new zg(u,e)}class zg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Nf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new hg(this._repo,v())),this._rootInternal}_delete(){var e,t,r;return null!==this._rootInternal&&(e=this._repo,t=this.app.name,(r=qg[t])&&r[e.key]===e||uu(`Database ${t}(${e.repoInfo_}) has already been deleted.`),qf(e),delete r[e.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&uu("Cannot call "+e+" on a deleted database.")}}function Kg(){Bu.IS_TRANSPORT_INITIALIZED&&cu("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Wg(){Kg(),Uu.forceDisallow()}function Hg(){Kg(),ju.forceDisallow(),Uu.forceAllow()}function Gg(e,t,r,n={}){(e=w(e))._checkNotDeleted("useEmulator");var i,s=t+":"+r,a=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&Te(n,a.repoInfo_.emulatorOptions))return;uu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o=void 0;a.repoInfo_.nodeAdmin?(n.mockUserToken&&uu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Su(Su.OWNER)):n.mockUserToken&&(i="string"==typeof n.mockUserToken?n.mockUserToken:ee(n.mockUserToken,e.app.options.projectId),o=new Su(i)),t=a,r=s,e=n,n=o,t.repoInfo_=new Pu(r,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,e),n&&(t.authTokenProvider_=n)}function $g(e){(e=w(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(kf)}function Qg(e,t){lu(e,t)}let Yg={".sv":"timestamp"};class Jg{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Xg(i,e,t){if(i=w(i),uf("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var r=null==(r=null==t?void 0:t.applyLocally)||r;let s=new Z;var n=wg(i,()=>{}),t=i._repo,a=i._path,o=(e,t,r)=>{var n;e?s.reject(e):(n=new ug(r,new hg(i._repo,i._path),I),s.resolve(new Jg(t,n)))},l=n,h=r;jf(t,"transaction on "+a);var u,n={path:a,update:e,onComplete:o,status:null,order:iu(),applyLocally:h,retryCount:0,unwatcher:l,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},r=zf(t,a,void 0);if(n.currentInputSnapshot=r,void 0===(u=n.update(r.val())))n.unwatcher(),n.currentOutputSnapshotRaw=null,n.currentOutputSnapshotResolved=null,n.onComplete&&n.onComplete(null,!1,n.currentInputSnapshot);else{_f("transaction failed: Data returned ",u,n.path),n.status=0;var c=Jp(t.transactionQueueTree_,a),d=Xp(c)||[];d.push(n),Zp(c,d);let e;"object"==typeof u&&null!==u&&ye(u,".priority")?(e=we(u,".priority"),g(vf(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):(c=Rp(t.serverSyncTree_,a)||T.EMPTY_NODE,e=c.getPriority().val());d=Pf(t),c=Fc(u,e),u=$p(c,r,d),r=(n.currentOutputSnapshotRaw=c,n.currentOutputSnapshotResolved=u,n.currentWriteId=Lf(t),Tp(t.serverSyncTree_,a,u,n.currentWriteId,n.applyLocally));Ef(t.eventQueue_,a,r),Kf(t,t.transactionQueueTree_)}return s.promise}lc.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},lc.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},zh(xt),kt(new u("database",(e,{instanceIdentifier:t})=>Bg(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),d(jh,"1.0.13",WD),d(jh,"1.0.13","esm2017");function Zg(e){var t="FIREBASE WARNING: "+e;em.warn(t)}let em=new Qe("@firebase/database-compat");class tm{constructor(e){this._delegate=e}cancel(t){l("OnDisconnect.cancel",0,1,arguments.length),xe("OnDisconnect.cancel","onComplete",t,!0);var e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){l("OnDisconnect.remove",0,1,arguments.length),xe("OnDisconnect.remove","onComplete",t,!0);var e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){l("OnDisconnect.set",1,2,arguments.length),xe("OnDisconnect.set","onComplete",t,!0);var r=this._delegate.set(e);return t&&r.then(()=>t(null),e=>t(e)),r}setWithPriority(e,t,r){l("OnDisconnect.setWithPriority",2,3,arguments.length),xe("OnDisconnect.setWithPriority","onComplete",r,!0);var n=this._delegate.setWithPriority(e,t);return r&&n.then(()=>r(null),e=>r(e)),n}update(t,r){if(l("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){var n={};for(let e=0;e<t.length;++e)n[""+e]=t[e];t=n,Zg("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}xe("OnDisconnect.update","onComplete",r,!0);var e=this._delegate.update(t);return r&&e.then(()=>r(null),e=>r(e)),e}}class rm{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return l("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class nm{constructor(e,t){this._database=e,this._delegate=t}val(){return l("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return l("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return l("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return l("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return l("DataSnapshot.child",0,1,arguments.length),e=String(e),yf("DataSnapshot.child","path",e,!1),new nm(this._database,this._delegate.child(e))}hasChild(e){return l("DataSnapshot.hasChild",1,1,arguments.length),yf("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return l("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return l("DataSnapshot.forEach",1,1,arguments.length),xe("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new nm(this._database,e)))}hasChildren(){return l("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return l("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return l("DataSnapshot.ref",0,0,arguments.length),new sm(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class im{constructor(e,t){this.database=e,this._delegate=t}on(e,r,t,n){var i;l("Query.on",2,4,arguments.length),xe("Query.on","callback",r,!1);let s=im.getCancelAndContextArgs_("Query.on",t,n);var a=(e,t)=>{r.call(s.context,new nm(this.database,e),t)},o=(a.userCallback=r,a.context=s.context,null==(i=s.cancel)?void 0:i.bind(s.context));switch(e){case"value":return wg(this._delegate,a,o),r;case"child_added":return bg(this._delegate,a,o),r;case"child_removed":return Eg(this._delegate,a,o),r;case"child_changed":return Ig(this._delegate,a,o),r;case"child_moved":return Tg(this._delegate,a,o),r;default:throw new Error(De("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){l("Query.off",0,3,arguments.length);var n,i="Query.off",s=e,a=!0;if(!a||void 0!==s)switch(s){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(De(i,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}xe("Query.off","callback",t,!0),Oe("Query.off","context",r,!0),t?((n=()=>{}).userCallback=t,n.context=r,Cg(this._delegate,e,n)):Cg(this._delegate,e)}get(){return mg(this._delegate).then(e=>new nm(this.database,e))}once(e,n,t,r){l("Query.once",1,4,arguments.length),xe("Query.once","callback",n,!0);let i=im.getCancelAndContextArgs_("Query.once",t,r),s=new Z;var a=(e,t)=>{var r=new nm(this.database,e);n&&n.call(i.context,r,t),s.resolve(r)},o=(a.userCallback=n,a.context=i.context,e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)});switch(e){case"value":wg(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":bg(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":Eg(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":Ig(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":Tg(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(De("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return l("Query.limitToFirst",1,1,arguments.length),new im(this.database,Ug(this._delegate,(e=>{if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Pg(e)})(e)))}limitToLast(e){return l("Query.limitToLast",1,1,arguments.length),new im(this.database,Ug(this._delegate,(e=>{if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Dg(e)})(e)))}orderByChild(e){return l("Query.orderByChild",1,1,arguments.length),new im(this.database,Ug(this._delegate,(e=>{if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return yf("orderByChild","path",e,!1),new xg(e)})(e)))}orderByKey(){return l("Query.orderByKey",0,0,arguments.length),new im(this.database,Ug(this._delegate,new Og))}orderByPriority(){return l("Query.orderByPriority",0,0,arguments.length),new im(this.database,Ug(this._delegate,new Lg))}orderByValue(){return l("Query.orderByValue",0,0,arguments.length),new im(this.database,Ug(this._delegate,new Mg))}startAt(e=null,t){return l("Query.startAt",0,2,arguments.length),new im(this.database,Ug(this._delegate,([e=null,t]=[e,t],lf("startAt","key",t,!0),new Ng(e,t))))}startAfter(e=null,t){return l("Query.startAfter",0,2,arguments.length),new im(this.database,Ug(this._delegate,(e=e,t=t,lf("startAfter","key",t,!0),new Rg(e,t))))}endAt(e=null,t){return l("Query.endAt",0,2,arguments.length),new im(this.database,Ug(this._delegate,(e=e,t=t,lf("endAt","key",t,!0),new Sg(e,t))))}endBefore(e=null,t){return l("Query.endBefore",0,2,arguments.length),new im(this.database,Ug(this._delegate,(e=e,t=t,lf("endBefore","key",t,!0),new Ag(e,t))))}equalTo(e,t){return l("Query.equalTo",1,2,arguments.length),new im(this.database,Ug(this._delegate,(e=e,t=t,lf("equalTo","key",t,!0),new Fg(e,t))))}toString(){return l("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return l("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(l("Query.isEqual",1,1,arguments.length),e instanceof im)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,r){var n={cancel:void 0,context:void 0};if(t&&r)n.cancel=t,xe(e,"cancel",n.cancel,!0),n.context=r,Oe(e,"context",n.context,!0);else if(t)if("object"==typeof t&&null!==t)n.context=t;else{if("function"!=typeof t)throw new Error(De(e,"cancelOrContext")+" must either be a cancel callback or a context object.");n.cancel=t}return n}get ref(){return new sm(this.database,new hg(this._delegate._repo,this._delegate._path))}}class sm extends im{constructor(e,t){super(e,new sg(t._repo,t._path,new $c,!1)),this.database=e,this._delegate=t}getKey(){return l("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return l("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new sm(this.database,pg(this._delegate,e))}getParent(){l("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new sm(this.database,e):null}getRoot(){return l("Reference.root",0,0,arguments.length),new sm(this.database,this._delegate.root)}set(e,t){l("Reference.set",1,2,arguments.length),xe("Reference.set","onComplete",t,!0);var r=fg(this._delegate,e);return t&&r.then(()=>t(null),e=>t(e)),r}update(t,r){if(l("Reference.update",1,2,arguments.length),Array.isArray(t)){var n={};for(let e=0;e<t.length;++e)n[""+e]=t[e];t=n,Zg("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}uf("Reference.update",this._delegate._path),xe("Reference.update","onComplete",r,!0);var e=gg(this._delegate,t);return r&&e.then(()=>r(null),e=>r(e)),e}setWithPriority(e,t,r){l("Reference.setWithPriority",2,3,arguments.length),xe("Reference.setWithPriority","onComplete",r,!0);var n=((e,t,r)=>{if(uf("setWithPriority",e._path),sf("setWithPriority",t,e._path,!1),of("setWithPriority",r,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var n=new Z;return Mf(e._repo,e._path,t,r,n.wrapCallback(()=>{})),n.promise})(this._delegate,e,t);return r&&n.then(()=>r(null),e=>r(e)),n}remove(t){l("Reference.remove",0,1,arguments.length),xe("Reference.remove","onComplete",t,!0);e=this._delegate,uf("remove",e._path);var e,r=fg(e,null);return t&&r.then(()=>t(null),e=>t(e)),r}transaction(e,t,r){l("Reference.transaction",1,3,arguments.length),xe("Reference.transaction","transactionUpdate",e,!1),xe("Reference.transaction","onComplete",t,!0);var n,i="Reference.transaction",s="applyLocally",a=r,o=!0;if(o&&void 0===a||"boolean"==typeof a)return n=Xg(this._delegate,e,{applyLocally:r}).then(e=>new rm(e.committed,new nm(this.database,e.snapshot))),t&&n.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),n;throw new Error(De(i,s)+"must be a boolean.")}setPriority(e,t){l("Reference.setPriority",1,2,arguments.length),xe("Reference.setPriority","onComplete",t,!0);r=this._delegate,e=e,r=w(r),uf("setPriority",r._path),of("setPriority",e,!1),n=new Z,Mf(r._repo,Zu(r._path,".priority"),e,null,n.wrapCallback(()=>{}));var r,n=n.promise;return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){l("Reference.push",0,2,arguments.length),xe("Reference.push","onComplete",t,!0);var r=((e,t)=>{e=w(e),uf("push",e._path),sf("push",t,e._path,!0);var r=Rf(e._repo),r=eg(r),n=pg(e,r);let i=pg(e,r),s;return s=null!=t?fg(i,t).then(()=>i):Promise.resolve(i),n.then=s.then.bind(s),n.catch=s.then.bind(s,void 0),n})(this._delegate,e),n=r.then(e=>new sm(this.database,e)),r=(t&&n.then(()=>t(null),e=>t(e)),new sm(this.database,r));return r.then=n.then.bind(n),r.catch=n.catch.bind(n,void 0),r}onDisconnect(){return uf("Reference.onDisconnect",this._delegate._path),new tm(new ig(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class am{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Wg,forceLongPolling:Hg}}useEmulator(e,t,r={}){Gg(this._delegate,e,t,r)}ref(e){var t;return l("database.ref",0,1,arguments.length),e instanceof sm?(t=dg(this._delegate,e.toString()),new sm(this,t)):(t=cg(this._delegate,e),new sm(this,t))}refFromURL(e){l("database.refFromURL",1,1,arguments.length);var t=dg(this._delegate,e);return new sm(this,t)}goOffline(){var e;l("database.goOffline",0,0,arguments.length),(e=w(e=this._delegate))._checkNotDeleted("goOffline"),qf(e._repo)}goOnline(){return l("database.goOnline",0,0,arguments.length),$g(this._delegate)}}am.ServerValue={TIMESTAMP:Yg,increment:e=>({".sv":{increment:e}})};nr=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:r,customAuthImpl:n,customAppCheckImpl:i,namespace:s,nodeAdmin:a=!1}){zh(r);var o=new ze("database-standalone"),l=new Be("auth-internal",o);l.setComponent(new u("auth-internal",()=>n,"PRIVATE"));let h=void 0;return i&&(h=new Be("app-check-internal",o)).setComponent(new u("app-check-internal",()=>i,"PRIVATE")),{instance:new am(Bg(e,l,h,t,a),e),namespace:s}}});let om=am.ServerValue;(t=rr).INTERNAL.registerComponent(new u("database-compat",(e,{instanceIdentifier:t})=>{var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("database").getImmediate({identifier:t});return new am(n,r)},"PUBLIC").setServiceProps({Reference:sm,Query:im,Database:am,DataSnapshot:nm,enableLogging:Qg,INTERNAL:nr,ServerValue:om}).setMultipleInstances(!0)),t.registerVersion("@firebase/database-compat","2.0.4");var lm,hm,um,cm,dm,pm,fm,gm,mm,vm,_m,ym,wm="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},bm=(!(function(){var e,t,s;function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(){}function a(e,t,r){r=r||0;var n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1];var i=e.g[2],s=e.g[3],a=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=r+((a=t+(s^r&(i^s))+n[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i^s)+n[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(r|~s))+n[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=r+((a=t+(i^(r|~s))+n[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~r))+n[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+n[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function h(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}t=r,s=function(){this.blockSize=-1},n.prototype=s.prototype,t.D=s.prototype,t.prototype=new n,(t.prototype.constructor=t).C=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)},r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},r.prototype.u=function(e,t){for(var r=(t=void 0===t?e.length:t)-this.blockSize,n=this.B,i=this.h,s=0;s<t;){if(0==i)for(;s<=r;)a(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(n[i++]=e.charCodeAt(s++),i==this.blockSize){a(this,n),i=0;break}}else for(;s<t;)if(n[i++]=e[s++],i==this.blockSize){a(this,n),i=0;break}}this.h=i,this.o+=t},r.prototype.v=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;for(var r=8*this.o,t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;t<4;++t)for(var n=0;n<32;n+=8)e[r++]=this.g[t]>>>n&255;return e};var i={};function o(e){return-128<=e&&e<128?(t=e,r=function(e){return new h([0|e],e<0?-1:0)},n=i,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=r(t)):new h([0|e],e<0?-1:0);var t,r,n}function u(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(u(-e));for(var t=[],r=1,n=0;r<=e;n++)t[n]=e/r|0,r*=4294967296;return new h(t,0)}var c=o(0),l=o(1),d=o(16777216);function p(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function f(e){return-1==e.h}function g(e){for(var t=e.g.length,r=[],n=0;n<t;n++)r[n]=~e.g[n];return new h(r,~e.h).add(l)}function m(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function _(e,t){this.g=e,this.h=t}function y(e,t){if(p(t))throw Error("division by zero");if(p(e))return new _(c,c);if(f(e))return t=y(g(e),t),new _(g(t.g),g(t.h));if(f(t))return t=y(e,g(t)),new _(g(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=l,n=t;n.l(e)<=0;)r=w(r),n=w(n);for(var i=b(r,1),s=b(n,1),n=b(n,2),r=b(r,2);!p(n);){var a=s.add(n);a.l(e)<=0&&(i=i.add(r),s=a),n=b(n,1),r=b(r,1)}return t=m(e,i.j(t)),new _(i,t)}for(i=c;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=(n=Math.ceil(Math.log(r)/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=u(r)).j(t);f(a)||0<a.l(e);)a=(s=u(r-=n)).j(t);p(s)&&(s=l),i=i.add(s),e=m(e,a)}return new _(i,e)}function w(e){for(var t=e.g.length+1,r=[],n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new h(r,e.h)}function b(e,t){var r=t>>5;t%=32;for(var n=e.g.length-r,i=[],s=0;s<n;s++)i[s]=0<t?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new h(i,e.h)}(e=h.prototype).m=function(){if(f(this))return-g(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(f(this))return"-"+g(this).toString(e);for(var t=u(Math.pow(e,6)),r=this,n="";;){var i=y(r,t).g,s=((0<(r=m(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return f(e=m(this,e))?-1:p(e)?0:1},e.abs=function(){return f(this)?g(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0,i=0;i<=t;i++){var s=n+(65535&this.i(i))+(65535&e.i(i)),a=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16),n=a>>>16;r[i]=(a&=65535)<<16|(s&=65535)}return new h(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(p(this)||p(e))return c;if(f(this))return f(e)?g(this).j(g(e)):g(g(this).j(e));if(f(e))return g(this.j(g(e)));if(this.l(d)<0&&e.l(d)<0)return u(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(var i=0;i<e.g.length;i++){var s=this.i(n)>>>16,a=65535&this.i(n),o=e.i(i)>>>16,l=65535&e.i(i);r[2*n+2*i]+=a*l,v(r,2*n+2*i),r[2*n+2*i+1]+=s*l,v(r,2*n+2*i+1),r[2*n+2*i+1]+=a*o,v(r,2*n+2*i+1),r[2*n+2*i+2]+=s*o,v(r,2*n+2*i+2)}for(n=0;n<t;n++)r[n]=r[2*n+1]<<16|r[2*n];for(n=t;n<2*t;n++)r[n]=0;return new h(r,0)},e.A=function(e){return y(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new h(r,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new h(r,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new h(r,this.h^e.h)},r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,hm=r,h.prototype.multiply=h.prototype.j,h.prototype.modulo=h.prototype.A,h.prototype.compare=h.prototype.l,h.prototype.toNumber=h.prototype.m,h.prototype.getBits=h.prototype.i,h.fromNumber=u,h.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=u(Math.pow(r,8)),i=c,s=0;s<t.length;s+=8)var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),r),i=(a<8?(a=u(Math.pow(r,a)),i.j(a)):i=i.j(n)).add(u(o));return i},lm=h}).apply(void 0!==wm?wm:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});!(function(){var e,R="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value),e};var P=(e=>{e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof bm&&bm];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")})(this);var t="Array.prototype.values",r=function(e){return e||function(){return r=function(e,t){return t},(t=this)instanceof String&&(t+=""),n=0,i=!1,(e={next:function(){var e;return!i&&n<t.length?(e=n++,{value:r(e,t[e]),done:!1}):{done:i=!0,value:void 0}}})[Symbol.iterator]=function(){return e},e;var t,r,n,i,e}};if(r)e:{var n=P;t=t.split(".");for(var i=0;i<t.length-1;i++){var U=t[i];if(!(U in n))break e;n=n[U]}(r=r(i=n[t=t[t.length-1]]))!=i&&null!=r&&R(n,t,{configurable:!0,writable:!0,value:r})}var V=V||{},D=this||self;function q(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function h(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function j(e,t,r){return e.call.apply(e.bind,arguments)}function B(t,r,e){var n;if(t)return 2<arguments.length?(n=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,n),t.apply(r,e)}):function(){return t.apply(r,arguments)};throw Error()}function m(e,t,r){return(m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?j:B).apply(null,arguments)}function z(t){var r=Array.prototype.slice.call(arguments,1);return function(){var e=r.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function s(e,s){function t(){}t.prototype=s.prototype,e.aa=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Qb=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)}}function K(t){var r=t.length;if(0<r){var n=Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n}return[]}function W(t){for(let e=1;e<arguments.length;e++){var r=arguments[e];if(q(r)){var n=t.length||0,i=r.length||0;t.length=n+i;for(let e=0;e<i;e++)t[n+e]=r[e]}else t.push(r)}}function x(e){return/^[\s\xa0]*$/.test(e)}function a(){var e=D.navigator;return(e=e&&e.userAgent)||""}function H(e){return H[" "](e),e}H[" "]=function(){};var G=!(-1==a().indexOf("Gecko")||-1!=a().toLowerCase().indexOf("webkit")&&-1==a().indexOf("Edge")||-1!=a().indexOf("Trident")||-1!=a().indexOf("MSIE")||-1!=a().indexOf("Edge"));function $(e,t,r){for(var n in e)t.call(r,e[n],n,e)}function Q(e){var t,r={};for(t in e)r[t]=e[t];return r}let Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t){let r,n;for(let i=1;i<arguments.length;i++){for(r in n=arguments[i])t[r]=n[r];for(let e=0;e<Y.length;e++)r=Y[e],Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}}var X=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Z,e=>e.reset());class Z{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let o,l=!1,ee=new class{constructor(){this.h=this.g=null}add(e,t){var r=X.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},te=()=>{let e=D.Promise.resolve(void 0);o=()=>{e.then(re)}};var re=()=>{for(var e;e=(()=>{let e=ee,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t})();){try{e.h.call(e.g)}catch(e){(e=>{D.setTimeout(()=>{throw e},0)})(e)}var t=X;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}l=!1};function u(){this.s=this.s,this.C=this.C}function c(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}u.prototype.s=!1,u.prototype.ma=function(){this.s||(this.s=!0,this.N())},u.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},c.prototype.h=function(){this.defaultPrevented=!0};var ne=(()=>{if(!D.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var r=()=>{};D.addEventListener("test",r,t),D.removeEventListener("test",r,t)}catch(e){}return e})();function d(e,t){if(c.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(G){e:{try{H(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ie[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&d.aa.h.call(this)}}s(d,c);var ie={2:"touch",3:"pen",4:"mouse"},p=(d.prototype.h=function(){d.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1},"closure_listenable_"+(1e6*Math.random()|0)),se=0;function ae(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++se,this.da=this.fa=!1}function oe(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function le(e){this.src=e,this.g={},this.h=0}function he(e,t){var r,n,i,s=t.type;s in e.g&&(r=e.g[s],(i=0<=(n=Array.prototype.indexOf.call(r,t,void 0)))&&Array.prototype.splice.call(r,n,1),i)&&(oe(t),0==e.g[s].length)&&(delete e.g[s],e.h--)}function ue(e,t,r,n){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!r&&s.ha==n)return i}return-1}le.prototype.add=function(e,t,r,n,i){var s=e.toString(),a=((e=this.g[s])||(e=this.g[s]=[],this.h++),ue(e,t,n,i));return-1<a?(t=e[a],r||(t.fa=!1)):((t=new ae(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var ce="closure_lm_"+(1e6*Math.random()|0),de={};function pe(e,t,r,n,i){if(n&&n.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}n=we(n);return t&&t[p]?t.L(r,n,h(i)?!!i.capture:!!i,s):fe(t,r,n,!0,i,s)}(e,t,r,n,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)pe(e,t[s],r,n,i);return null}return r=we(r),e&&e[p]?e.K(t,r,h(n)?!!n.capture:!!n,i):fe(e,t,r,!1,n,i)}function fe(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");var a=h(i)?!!i.capture:!!i,o=_e(e);if(o||(e[ce]=o=new le(e)),!(r=o.add(t,r,n,a,s)).proxy)if(n=(()=>{let r=ve;return function e(t){return r.call(e.src,e.listener,t)}})(),(r.proxy=n).src=e,n.listener=r,e.addEventListener)void 0===(i=ne?i:a)&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(me(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function ge(e){var t,r,n;"number"!=typeof e&&e&&!e.da&&((t=e.src)&&t[p]?he(t.i,e):(r=e.type,n=e.proxy,t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(me(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=_e(t))?(he(r,e),0==r.h&&(r.src=null,t[ce]=null)):oe(e)))}function me(e){return e in de?de[e]:de[e]="on"+e}function ve(e,t){var r,n;return e=!!e.da||(t=new d(t,this),r=e.listener,n=e.ha||e.src,e.fa&&ge(e),r.call(n,t))}function _e(e){return(e=e[ce])instanceof le?e:null}var ye="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(t){return"function"==typeof t?t:(t[ye]||(t[ye]=function(e){return t.handleEvent(e)}),t[ye])}function f(){u.call(this),this.i=new le(this),(this.M=this).F=null}function g(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t?t=new c(t,e):t instanceof c?t.target=t.target||e:(a=t,J(t=new c(n,e),a)),a=!0,r)for(var i=r.length-1;0<=i;i--)var s=t.g=r[i],a=be(s,n,!0,t)&&a;if(a=be(s=t.g=e,n,!0,t)&&a,a=be(s,n,!1,t)&&a,r)for(i=0;i<r.length;i++)a=be(s=t.g=r[i],n,!1,t)&&a}function be(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,l=t[s];l&&!l.da&&l.capture==r&&(a=l.listener,o=l.ha||l.src,l.fa&&he(e.i,l),i=!1!==a.call(o,n)&&i)}return i&&!n.defaultPrevented}function Ie(e,t,r){if("function"==typeof e)r&&(e=m(e,r));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=m(e.handleEvent,e)}return 2147483647<Number(t)?-1:D.setTimeout(e,t||0)}s(f,u),f.prototype[p]=!0,f.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else i=h(i)?!!i.capture:!!i,n=we(n),t&&t[p]?(t=t.i,(r=String(r).toString())in t.g&&-1<(n=ue(a=t.g[r],n,i,s))&&(oe(a[n]),Array.prototype.splice.call(a,n,1),0==a.length)&&(delete t.g[r],t.h--)):(t=t&&_e(t))&&(r=t.g[r.toString()],n=(t=-1)<(t=r?ue(r,n,i,s):t)?r[t]:null)&&ge(n)}(this,e,t,r,n)},f.prototype.N=function(){if(f.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)oe(r[n]);delete t.g[e],t.h--}}this.F=null},f.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},f.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class Te extends u{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Ie(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);var r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function v(e){u.call(this),this.h=e,this.g={}}s(v,u);var Ee=[];function Ce(e){$(e.g,function(e,t){this.g.hasOwnProperty(t)&&ge(e)},e),e.g={}}v.prototype.N=function(){v.aa.N.call(this),Ce(this)},v.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ke=D.JSON.stringify,Se=D.JSON.parse,Ae=class{stringify(e){return D.JSON.stringify(e,void 0)}parse(e){return D.JSON.parse(e,void 0)}};function Ne(){}function Re(e){return e.h||(e.h=e.i())}function Pe(){}Ne.prototype.h=null;var De={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xe(){c.call(this,"d")}function Oe(){c.call(this,"c")}s(xe,c),s(Oe,c);var _={},Le=null;function Me(){return Le=Le||new f}function Fe(e){c.call(this,_.La,e)}function Ue(){var e=Me();g(e,new Fe(e))}function Ve(e,t){c.call(this,_.STAT_EVENT,e),this.stat=t}function O(e){var t=Me();g(t,new Ve(t,e))}function qe(e,t){c.call(this,_.Ma,e),this.size=t}function je(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){e()},t)}function Be(){this.g=!0}function L(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+((e,t)=>{if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return ke(r)}catch(e){return t}})(e,r)+(n?" "+n:"")})}_.La="serverreachability",s(Fe,c),_.STAT_EVENT="statevent",s(Ve,c),_.Ma="timingevent",s(qe,c),Be.prototype.xa=function(){this.g=!1},Be.prototype.info=function(){};var ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ke={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function We(){}function y(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new v(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new He}function He(){this.i=null,this.g="",this.h=!1}s(We,Ne),We.prototype.g=function(){return new XMLHttpRequest},We.prototype.i=function(){return{}};var Ge=new We,$e={},Qe={};function Ye(e,t,r){e.L=1,e.v=vt(b(t)),e.m=r,e.P=!0,Je(e,null)}function Je(e,t){e.F=Date.now(),Ze(e),e.A=b(e.v);var r=e.A,n=e.R,i=(Array.isArray(n)||(n=[String(n)]),Rt(r.i,"t",n),e.C=0,r=e.j.J,e.h=new He,e.g=cr(e.j,r?t:null,!e.m),0<e.O&&(e.M=new Te(m(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca,"readystatechange");Array.isArray(i)||(i&&(Ee[0]=i.toString()),i=Ee);for(var a,o,l,h,u,c,s=0;s<i.length;s++){var d=pe(r,i[s],n||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?Q(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ue(),a=e.i,o=e.u,l=e.A,h=e.l,u=e.R,c=e.m,a.info(function(){if(a.g)if(c)for(var e="",t=c.split("&"),r=0;r<t.length;r++){var n,i,s=t[r].split("=");1<s.length&&(n=s[0],s=s[1],e=2<=(i=n.split("_")).length&&"type"==i[1]?e+(n+"=")+s+"&":e+(n+"=redacted&"))}else e=null;else e=c;return"XMLHTTP REQ ("+h+") [attempt "+u+"]: "+o+"\n"+l+"\n"+e})}function Xe(e){return e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Ze(e){e.S=Date.now()+e.I,et(e,e.I)}function et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=je(m(e.ba,e),t)}function tt(e){e.B&&(D.clearTimeout(e.B),e.B=null)}function rt(e){0==e.j.G||e.J||or(e.j,e)}function M(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,Ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function nt(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||lt(r.h,e)))if(!e.K&&lt(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.u){if(r.g){if(!(r.g.F+3e3<e.F))break e;ar(r),Yt(r)}nr(r),O(18)}}else r.za=i[1],0<r.za-r.T&&i[2]<37500&&r.F&&0==r.v&&!r.C&&(r.C=je(m(r.Za,r),6e3));if(ot(r.h)<=1&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else S(r,11)}else if(!e.K&&r.g!=e||ar(r),!x(t))for(i=r.Da.g.parse(t),t=0;t<i.length;t++){var s,a,o,l,h,u,c,d,p,f,g=i[t];r.T=g[0],g=g[1],2==r.G?"c"==g[0]?(r.K=g[1],r.ia=g[2],null!=(s=g[3])&&(r.la=s,r.j.info("VER="+r.la)),null!=(a=g[4])&&(r.Aa=a,r.j.info("SVER="+r.Aa)),null!=(o=g[5])&&"number"==typeof o&&0<o&&(n=1.5*o,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r,(l=e.g)&&(!(h=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null)||(u=n.h).g||-1==h.indexOf("spdy")&&-1==h.indexOf("quic")&&-1==h.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(ht(u,u.h),u.h=null)),n.D)&&(c=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.ya=c,I(n.I,n.D,c)),r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms")),d=e,(n=r).qa=ur(n,n.J?n.ia:null,n.W),d.K?(ut(n.h,d),p=d,(f=n.L)&&(p.I=f),p.B&&(tt(p),Ze(p)),n.g=d):rr(n),0<r.i.length&&Xt(r)):"stop"!=g[0]&&"close"!=g[0]||S(r,7):3==r.G&&("stop"==g[0]||"close"==g[0]?"stop"==g[0]?S(r,7):Qt(r):"noop"!=g[0]&&r.l&&r.l.ta(g),r.v=0)}Ue()}catch(e){}}y.prototype.ca=function(e){e=e.target;var t=this.M;t&&3==F(e)?t.j():this.Y(e)},y.prototype.Y=function(e){try{if(e==this.g)e:{var t=F(this.g),r=this.g.Ba();this.g.Z();if(!(t<3)&&(3!=t||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=t||7==r||Ue(),tt(this);var n=this.g.Z();this.X=n;t:if(Xe(this)){var i=Ht(this.g),s=(e="",i.length),a=4==F(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){M(this),rt(this);var o="";break t}this.h.i=new D.TextDecoder}for(r=0;r<s;r++)this.h.h=!0,e+=this.h.i.decode(i[r],{stream:!(a&&r==s-1)});i.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,C=this.i,k=this.u,S=this.A,A=this.l,N=this.R,R=t,P=n,C.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+N+"]: "+k+"\n"+S+"\n"+R+" "+P}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h=this.g;if((l=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,O(12),M(this),rt(this);break e}L(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nt(this,n)}if(this.P){for(var c,d,n=!0;!this.J&&this.C<o.length;){if(I=o,E=T=void 0,T=(b=this).C,(c=-1==(E=I.indexOf("\n",T))?Qe:(T=Number(I.substring(T,E)),isNaN(T)?$e:(E+=1)+T>I.length?Qe:(I=I.slice(E,E+T),b.C=E+T,I)))==Qe){4==t&&(this.s=4,O(14),n=!1),L(this.i,this.l,null,"[Incomplete Response]");break}if(c==$e){this.s=4,O(15),L(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}L(this.i,this.l,c,null),nt(this,c)}Xe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=t||0!=o.length||this.h.h||(this.s=1,O(16),n=!1),this.o=this.o&&n,n?0<o.length&&!this.W&&(this.W=!0,(d=this.j).g==this)&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),ir(d),d.M=!0,O(11)):(L(this.i,this.l,o,"[Invalid Chunked Response]"),M(this),rt(this))}else L(this.i,this.l,o,null),nt(this,o);4==t&&M(this),this.o&&!this.J&&(4==t?or(this.j,this):(this.o=!1,Ze(this)))}else{{var p=this.g;var f,g,m,v={};p=(p.g&&2<=F(p)&&p.g.getAllResponseHeaders()||"").split("\r\n");for(let e=0;e<p.length;e++)x(p[e])||(f=(e=>{for(var t=1,r=(e=e.split(":"),[]);0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r})(p[e]),g=f[0],"string"==typeof(f=f[1])&&(f=f.trim(),m=v[g]||[],(v[g]=m).push(f)));var _,y=v,w=function(e){return e.join(", ")};for(_ in y)w.call(void 0,y[_],_,y)}400==n&&0<o.indexOf("Unknown SID")?(this.s=3,O(12)):(this.s=0,O(13)),M(this),rt(this)}}}}catch(e){}var b,I,T,E,C,k,S,A,N,R,P},y.prototype.cancel=function(){this.J=!0,M(this)},y.prototype.ba=function(){this.B=null;var e,t,r=Date.now();0<=r-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(Ue(),O(17)),M(this),this.s=2,rt(this)):et(this,this.S-r)};var it=class{constructor(e,t){this.g=e,this.map=t}};function st(e){this.l=e||10,e=D.PerformanceNavigationTiming?0<(e=D.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(D.chrome&&D.chrome.loadTimes&&D.chrome.loadTimes()&&D.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function at(e){return e.h||e.g&&e.g.size>=e.j}function ot(e){return e.h?1:e.g?e.g.size:0}function lt(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function ht(e,t){e.g?e.g.add(t):e.h=t}function ut(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ct(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return K(t.i);{let e=t.i;for(var r of t.g.values())e=e.concat(r.D);return e}}function dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(q(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=(e=>{if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(q(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r)}else for(var n in t=[],r=0,e)t[r++]=n;return t}}})(e),n=(e=>{if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(q(e))for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);else for(n in t=[],r=0,e)t[r++]=e[n];return t})(e),i=n.length,s=0;s<i;s++)t.call(void 0,n[s],r&&r[s],e)}st.prototype.cancel=function(){if(this.i=ct(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(var e of this.g.values())e.cancel();this.g.clear()}};var pt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function w(e){var t,r;this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof w?(this.h=e.h,ft(this,e.j),this.o=e.o,this.g=e.g,gt(this,e.s),this.l=e.l,t=e.i,(r=new St).i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),mt(this,r),this.m=e.m):e&&(t=String(e).match(pt))?(this.h=!1,ft(this,t[1]||"",!0),this.o=_t(t[2]||""),this.g=_t(t[3]||"",!0),gt(this,t[4]),this.l=_t(t[5]||"",!0),mt(this,t[6]||"",!0),this.m=_t(t[7]||"")):(this.h=!1,this.i=new St(null,this.h))}function b(e){return new w(e)}function ft(e,t,r){e.j=r?_t(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.s=t}else e.s=null}function mt(e,t,r){var n,i;t instanceof St?(e.i=t,n=e.i,(i=e.h)&&!n.j&&(T(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(At(this,t),Rt(this,r,e))},n)),n.j=i):(r||(t=yt(t,Ct)),e.i=new St(t,e.h))}function I(e,t,r){e.i.set(t,r)}function vt(e){return I(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function _t(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function yt(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,wt),e=r?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function wt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}w.prototype.toString=function(){var e=[],t=this.j,r=(t&&e.push(yt(t,It,!0),":"),this.g);return!r&&"file"!=t||(e.push("//"),(t=this.o)&&e.push(yt(t,It,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null==(r=this.s))||e.push(":",String(r)),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(yt(r,"/"==r.charAt(0)?Et:Tt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",yt(r,kt)),e.join("")};var bt,It=/[#\/\?@]/g,Tt=/[#\?:]/g,Et=/[#\?]/g,Ct=/[#\?@]/g,kt=/#/g;function St(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function T(r){if(!r.g&&(r.g=new Map,r.h=0,r.i)){var e=r.i,t=function(e,t){r.add(decodeURIComponent(e.replace(/\+/g," ")),t)};if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i,s=e[n].indexOf("="),a=null;0<=s?(i=e[n].substring(0,s),a=e[n].substring(s+1)):i=e[n],t(i,a?decodeURIComponent(a.replace(/\+/g," ")):"")}}}}function At(e,t){T(e),t=E(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Nt(e,t){return T(e),t=E(e,t),e.g.has(t)}function Rt(e,t,r){At(e,t),0<r.length&&(e.i=null,e.g.set(E(e,t),K(r)),e.h+=r.length)}function E(e,t){return t=String(t),t=e.j?t.toLowerCase():t}function C(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function Pt(){this.g=new Ae}function Dt(e){this.l=e.Ub||null,this.j=e.eb||!1}function xt(e,t){f.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ot(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Lt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Mt(e)}function Mt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ft(e){let r="";return $(e,function(e,t){r=(r=r+t+":")+e+"\r\n"}),r}function Ut(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Ft(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):I(e,t,r))}function k(e){f.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=St.prototype).add=function(e,t){T(this),this.i=null,e=E(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(r,n){T(this),this.g.forEach(function(e,t){e.forEach(function(e){r.call(n,e,t,this)},this)},this)},e.na=function(){T(this);var t=Array.from(this.g.values()),r=Array.from(this.g.keys()),n=[];for(let s=0;s<r.length;s++){var i=t[s];for(let e=0;e<i.length;e++)n.push(r[s])}return n},e.V=function(t){T(this);let r=[];if("string"==typeof t)Nt(this,t)&&(r=r.concat(this.g.get(E(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)r=r.concat(t[e])}return r},e.set=function(e,t){return T(this),this.i=null,Nt(this,e=E(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),r=0;r<t.length;r++)for(var n=t[r],i=encodeURIComponent(String(n)),s=this.V(n),n=0;n<s.length;n++){var a=i;""!==s[n]&&(a+="="+encodeURIComponent(String(s[n]))),e.push(a)}return this.i=e.join("&")},s(Dt,Ne),Dt.prototype.g=function(){return new xt(this.l,this.j)},Dt.prototype.i=(bt={},function(){return bt}),s(xt,f),(e=xt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Mt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||D).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Lt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Mt(this)),this.g)&&(this.readyState=3,Mt(this),this.g))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==D.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ot(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){var t;this.g&&(this.o&&e.value?this.response.push(e.value):!this.o&&(t=e.value||new Uint8Array(0),t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t),(e.done?Lt:Mt)(this),3==this.readyState)&&Ot(this)},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Lt(this))},e.Qa=function(e){this.g&&(this.response=e,Lt(this))},e.ga=function(){this.g&&Lt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(xt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),s(k,f);var Vt=/^https?$/i,qt=["POST","PUT"];function jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),Kt(e)}function Bt(e){e.A||(e.A=!0,g(e,"complete"),g(e,"error"))}function zt(e){if(e.h&&void 0!==V&&(!e.v[1]||4!=F(e)||2!=e.Z()))if(e.u&&4==F(e))Ie(e.Ea,0,e);else if(g(e,"readystatechange"),4==F(e)){e.h=!1;try{var t,r,n,i=e.Z();switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break;default:s=!1}if((t=s)||((r=0===i)&&(!(n=String(e.D).match(pt)[1]||null)&&D.self&&D.self.location&&(n=D.self.location.protocol.slice(0,-1)),r=!Vt.test(n?n.toLowerCase():"")),t=r),t)g(e,"complete"),g(e,"success");else{e.m=6;try{var a=2<F(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Bt(e)}}finally{Kt(e)}}}function Kt(e,t){if(e.g){Wt(e);var r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||g(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function Wt(e){e.I&&(D.clearTimeout(e.I),e.I=null)}function F(e){return e.g?e.g.readyState:0}function Ht(e){try{if(e.g){if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}}return null}catch(e){return null}}function Gt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function $t(e){this.Aa=0,this.i=[],this.j=new Be,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new st(e&&e.concurrentRequestLimit),this.Da=new Pt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Jt(e),3==e.G){var t=e.U++,r=b(e.I);if(I(r,"SID",e.K),I(r,"RID",t),I(r,"TYPE","terminate"),er(e,r),(t=new y(e,e.j,t)).L=2,t.v=vt(b(r)),r=!1,D.navigator&&D.navigator.sendBeacon)try{r=D.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&D.Image&&((new Image).src=t.v,r=!0),r||(t.g=cr(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ze(t)}hr(e)}function Yt(e){e.g&&(ir(e),e.g.cancel(),e.g=null)}function Jt(e){Yt(e),e.u&&(D.clearTimeout(e.u),e.u=null),ar(e),e.h.cancel(),e.s&&("number"==typeof e.s&&D.clearTimeout(e.s),e.s=null)}function Xt(e){var t;at(e.h)||e.s||(e.s=!0,t=e.Ga,o||te(),l||(o(),l=!0),ee.add(t,e),e.B=0)}function Zt(e,t){var r=t?t.l:e.U++,n=b(e.I);I(n,"SID",e.K),I(n,"RID",r),I(n,"AID",e.T),er(e,n),e.m&&e.o&&Ut(n,e.m,e.o),r=new y(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tr(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),ht(e.h,r),Ye(r,n,t)}function er(e,r){e.H&&$(e.H,function(e,t){I(r,t,e)}),e.l&&dt({},function(e,t){I(r,t,e)})}function tr(e,t,i){i=Math.min(e.i.length,i);var s=e.l?m(e.l.Na,e.l,e):null;e:{let r=e.i,n=-1;for(;;){var a=["count="+i];-1==n?0<i?(n=r[0].g,a.push("ofs="+n)):n=0:a.push("ofs="+n);let e=!0;for(let t=0;t<i;t++){var o=r[t].g,l=r[t].map;if((o-=n)<0)n=Math.max(0,r[t].g-100),e=!1;else try{((e,n,t)=>{let i=t||"";try{dt(e,function(e,t){let r=e;h(e)&&(r=ke(e)),n.push(i+t+"="+encodeURIComponent(r))})}catch(e){throw n.push(i+"type="+encodeURIComponent("_badmap")),e}})(l,a,"req"+o+"_")}catch(e){s&&s(l)}}if(e){s=a.join("&");break e}}}return e=e.i.splice(0,i),t.D=e,s}function rr(e){var t;e.g||e.u||(e.Y=1,t=e.Fa,o||te(),l||(o(),l=!0),ee.add(t,e),e.v=0)}function nr(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=je(m(e.Fa,e),lr(e,e.v)),e.v++,1)}function ir(e){null!=e.A&&(D.clearTimeout(e.A),e.A=null)}function sr(e){e.g=new y(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=b(e.qa),r=(I(t,"RID","rpc"),I(t,"SID",e.K),I(t,"AID",e.T),I(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&I(t,"TO",e.ja),I(t,"TYPE","xmlhttp"),er(e,t),e.m&&e.o&&Ut(t,e.m,e.o),e.L&&(e.g.I=e.L),e.g);e=e.ia,r.L=1,r.v=vt(b(t)),r.m=null,r.P=!0,Je(r,e)}function ar(e){null!=e.C&&(D.clearTimeout(e.C),e.C=null)}function or(e,t){var r,n,i,s=null;if(e.g==t){ar(e),ir(e),e.g=null;var a=2}else{if(!lt(e.h,t))return;s=t.D,ut(e.h,t),a=1}if(0!=e.G)if(t.o)(1==a?(s=t.m?t.m.length:0,t=Date.now()-t.F,r=e.B,g(a=Me(),new qe(a,s)),Xt):rr)(e);else if(3==(r=t.s)||0==r&&0<t.X||(1!=a||(i=t,ot((n=e).h)>=n.h.j-(n.s?1:0))||(n.s?(n.i=i.D.concat(n.i),0):1==n.G||2==n.G||n.B>=(n.Va?0:n.Wa)||(n.s=je(m(n.Ga,n,i),lr(n,n.B)),n.B++,0)))&&(2!=a||!nr(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),r){case 1:S(e,5);break;case 4:S(e,10);break;case 3:S(e,6);break;default:S(e,2)}}function lr(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function S(e,t){var r,n,i;e.j.info("Error code "+t),2==t?(r=m(e.fb,e),n=!(i=e.Xa),i=new w(i||"//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||ft(i,"https"),vt(i),(n?(t,r)=>{var n=new Be;if(D.Image){let e=new Image;e.onload=z(C,n,"TestLoadImage: loaded",!0,r,e),e.onerror=z(C,n,"TestLoadImage: error",!1,r,e),e.onabort=z(C,n,"TestLoadImage: abort",!1,r,e),e.ontimeout=z(C,n,"TestLoadImage: timeout",!1,r,e),D.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=t}else r(!1)}:(e,t)=>{let r=new Be,n=new AbortController,i=setTimeout(()=>{n.abort(),C(r,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?C(r,0,!0,t):C(r,0,!1,t)}).catch(()=>{clearTimeout(i),C(r,0,!1,t)})})(i.toString(),r)):O(2),e.G=0,e.l&&e.l.sa(t),hr(e),Jt(e)}function hr(e){var t;e.G=0,e.ka=[],e.l&&(0==(t=ct(e.h)).length&&0==e.i.length||(W(e.ka,t),W(e.ka,e.i),e.h.i.length=0,K(e.i),e.i.length=0),e.l.ra())}function ur(e,t,r){var n,i,s=r instanceof w?b(r):new w(r);return""!=s.g?(t&&(s.g=t+"."+s.g),gt(s,s.s)):(s=(n=D.location).protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port,i=new w(null),s&&ft(i,s),t&&(i.g=t),n&&gt(i,n),r&&(i.l=r),s=i),r=e.D,t=e.ya,r&&t&&I(s,r,t),I(s,"VER",e.la),er(e,s),s}function cr(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new k(new Dt({eb:r})):new k(e.pa)).Ha(e.J),t}function dr(){}function pr(){}function A(e,t){f.call(this),this.g=new $t(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!x(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!x(t)&&(this.g.D=t,null!==(e=this.h))&&t in e&&t in(e=this.h)&&delete e[t],this.j=new N(this)}function fr(e){xe.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function gr(){Oe.call(this),this.status=1}function N(e){this.g=e}(e=k.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=(this.o||Ge).g(),this.v=this.o?Re(this.o):Re(Ge),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void jt(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(var s of n.keys())r.set(s,n.get(s))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=D.FormData&&e instanceof D.FormData,0<=Array.prototype.indexOf.call(qt,t,void 0)&&!n&&!i&&r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[a,o]of r)this.g.setRequestHeader(a,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){jt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,g(this,"complete"),g(this,"abort"),Kt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kt(this,!0)),k.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<F(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Se(t)},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=$t.prototype).la=8,e.G=1,e.connect=function(e,t,r,n){O(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=ur(this,null,this.W),Xt(this)},e.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;var r=new y(this,this.j,t);let e=this.o;if(this.S&&(e?J(e=Q(e),this.S):e=this.S),null!==this.m||this.O||(r.H=e,e=null),this.P)e:{for(var n=0,i=0;i<this.i.length;i++){var s=this.i[i];if("__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(n+=s)){n=i;break e}if(4096===n||i===this.i.length-1){n=i+1;break e}}n=1e3}else n=1e3;n=tr(this,r,n),I(i=b(this.I),"RID",t),I(i,"CVER",22),this.D&&I(i,"X-HTTP-Session-Id",this.D),er(this,i),e&&(this.O?n="headers="+encodeURIComponent(String(Ft(e)))+"&"+n:this.m&&Ut(i,this.m,e)),ht(this.h,r),this.Ua&&I(i,"TYPE","init"),this.P?(I(i,"$req",n),I(i,"SID","null"),r.T=!0,Ye(r,i,null)):Ye(r,i,n),this.G=2}}else 3==this.G&&(t?Zt(this,t):0==this.i.length||at(this.h)||Zt(this))},e.Fa=function(){var e;this.u=null,sr(this),this.ba&&!(this.M||null==this.g||this.R<=0)&&(e=2*this.R,this.j.info("BP detection timer enabled: "+e),this.A=je(m(this.ab,this),e))},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,O(10),Yt(this),sr(this))},e.Za=function(){null!=this.C&&(this.C=null,Yt(this),nr(this),O(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),O(2)):(this.j.info("Failed to ping google.com"),O(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=dr.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},pr.prototype.g=function(e,t){return new A(e,t)},s(A,f),A.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},A.prototype.close=function(){Qt(this.g)},A.prototype.o=function(e){var t,r=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.u&&((t={}).__data__=ke(e),e=t),r.i.push(new it(r.Ya++,e)),3==r.G&&Xt(r)},A.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,A.aa.N.call(this)},s(fr,xe),s(gr,Oe),s(N,dr),N.prototype.ua=function(){g(this.g,"a")},N.prototype.ta=function(e){g(this.g,new fr(e))},N.prototype.sa=function(e){g(this.g,new gr)},N.prototype.ra=function(){g(this.g,"b")},pr.prototype.createWebChannel=pr.prototype.g,A.prototype.send=A.prototype.o,A.prototype.open=A.prototype.m,vm=function(){return new pr},mm=Me,gm=_,fm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ze.NO_ERROR=0,ze.TIMEOUT=8,ze.HTTP_ERROR=6,pm=ze,Ke.COMPLETE="complete",dm=Ke,(Pe.EventType=De).OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",f.prototype.listen=f.prototype.K,cm=Pe,k.prototype.listenOnce=k.prototype.L,k.prototype.getLastError=k.prototype.Ka,k.prototype.getLastErrorCode=k.prototype.Ba,k.prototype.getStatus=k.prototype.Z,k.prototype.getResponseJson=k.prototype.Oa,k.prototype.getResponseText=k.prototype.oa,k.prototype.send=k.prototype.ea,k.prototype.setWithCredentials=k.prototype.Ha,um=k}).apply(void 0!==bm?bm:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let Im="@firebase/firestore";class Tm{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Tm.UNAUTHENTICATED=new Tm(null),Tm.GOOGLE_CREDENTIALS=new Tm("google-credentials-uid"),Tm.FIRST_PARTY=new Tm("first-party-uid"),Tm.MOCK_USER=new Tm("mock-user");let Em="11.4.0",Cm=new Qe("@firebase/firestore");function km(){return Cm.logLevel}function C(e,...t){var r;Cm.logLevel<=c.DEBUG&&(r=t.map(Nm),Cm.debug(`Firestore (${Em}): `+e,...r))}function Sm(e,...t){var r;Cm.logLevel<=c.ERROR&&(r=t.map(Nm),Cm.error(`Firestore (${Em}): `+e,...r))}function Am(e,...t){var r;Cm.logLevel<=c.WARN&&(r=t.map(Nm),Cm.warn(`Firestore (${Em}): `+e,...r))}function Nm(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function k(e="Unexpected state"){var t=`FIRESTORE (${Em}) INTERNAL ASSERTION FAILED: `+e;throw Sm(t),new Error(t)}function S(e){e||k()}let A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class N extends pe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class Rm{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Pm{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class Dm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Tm.UNAUTHENTICATED))}shutdown(){}}class xm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Om{constructor(e){this.t=e,this.currentUser=Tm.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,r){S(void 0===this.o);let n=this.i,i=e=>this.i!==n?(n=this.i,r(e)):Promise.resolve(),s=new Rm,a=(this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Rm,t.enqueueRetryable(()=>i(this.currentUser))},()=>{let e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})}),o=e=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Rm))},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(S("string"==typeof e.accessToken),new Pm(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){var e=this.auth&&this.auth.getUid();return S(null===e||"string"==typeof e),new Tm(e)}}class Lm{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Tm.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Mm{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Lm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Tm.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Fm{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Um{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,h(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(t,r){S(void 0===this.o);let n=e=>{null!=e.error&&C("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.R;return this.R=e.token,C("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?r(e.token):Promise.resolve()},i=(this.o=e=>{t.enqueueRetryable(()=>n(e))},e=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)});this.A.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.A.getImmediate({optional:!0}))?i(e):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e;return this.V?Promise.resolve(new Fm(this.V)):(e=this.forceRefresh,this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(S("string"==typeof e.token),this.R=e.token,new Fm(e.token)):null):Promise.resolve(null))}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class Vm{static newId(){var t=62*Math.floor(256/62);let r="";for(;r.length<20;){var n=(t=>{var r="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(r&&"function"==typeof r.getRandomValues)r.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n})(40);for(let e=0;e<n.length;++e)r.length<20&&n[e]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[e]%62))}return r}}function R(e,t){return e<t?-1:t<e?1:0}function qm(e,r,n){return e.length===r.length&&e.every((e,t)=>n(e,r[t]))}function jm(e){return e+"\0"}let Bm=-62135596800;class zm{static now(){return zm.fromMillis(Date.now())}static fromDate(e){return zm.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new zm(t,r)}constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new N(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bm)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new N(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?R(this.nanoseconds,e.nanoseconds):R(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds-Bm;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class P{static fromTimestamp(e){return new P(e)}static min(){return new P(new zm(0,0))}static max(){return new P(new zm(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let Km="__name__";class Wm{constructor(e,t,r){void 0===t?t=0:t>e.length&&k(),void 0===r?r=e.length-t:r>e.length-t&&k(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Wm.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof Wm?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){let e=Math.min(t.length,r.length);for(let n=0;n<e;n++){let e=Wm.compareSegments(t.get(n),r.get(n));if(0!==e)return e}return Math.sign(t.length-r.length)}static compareSegments(e,t){var r=Wm.isNumericId(e),n=Wm.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?Wm.extractNumericId(e).compare(Wm.extractNumericId(t)):e<t?-1:t<e?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return lm.fromString(e.substring(4,e.length-2))}}class D extends Wm{construct(e,t,r){return new D(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){var t,r=[];for(t of e){if(0<=t.indexOf("//"))throw new N(A.INVALID_ARGUMENT,`Invalid segment (${t}). Paths must not contain // in them.`);r.push(...t.split("/").filter(e=>0<e.length))}return new D(r)}static emptyPath(){return new D([])}}let Hm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gm extends Wm{construct(e,t,r){return new Gm(e,t,r)}static isValidIdentifier(e){return Hm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=Gm.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Km}static keyField(){return new Gm([Km])}static fromServerFormat(t){let e=[],r="",n=0;var i=()=>{if(0===r.length)throw new N(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let s=!1;for(;n<t.length;){let e=t[n];if("\\"===e){if(n+1===t.length)throw new N(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let e=t[n+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new N(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=e,n+=2}else"`"===e?s=!s:"."!==e||s?r+=e:i(),n++}if(i(),s)throw new N(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Gm(e)}static emptyPath(){return new Gm([])}}class x{constructor(e){this.path=e}static fromPath(e){return new x(D.fromString(e))}static fromName(e){return new x(D.fromString(e).popFirst(5))}static empty(){return new x(D.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===D.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return D.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new x(new D(e.slice()))}}let $m=-1;class Qm{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function Ym(e){return e.fields.find(e=>2===e.kind)}function Jm(e){return e.fields.filter(e=>2!==e.kind)}Qm.UNKNOWN_ID=-1;class Xm{constructor(e,t){this.fieldPath=e,this.kind=t}}class Zm{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Zm(0,rv.min())}}function ev(e,t){var r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=P.fromTimestamp(1e9===n?new zm(r+1,0):new zm(r,n));return new rv(r,x.empty(),t)}function tv(e){return new rv(e.readTime,e.key,$m)}class rv{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new rv(P.min(),x.empty(),$m)}static max(){return new rv(P.max(),x.empty(),$m)}}function nv(e,t){var r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=x.comparator(e.documentKey,t.documentKey))?r:R(e.largestBatchId,t.largestBatchId)}let iv="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sv{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function av(e){if(e.code!==A.FAILED_PRECONDITION||e.message!==iv)throw e;C("LocalStore","Unexpectedly lost primary lease")}class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(n,i){return this.callbackAttached&&k(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new O((t,r)=>{this.nextCallback=e=>{this.wrapSuccess(n,e).next(t,r)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof O?t:O.resolve(t)}catch(e){return O.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(r){return new O((e,t)=>{e(r)})}static reject(r){return new O((e,t)=>{t(r)})}static waitFor(e){return new O((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=O.resolve(!1);for(let r of e)t=t.next(e=>e?O.resolve(e):r());return t}static forEach(e,r){let n=[];return e.forEach((e,t)=>{n.push(r.call(this,e,t))}),this.waitFor(n)}static mapArray(o,l){return new O((r,n)=>{let i=o.length,s=new Array(i),a=0;for(let e=0;e<i;e++){let t=e;l(o[t]).next(e=>{s[t]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(n,i){return new O((e,t)=>{let r=()=>{!0===n()?i().next(()=>{r()},t):e()};r()})}}let ov="SimpleDb";class lv{static open(e,t,r,n){try{return new lv(t,e.transaction(n,r))}catch(e){throw new dv(t,e)}}constructor(r,e){this.action=r,this.transaction=e,this.aborted=!1,this.m=new Rm,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{e.error?this.m.reject(new dv(r,e.error)):this.m.resolve()},this.transaction.onerror=e=>{var t=vv(e.target.error);this.m.reject(new dv(r,t))}}get p(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(C(ov,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}S(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new fv(t)}}class hv{static delete(e){return C(ov,"Removing database:",e),gv(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){var e,t,r;return!(!ue()||!hv.v()&&(e=te(),t=0<(t=hv.C(e))&&t<10,r=0<(r=uv(e))&&r<4.5,0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||t||r))}static v(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.__PRIVATE_env)?void 0:e.F)}static M(e,t){return e.store(t)}static C(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)}constructor(e,t,r){this.name=e,this.version=t,this.O=r,12.2===hv.C(te())&&Sm("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async N(s){return this.db||(C(ov,"Opening database:",this.name),this.db=await new Promise((r,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;r(t)},i.onblocked=()=>{n(new dv(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?n(new N(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?n(new N(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):n(new dv(s,t))},i.onupgradeneeded=e=>{C(ov,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.O.B(t,i.transaction,e.oldVersion,this.version).next(()=>{C(ov,"Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}k(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(r,e,n,i){var s="readonly"===e;let a=0;for(;;){++a;try{this.db=await this.N(r);let t=lv.open(this.db,r,s?"readonly":"readwrite",n),e=i(t).next(e=>(t.S(),e)).catch(e=>(t.abort(e),O.reject(e))).toPromise();return e.catch(()=>{}),await t.p,e}catch(r){let e=r,t="FirebaseError"!==e.name&&a<3;if(C(ov,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function uv(e){var t=e.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class cv{constructor(e){this.q=e,this.$=!1,this.K=null}get isDone(){return this.$}get U(){return this.K}set cursor(e){this.q=e}done(){this.$=!0}W(e){this.K=e}delete(){return gv(this.q.delete())}}class dv extends N{constructor(e,t){super(A.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function pv(e){return"IndexedDbTransactionError"===e.name}class fv{constructor(e){this.store=e}put(e,t){let r;return gv(r=void 0!==t?(C(ov,"PUT",this.store.name,e,t),this.store.put(t,e)):(C(ov,"PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return C(ov,"ADD",this.store.name,e,e),gv(this.store.add(e))}get(t){return gv(this.store.get(t)).next(e=>(void 0===e&&(e=null),C(ov,"GET",this.store.name,t,e),e))}delete(e){return C(ov,"DELETE",this.store.name,e),gv(this.store.delete(e))}count(){return C(ov,"COUNT",this.store.name),gv(this.store.count())}G(e,t){var n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new O((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),r=[];return this.j(e,(e,t)=>{r.push(t)}).next(()=>r)}}H(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new O((t,r)=>{n.onerror=e=>{r(e.target.error)},n.onsuccess=e=>{t(e.target.result)}})}J(e,t){C(ov,"DELETE ALL",this.store.name);var r=this.options(e,t),r=(r.Y=!1,this.cursor(r));return this.j(r,(e,t,r)=>r.delete())}Z(e,t){let r;t?r=e:(r={},t=e);var n=this.cursor(r);return this.j(n,t)}X(i){let e=this.cursor({});return new O((r,n)=>{e.onerror=e=>{var t=vv(e.target.error);n(t)},e.onsuccess=e=>{let t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():r()}):r()}})}j(e,s){let a=[];return new O((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{var n=e.target.result;if(n){let t=new cv(n),r=s(n.primaryKey,n.value,t);if(r instanceof O){let e=r.catch(e=>(t.done(),O.reject(e)));a.push(e)}t.isDone?i():null===t.U?n.continue():n.continue(t.U)}else i()}}).next(()=>O.waitFor(a))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";var r;return e.reverse&&(t="prev"),e.index?(r=this.store.index(e.index),e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)):this.store.openCursor(e.range,t)}}function gv(e){return new O((r,n)=>{e.onsuccess=e=>{var t=e.target.result;r(t)},e.onerror=e=>{var t=vv(e.target.error);n(t)}})}let mv=!1;function vv(e){let t=hv.C(te());if(12.2<=t&&t<13){let t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){let e=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return mv||(mv=!0,setTimeout(()=>{throw e},0)),e}}return e}let _v="IndexBackfiller";class yv{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){C(_v,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{var e=await this.ee.ne();C(_v,"Documents written: "+e)}catch(e){pv(e)?C(_v,"Ignoring IndexedDB error during index backfill: ",e):await av(e)}await this.te(6e4)})}}class wv{constructor(e,t){this.localStore=e,this.persistence=t}async ne(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.re(e,t))}re(e,t){let r=new Set,n=t,i=!0;return O.doWhile(()=>!0===i&&0<n,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return C(_v,"Processing collection: "+t),this.ie(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}ie(n,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(n,i).next(r=>this.localStore.localDocuments.getNextDocuments(n,i,r,e).next(e=>{let t=e.changes;return this.localStore.indexManager.updateIndexEntries(n,t).next(()=>this.se(r,e)).next(e=>(C(_v,"Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(n,i,e))).next(()=>t.size)}))}se(e,t){let n=e;return t.changes.forEach((e,t)=>{var r=tv(t);0<nv(r,n)&&(n=r)}),new rv(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class bv{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this._e&&this._e(e),e}}let Iv=bv.ae=-1;function Tv(e){return null==e}function Ev(e){return 0===e&&1/e==-1/0}function Cv(e){return"number"==typeof e&&Number.isInteger(e)&&!Ev(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let kv="";function Sv(e){let t="";for(let r=0;r<e.length;r++)0<t.length&&(t=Av(t)),t=((t,e)=>{let r=e,n=t.length;for(let i=0;i<n;i++){let e=t.charAt(i);switch(e){case"\0":r+="";break;case kv:r+="";break;default:r+=e}}return r})(e.get(r),t);return Av(t)}function Av(e){return e+kv+""}function Nv(r){let e=r.length;if(S(2<=e),2===e)return S(r.charAt(0)===kv&&""===r.charAt(1)),D.emptyPath();var __PRIVATE_lastReasonableEscapeIndex=e-2,n=[];let i="";for(let a=0;a<e;){let t=r.indexOf(kv,a);switch((t<0||t>__PRIVATE_lastReasonableEscapeIndex)&&k(),r.charAt(t+1)){case"":var s=r.substring(a,t);let e;0===i.length?e=s:(i+=s,e=i,i=""),n.push(e);break;case"":i=i+r.substring(a,t)+"\0";break;case"":i+=r.substring(a,t+1);break;default:k()}a=t+2}return new D(n)}let Rv="remoteDocuments",Pv="owner",Dv="owner",xv="mutationQueues",Ov="mutations",Lv="batchId",Mv="userMutationsIndex",Fv=["userId","batchId"];function Uv(e,t){return[e,Sv(t)]}function Vv(e,t,r){return[e,Sv(t),r]}let qv={},jv="documentMutations",Bv="remoteDocumentsV14",zv=["prefixPath","collectionGroup","readTime","documentId"],Kv="documentKeyIndex",Wv=["prefixPath","collectionGroup","documentId"],Hv="collectionGroupIndex",Gv=["collectionGroup","readTime","prefixPath","documentId"],$v="remoteDocumentGlobal",Qv="remoteDocumentGlobalKey",Yv="targets",Jv="queryTargetsIndex",Xv=["canonicalId","targetId"],Zv="targetDocuments",e_=["targetId","path"],t_="documentTargetsIndex",r_=["path","targetId"],n_="targetGlobalKey",i_="targetGlobal",s_="collectionParents",a_=["collectionId","parent"],o_="clientMetadata",l_="bundles",h_="namedQueries",u_="indexConfiguration",c_="collectionGroupIndex",d_="indexState",p_=["indexId","uid"],f_="sequenceNumberIndex",g_=["uid","sequenceNumber"],m_="indexEntries",v_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],__="documentKeyIndex",y_=["indexId","uid","orderedDocumentKey"],w_="documentOverlays",b_=["userId","collectionPath","documentId"],I_="collectionPathOverlayIndex",T_=["userId","collectionPath","largestBatchId"],E_="collectionGroupOverlayIndex",C_=["userId","collectionGroup","largestBatchId"],k_="globals",S_=[xv,Ov,jv,Rv,Yv,Pv,i_,Zv,o_,$v,s_,l_,h_],A_=[...S_,w_],N_=[xv,Ov,jv,Bv,Yv,Pv,i_,Zv,o_,$v,s_,l_,h_,w_],R_=N_,P_=[...R_,u_,d_,m_],D_=P_,x_=[...P_,k_];class O_ extends sv{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function L_(e,t){var r=e;return hv.M(r.ue,t)}function M_(e){let t=0;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function F_(e,t){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function U_(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class L{constructor(e,t){this.comparator=e,this.root=t||q_.EMPTY}insert(e,t){return new L(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,q_.BLACK,null,null))}remove(e){return new L(this.comparator,this.root.remove(e,this.comparator).copy(null,null,q_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:0<r&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){var n=this.comparator(e,r.key);if(0===n)return t+r.left.size;r=n<0?r.left:(t+=r.left.size+1,r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(r){this.inorderTraversal((e,t)=>(r(e,t),!1))}toString(){let r=[];return this.inorderTraversal((e,t)=>(r.push(e+":"+t),!1)),`{${r.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new V_(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new V_(this.root,e,this.comparator,!1)}getReverseIterator(){return new V_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new V_(this.root,e,this.comparator,!0)}}class V_{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){var e;return 0===this.nodeStack.length?null:{key:(e=this.nodeStack[this.nodeStack.length-1]).key,value:e.value}}}class q_{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:q_.RED,this.left=null!=n?n:q_.EMPTY,this.right=null!=i?i:q_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new q_(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){var n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return q_.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n=(n=n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()?n:n.moveRedLeft()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed()?n.rotateRight():n).right.isEmpty()||n.right.isRed()||n.right.left.isRed()?n:n.moveRedRight()).key)){if(n.right.isEmpty())return q_.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,q_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,q_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw k();if(this.right.isRed())throw k();var e=this.left.check();if(e!==this.right.check())throw k();return e+(this.isRed()?0:1)}}q_.EMPTY=null,q_.RED=!0,q_.BLACK=!1,q_.EMPTY=new class{constructor(){this.size=0}get key(){throw k()}get value(){throw k()}get color(){throw k()}get left(){throw k()}get right(){throw k()}copy(e,t,r,n,i){return this}insert(e,t,r){return new q_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class M{constructor(e){this.comparator=e,this.data=new L(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(r){this.data.inorderTraversal((e,t)=>(r(e),!1))}forEachInRange(e,t){for(var r=this.data.getIteratorFrom(e[0]);r.hasNext();){var n=r.getNext();if(0<=this.comparator(n.key,e[1]))return;t(n.key)}}forEachWhile(e,t){for(var r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new j_(this.data.getIterator())}getIteratorFrom(e){return new j_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof M))return!1;if(this.size!==e.size)return!1;for(var r=this.data.getIterator(),n=e.data.getIterator();r.hasNext();){let e=r.getNext().key,t=n.getNext().key;if(0!==this.comparator(e,t))return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){var t=new M(this.comparator);return t.data=e,t}}class j_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function B_(e){return e.hasNext()?e.getNext():void 0}class z_{constructor(e){(this.fields=e).sort(Gm.comparator)}static empty(){return new z_([])}unionWith(e){let t=new M(Gm.comparator);for(let e of this.fields)t=t.add(e);for(var r of e)t=t.add(r);return new z_(t.toArray())}covers(e){for(var t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qm(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class K_ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class W_{constructor(e){this.binaryString=e}static fromBase64String(e){var t=(e=>{try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new K_("Invalid base64 string: "+e):e}})(e);return new W_(t)}static fromUint8Array(e){var t=(e=>{let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t})(e);return new W_(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){var e=this.binaryString,t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return R(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}W_.EMPTY_BYTE_STRING=new W_("");let H_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function G_(t){if(S(!!t),"string"!=typeof t)return{seconds:$_(t.seconds),nanos:$_(t.nanos)};{let e=0;var r=H_.exec(t),r=(S(!!r),r[1]&&(r=((r=r[1])+"000000000").substr(0,9),e=Number(r)),new Date(t));return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function $_(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Q_(e){return"string"==typeof e?W_.fromBase64String(e):W_.fromUint8Array(e)}let Y_="server_timestamp",J_="__type__",X_="__previous_value__",Z_="__local_write_time__";function ey(e){var t;return(null==(t=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[J_])?void 0:t.stringValue)===Y_}function ty(e){var t=e.mapValue.fields[X_];return ey(t)?ty(t):t}function ry(e){var t=G_(e.mapValue.fields[Z_].timestampValue);return new zm(t.seconds,t.nanos)}class ny{constructor(e,t,r,n,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let iy="(default)";class sy{constructor(e,t){this.projectId=e,this.database=t||iy}static empty(){return new sy("","")}get isDefaultDatabase(){return this.database===iy}isEqual(e){return e instanceof sy&&e.projectId===this.projectId&&e.database===this.database}}let ay="__type__",oy="__max__",ly={mapValue:{fields:{__type__:{stringValue:oy}}}},hy="__vector__",uy="value",cy={nullValue:"NULL_VALUE"};function dy(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ey(e)?4:Sy(e)?9007199254740991:Cy(e)?10:11:k()}function py(t,r){if(t===r)return!0;var n,i,s,a,o,e=dy(t);if(e!==dy(r))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===r.booleanValue;case 4:return ry(t).isEqual(ry(r));case 3:return s=r,"string"==typeof(i=t).timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length?i.timestampValue===s.timestampValue:(a=G_(i.timestampValue),o=G_(s.timestampValue),a.seconds===o.seconds&&a.nanos===o.nanos);case 5:return t.stringValue===r.stringValue;case 6:return i=r,Q_(t.bytesValue).isEqual(Q_(i.bytesValue));case 7:return t.referenceValue===r.referenceValue;case 8:return s=r,$_((n=t).geoPointValue.latitude)===$_(s.geoPointValue.latitude)&&$_(n.geoPointValue.longitude)===$_(s.geoPointValue.longitude);case 2:return n=r,"integerValue"in(h=t)&&"integerValue"in n?$_(h.integerValue)===$_(n.integerValue):"doubleValue"in h&&"doubleValue"in n&&((a=$_(h.doubleValue))===(o=$_(n.doubleValue))?Ev(a)===Ev(o):isNaN(a)&&isNaN(o));case 9:return qm(t.arrayValue.values||[],r.arrayValue.values||[],py);case 10:case 11:var l=t,h=r,u=l.mapValue.fields||{},c=h.mapValue.fields||{};if(M_(u)!==M_(c))return!1;for(let e in u)if(u.hasOwnProperty(e)&&(void 0===c[e]||!py(u[e],c[e])))return!1;return!0;default:return k()}}function fy(e,t){return void 0!==(e.values||[]).find(e=>py(e,t))}function gy(e,n){if(e===n)return 0;var i,s,a,o,l,h,u,c,t=dy(e),r=dy(n);if(t!==r)return R(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return R(e.booleanValue,n.booleanValue);case 2:return h=n,u=$_((l=e).integerValue||l.doubleValue),c=$_(h.integerValue||h.doubleValue),u<c?-1:c<u?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return my(e.timestampValue,n.timestampValue);case 4:return my(ry(e),ry(n));case 5:return R(e.stringValue,n.stringValue);case 6:return l=e.bytesValue,h=n.bytesValue,u=Q_(l),c=Q_(h),u.compareTo(c);case 7:var d=e.referenceValue,p=n.referenceValue,f=d.split("/"),g=p.split("/");for(let t=0;t<f.length&&t<g.length;t++){let e=R(f[t],g[t]);if(0!==e)return e}return R(f.length,g.length);case 8:return d=e.geoPointValue,p=n.geoPointValue,0!==(o=R($_(d.latitude),$_(p.latitude)))?o:R($_(d.longitude),$_(p.longitude));case 9:return vy(e.arrayValue,n.arrayValue);case 10:return m=e.mapValue,i=n.mapValue,o=m.fields||{},s=i.fields||{},o=null==(o=o[uy])?void 0:o.arrayValue,s=null==(s=s[uy])?void 0:s.arrayValue,0!==(a=R((null==(a=null==o?void 0:o.values)?void 0:a.length)||0,(null==(a=null==s?void 0:s.values)?void 0:a.length)||0))?a:vy(o,s);case 11:var m=e.mapValue,v=n.mapValue;if(m===ly.mapValue&&v===ly.mapValue)return 0;if(m===ly.mapValue)return 1;if(v===ly.mapValue)return-1;var _=m.fields||{},y=Object.keys(_),w=v.fields||{},b=Object.keys(w);y.sort(),b.sort();for(let r=0;r<y.length&&r<b.length;++r){let e=R(y[r],b[r]);if(0!==e)return e;var I=gy(_[y[r]],w[b[r]]);if(0!==I)return I}return R(y.length,b.length);default:throw k()}}function my(e,t){var r,n,i;return"string"==typeof e&&"string"==typeof t&&e.length===t.length?R(e,t):(r=G_(e),n=G_(t),0!==(i=R(r.seconds,n.seconds))?i:R(r.nanos,n.nanos))}function vy(e,t){var r=e.values||[],n=t.values||[];for(let i=0;i<r.length&&i<n.length;++i){let e=gy(r[i],n[i]);if(e)return e}return R(r.length,n.length)}function _y(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(e=>{let t=G_(e);return`time(${t.seconds},${t.nanos})`})(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?(e=>Q_(e).toBase64())(e.bytesValue):"referenceValue"in e?(e=>x.fromName(e).toString())(e.referenceValue):"geoPointValue"in e?(e=>`geo(${e.latitude},${e.longitude})`)(e.geoPointValue):"arrayValue"in e?(e=>{let t="[",r=!0;for(var n of e.values||[])r?r=!1:t+=",",t+=s(n);return t+"]"})(e.arrayValue):"mapValue"in e?(e=>{let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(var i of t)n?n=!1:r+=",",r+=i+":"+s(e.fields[i]);return r+"}"})(e.mapValue):k()}(e)}function yy(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function wy(e){return!!e&&"integerValue"in e}function by(e){return!!e&&"arrayValue"in e}function Iy(e){return e&&"nullValue"in e}function Ty(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ey(e){return e&&"mapValue"in e}function Cy(e){var t;return(null==(t=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[ay])?void 0:t.stringValue)===hy}function ky(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let r={mapValue:{fields:{}}};return F_(t.mapValue.fields,(e,t)=>r.mapValue.fields[e]=ky(t)),r}if(t.arrayValue){var r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=ky(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Sy(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===oy}let Ay={mapValue:{fields:{[ay]:{stringValue:hy},[uy]:{arrayValue:{}}}}};function Ny(e,t){var r=gy(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Ry(e,t){var r=gy(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Py{constructor(e){this.value=e}static empty(){return new Py({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let e=this.value;for(let t=0;t<r.length-1;++t)if(!Ey(e=(e.mapValue.fields||{})[r.get(t)]))return null;return(e=(e.mapValue.fields||{})[r.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ky(t)}setAll(e){let r=Gm.emptyPath(),n={},i=[];e.forEach((e,t)=>{if(!r.isImmediateParentOf(t)){let e=this.getFieldsMap(r);this.applyChanges(e,n,i),n={},i=[],r=t.popLast()}e?n[t.lastSegment()]=ky(e):i.push(t.lastSegment())});var t=this.getFieldsMap(r);this.applyChanges(t,n,i)}delete(e){var t=this.field(e.popLast());Ey(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return py(this.value,e.value)}getFieldsMap(t){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let n=0;n<t.length;++n){let e=r.mapValue.fields[t.get(n)];Ey(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[t.get(n)]=e),r=e}return r.mapValue.fields}applyChanges(r,e,t){F_(e,(e,t)=>r[e]=t);for(let e of t)delete r[e]}clone(){return new Py(ky(this.value))}}class Dy{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new Dy(e,0,P.min(),P.min(),P.min(),Py.empty(),0)}static newFoundDocument(e,t,r,n){return new Dy(e,1,t,P.min(),r,n,0)}static newNoDocument(e,t){return new Dy(e,2,t,P.min(),P.min(),Py.empty(),0)}static newUnknownDocument(e,t){return new Dy(e,3,t,P.min(),P.min(),Py.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(P.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Py.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Py.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Dy&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dy(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xy{constructor(e,t){this.position=e,this.inclusive=t}}function Oy(e,t,r){let n=0;for(let a=0;a<e.position.length;a++){var i=t[a],s=e.position[a];if(n=i.field.isKeyField()?x.comparator(x.fromName(s.referenceValue),r.key):gy(s,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function Ly(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!py(e.position[r],t.position[r]))return!1;return!0}class My{constructor(e,t="asc"){this.field=e,this.dir=t}}class Fy{}class F extends Fy{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Ky(e,t,r):"array-contains"===t?new $y(e,r):"in"===t?new Qy(e,r):"not-in"===t?new Yy(e,r):"array-contains-any"===t?new Jy(e,r):new F(e,t,r)}static createKeyFieldInFilter(e,t,r){return new("in"===t?Wy:Hy)(e,r)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(gy(t,this.value)):null!==t&&dy(this.value)===dy(t)&&this.matchesComparison(gy(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return k()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class U extends Fy{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new U(e,t)}matches(t){return Uy(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.ce&&(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Uy(e){return"and"===e.op}function Vy(e){return"or"===e.op}function qy(e){return jy(e)&&Uy(e)}function jy(e){for(var t of e.filters)if(t instanceof U)return!1;return!0}function By(e,t){var r=e.filters.concat(t);return U.create(r,e.op)}function zy(e){return e instanceof F?`${(t=e).field.canonicalString()} ${t.op} `+_y(t.value):e instanceof U?(t=e).op.toString()+" {"+t.getFilters().map(zy).join(" ,")+"}":"Filter";var t}class Ky extends F{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){var t=x.comparator(e.key,this.key);return this.matchesComparison(t)}}class Wy extends F{constructor(e,t){super(e,"in",t),this.keys=Gy(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Hy extends F{constructor(e,t){super(e,"not-in",t),this.keys=Gy(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Gy(e,t){var r;return((null==(r=t.arrayValue)?void 0:r.values)||[]).map(e=>x.fromName(e.referenceValue))}class $y extends F{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return by(t)&&fy(t.arrayValue,this.value)}}class Qy extends F{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&fy(this.value.arrayValue,t)}}class Yy extends F{constructor(e,t){super(e,"not-in",t)}matches(e){var t;return!fy(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&null!==(t=e.data.field(this.field))&&!fy(this.value.arrayValue,t)}}class Jy extends F{constructor(e,t){super(e,"array-contains-any",t)}matches(e){var t=e.data.field(this.field);return!(!by(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>fy(this.value.arrayValue,e))}}class Xy{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.le=null}}function Zy(e,t=null,r=[],n=[],i=null,s=null,a=null){return new Xy(e,t,r,n,i,s,a)}function ew(e){var t=e;if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>function t(e){var r;return e instanceof F?e.field.canonicalString()+e.op.toString()+_y(e.value):qy(e)?e.filters.map(e=>t(e)).join(","):(r=e.filters.map(e=>t(e)).join(","),e.op+`(${r})`)}(e)).join(",")+"|ob:")+t.orderBy.map(e=>(e=e).field.canonicalString()+e.dir).join(","),Tv(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>_y(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>_y(e)).join(",")),t.le=e}return t.le}function tw(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(r=e.orderBy[i],n=t.orderBy[i],r.dir!==n.dir||!r.field.isEqual(n.field))return!1;var r,n;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function n(e,t){return e instanceof F?(r=e,(s=t)instanceof F&&r.op===s.op&&r.field.isEqual(s.field)&&py(r.value,s.value)):e instanceof U?(r=e,(i=t)instanceof U&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((e,t,r)=>e&&n(t,i.filters[r]),!0)):void k();var i,r,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ly(e.startAt,t.startAt)&&Ly(e.endAt,t.endAt)}function rw(e){return x.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function nw(e,t){return e.filters.filter(e=>e instanceof F&&e.field.isEqual(t))}function iw(e,r,n){let i=cy,s=!0;for(let n of nw(e,r)){let e=cy,t=!0;switch(n.op){case"<":case"<=":e="nullValue"in(a=n.value)?cy:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?yy(sy.empty(),x.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?Cy(a)?Ay:{mapValue:{}}:k();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=cy}Ny({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==n)for(let t=0;t<e.orderBy.length;++t)if(e.orderBy[t].field.isEqual(r)){let e=n.position[t];Ny({value:i,inclusive:s},{value:e,inclusive:n.inclusive})<0&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}function sw(e,r,n){let i=ly,s=!0;for(let n of nw(e,r)){let e=ly,t=!0;switch(n.op){case">=":case">":e="nullValue"in(a=n.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?yy(sy.empty(),x.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?Ay:"mapValue"in a?Cy(a)?{mapValue:{}}:ly:k(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=ly}0<Ry({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==n)for(let t=0;t<e.orderBy.length;++t)if(e.orderBy[t].field.isEqual(r)){let e=n.position[t];0<Ry({value:i,inclusive:s},{value:e,inclusive:n.inclusive})&&(i=e,s=n.inclusive);break}return{value:i,inclusive:s}}class aw{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function ow(e,t,r,n,i,s,a,o){return new aw(e,t,r,n,i,s,a,o)}function lw(e){return new aw(e)}function hw(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function uw(e){return null!==e.collectionGroup}function cw(e){let n=e;if(null===n.he){n.he=[];let t=new Set;for(var i of n.explicitOrderBy)n.he.push(i),t.add(i.field.canonicalString());let r=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc",e=(e=>{let t=new M(Gm.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(n);e.forEach(e=>{t.has(e.canonicalString())||e.isKeyField()||n.he.push(new My(e,r))}),t.has(Gm.keyField().canonicalString())||n.he.push(new My(Gm.keyField(),r))}return n.he}function dw(e){var t=e;return t.Pe||(t.Pe=((e,t)=>{if("F"===e.limitType)return Zy(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map(e=>{var t="desc"===e.dir?"asc":"desc";return new My(e.field,t)});var r=e.endAt?new xy(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new xy(e.startAt.position,e.startAt.inclusive):null;return Zy(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)})(t,cw(e))),t.Pe}function pw(e,t){var r=e.filters.concat([t]);return new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function fw(e,t,r){return new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function gw(e,t){return tw(dw(e),dw(t))&&e.limitType===t.limitType}function mw(e){return ew(dw(e))+"|lt:"+e.limitType}function vw(e){return`Query(target=${(e=>{let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>zy(e)).join(", ")}]`),Tv(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>`${(e=e).field.canonicalString()} (${e.dir})`).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>_y(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>_y(e)).join(","):t})`})(dw(e))}; limitType=${e.limitType})`}function _w(e,t){return t.isFoundDocument()&&(s=e,o=(a=t).key.path,null!==s.collectionGroup?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):x.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o))&&((e,t)=>{for(var r of cw(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return;return 1})(e,t)&&((e,t)=>{for(var r of e.filters)if(!r.matches(t))return;return 1})(e,t)&&(a=t,!(s=e).startAt||(n=s.startAt,r=cw(s),i=Oy(n,r,a),n.inclusive?i<=0:i<0))&&(!s.endAt||(r=s.endAt,n=cw(s),i=Oy(r,n,a),r.inclusive?0<=i:0<i));var r,n,i,s,a,o}function yw(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ww(e){return(t,r)=>{let n=!1;for(var i of cw(e)){let e=((e,t,r)=>{var n=e.field.isKeyField()?x.comparator(t.key,r.key):((e,t,r)=>{var n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?gy(n,i):k()})(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return k()}})(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class bw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(r){let e=this.mapKeyFn(r),n=this.inner[e];if(void 0!==n)for(let[e,t]of n)if(this.equalsFn(e,r))return t}has(e){return void 0!==this.get(e)}set(t,r){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)this.inner[e]=[[t,r]];else{for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return void(n[e]=[t,r]);n.push([t,r])}this.innerSize++}delete(t){var r=this.mapKeyFn(t),n=this.inner[r];if(void 0!==n)for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return 1===n.length?delete this.inner[r]:n.splice(e,1),this.innerSize--,!0;return!1}forEach(n){F_(this.inner,(e,t)=>{for(let[e,r]of t)n(e,r)})}isEmpty(){return U_(this.inner)}size(){return this.innerSize}}let Iw=new L(x.comparator);let Tw=new L(x.comparator);function Ew(...e){let t=Tw;for(var r of e)t=t.insert(r.key,r);return t}function Cw(e){let r=Tw;return e.forEach((e,t)=>r=r.insert(e,t.overlayedDocument)),r}function kw(){return new bw(e=>e.toString(),(e,t)=>e.isEqual(t))}let Sw=new L(x.comparator),Aw=new M(x.comparator);function V(...e){let t=Aw;for(var r of e)t=t.add(r);return t}let Nw=new M(R);function Rw(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ev(t)?"-0":t}}function Pw(e){return{integerValue:""+e}}function Dw(e,t){return Cv(t)?Pw(t):Rw(e,t)}class xw{constructor(){this._=void 0}}function Ow(e,t){return e instanceof qw?wy(e=t)||(e=e)&&"doubleValue"in e?t:{integerValue:0}:null}class Lw extends xw{}class Mw extends xw{constructor(e){super(),this.elements=e}}function Fw(e,t){var r=Bw(t);for(let t of e.elements)r.some(e=>py(e,t))||r.push(t);return{arrayValue:{values:r}}}class Uw extends xw{constructor(e){super(),this.elements=e}}function Vw(e,t){let r=Bw(t);for(let t of e.elements)r=r.filter(e=>!py(e,t));return{arrayValue:{values:r}}}class qw extends xw{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function jw(e){return $_(e.integerValue||e.doubleValue)}function Bw(e){return by(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class zw{constructor(e,t){this.field=e,this.transform=t}}class Kw{constructor(e,t){this.version=e,this.transformResults=t}}class Ww{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ww}static exists(e){return new Ww(void 0,e)}static updateTime(e){return new Ww(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hw(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Gw{}function $w(e,r){if(!e.hasLocalMutations||r&&0===r.fields.length)return null;if(null===r)return e.isNoDocument()?new rb(e.key,Ww.none()):new Jw(e.key,e.data,Ww.none());{var n,i=e.data,s=Py.empty();let t=new M(Gm.comparator);for(n of r.fields)if(!t.has(n)){let e=i.field(n);null===e&&1<n.length&&(n=n.popLast(),e=i.field(n)),null===e?s.delete(n):s.set(n,e),t=t.add(n)}return new Xw(e.key,s,new z_(t.toArray()),Ww.none())}}function Qw(e,t,r,n){return e instanceof Jw?(s=t,a=r,o=n,Hw((i=e).precondition,s)?(l=i.value.clone(),h=tb(i.fieldTransforms,o,s),l.setAll(h),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null):a):e instanceof Xw?(i=t,o=r,s=n,Hw((a=e).precondition,i)?(h=tb(a.fieldTransforms,s,i),(l=i.data).setAll(Zw(a)),l.setAll(h),i.convertToFoundDocument(i.version,l).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))):o):(n=t,t=r,Hw(e.precondition,n)?(n.convertToNoDocument(n.version).setHasLocalMutations(),null):t);var i,s,a,o,l,h}function Yw(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||r&&n&&qm(r,n,(e,t)=>(t=t,(e=e).field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Mw&&t instanceof Mw||e instanceof Uw&&t instanceof Uw?qm(e.elements,t.elements,py):e instanceof qw&&t instanceof qw?py(e.Ie,t.Ie):e instanceof Lw&&t instanceof Lw)))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var r,n}class Jw extends Gw{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Xw extends Gw{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Zw(r){let n=new Map;return r.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=r.data.field(e),n.set(e,t))}),n}function eb(e,t,r){var n,i,s,a=new Map;S(e.length===r.length);for(let u=0;u<r.length;u++){var o=e[u],l=o.transform,h=t.data.field(o.field);a.set(o.field,(n=l,i=h,s=r[u],n instanceof Mw?Fw(n,i):n instanceof Uw?Vw(n,i):s))}return a}function tb(e,r,n){var i,s,a,o,l,h,u,c=new Map;for(i of e){let e=i.transform,t=n.data.field(i.field);c.set(i.field,(s=e,a=t,o=r,u=h=l=void 0,s instanceof Lw?(o=o,h=a,u={fields:{[J_]:{stringValue:Y_},[Z_]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}},(h=h&&ey(h)?ty(h):h)&&(u.fields[X_]=h),{mapValue:u}):s instanceof Mw?Fw(s,a):s instanceof Uw?Vw(s,a):(u=Ow(o=s,a),l=jw(u)+jw(o.Ie),wy(u)&&wy(o.Ie)?Pw(l):Rw(o.serializer,l))))}return c}class rb extends Gw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nb extends Gw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ib{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){var r,n,i,s,a,o,l,h=t.mutationResults;for(let c=0;c<this.mutations.length;c++){var u=this.mutations[c];u.key.isEqual(e.key)&&(r=u,n=e,i=h[c],l=u=o=a=s=void 0,r instanceof Jw?(a=n,o=i,u=(s=r).value.clone(),l=eb(s.fieldTransforms,a,o.transformResults),u.setAll(l),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()):r instanceof Xw?(s=n,a=i,Hw((o=r).precondition,s)?(l=eb(o.fieldTransforms,s,a.transformResults),(u=s.data).setAll(Zw(o)),u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()):s.convertToUnknownDocument(a.version)):n.convertToNoDocument(i.version).setHasCommittedMutations())}}applyToLocalView(e,t){for(var r of this.baseMutations)r.key.isEqual(e.key)&&(t=Qw(r,e,t,this.localWriteTime));for(var n of this.mutations)n.key.isEqual(e.key)&&(t=Qw(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(n,i){let s=kw();return this.mutations.forEach(e=>{var t=n.get(e.key),r=t.overlayedDocument,t=this.applyToLocalView(r,t.mutatedFields),t=$w(r,i.has(e.key)?null:t);null!==t&&s.set(e.key,t),r.isValidDocument()||r.convertToNoDocument(P.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),V())}isEqual(e){return this.batchId===e.batchId&&qm(this.mutations,e.mutations,(e,t)=>Yw(e,t))&&qm(this.baseMutations,e.baseMutations,(e,t)=>Yw(e,t))}}class sb{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){S(e.mutations.length===r.length);let n=Sw;var i=e.mutations;for(let s=0;s<i.length;s++)n=n.insert(i[s].key,r[s].version);return new sb(e,t,r,n)}}class ab{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ob{constructor(e,t){this.count=e,this.unchangedNames=t}}function lb(e){switch(e){case A.OK:return k();case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return k()}}function hb(e){if(void 0===e)return Sm("GRPC error has no .code"),A.UNKNOWN;switch(e){case _m.OK:return A.OK;case _m.CANCELLED:return A.CANCELLED;case _m.UNKNOWN:return A.UNKNOWN;case _m.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case _m.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case _m.INTERNAL:return A.INTERNAL;case _m.UNAVAILABLE:return A.UNAVAILABLE;case _m.UNAUTHENTICATED:return A.UNAUTHENTICATED;case _m.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case _m.NOT_FOUND:return A.NOT_FOUND;case _m.ALREADY_EXISTS:return A.ALREADY_EXISTS;case _m.PERMISSION_DENIED:return A.PERMISSION_DENIED;case _m.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case _m.ABORTED:return A.ABORTED;case _m.OUT_OF_RANGE:return A.OUT_OF_RANGE;case _m.UNIMPLEMENTED:return A.UNIMPLEMENTED;case _m.DATA_LOSS:return A.DATA_LOSS;default:return k()}}function ub(){return new TextEncoder}(e=_m=_m||{})[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS";let cb=new lm([4294967295,4294967295],0);function db(e){var t=ub().encode(e),r=new hm;return r.update(t),new Uint8Array(r.digest())}function pb(e){var t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),t=t.getUint32(12,!0);return[new lm([r,n],0),new lm([i,t],0)]}class fb{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||8<=t)throw new gb("Invalid padding: "+t);if(r<0)throw new gb("Invalid hash count: "+r);if(0<e.length&&0===this.hashCount)throw new gb("Invalid hash count: "+r);if(0===e.length&&0!==t)throw new gb("Invalid padding when bitmap length is 0: "+t);this.Ee=8*e.length-t,this.de=lm.fromNumber(this.Ee)}Ae(e,t,r){let n=e.add(t.multiply(lm.fromNumber(r)));return(n=1===n.compare(cb)?new lm([n.getBits(0),n.getBits(1)],0):n).modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;let t=db(e),[r,n]=pb(t);for(let i=0;i<this.hashCount;i++){let e=this.Ae(r,n,i);if(!this.Re(e))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new fb(i,n,t);return r.forEach(e=>s.insert(e)),s}insert(i){if(0!==this.Ee){let e=db(i),[t,r]=pb(e);for(let n=0;n<this.hashCount;n++){let e=this.Ae(t,r,n);this.Ve(e)}}}Ve(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class gb extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class mb{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){var n=new Map;return n.set(e,vb.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new mb(P.min(),n,new L(R),Iw,V())}}class vb{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new vb(r,t,V(),V(),V())}}class _b{constructor(e,t,r,n){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=n}}class yb{constructor(e,t){this.targetId=e,this.ge=t}}class wb{constructor(e,t,r=W_.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class bb{constructor(){this.pe=0,this.ye=Eb(),this.we=W_.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.Se}Ce(e){0<e.approximateByteSize()&&(this.Se=!0,this.we=e)}Fe(){let r=V(),n=V(),i=V();return this.ye.forEach((e,t)=>{switch(t){case 0:r=r.add(e);break;case 2:n=n.add(e);break;case 1:i=i.add(e);break;default:k()}}),new vb(this.we,this.be,r,n,i)}Me(){this.Se=!1,this.ye=Eb()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){--this.pe,S(0<=this.pe)}Le(){this.Se=!0,this.be=!0}}class Ib{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Iw,this.$e=Tb(),this.Ke=Tb(),this.Ue=new L(R)}We(e){for(var t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(var r of e.removedTargetIds)this.ze(r,e.key,e.fe)}je(r){this.forEachTarget(r,e=>{var t=this.He(e);switch(r.state){case 0:this.Je(e)&&t.Ce(r.resumeToken);break;case 1:t.Be(),t.De||t.Me(),t.Ce(r.resumeToken);break;case 2:t.Be(),t.De||this.removeTarget(e);break;case 3:this.Je(e)&&(t.Le(),t.Ce(r.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),t.Ce(r.resumeToken));break;default:k()}})}forEachTarget(e,r){0<e.targetIds.length?e.targetIds.forEach(r):this.qe.forEach((e,t)=>{this.Je(t)&&r(t)})}Ze(n){let i=n.targetId,e=n.ge.count,t=this.Xe(i);if(t){var r=t.target;if(rw(r))if(0===e){let e=new x(r.path);this.ze(i,e,Dy.newNoDocument(e,P.min()))}else S(1===e);else{let r=this.et(i);if(r!==e){let e=this.tt(n),t=e?this.nt(e,n,r):1;if(0!==t){this.Ye(i);let e=2===t?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,e)}}}}}tt(e){var t=e.ge.unchangedNames;if(!t||!t.bits)return null;var{bits:{bitmap:t="",padding:r=0},hashCount:n=0}=t;let i,s;try{i=Q_(t).toUint8Array()}catch(e){if(e instanceof K_)return Am("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new fb(i,r,n)}catch(e){return Am(e instanceof gb?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ee?null:s}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(r,n){var e=this.ke.getRemoteKeysForTarget(n);let i=0;return e.forEach(e=>{var t=this.ke.it(),t=`projects/${t.projectId}/databases/${t.database}/documents/`+e.path.canonicalString();r.mightContain(t)||(this.ze(n,e,null),i++)}),i}ot(n){let i=new Map,s=(this.qe.forEach((e,t)=>{var r=this.Xe(t);if(r){if(e.current&&rw(r.target)){let e=new x(r.target.path);this._t(e).has(t)||this.ut(t,e)||this.ze(t,e,Dy.newNoDocument(e,n))}e.ve&&(i.set(t,e.Fe()),e.Me())}}),V());this.Ke.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{var t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1)}),r&&(s=s.add(e))}),this.Qe.forEach((e,t)=>t.setReadTime(n));var e=new mb(n,i,this.Ue,this.Qe,s);return this.Qe=Iw,this.$e=Tb(),this.Ke=Tb(),this.Ue=new L(R),e}Ge(e,t){var r;this.Je(e)&&(r=this.ut(e,t.key)?2:0,this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e)))}ze(e,t,r){var n;this.Je(e)&&(n=this.He(e),this.ut(e,t)?n.xe(t,1):n.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),r)&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){var t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new bb,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new M(R),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new M(R),this.$e=this.$e.insert(e,t)),t}Je(e){var t=null!==this.Xe(e);return t||C("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){var t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(t){this.qe.set(t,new bb),this.ke.getRemoteKeysForTarget(t).forEach(e=>{this.ze(t,e,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function Tb(){return new L(x.comparator)}function Eb(){return new L(x.comparator)}let Cb={asc:"ASCENDING",desc:"DESCENDING"},kb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Sb={and:"AND",or:"OR"};class Ab{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Nb(e,t){return e.useProto3Json||Tv(t)?t:{value:t}}function Rb(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Pb(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Db(e){return S(!!e),P.fromTimestamp((t=G_(e),new zm(t.seconds,t.nanos)));var t}function xb(e,t){return Ob(e,t).canonicalString()}function Ob(e,t){e=e;var r=new D(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function Lb(e){var t=D.fromString(e);return S(tI(t)),t}function Mb(e,t){return xb(e.databaseId,t.path)}function Fb(e,t){var r=Lb(t);if(r.get(1)!==e.databaseId.projectId)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new N(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new x(jb(r))}function Ub(e,t){return xb(e.databaseId,t)}function Vb(e){var t=Lb(e);return 4===t.length?D.emptyPath():jb(t)}function qb(e){return new D(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function jb(e){return S(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Bb(e,t,r){return{name:Mb(e,t),fields:r.value.mapValue.fields}}function zb(e,t,r){var n=Fb(e,t.name),i=Db(t.updateTime),s=t.createTime?Db(t.createTime):P.min(),a=new Py({mapValue:{fields:t.fields}}),n=Dy.newFoundDocument(n,i,s,a);return r&&n.setHasCommittedMutations(),r?n.setHasCommittedMutations():n}function Kb(e,t){let r;if(t instanceof Jw)r={update:Bb(e,t.key,t.value)};else if(t instanceof rb)r={delete:Mb(e,t.key)};else if(t instanceof Xw)r={update:Bb(e,t.key,t.data),updateMask:(e=>{let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}})(t.fieldMask)};else{if(!(t instanceof nb))return k();r={verify:Mb(e,t.key)}}return 0<t.fieldTransforms.length&&(r.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof Lw)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Mw)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Uw)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof qw)return{fieldPath:e.field.canonicalString(),increment:t.Ie};throw k()})),t.precondition.isNone||(r.currentDocument=(e=e,void 0!==(t=t.precondition).updateTime?{updateTime:(n=t.updateTime,Rb(e,n.toTimestamp()))}:void 0!==t.exists?{exists:t.exists}:k())),r;var n}function Wb(i,t){let r=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?Ww.updateTime(Db(s.updateTime)):void 0!==s.exists?Ww.exists(s.exists):Ww.none():Ww.none(),n=t.updateTransforms?t.updateTransforms.map(r=>{{var e=i;let t=null;if("setToServerValue"in r)S("REQUEST_TIME"===r.setToServerValue),t=new Lw;else if("appendMissingElements"in r){let e=r.appendMissingElements.values||[];t=new Mw(e)}else if("removeAllFromArray"in r){let e=r.removeAllFromArray.values||[];t=new Uw(e)}else"increment"in r?t=new qw(e,r.increment):k();var n=Gm.fromServerFormat(r.fieldPath);return new zw(n,t)}}):[];var s,a;if(t.update){t.update.name;var o=Fb(i,t.update.name),l=new Py({mapValue:{fields:t.update.fields}});if(t.updateMask){s=t.updateMask,a=s.fieldPaths||[];let e=new z_(a.map(e=>Gm.fromServerFormat(e)));return new Xw(o,l,e,r,n)}return new Jw(o,l,r,n)}if(t.delete){let e=Fb(i,t.delete);return new rb(e,r)}if(t.verify){let e=Fb(i,t.verify);return new nb(e,r)}return k()}function Hb(e,n){return e&&0<e.length?(S(void 0!==n),e.map(t=>{{var r=n;let e=t.updateTime?Db(t.updateTime):Db(r);return e.isEqual(P.min())&&(e=Db(r)),new Kw(e,t.transformResults||[])}})):[]}function Gb(e,t){return{documents:[Ub(e,t.path)]}}function $b(e,t){var r={structuredQuery:{}},n=t.path;let i;null!==t.collectionGroup?(i=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Ub(e,i);n=(e=>{if(0!==e.length)return function r(e){return e instanceof F?(e=>{if("=="===e.op){if(Ty(e.value))return{unaryFilter:{field:Zb(e.field),op:"IS_NAN"}};if(Iy(e.value))return{unaryFilter:{field:Zb(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ty(e.value))return{unaryFilter:{field:Zb(e.field),op:"IS_NOT_NAN"}};if(Iy(e.value))return{unaryFilter:{field:Zb(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zb(e.field),op:Jb(e.op),value:e.value}}})(e):e instanceof U?(e=>{let t=e.getFilters().map(e=>r(e));return 1===t.length?t[0]:{compositeFilter:{op:Xb(e.op),filters:t}}})(e):k()}(U.create(e,"and"))})(t.filters),n&&(r.structuredQuery.where=n),n=(e=>{if(0!==e.length)return e.map(e=>({field:Zb((e=e).field),direction:(e=e.dir,Cb[e])}))})(t.orderBy),n&&(r.structuredQuery.orderBy=n),n=Nb(e,t.limit);return null!==n&&(r.structuredQuery.limit=n),t.startAt&&(r.structuredQuery.startAt={before:(e=t.startAt).inclusive,values:e.position}),t.endAt&&(r.structuredQuery.endAt={before:!(e=t.endAt).inclusive,values:e.position}),{ht:r,parent:i}}function Qb(e){let t=Vb(e.parent);var r,n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(0<i){S(1===i);let e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let a=[],o=(n.where&&(a=(e=n.where,(i=function t(e){return void 0!==e.unaryFilter?(i=>{switch(i.unaryFilter.op){case"IS_NAN":let e=eI(i.unaryFilter.field);return F.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=eI(i.unaryFilter.field);return F.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=eI(i.unaryFilter.field);return F.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let n=eI(i.unaryFilter.field);return F.create(n,"!=",{nullValue:"NULL_VALUE"});default:return k()}})(e):void 0!==e.fieldFilter?(e=>F.create(eI(e.fieldFilter.field),(e=>{switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return k()}})(e.fieldFilter.op),e.fieldFilter.value))(e):void 0!==e.compositeFilter?(e=>U.create(e.compositeFilter.filters.map(e=>t(e)),(e=>{switch(e){case"AND":return"and";case"OR":return"or";default:return k()}})(e.compositeFilter.op)))(e):k()}(e))instanceof U&&qy(i)?i.getFilters():[i])),[]),l=(n.orderBy&&(o=n.orderBy.map(e=>(e=e,new My(eI(e.field),(e=>{switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(e.direction))))),null),h=(n.limit&&(l=(e=n.limit,Tv(i="object"==typeof e?e.value:e)?null:i)),null),u=(n.startAt&&(h=(e=n.startAt,i=!!e.before,r=e.values||[],new xy(r,i))),null);return n.endAt&&(u=(e=n.endAt,r=!e.before,i=e.values||[],new xy(i,r))),ow(t,s,o,a,l,"F",h,u)}function Yb(e,t){var r=(e=>{switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return k()}})(t.purpose);return null==r?null:{"goog-listen-tags":r}}function Jb(e){return kb[e]}function Xb(e){return Sb[e]}function Zb(e){return{fieldPath:e.canonicalString()}}function eI(e){return Gm.fromServerFormat(e.fieldPath)}function tI(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class rI{constructor(e,t,r,n,i=P.min(),s=P.min(),a=W_.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new rI(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new rI(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new rI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new rI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class nI{constructor(e){this.Tt=e}}function iI(e,t){var r,n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:sI(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document={name:Mb(e=e.Tt,(r=t).key),fields:r.data.value.mapValue.fields,updateTime:Rb(e,r.version.toTimestamp()),createTime:Rb(e,r.createTime.toTimestamp())};else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:aI(t.version)};else{if(!t.isUnknownDocument())return k();i.unknownDocument={path:n.path.toArray(),version:aI(t.version)}}return i}function sI(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function aI(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function oI(e){var t=new zm(e.seconds,e.nanoseconds);return P.fromTimestamp(t)}function lI(t,r){let e=(r.baseMutations||[]).map(e=>Wb(t.Tt,e));for(let s=0;s<r.mutations.length-1;++s){let t=r.mutations[s];if(s+1<r.mutations.length&&void 0!==r.mutations[s+1].transform){let e=r.mutations[s+1];t.updateTransforms=e.transform.fieldTransforms,r.mutations.splice(s+1,1),++s}}let n=r.mutations.map(e=>Wb(t.Tt,e)),i=zm.fromMillis(r.localWriteTimeMs);return new ib(r.batchId,i,e,n)}function hI(e){var t,r=oI(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?oI(e.lastLimboFreeSnapshotVersion):P.min(),i=void 0!==e.query.documents?(S(1===(t=e.query).documents.length),dw(lw(Vb(t.documents[0])))):dw(Qb(e.query));return new rI(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,W_.fromBase64String(e.resumeToken))}function uI(e,t){var r=aI(t.snapshotVersion),n=aI(t.lastLimboFreeSnapshotVersion),i=rw(t.target)?Gb(e.Tt,t.target):$b(e.Tt,t.target).ht,s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ew(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function cI(e){var t=Qb({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?fw(t,t.limit,"L"):t}function dI(e,t){return new ab(t.largestBatchId,Wb(e.Tt,t.overlayMutation))}function pI(e,t){var r=t.path.lastSegment();return[e,Sv(t.path.popLast()),r]}function fI(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:aI(n.readTime),documentKey:Sv(n.documentKey.path),largestBatchId:n.largestBatchId}}class gI{getBundleMetadata(e,t){return mI(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:oI(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return mI(e).put({bundleId:(e=t).id,createTime:aI(Db(e.createTime)),version:e.version})}getNamedQuery(e,t){return vI(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:cI(e.bundledQuery),readTime:oI(e.readTime)}})}saveNamedQuery(e,t){return vI(e).put({name:(e=t).name,readTime:aI(Db(e.readTime)),bundledQuery:e.bundledQuery})}}function mI(e){return L_(e,l_)}function vI(e){return L_(e,h_)}class _I{constructor(e,t){this.serializer=e,this.userId=t}static It(e,t){var r=t.uid||"";return new _I(e,r)}getOverlay(e,t){return yI(e).get(pI(this.userId,t)).next(e=>e?dI(this.serializer,e):null)}getOverlays(e,t){let r=kw();return O.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(n,i,e){let s=[];return e.forEach((e,t)=>{var r=new ab(i,t);s.push(this.Et(n,r))}),O.waitFor(s)}removeOverlaysForBatchId(r,e,n){let t=new Set,i=(e.forEach(e=>t.add(Sv(e.getCollectionPath()))),[]);return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(yI(r).J(I_,t))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){let n=kw(),i=Sv(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return yI(e).G(I_,s).next(e=>{for(var t of e){let e=dI(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,i){let s=kw(),a;var n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yI(e).Z({index:E_,range:n},(e,t,r)=>{var n=dI(this.serializer,t);s.size()<i||n.largestBatchId===a?(s.set(n.getKey(),n),a=n.largestBatchId):r.done()}).next(()=>s)}Et(e,t){return yI(e).put(((e,t,r)=>{var[,n,i]=pI(t,r.mutation.key);return{userId:t,collectionPath:n,documentId:i,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Kb(e.Tt,r.mutation)}})(this.serializer,this.userId,t))}}function yI(e){return L_(e,w_)}class wI{dt(e){return L_(e,k_)}getSessionToken(e){return this.dt(e).get("sessionToken").next(e=>{var t=null==e?void 0:e.value;return t?W_.fromUint8Array(t):W_.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class bI{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(t,r){if("nullValue"in t)this.ft(r,5);else if("booleanValue"in t)this.ft(r,10),r.gt(t.booleanValue?1:0);else if("integerValue"in t)this.ft(r,15),r.gt($_(t.integerValue));else if("doubleValue"in t){var e=$_(t.doubleValue);isNaN(e)?this.ft(r,13):(this.ft(r,15),Ev(e)?r.gt(0):r.gt(e))}else if("timestampValue"in t){let e=t.timestampValue;this.ft(r,20),"string"==typeof e&&(e=G_(e)),r.yt(""+(e.seconds||"")),r.gt(e.nanos||0)}else"stringValue"in t?(this.wt(t.stringValue,r),this.bt(r)):"bytesValue"in t?(this.ft(r,30),r.St(Q_(t.bytesValue)),this.bt(r)):"referenceValue"in t?this.Dt(t.referenceValue,r):"geoPointValue"in t?(e=t.geoPointValue,this.ft(r,45),r.gt(e.latitude||0),r.gt(e.longitude||0)):"mapValue"in t?Sy(t)?this.ft(r,Number.MAX_SAFE_INTEGER):Cy(t)?this.vt(t.mapValue,r):(this.Ct(t.mapValue,r),this.bt(r)):"arrayValue"in t?(this.Ft(t.arrayValue,r),this.bt(r)):k()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){var r=e.fields||{};this.ft(t,55);for(let e of Object.keys(r))this.wt(e,t),this.Rt(r[e],t)}vt(e,t){var r=e.fields||{},n=(this.ft(t,53),uy),i=(null==(i=null==(i=r[n].arrayValue)?void 0:i.values)?void 0:i.length)||0;this.ft(t,15),t.gt($_(i)),this.wt(n,t),this.Rt(r[n],t)}Ft(e,t){var r=e.values||[];this.ft(t,50);for(let e of r)this.Rt(e,t)}Dt(e,t){this.ft(t,37),x.fromName(e).path.forEach(e=>{this.ft(t,60),this.Mt(e,t)})}ft(e,t){e.gt(t)}bt(e){e.gt(2)}}bI.xt=new bI;function II(e){var t=64-(e=>{let t=0;for(let n=0;n<8;++n){var r=(e=>{if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t})(255&e[n]);if(t+=r,8!==r)break}return t})(e);return Math.ceil(t/8)}class TI{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ot(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Nt(r.value),r=t.next();this.Bt()}Lt(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.kt(r.value),r=t.next();this.qt()}Qt(e){for(var t of e){let e=t.charCodeAt(0);if(e<128)this.Nt(e);else if(e<2048)this.Nt(960|e>>>6),this.Nt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Nt(480|e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e);else{let e=t.codePointAt(0);this.Nt(240|e>>>18),this.Nt(128|63&e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e)}}this.Bt()}$t(e){for(var t of e){let e=t.charCodeAt(0);if(e<128)this.kt(e);else if(e<2048)this.kt(960|e>>>6),this.kt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.kt(480|e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e);else{let e=t.codePointAt(0);this.kt(240|e>>>18),this.kt(128|63&e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e)}}this.qt()}Kt(e){var t=this.Ut(e),r=II(t);this.Wt(1+r),this.buffer[this.position++]=255&r;for(let n=t.length-r;n<t.length;++n)this.buffer[this.position++]=255&t[n]}Gt(e){var t=this.Ut(e),r=II(t);this.Wt(1+r),this.buffer[this.position++]=~(255&r);for(let n=t.length-r;n<t.length;++n)this.buffer[this.position++]=~(255&t[n])}zt(){this.jt(255),this.jt(255)}Ht(){this.Jt(255),this.Jt(255)}reset(){this.position=0}seed(e){this.Wt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Yt(){return this.buffer.slice(0,this.position)}Ut(e){e=e,(t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1);var t,r=new Uint8Array(t.buffer),n=!!(128&r[0]);r[0]^=n?255:128;for(let i=1;i<r.length;++i)r[i]^=n?255:0;return r}Nt(e){var t=255&e;0==t?(this.jt(0),this.jt(255)):255==t?(this.jt(255),this.jt(0)):this.jt(t)}kt(e){var t=255&e;0==t?(this.Jt(0),this.Jt(255)):255==t?(this.Jt(255),this.Jt(0)):this.Jt(e)}Bt(){this.jt(0),this.jt(1)}qt(){this.Jt(0),this.Jt(1)}jt(e){this.Wt(1),this.buffer[this.position++]=e}Jt(e){this.Wt(1),this.buffer[this.position++]=~e}Wt(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);t=new Uint8Array(e);t.set(this.buffer),this.buffer=t}}}class EI{constructor(e){this.Zt=e}St(e){this.Zt.Ot(e)}yt(e){this.Zt.Qt(e)}gt(e){this.Zt.Kt(e)}Vt(){this.Zt.zt()}}class CI{constructor(e){this.Zt=e}St(e){this.Zt.Lt(e)}yt(e){this.Zt.$t(e)}gt(e){this.Zt.Gt(e)}Vt(){this.Zt.Ht()}}class kI{constructor(){this.Zt=new TI,this.Xt=new EI(this.Zt),this.en=new CI(this.Zt)}seed(e){this.Zt.seed(e)}tn(e){return 0===e?this.Xt:this.en}Yt(){return this.Zt.Yt()}reset(){this.Zt.reset()}}class SI{constructor(e,t,r,n){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=n}nn(){var e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new SI(this.indexId,this.documentKey,this.arrayValue,r)}}function AI(e,t){var r=e.indexId-t.indexId;return 0!=r||0!==(r=NI(e.arrayValue,t.arrayValue))||0!==(r=NI(e.directionalValue,t.directionalValue))?r:x.comparator(e.documentKey,t.documentKey)}function NI(e,t){for(let n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!=r)return r}return e.length-t.length}class RI{constructor(e){this.rn=new M((e,t)=>Gm.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.sn=e.orderBy,this._n=[];for(var t of e.filters){let e=t;e.isInequality()?this.rn=this.rn.add(e):this._n.push(e)}}get an(){return 1<this.rn.size}un(e){if(S(e.collectionGroup===this.collectionId),this.an)return!1;let t=Ym(e);if(void 0!==t&&!this.cn(t))return!1;var r=Jm(e);let n=new Set,i=0,s=0;for(;i<r.length&&this.cn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i!==r.length){if(0<this.rn.size){let t=this.rn.getIterator().getNext();if(!n.has(t.field.canonicalString())){let e=r[i];if(!this.ln(t,e)||!this.hn(this.sn[s++],e))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.sn.length||!this.hn(this.sn[s++],e))return!1}}return!0}Pn(){if(this.an)return null;let e=new M(Gm.comparator);var t,r,n=[];for(t of this._n)t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n.push(new Xm(t.field,2)):e.has(t.field)||(e=e.add(t.field),n.push(new Xm(t.field,0))));for(r of this.sn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Xm(r.field,"asc"===r.dir?0:1)));return new Qm(Qm.UNKNOWN_ID,this.collectionId,n,Zm.empty())}cn(e){for(var t of this._n)if(this.ln(t,e))return!0;return!1}ln(e,t){var r;return!(void 0===e||!e.field.isEqual(t.fieldPath))&&(r="array-contains"===e.op||"array-contains-any"===e.op,2===t.kind==r)}hn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function PI(e){var t;return 0===e.getFilters().length?[]:(t=function t(e){if(S(e instanceof F||e instanceof U),e instanceof F)return e;if(1===e.filters.length)return t(e.filters[0]);let r=e.filters.map(e=>t(e));let n=U.create(r,e.op);return n=FI(n),OI(n)?n:(S(n instanceof U),S(Uy(n)),S(1<n.filters.length),n.filters.reduce((e,t)=>LI(e,t)))}(function t(r){var n;if(S(r instanceof F||r instanceof U),r instanceof F){if(r instanceof Qy){let e=(null==(n=null==(n=r.value.arrayValue)?void 0:n.values)?void 0:n.map(e=>F.create(r.field,"==",e)))||[];return U.create(e,"or")}return r}let e=r.filters.map(e=>t(e));return U.create(e,r.op)}(e)),S(OI(t)),DI(t)||xI(t)?[t]:t.getFilters())}function DI(e){return e instanceof F}function xI(e){return e instanceof U&&qy(e)}function OI(e){return DI(e)||xI(e)||(e=>{if(e instanceof U&&Vy(e)){for(var t of e.getFilters())if(!DI(t)&&!xI(t))return!1;return!0}return!1})(e)}function LI(e,t){var r,n;return S(e instanceof F||e instanceof U),S(t instanceof F||t instanceof U),FI(e instanceof F?t instanceof F?(r=e,n=t,U.create([r,n],"and")):MI(e,t):t instanceof F?MI(t,e):((e,t)=>{if(S(0<e.filters.length&&0<t.filters.length),Uy(e)&&Uy(t))return By(e,t.getFilters());let r=Vy(e)?e:t,n=Vy(e)?t:e,i=r.filters.map(e=>LI(e,n));return U.create(i,"or")})(e,t))}function MI(t,e){var r;return Uy(e)?By(e,t.getFilters()):(r=e.filters.map(e=>LI(t,e)),U.create(r,"or"))}function FI(t){if(S(t instanceof F||t instanceof U),t instanceof F)return t;var e=t.getFilters();if(1===e.length)return FI(e[0]);if(jy(t))return t;let r=e.map(e=>FI(e)),n=[];return r.forEach(e=>{e instanceof F?n.push(e):e instanceof U&&(e.op===t.op?n.push(...e.filters):n.push(e))}),1===n.length?n[0]:U.create(n,t.op)}class UI{constructor(){this.Tn=new VI}addToCollectionParentIndex(e,t){return this.Tn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(rv.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(rv.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class VI{constructor(){this.index={}}add(e){var t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new M(D.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){var t=e.lastSegment(),r=e.popLast(),t=this.index[t];return t&&t.has(r)}getEntries(e){return(this.index[e]||new M(D.comparator)).toArray()}}let qI="IndexedDbIndexManager",jI=new Uint8Array(0);class BI{constructor(e,t){this.databaseId=t,this.In=new VI,this.En=new bw(e=>ew(e),(e,t)=>tw(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){var r,n;return this.In.has(t)?O.resolve():(n=t.lastSegment(),r=t.popLast(),e.addOnCommittedListener(()=>{this.In.add(t)}),n={collectionId:n,parent:Sv(r)},zI(e).put(n))}getCollectionParents(e,r){let n=[],t=IDBKeyRange.bound([r,""],[jm(r),""],!1,!0);return zI(e).G(t).next(e=>{for(var t of e){if(t.collectionId!==r)break;n.push(Nv(t.parent))}return n})}addFieldIndex(e,r){let t=WI(e),n={indexId:r.indexId,collectionGroup:r.collectionGroup,fields:r.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;var i=t.add(n);if(r.indexState){let t=HI(e);return i.next(e=>{t.put(fI(e,this.uid,r.indexState.sequenceNumber,r.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=WI(e),n=HI(e),i=KI(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=WI(e),r=KI(e),n=HI(e);return t.J().next(()=>r.J()).next(()=>n.J())}createTargetIndexes(r,e){return O.forEach(this.dn(e),t=>this.getIndexType(r,t).next(e=>{if(0===e||1===e){let e=new RI(t).Pn();if(null!=e)return this.addFieldIndex(r,e)}}))}getDocumentsMatchingTarget(e,c){let d=KI(e),r=!0,n=new Map;return O.forEach(this.dn(c),t=>this.An(e,t).next(e=>{r=r&&!!e,n.set(t,e)})).next(()=>{if(r){let h=V(),u=[];return O.forEach(n,(e,t)=>{C(qI,`Using index ${r=e,`id=${r.indexId}|cg=${r.collectionGroup}|f=`+r.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+ew(c));var r,n=((t,e)=>{var r=Ym(e);if(void 0!==r)for(let e of nw(t,r.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null})(t,e),i=((t,r)=>{var n,i=new Map;for(n of Jm(r))for(let e of nw(t,n.fieldPath))switch(e.op){case"==":case"in":i.set(n.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return i.set(n.fieldPath.canonicalString(),e.value),Array.from(i.values())}return null})(t,e),s=((t,e)=>{var r,n=[];let i=!0;for(r of Jm(e)){let e=(0===r.kind?iw:sw)(t,r.fieldPath,t.startAt);n.push(e.value),i=i&&e.inclusive}return new xy(n,i)})(t,e),a=((t,e)=>{var r,n=[];let i=!0;for(r of Jm(e)){let e=(0===r.kind?sw:iw)(t,r.fieldPath,t.endAt);n.push(e.value),i=i&&e.inclusive}return new xy(n,i)})(t,e),o=this.Rn(e,t,s),l=this.Rn(e,t,a),i=this.Vn(e,t,i),n=this.mn(e.indexId,n,o,s.inclusive,l,a.inclusive,i);return O.forEach(n,e=>d.H(e,c.limit).next(e=>{e.forEach(e=>{var t=x.fromSegments(e.documentKey);h.has(t)||(h=h.add(t),u.push(t))})}))}).next(()=>u)}return O.resolve(null)})}dn(t){let e=this.En.get(t);return e||(e=0===t.filters.length?[t]:PI(U.create(t.filters,"and")).map(e=>Zy(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.En.set(t,e)),e}mn(i,s,a,o,l,h,u){let e=(null!=s?s.length:1)*Math.max(a.length,l.length),c=e/(null!=s?s.length:1),d=[];for(let p=0;p<e;++p){let t=s?this.fn(s[p/c]):jI,e=this.gn(i,t,a[p%c],o),r=this.pn(i,t,l[p%c],h),n=u.map(e=>this.gn(i,t,e,!0));d.push(...this.createRange(e,r,n))}return d}gn(e,t,r,n){var i=new SI(e,x.empty(),t,r);return n?i:i.nn()}pn(e,t,r,n){var i=new SI(e,x.empty(),t,r);return n?i.nn():i}An(e,t){let n=new RI(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(var r of e)n.un(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let r=2,n=this.dn(t);return O.forEach(n,t=>this.An(e,t).next(e=>{e?0!==r&&e.fields.length<(t=>{let r=new M(Gm.comparator),n=!1;for(var i of t.filters)for(let e of i.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:r=r.add(e.field));for(let n of t.orderBy)n.field.isKeyField()||(r=r.add(n.field));return r.size+(n?1:0)})(t)&&(r=1):r=0})).next(()=>null!==t.limit&&1<n.length&&2===r?1:r)}yn(e,t){var r,n=new kI;for(r of Jm(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;var i=n.tn(r.kind);bI.xt.At(e,i)}return n.Yt()}fn(e){var t=new kI;return bI.xt.At(e,t.tn(0)),t.Yt()}wn(e,t){var r,n=new kI;return bI.xt.At(yy(this.databaseId,t),n.tn(0===(r=Jm(e)).length?0:r[r.length-1].kind)),n.Yt()}Vn(e,n,i){if(null===i)return[];let s=[],a=(s.push(new kI),0);for(var o of Jm(e)){let t=i[a++];for(let r of s)if(this.bn(n,o.fieldPath)&&by(t))s=this.Sn(s,o,t);else{let e=r.tn(o.kind);bI.xt.At(t,e)}}return this.Dn(s)}Rn(e,t,r){return this.Vn(e,t,r.position)}Dn(e){var t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Yt();return t}Sn(r,n,e){let i=[...r],s=[];for(let r of e.arrayValue.values||[])for(let t of i){let e=new kI;e.seed(t.Yt()),bI.xt.At(r,e.tn(n.kind)),s.push(e)}return s}bn(e,t){return!!e.filters.find(e=>e instanceof F&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=WI(e),n=HI(e);return(t?r.G(c_,IDBKeyRange.bound(t,t)):r.G()).next(e=>{let s=[];return O.forEach(e,i=>n.get([i.indexId,this.uid]).next(e=>{var t,r,n;s.push((t=i,r=(e=e)?new Zm(e.sequenceNumber,new rv(oI(e.readTime),new x(Nv(e.documentKey)),e.largestBatchId)):Zm.empty(),n=t.fields.map(([e,t])=>new Xm(Gm.fromServerFormat(e),t)),new Qm(t.indexId,t.collectionGroup,n,r)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=r?r:R(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,r,n){let i=WI(e),s=HI(e);return this.vn(e).next(t=>i.G(c_,IDBKeyRange.bound(r,r)).next(e=>O.forEach(e,e=>s.put(fI(e.indexId,this.uid,t,n)))))}updateIndexEntries(i,e){let r=new Map;return O.forEach(e,(t,n)=>{var e=r.get(t.collectionGroup);return(e?O.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(r.set(t.collectionGroup,e),O.forEach(e,r=>this.Cn(i,t,r).next(e=>{var t=this.Fn(n,r);return e.isEqual(t)?O.resolve():this.Mn(i,n,r,e,t)}))))})}xn(e,t,r,n){return KI(e).put({indexId:n.indexId,uid:this.uid,arrayValue:n.arrayValue,directionalValue:n.directionalValue,orderedDocumentKey:this.wn(r,t.key),documentKey:t.key.path.toArray()})}On(e,t,r,n){return KI(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,this.wn(r,t.key),t.key.path.toArray()])}Cn(e,r,n){var t=KI(e);let i=new M(AI);return t.Z({index:__,range:IDBKeyRange.only([n.indexId,this.uid,this.wn(n,r)])},(e,t)=>{i=i.add(new SI(n.indexId,r,t.arrayValue,t.directionalValue))}).next(()=>i)}Fn(t,r){let n=new M(AI);var i=this.yn(r,t);if(null!=i){let e=Ym(r);if(null!=e){var s=t.data.field(e.fieldPath);if(by(s))for(let e of s.arrayValue.values||[])n=n.add(new SI(r.indexId,t.key,this.fn(e),i))}else n=n.add(new SI(r.indexId,t.key,jI,i))}return n}Mn(t,r,s,e,a){C(qI,"Updating index entries for document '%s'",r.key);let o=[];{var l=AI,h=e=>{o.push(this.xn(t,r,s,e))},u=e=>{o.push(this.On(t,r,s,e))},c=e.getIterator(),d=a.getIterator();let n=B_(c),i=B_(d);for(;n||i;){let t=!1,r=!1;if(n&&i){let e=l(n,i);e<0?r=!0:0<e&&(t=!0)}else null!=n?r=!0:t=!0;t?(h(i),i=B_(d)):r?(u(n),n=B_(c)):(n=B_(c),i=B_(d))}}return O.waitFor(o)}vn(e){let n=1;return HI(e).Z({index:f_,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,r)=>{r.done(),n=t.sequenceNumber+1}).next(()=>n)}createRange(r,n,e){e=e.sort((e,t)=>AI(e,t)).filter((e,t,r)=>!t||0!==AI(e,r[t-1]));var i=[];i.push(r);for(let s of e){let e=AI(s,r),t=AI(s,n);if(0===e)i[0]=r.nn();else if(0<e&&t<0)i.push(s),i.push(s.nn());else if(0<t)break}i.push(n);let s=[];for(let a=0;a<i.length;a+=2){if(this.Nn(i[a],i[a+1]))return[];let e=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,jI,[]],t=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,jI,[]];s.push(IDBKeyRange.bound(e,t))}return s}Nn(e,t){return 0<AI(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(GI)}getMinOffset(t,e){return O.mapArray(this.dn(e),e=>this.An(t,e).next(e=>e||k())).next(GI)}}function zI(e){return L_(e,s_)}function KI(e){return L_(e,m_)}function WI(e){return L_(e,u_)}function HI(e){return L_(e,d_)}function GI(e){S(0!==e.length);let t=e[0].indexState.offset,r=t.largestBatchId;for(let i=1;i<e.length;i++){var n=e[i].indexState.offset;nv(n,t)<0&&(t=n),r<n.largestBatchId&&(r=n.largestBatchId)}return new rv(t.readTime,t.documentKey,r)}let $I={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class QI{static withCacheSize(e){return new QI(e,QI.DEFAULT_COLLECTION_PERCENTILE,QI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function YI(t,r,n){let e=t.store(Ov),i=t.store(jv),s=[],a=IDBKeyRange.only(n.batchId),o=0;var l=e.Z({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{S(1===o)}));let h=[];for(let t of n.mutations){let e=Vv(r,t.key.path,n.batchId);s.push(i.delete(e)),h.push(t.key)}return O.waitFor(s).next(()=>h)}function JI(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw k();t=e.noDocument}return JSON.stringify(t).length}QI.DEFAULT_COLLECTION_PERCENTILE=10,QI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,QI.DEFAULT=new QI(41943040,QI.DEFAULT_COLLECTION_PERCENTILE,QI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),QI.DISABLED=new QI(-1,0,0);class XI{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Bn={}}static It(e,t,r,n){S(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new XI(i,t,r,n)}checkEmpty(e){let n=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return eT(e).Z({index:Mv,range:t},(e,t,r)=>{n=!1,r.done()}).next(()=>n)}addMutationBatch(c,d,p,f){let g=tT(c),m=eT(c);return m.add({}).next(t=>{S("number"==typeof t);let e=new ib(t,d,p,f),r=(i=this.serializer,s=this.userId,a=e,o=a.baseMutations.map(e=>Kb(i.Tt,e)),l=a.mutations.map(e=>Kb(i.Tt,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:l}),n=[];var i,s,a,o,l;let h=new M((e,t)=>R(e.canonicalString(),t.canonicalString()));for(let u of f){let e=Vv(this.userId,u.key.path,t);h=h.add(u.key.path.popLast()),n.push(m.put(r)),n.push(g.put(e,qv))}return h.forEach(e=>{n.push(this.indexManager.addToCollectionParentIndex(c,e))}),c.addOnCommittedListener(()=>{this.Bn[t]=e.keys()}),O.waitFor(n).next(()=>e)})}lookupMutationBatch(e,t){return eT(e).get(t).next(e=>e?(S(e.userId===this.userId),lI(this.serializer,e)):null)}Ln(e,r){return this.Bn[r]?O.resolve(this.Bn[r]):this.lookupMutationBatch(e,r).next(e=>{var t;return e?(t=e.keys(),this.Bn[r]=t):null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return eT(e).Z({index:Mv,range:r},(e,t,r)=>{t.userId===this.userId&&(S(t.batchId>=n),i=lI(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Iv;return eT(e).Z({index:Mv,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,Iv],[this.userId,Number.POSITIVE_INFINITY]);return eT(e).G(Mv,t).next(e=>e.map(e=>lI(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){let e=Uv(this.userId,o.path),t=IDBKeyRange.lowerBound(e),l=[];return tT(a).Z({range:t},(e,t,r)=>{var[n,i,s]=e,i=Nv(i);if(n===this.userId&&o.path.isEqual(i))return eT(a).get(s).next(e=>{if(!e)throw k();S(e.userId===this.userId),l.push(lI(this.serializer,e))});r.done()}).next(()=>l)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new M(R),r=[];return e.forEach(a=>{var e=Uv(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=tT(t).Z({range:e},(e,t,r)=>{var[n,i,s]=e,i=Nv(i);n===this.userId&&a.path.isEqual(i)?o=o.add(s):r.done()});r.push(e)}),O.waitFor(r).next(()=>this.kn(t,o))}getAllMutationBatchesAffectingQuery(e,t){let a=t.path,o=a.length+1,r=Uv(this.userId,a),n=IDBKeyRange.lowerBound(r),l=new M(R);return tT(e).Z({range:n},(e,t,r)=>{var[n,i,s]=e,i=Nv(i);n===this.userId&&a.isPrefixOf(i)?i.length===o&&(l=l.add(s)):r.done()}).next(()=>this.kn(e,l))}kn(t,e){let r=[],n=[];return e.forEach(e=>{n.push(eT(t).get(e).next(e=>{if(null===e)throw k();S(e.userId===this.userId),r.push(lI(this.serializer,e))}))}),O.waitFor(n).next(()=>r)}removeMutationBatch(t,r){return YI(t.ue,this.userId,r).next(e=>(t.addOnCommittedListener(()=>{this.qn(r.batchId)}),O.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}qn(e){delete this.Bn[e]}performConsistencyCheck(r){return this.checkEmpty(r).next(e=>{if(!e)return O.resolve();let t=IDBKeyRange.lowerBound([this.userId]),n=[];return tT(r).Z({range:t},(t,e,r)=>{if(t[0]===this.userId){let e=Nv(t[1]);n.push(e)}else r.done()}).next(()=>{S(0===n.length)})})}containsKey(e,t){return ZI(e,this.userId,t)}Qn(e){return rT(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:Iv,lastStreamToken:""})}}function ZI(e,s,t){let r=Uv(s,t.path),a=r[1],n=IDBKeyRange.lowerBound(r),o=!1;return tT(e).Z({range:n,Y:!0},(e,t,r)=>{var[n,i,,]=e;n===s&&i===a&&(o=!0),r.done()}).next(()=>o)}function eT(e){return L_(e,Ov)}function tT(e){return L_(e,jv)}function rT(e){return L_(e,xv)}class nT{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new nT(0)}static Un(){return new nT(-1)}}class iT{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(r){return this.Wn(r).next(e=>{var t=new nT(e.highestTargetId);return e.highestTargetId=t.next(),this.Gn(r,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Wn(e).next(e=>P.fromTimestamp(new zm(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Wn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,r,n){return this.Wn(t).next(e=>(e.highestListenSequenceNumber=r,n&&(e.lastRemoteSnapshotVersion=n.toTimestamp()),e.highestListenSequenceNumber<r&&(e.highestListenSequenceNumber=r),this.Gn(t,e)))}addTargetData(t,r){return this.zn(t,r).next(()=>this.Wn(t).next(e=>(e.targetCount+=1,this.jn(r,e),this.Gn(t,e))))}updateTargetData(e,t){return this.zn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>sT(t).delete(e.targetId)).next(()=>this.Wn(t)).next(e=>(S(0<e.targetCount),--e.targetCount,this.Gn(t,e)))}removeTargets(n,i,s){let a=0,o=[];return sT(n).Z((e,t)=>{var r=hI(t);r.sequenceNumber<=i&&null===s.get(r.targetId)&&(a++,o.push(this.removeTargetData(n,r)))}).next(()=>O.waitFor(o)).next(()=>a)}forEachTarget(e,n){return sT(e).Z((e,t)=>{var r=hI(t);n(r)})}Wn(e){return aT(e).get(n_).next(e=>(S(null!==e),e))}Gn(e,t){return aT(e).put(n_,t)}zn(e,t){return sT(e).put(uI(this.serializer,t))}jn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),t.highestListenSequenceNumber<e.sequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Wn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=ew(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return sT(e).Z({range:t,index:Jv},(e,t,r)=>{var n=hI(t);tw(i,n.target)&&(s=n,r.done())}).next(()=>s)}addMatchingKeys(r,e,n){let i=[],s=oT(r);return e.forEach(e=>{var t=Sv(e.path);i.push(s.put({targetId:n,path:t})),i.push(this.referenceDelegate.addReference(r,n,e))}),O.waitFor(i)}removeMatchingKeys(r,e,n){let i=oT(r);return O.forEach(e,e=>{var t=Sv(e.path);return O.waitFor([i.delete([n,t]),this.referenceDelegate.removeReference(r,n,e)])})}removeMatchingKeysForTargetId(e,t){var r=oT(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){var r=IDBKeyRange.bound([t],[t+1],!1,!0),n=oT(e);let i=V();return n.Z({range:r,Y:!0},(e,t,r)=>{var n=Nv(e[1]),n=new x(n);i=i.add(n)}).next(()=>i)}containsKey(e,t){var r=Sv(t.path),r=IDBKeyRange.bound([r],[jm(r)],!1,!0);let n=0;return oT(e).Z({index:t_,Y:!0,range:r},([e],t,r)=>{0!==e&&(n++,r.done())}).next(()=>0<n)}lt(e,t){return sT(e).get(t).next(e=>e?hI(e):null)}}function sT(e){return L_(e,Yv)}function aT(e){return L_(e,i_)}function oT(e){return L_(e,Zv)}let lT="LruGarbageCollector";function hT([e,t],[r,n]){var i=R(e,r);return 0===i?R(t,n):i}class uT{constructor(e){this.Hn=e,this.buffer=new M(hT),this.Jn=0}Yn(){return++this.Jn}Zn(e){var t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();hT(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){C(lT,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){pv(e)?C(lT,"Ignoring IndexedDB error during garbage collection: ",e):await av(e)}await this.er(3e5)})}}class dT{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return O.resolve(bv.ae);let r=new uT(t);return this.tr.forEachTarget(e,e=>r.Zn(e.sequenceNumber)).next(()=>this.tr.rr(e,e=>r.Zn(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(t,r){return-1===this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve($I)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),$I):this.ir(t,r))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(t,r){let n,i,s,a,o,l,h,u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(n=e,o=Date.now(),this.removeTargets(t,n,r))).next(e=>(s=e,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(e=>(h=Date.now(),km()<=c.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(h-l)+"ms\n"+`Total Duration: ${h-u}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}function pT(e,t){return new dT(e,t)}class fT{constructor(e,t){this.db=e,this.garbageCollector=pT(this,t)}nr(e){let r=this.sr(e);return this.db.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}sr(e){let t=0;return this.rr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}rr(e,r){return this._r(e,(e,t)=>r(t))}addReference(e,t,r){return gT(e,r)}removeReference(e,t,r){return gT(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return gT(e,t)}ar(e,r){{var n=e,i=r;let t=!1;return rT(n).X(e=>ZI(n,e,i).next(e=>(e&&(t=!0),O.resolve(!e)))).next(()=>t)}}removeOrphanedDocuments(r,n){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this._r(r,(t,e)=>{if(e<=n){let e=this.ar(r,t).next(e=>{if(!e)return a++,i.getEntry(r,t).next(()=>(i.removeEntry(t,P.min()),oT(r).delete([0,Sv(t.path)])))});s.push(e)}}).next(()=>O.waitFor(s)).next(()=>i.apply(r)).next(()=>a)}removeTarget(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return gT(e,t)}_r(e,n){var t=oT(e);let i,s=bv.ae;return t.Z({index:t_},([e],{path:t,sequenceNumber:r})=>{0===e?(s!==bv.ae&&n(new x(Nv(i)),s),s=r,i=t):s=bv.ae}).next(()=>{s!==bv.ae&&n(new x(Nv(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function gT(e,t){return oT(e).put((e=e.currentSequenceNumber,{targetId:0,path:Sv(t.path),sequenceNumber:e}))}class mT{constructor(){this.changes=new bw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Dy.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var r=this.changes.get(t);return void 0!==r?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class vT{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return bT(e).put(r)}removeEntry(e,t,r){return bT(e).delete((e=r,[(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],sI(e),n[n.length-1]]));var n}updateMetadata(t,r){return this.getMetadata(t).next(e=>(e.byteSize+=r,this.ur(t,e)))}getEntry(e,r){let n=Dy.newInvalidDocument(r);return bT(e).Z({index:Kv,range:IDBKeyRange.only(IT(r))},(e,t)=>{n=this.cr(r,t)}).next(()=>n)}lr(e,r){let n={size:0,document:Dy.newInvalidDocument(r)};return bT(e).Z({index:Kv,range:IDBKeyRange.only(IT(r))},(e,t)=>{n={document:this.cr(r,t),size:JI(t)}}).next(()=>n)}getEntries(e,t){let n=Iw;return this.hr(e,t,(e,t)=>{var r=this.cr(e,t);n=n.insert(e,r)}).next(()=>n)}Pr(e,t){let n=Iw,i=new L(x.comparator);return this.hr(e,t,(e,t)=>{var r=this.cr(e,t);n=n.insert(e,r),i=i.insert(e,JI(t))}).next(()=>({documents:n,Tr:i}))}hr(e,t,i){if(t.isEmpty())return O.resolve();let r=new M(ET),n=(t.forEach(e=>r=r.add(e)),IDBKeyRange.bound(IT(r.first()),IT(r.last()))),s=r.getIterator(),a=s.getNext();return bT(e).Z({index:Kv,range:n},(e,t,r)=>{for(var n=x.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&ET(a,n)<0;)i(a,null),a=s.getNext();a&&a.isEqual(n)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?r.W(IT(a)):r.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,n,t,i,s){var r=n.path,a=[r.popLast().toArray(),r.lastSegment(),sI(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],r=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return bT(e).G(IDBKeyRange.bound(a,r,!0)).next(e=>{null!=s&&s.incrementDocumentReadCount(e.length);let t=Iw;for(let r of e){let e=this.cr(x.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);e.isFoundDocument()&&(_w(n,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,r,i){let s=Iw;var n=TT(t,r),a=TT(t,rv.max());return bT(e).Z({index:Hv,range:IDBKeyRange.bound(n,a,!0)},(e,t,r)=>{var n=this.cr(x.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(s=s.insert(n.key,n)).size===i&&r.done()}).next(()=>s)}newChangeBuffer(e){return new yT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return wT(e).get(Qv).next(e=>(S(!!e),e))}ur(e,t){return wT(e).put(Qv,t)}cr(e,t){if(t){let e=((e,r)=>{let n;if(r.document)n=zb(e.Tt,r.document,!!r.hasCommittedMutations);else if(r.noDocument){let e=x.fromSegments(r.noDocument.path),t=oI(r.noDocument.readTime);n=Dy.newNoDocument(e,t),r.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!r.unknownDocument)return k();{let e=x.fromSegments(r.unknownDocument.path),t=oI(r.unknownDocument.version);n=Dy.newUnknownDocument(e,t)}}return r.readTime&&n.setReadTime((e=r.readTime,t=new zm(e[0],e[1]),P.fromTimestamp(t))),n;var t})(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(P.min()))return e}return Dy.newInvalidDocument(e)}}function _T(e){return new vT(e)}class yT extends mT{constructor(e,t){super(),this.Ir=e,this.trackRemovals=t,this.Er=new bw(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){let a=[],o=0,l=new M((e,t)=>R(e.canonicalString(),t.canonicalString()));return this.changes.forEach((t,r)=>{var e=this.Er.get(t);if(a.push(this.Ir.removeEntry(s,t,e.readTime)),r.isValidDocument()){var n=iI(this.Ir.serializer,r),i=(l=l.add(t.path.popLast()),JI(n));o+=i-e.size,a.push(this.Ir.addEntry(s,t,n))}else if(o-=e.size,this.trackRemovals){let e=iI(this.Ir.serializer,r.convertToNoDocument(P.min()));a.push(this.Ir.addEntry(s,t,e))}}),l.forEach(e=>{a.push(this.Ir.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Ir.updateMetadata(s,o)),O.waitFor(a)}getFromCache(e,t){return this.Ir.lr(e,t).next(e=>(this.Er.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Ir.Pr(e,t).next(({documents:r,Tr:e})=>(e.forEach((e,t)=>{this.Er.set(e,{size:t,readTime:r.get(e).readTime})}),r))}}function wT(e){return L_(e,$v)}function bT(e){return L_(e,Bv)}function IT(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function TT(e,t){var r=t.documentKey.path.toArray();return[e,sI(t.readTime),r.slice(0,r.length-2),0<r.length?r[r.length-1]:""]}function ET(e,t){var r=e.path.toArray(),n=t.path.toArray();let i=0;for(let s=0;s<r.length-2&&s<n.length-2;++s)if(i=R(r[s],n[s]))return i;return(i=R(r.length,n.length))||(i=R(r[r.length-2],n[n.length-2]))||R(r[r.length-1],n[n.length-1])}class CT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class kT{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(t,r){let n=null;return this.documentOverlayCache.getOverlay(t,r).next(e=>(n=e,this.remoteDocumentCache.getEntry(t,r))).next(e=>(null!==n&&Qw(n.mutation,e,z_.empty(),zm.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,V()).next(()=>e))}getLocalViewOfDocuments(e,t,r=V()){let n=kw();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let r=Ew();return e.forEach((e,t)=>{r=r.insert(e,t.overlayedDocument)}),r}))}getOverlayedDocuments(e,t){let r=kw();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,V()))}populateOverlays(e,r,t){let n=[];return t.forEach(e=>{r.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,t)=>{r.set(e,t)})})}computeViews(e,t,n,i){let s=Iw,a=kw(),o=kw();return t.forEach((e,t)=>{var r=n.get(t.key);i.has(t.key)&&(void 0===r||r.mutation instanceof Xw)?s=s.insert(t.key,t):void 0!==r?(a.set(t.key,r.mutation.getFieldMask()),Qw(r.mutation,t,r.mutation.getFieldMask(),zm.now())):a.set(t.key,z_.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new CT(t,null!=(r=a.get(e))?r:null))}),o))}recalculateAndSaveOverlays(a,o){let l=kw(),h=new L((e,t)=>e-t),u=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,o).next(e=>{for(let n of e)n.keys().forEach(e=>{var t,r=o.get(e);null!==r&&(t=l.get(e)||z_.empty(),t=n.applyToLocalView(r,t),l.set(e,t),r=(h.get(n.batchId)||V()).add(e),h=h.insert(n.batchId,r))})}).next(()=>{for(var i=[],s=h.getReverseIterator();s.hasNext();){let e=s.getNext(),t=e.key,r=e.value,n=kw();r.forEach(e=>{var t;u.has(e)||(null!==(t=$w(o.get(e),l.get(e)))&&n.set(e,t),u=u.add(e))}),i.push(this.documentOverlayCache.saveOverlays(a,t,n))}return O.waitFor(i)}).next(()=>l)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,r,n){return i=t,x.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):uw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n);var i}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(r=>{var e=0<o-r.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-r.size):O.resolve(kw());let n=$m,i=r;return e.next(e=>O.forEach(e,(t,e)=>(n<e.largestBatchId&&(n=e.largestBatchId),r.get(t)?O.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,r)).next(()=>this.computeViews(s,i,e,V())).next(e=>({batchId:n,changes:Cw(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(e=>{let t=Ew();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(n,i,s,a){let o=i.collectionGroup,l=Ew();return this.indexManager.getCollectionParents(n,o).next(e=>O.forEach(e,e=>{t=i,e=e.child(o);var t,r=new aw(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(n,r,s,a).next(e=>{e.forEach((e,t)=>{l=l.insert(e,t)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(t,s,r,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,r.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,r,a,n))).next(n=>{a.forEach((e,t)=>{var r=t.getKey();null===n.get(r)&&(n=n.insert(r,Dy.newInvalidDocument(r)))});let i=Ew();return n.forEach((e,t)=>{var r=a.get(e);void 0!==r&&Qw(r.mutation,t,z_.empty(),zm.now()),_w(s,t)&&(i=i.insert(e,t))}),i})}}class ST{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return O.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,{id:t.id,version:t.version,createTime:Db(t.createTime)}),O.resolve()}getNamedQuery(e,t){return O.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,{name:(t=t).name,query:cI(t.bundledQuery),readTime:Db(t.readTime)}),O.resolve()}}class AT{constructor(){this.overlays=new L(x.comparator),this.Rr=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){let r=kw();return O.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(r,n,e){return e.forEach((e,t)=>{this.Et(r,n,t)}),O.resolve()}removeOverlaysForBatchId(e,t,r){var n=this.Rr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Rr.delete(r)),O.resolve()}getOverlaysForCollection(e,r,n){let i=kw(),s=r.length+1,t=new x(r.child("")),a=this.overlays.getIteratorFrom(t);for(;a.hasNext();){let e=a.getNext().value,t=e.getKey();if(!r.isPrefixOf(t.path))break;t.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return O.resolve(i)}getOverlaysForCollectionGroup(e,r,n,t){let i=new L((e,t)=>e-t);for(var s=this.overlays.getIterator();s.hasNext();){let t=s.getNext().value;if(t.getKey().getCollectionGroup()===r&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=kw(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}let a=kw(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=t)););return O.resolve(a)}Et(e,t,r){var n=this.overlays.get(r.key);if(null!==n){let e=this.Rr.get(n.largestBatchId).delete(r.key);this.Rr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new ab(t,r));let i=this.Rr.get(t);void 0===i&&(i=V(),this.Rr.set(t,i)),this.Rr.set(t,i.add(r.key))}}class NT{constructor(){this.sessionToken=W_.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}class RT{constructor(){this.Vr=new M(PT.mr),this.gr=new M(PT.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){var r=new PT(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.wr(new PT(e,t))}br(e,t){e.forEach(e=>this.removeReference(e,t))}Sr(e){let t=new x(new D([])),r=new PT(t,e),n=new PT(t,e+1),i=[];return this.gr.forEachInRange([r,n],e=>{this.wr(e),i.push(e.key)}),i}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){var t=new x(new D([])),r=new PT(t,e),t=new PT(t,e+1);let n=V();return this.gr.forEachInRange([r,t],e=>{n=n.add(e.key)}),n}containsKey(e){var t=new PT(e,0),t=this.Vr.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class PT{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return x.comparator(e.key,t.key)||R(e.Cr,t.Cr)}static pr(e,t){return R(e.Cr,t.Cr)||x.comparator(e.key,t.key)}}class DT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new M(PT.mr)}checkEmpty(e){return O.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){var i=this.Fr,s=(this.Fr++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new ib(i,t,r,n));this.mutationQueue.push(s);for(let t of n)this.Mr=this.Mr.add(new PT(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return O.resolve(s)}lookupMutationBatch(e,t){return O.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){var r=this.Nr(t+1),r=r<0?0:r;return O.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(0===this.mutationQueue.length?Iv:this.Fr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new PT(t,0),n=new PT(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([r,n],e=>{var t=this.Or(e.Cr);i.push(t)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new M(R);return t.forEach(e=>{var t=new PT(e,0),r=new PT(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],e=>{n=n.add(e.Cr)})}),O.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;x.isDocumentKey(i)||(i=i.child(""));var s=new PT(new x(i),0);let a=new M(R);return this.Mr.forEachWhile(e=>{var t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Cr)),!0)},s),O.resolve(this.Br(a))}Br(e){let r=[];return e.forEach(e=>{var t=this.Or(e);null!==t&&r.push(t)}),r}removeMutationBatch(r,n){S(0===this.Lr(n.batchId,"removed")),this.mutationQueue.shift();let i=this.Mr;return O.forEach(n.mutations,e=>{var t=new PT(e.key,n.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(r,e.key)}).next(()=>{this.Mr=i})}qn(e){}containsKey(e,t){var r=new PT(t,0),r=this.Mr.firstAfterOrEqual(r);return O.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){var t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xT{constructor(e){this.kr=e,this.docs=new L(x.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){var r=t.key,n=this.docs.get(r),n=n?n.size:0,i=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){var r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():Dy.newInvalidDocument(t))}getEntries(e,t){let r=Iw;return t.forEach(e=>{var t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Dy.newInvalidDocument(e))}),O.resolve(r)}getDocumentsMatchingQuery(e,r,n,i){let s=Iw,a=r.path,t=new x(a.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(t);for(;o.hasNext();){let{key:e,value:{document:t}}=o.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||nv(tv(t),n)<=0||(i.has(t.key)||_w(r,t))&&(s=s.insert(t.key,t.mutableCopy()))}return O.resolve(s)}getAllFromCollectionGroup(e,t,r,n){k()}qr(e,t){return O.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new OT(this)}getSize(e){return O.resolve(this.size)}}class OT extends mT{constructor(e){super(),this.Ir=e}applyChanges(r){let n=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?n.push(this.Ir.addEntry(r,t)):this.Ir.removeEntry(e)}),O.waitFor(n)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class LT{constructor(e){this.persistence=e,this.Qr=new bw(e=>ew(e),tw),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.$r=0,this.Kr=new RT,this.targetCount=0,this.Ur=nT.Kn()}forEachTarget(e,r){return this.Qr.forEach((e,t)=>r(t)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),O.resolve()}zn(e){this.Qr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ur=new nT(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.zn(t),O.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),--this.targetCount,O.resolve()}removeTargets(r,n,i){let s=0,a=[];return this.Qr.forEach((e,t)=>{t.sequenceNumber<=n&&null===i.get(t.targetId)&&(this.Qr.delete(e),a.push(this.removeMatchingKeysForTargetId(r,t.targetId)),s++)}),O.waitFor(a).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){var r=this.Qr.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this.Kr.yr(t,r),O.resolve()}removeMatchingKeys(t,e,r){this.Kr.br(e,r);let n=this.persistence.referenceDelegate,i=[];return n&&e.forEach(e=>{i.push(n.markPotentiallyOrphaned(t,e))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),O.resolve()}getMatchingKeysForTargetId(e,t){var r=this.Kr.vr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this.Kr.containsKey(t))}}class MT{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new bv(0),this.zr=!1,this.zr=!0,this.jr=new NT,this.referenceDelegate=e(this),this.Hr=new LT(this),this.indexManager=new UI,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Jr(e),new xT(e)),this.serializer=new nI(t),this.Yr=new ST(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new AT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new DT(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){C("MemoryPersistence","Starting transaction:",e);let n=new FT(this.Gr.next());return this.referenceDelegate.Zr(),r(n).next(e=>this.referenceDelegate.Xr(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}ei(t,r){return O.or(Object.values(this.Wr).map(e=>()=>e.containsKey(t,r)))}}class FT extends sv{constructor(e){super(),this.currentSequenceNumber=e}}class UT{constructor(e){this.persistence=e,this.ti=new RT,this.ni=null}static ri(e){return new UT(e)}get ii(){if(this.ni)return this.ni;throw k()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),O.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach(e=>this.ii.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.ii.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(r){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.ii,e=>{let t=x.fromPath(e);return this.si(r,t).next(e=>{e||n.removeEntry(t,P.min())})}).next(()=>(this.ni=null,n.apply(r)))}updateLimboDocument(e,t){return this.si(e,t).next(e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return O.or([()=>O.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class VT{constructor(e,t){this.persistence=e,this.oi=new bw(e=>Sv(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=pT(this,t)}static ri(e,t){return new VT(e,t)}Zr(){}Xr(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){let r=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}sr(e){let t=0;return this.rr(e,e=>{t++}).next(()=>t)}rr(r,n){return O.forEach(this.oi,(e,t)=>this.ar(r,e,t).next(e=>e?O.resolve():n(t)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,r){let n=0,t=this.persistence.getRemoteDocumentCache(),i=t.newChangeBuffer();return t.qr(e,t=>this.ar(e,t,r).next(e=>{e||(n++,i.removeEntry(t,P.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){var r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),O.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function n(e){switch(dy(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=ty(e);return t?16+n(t):16;case 5:return 2*e.stringValue.length;case 6:return Q_(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+n(t),0);case 10:case 11:{var i=e.mapValue;let r=0;return F_(i.fields,(e,t)=>{r+=e.length+n(t)}),r}default:throw k()}}(e.data.value)),t}ar(e,t,r){return O.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{var e=this.oi.get(t);return O.resolve(void 0!==e&&r<e)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class qT{constructor(e){this.serializer=e}B(t,e,r,n){let s=new lv("createOrUpgrade",e);var i;r<1&&1<=n&&(t.createObjectStore(Pv),(i=t).createObjectStore(xv,{keyPath:"userId"}),i.createObjectStore(Ov,{keyPath:Lv,autoIncrement:!0}).createIndex(Mv,Fv,{unique:!0}),i.createObjectStore(jv),jT(t),t.createObjectStore(Rv));let a=O.resolve();return r<3&&3<=n&&(0!==r&&((i=t).deleteObjectStore(Zv),i.deleteObjectStore(Yv),i.deleteObjectStore(i_),jT(t)),a=a.next(()=>{return e=s,t=e.store(i_),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0},t.put(n_,r);var e,t,r})),r<4&&4<=n&&(a=(a=0!==r?a.next(()=>{return n=t,(i=s).store(Ov).G().next(e=>{n.deleteObjectStore(Ov),n.createObjectStore(Ov,{keyPath:Lv,autoIncrement:!0}).createIndex(Mv,Fv,{unique:!0});let t=i.store(Ov),r=e.map(e=>t.put(e));return O.waitFor(r)});var n,i}):a).next(()=>{t.createObjectStore(o_,{keyPath:"clientId"})})),r<5&&5<=n&&(a=a.next(()=>this._i(s))),r<6&&6<=n&&(a=a.next(()=>(t.createObjectStore($v),this.ai(s)))),r<7&&7<=n&&(a=a.next(()=>this.ui(s))),r<8&&8<=n&&(a=a.next(()=>this.ci(t,s))),r<9&&9<=n&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&10<=n&&(a=a.next(()=>this.li(s))),r<11&&11<=n&&(a=a.next(()=>{t.createObjectStore(l_,{keyPath:"bundleId"}),t.createObjectStore(h_,{keyPath:"name"})})),r<12&&12<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(w_,{keyPath:b_})).createIndex(I_,T_,{unique:!1}),e.createIndex(E_,C_,{unique:!1})})),r<13&&13<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(Bv,{keyPath:zv})).createIndex(Kv,Wv),e.createIndex(Hv,Gv)}).next(()=>this.hi(t,s)).next(()=>t.deleteObjectStore(Rv))),r<14&&14<=n&&(a=a.next(()=>this.Pi(t,s))),r<15&&15<=n&&(a=a.next(()=>{var e;(e=t).createObjectStore(u_,{keyPath:"indexId",autoIncrement:!0}).createIndex(c_,"collectionGroup",{unique:!1}),e.createObjectStore(d_,{keyPath:p_}).createIndex(f_,g_,{unique:!1}),e.createObjectStore(m_,{keyPath:v_}).createIndex(__,y_,{unique:!1})})),r<16&&16<=n&&(a=a.next(()=>{e.objectStore(d_).clear()}).next(()=>{e.objectStore(m_).clear()})),a=r<17&&17<=n?a.next(()=>{t.createObjectStore(k_,{keyPath:"name"})}):a}ai(t){let r=0;return t.store(Rv).Z((e,t)=>{r+=JI(t)}).next(()=>{var e={byteSize:r};return t.store($v).put(Qv,e)})}_i(n){let e=n.store(xv),t=n.store(Ov);return e.G().next(e=>O.forEach(e,r=>{var e=IDBKeyRange.bound([r.userId,Iv],[r.userId,r.lastAcknowledgedBatchId]);return t.G(Mv,e).next(e=>O.forEach(e,e=>{S(e.userId===r.userId);var t=lI(this.serializer,e);return YI(n,r.userId,t).next(()=>{})}))}))}ui(e){let a=e.store(Zv),t=e.store(Rv);return e.store(i_).get(n_).next(i=>{let s=[];return t.Z((e,t)=>{let r=new D(e),n=[0,Sv(r)];s.push(a.get(n).next(e=>e?O.resolve():(e=r,a.put({targetId:0,path:Sv(e),sequenceNumber:i.highestListenSequenceNumber}))))}).next(()=>O.waitFor(s))})}ci(e,t){e.createObjectStore(s_,{keyPath:a_});let n=t.store(s_),i=new VI,s=r=>{if(i.add(r)){let e=r.lastSegment(),t=r.popLast();return n.put({collectionId:e,parent:Sv(t)})}};return t.store(Rv).Z({Y:!0},(e,t)=>{var r=new D(e);return s(r.popLast())}).next(()=>t.store(jv).Z({Y:!0},([,e],t)=>{var r=Nv(e);return s(r.popLast())}))}li(e){let n=e.store(Yv);return n.Z((e,t)=>{var r=hI(t),r=uI(this.serializer,r);return n.put(r)})}hi(e,s){let t=s.store(Rv),a=[];return t.Z((e,t)=>{var r,n=s.store(Bv),i=((r=t).document?new x(D.fromString(r.document.name).popFirst(5)):r.noDocument?x.fromSegments(r.noDocument.path):r.unknownDocument?x.fromSegments(r.unknownDocument.path):k()).path.toArray(),i={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>O.waitFor(a))}Pi(e,s){let t=s.store(Ov),a=_T(this.serializer),o=new MT(UT.ri,this.serializer.Tt);return t.G().next(e=>{let n=new Map;return e.forEach(e=>{let t,r=null!=(t=n.get(e.userId))?t:V();lI(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),O.forEach(n,(e,t)=>{var r=new Tm(t),n=_I.It(this.serializer,r),i=o.getIndexManager(r),r=XI.It(r,this.serializer,i,o.referenceDelegate);return new kT(a,r,n,i).recalculateAndSaveOverlaysForDocumentKeys(new O_(s,bv.ae),e).next()})})}}function jT(e){e.createObjectStore(Zv,{keyPath:e_}).createIndex(t_,r_,{unique:!0}),e.createObjectStore(Yv,{keyPath:"targetId"}).createIndex(Jv,Xv,{unique:!0}),e.createObjectStore(i_)}let BT="IndexedDbPersistence",zT="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class KT{constructor(e,t,r,n,i,s,a,o,l,h,u=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ti=i,this.window=s,this.document=a,this.Ii=l,this.Ei=h,this.di=u,this.Gr=null,this.zr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ai=null,this.inForeground=!1,this.Ri=null,this.Vi=null,this.mi=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!KT.D())throw new N(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fT(this,n),this.gi=t+"main",this.serializer=new nI(o),this.pi=new hv(this.gi,this.di,new qT(this.serializer)),this.jr=new wI,this.Hr=new iT(this.referenceDelegate,this.serializer),this.remoteDocumentCache=_T(this.serializer),this.Yr=new gI,this.window&&this.window.localStorage?this.yi=this.window.localStorage:(this.yi=null,!1===h&&Sm(BT,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.bi(),this.Si(),this.Di(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Hr.getHighestSequenceNumber(e));throw new N(A.FAILED_PRECONDITION,zT)}).then(e=>{this.Gr=new bv(e,this.Ii)}).then(()=>{this.zr=!0}).catch(e=>(this.pi&&this.pi.close(),Promise.reject(e)))}Ci(t){return this.fi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.pi.k(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ti.enqueueAndForget(async()=>{this.started&&await this.wi()}))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>HT(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Fi(t).next(e=>{e||(this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Mi(t)).next(e=>this.isPrimary&&!e?this.xi(t).next(()=>!1):!!e&&this.Oi(t).next(()=>!0))).catch(e=>{if(pv(e))return C(BT,"Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return C(BT,"Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.Ti.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Fi(e){return WT(e).get(Dv).next(e=>O.resolve(this.Ni(e)))}Bi(e){return HT(e).delete(this.clientId)}async Li(){if(this.isPrimary&&!this.ki(this.mi,18e5)){this.mi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=L_(e,o_);return n.G().next(e=>{let t=this.qi(e,18e5),r=e.filter(e=>-1===t.indexOf(e));return O.forEach(r,e=>n.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.yi)for(var t of e)this.yi.removeItem(this.Qi(t.clientId))}}Di(){this.Vi=this.Ti.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Li()).then(()=>this.Di()))}Ni(e){return!!e&&e.ownerId===this.clientId}Mi(t){return this.Ei?O.resolve(!0):WT(t).get(Dv).next(e=>{if(null!==e&&this.ki(e.leaseTimestampMs,5e3)&&!this.$i(e.ownerId)){if(this.Ni(e)&&this.networkEnabled)return!0;if(!this.Ni(e)){if(e.allowTabSynchronization)return!1;throw new N(A.FAILED_PRECONDITION,zT)}}return!(!this.networkEnabled||!this.inForeground)||HT(t).G().next(e=>void 0===this.qi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&C(BT,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.zr=!1,this.Ki(),this.Vi&&(this.Vi.cancel(),this.Vi=null),this.Ui(),this.Wi(),await this.pi.runTransaction("shutdown","readwrite",[Pv,o_],e=>{let t=new O_(e,bv.ae);return this.xi(t).next(()=>this.Bi(t))}),this.pi.close(),this.Gi()}qi(e,t){return e.filter(e=>this.ki(e.updateTimeMs,t)&&!this.$i(e.clientId))}zi(){return this.runTransaction("getActiveClients","readonly",e=>HT(e).G().next(e=>this.qi(e,18e5).map(e=>e.clientId)))}get started(){return this.zr}getGlobalsCache(){return this.jr}getMutationQueue(e,t){return XI.It(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new BI(e,this.serializer.Tt.databaseId)}getDocumentOverlayCache(e){return _I.It(this.serializer,e)}getBundleCache(){return this.Yr}runTransaction(t,r,n){C(BT,"Starting transaction:",t);var e,i="readonly"===r?"readonly":"readwrite",s=17===(e=this.di)?x_:16===e?D_:15===e?P_:14===e?R_:13===e?N_:12===e?A_:11===e?S_:void k();let a;return this.pi.runTransaction(t,i,s,e=>(a=new O_(e,this.Gr?this.Gr.next():bv.ae),"readwrite-primary"===r?this.Fi(a).next(e=>!!e||this.Mi(a)).next(e=>{if(e)return n(a);throw Sm(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)),new N(A.FAILED_PRECONDITION,iv)}).next(e=>this.Oi(a).next(()=>e)):this.ji(a).next(()=>n(a)))).then(e=>(a.raiseOnCommittedEvent(),e))}ji(e){return WT(e).get(Dv).next(e=>{if(null!==e&&this.ki(e.leaseTimestampMs,5e3)&&!this.$i(e.ownerId)&&!this.Ni(e)&&!(this.Ei||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(A.FAILED_PRECONDITION,zT)})}Oi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return WT(e).put(Dv,t)}static D(){return hv.D()}xi(e){let t=WT(e);return t.get(Dv).next(e=>this.Ni(e)?(C(BT,"Releasing primary lease."),t.delete(Dv)):O.resolve())}ki(e,t){var r=Date.now();return!(e<r-t||r<e&&(Sm(`Detected an update time that is in the future: ${e} > `+r),1))}bi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ri=()=>{this.Ti.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.wi()))},this.document.addEventListener("visibilitychange",this.Ri),this.inForeground="visible"===this.document.visibilityState)}Ui(){this.Ri&&(this.document.removeEventListener("visibilitychange",this.Ri),this.Ri=null)}Si(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Ai=()=>{this.Ki();var e=/(?:Version|Mobile)\/1[456]/;he()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ti.enterRestrictedMode(!0),this.Ti.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ai))}Wi(){this.Ai&&(this.window.removeEventListener("pagehide",this.Ai),this.Ai=null)}$i(e){var t;try{var r=null!==(null==(t=this.yi)?void 0:t.getItem(this.Qi(e)));return C(BT,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return Sm(BT,"Failed to get zombied client id.",e),!1}}Ki(){if(this.yi)try{this.yi.setItem(this.Qi(this.clientId),String(Date.now()))}catch(e){Sm("Failed to set zombie client id.",e)}}Gi(){if(this.yi)try{this.yi.removeItem(this.Qi(this.clientId))}catch(e){}}Qi(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function WT(e){return L_(e,Pv)}function HT(e){return L_(e,o_)}function GT(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class $T{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=n}static Yi(e,t){let r=V(),n=V();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new $T(e,t.fromCache,r,n)}}class QT{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class YT{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=he()?8:0<uv(te())?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(r,n,e,t){let i={result:null};return this.rs(r,n).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ss(r,n,t,e).next(e=>{i.result=e})}).next(()=>{if(!i.result){let t=new QT;return this._s(r,n,t).next(e=>{if(i.result=e,this.Xi)return this.us(r,n,t,e.size)})}}).next(()=>i.result)}us(e,t,r,n){return r.documentReadCount<this.es?(km()<=c.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",vw(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),O.resolve()):(km()<=c.DEBUG&&C("QueryEngine","Query:",vw(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ts*n?(km()<=c.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",vw(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dw(t))):O.resolve())}rs(i,s){if(hw(s))return O.resolve(null);let t=dw(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=fw(s,null,"F"),t=dw(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{let n=V(...e);return this.ns.getDocuments(i,n).next(r=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.cs(s,r);return this.ls(s,t,n,e.readTime)?this.rs(i,fw(s,null,"F")):this.hs(i,t,s,e)}))})))}ss(r,n,i,s){return hw(n)||s.isEqual(P.min())?O.resolve(null):this.ns.getDocuments(r,i).next(e=>{var t=this.cs(n,e);return this.ls(n,t,i,s)?O.resolve(null):(km()<=c.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),vw(n)),this.hs(r,t,n,ev(s,$m)).next(e=>e))})}cs(r,e){let n=new M(ww(r));return e.forEach((e,t)=>{_w(r,t)&&(n=n.add(t))}),n}ls(e,t,r,n){var i;return null!==e.limit&&(r.size!==t.size||!!(i="F"===e.limitType?t.last():t.first())&&(i.hasPendingWrites||0<i.version.compareTo(n)))}_s(e,t,r){return km()<=c.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",vw(t)),this.ns.getDocumentsMatchingQuery(e,t,rv.min(),r)}hs(e,r,t,n){return this.ns.getDocumentsMatchingQuery(e,t,n).next(t=>(r.forEach(e=>{t=t.insert(e.key,e)}),t))}}let JT="LocalStore",XT=3e8;class ZT{constructor(e,t,r,n){this.persistence=e,this.Ps=t,this.serializer=n,this.Ts=new L(R),this.Is=new bw(e=>ew(e),tw),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new kT(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ts))}}function eE(e,t,r,n){return new ZT(e,t,r,n)}async function tE(e,t){let o=e;return o.persistence.runTransaction("Handle user change","readonly",s=>{let a;return o.mutationQueue.getAllMutationBatches(s).next(e=>(a=e,o.As(t),o.mutationQueue.getAllMutationBatches(s))).next(e=>{let t=[],r=[],n=V();for(let i of a){t.push(i.batchId);for(let e of i.mutations)n=n.add(e.key)}for(let i of e){r.push(i.batchId);for(let e of i.mutations)n=n.add(e.key)}return o.localDocuments.getDocuments(s,n).next(e=>({Rs:e,removedBatchIds:t,addedBatchIds:r}))})})}function rE(e,n){let i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let t=n.batch.keys(),r=i.ds.newChangeBuffer({trackRemovals:!0});return((e,t,n,i)=>{let s=n.batch,r=s.keys(),a=O.resolve();return r.forEach(r=>{a=a.next(()=>i.getEntry(t,r)).next(e=>{var t=n.docVersions.get(r);S(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument())&&(e.setReadTime(n.commitVersion),i.addEntry(e))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))})(i,e,n,r).next(()=>r.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,(e=>{let t=V();for(let r=0;r<e.mutationResults.length;++r)0<e.mutationResults[r].transformResults.length&&(t=t.add(e.batch.mutations[r].key));return t})(n))).next(()=>i.localDocuments.getDocuments(e,t))})}function nE(e){let t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Hr.getLastRemoteSnapshotVersion(e))}function iE(e,h){let u=e,c=h.snapshotVersion,d=u.Ts;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let e=u.ds.newChangeBuffer({trackRemovals:!0}),l=(d=u.Ts,[]),t=(h.targetChanges.forEach((t,r)=>{var n,i,s,a=d.get(r);if(a){l.push(u.Hr.removeMatchingKeys(o,t.removedDocuments,r).next(()=>u.Hr.addMatchingKeys(o,t.addedDocuments,r)));let e=a.withSequenceNumber(o.currentSequenceNumber);null!==h.targetMismatches.get(r)?e=e.withResumeToken(W_.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,c)),d=d.insert(r,e),n=a,i=e,s=t,(0===n.resumeToken.approximateByteSize()||i.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=XT||0<s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size)&&l.push(u.Hr.updateTargetData(o,e))}}),Iw),r=V();if(h.documentUpdates.forEach(e=>{h.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),l.push(sE(o,e,h.documentUpdates).next(e=>{t=e.Vs,r=e.fs})),!c.isEqual(P.min())){let e=u.Hr.getLastRemoteSnapshotVersion(o).next(e=>u.Hr.setTargetsMetadata(o,o.currentSequenceNumber,c));l.push(e)}return O.waitFor(l).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,r)).next(()=>t)}).then(e=>(u.Ts=d,e))}function sE(e,s,t){let r=V(),a=V();return t.forEach(e=>r=r.add(e)),s.getEntries(e,r).next(n=>{let i=Iw;return t.forEach((e,t)=>{var r=n.get(e);t.isFoundDocument()!==r.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(P.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!r.isValidDocument()||0<t.version.compareTo(r.version)||0===t.version.compareTo(r.version)&&r.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):C(JT,"Ignoring outdated watch update for ",e,". Current version:",r.version," Watch version:",t.version)}),{Vs:i,fs:a}})}function aE(e,n){let i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return i.Hr.getTargetData(t,n).next(e=>e?(r=e,O.resolve(r)):i.Hr.allocateTargetId(t).next(e=>(r=new rI(n,e,"TargetPurposeListen",t.currentSequenceNumber),i.Hr.addTargetData(t,r).next(()=>r))))}).then(e=>{var t=i.Ts.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ts=i.Ts.insert(e.targetId,e),i.Is.set(n,e.targetId)),e})}async function oE(e,t,r){let n=e,i=n.Ts.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!pv(e))throw e;C(JT,`Failed to update sequence numbers for target ${t}: `+e)}n.Ts=n.Ts.remove(t),n.Is.delete(i.target)}function lE(e,a,o){let l=e,h=P.min(),u=V();return l.persistence.runTransaction("Execute query","readwrite",t=>{return e=l,r=t,n=dw(a),(void 0!==(s=(i=e).Is.get(n))?O.resolve(i.Ts.get(s)):i.Hr.getTargetData(r,n)).next(e=>{if(e)return h=e.lastLimboFreeSnapshotVersion,l.Hr.getMatchingKeysForTargetId(t,e.targetId).next(e=>{u=e})}).next(()=>l.Ps.getDocumentsMatchingQuery(t,a,o?h:P.min(),o?u:V())).next(e=>(cE(l,yw(a),e),{documents:e,gs:u}));var e,r,n,i,s})}function hE(e,t){let r=e,n=r.Hr,i=r.Ts.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.lt(e,t).next(e=>e?e.target:null))}function uE(e,t){let r=e,n=r.Es.get(t)||P.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.ds.getAllFromCollectionGroup(e,t,ev(n,$m),Number.MAX_SAFE_INTEGER)).then(e=>(cE(r,t,e),e))}function cE(e,t,r){let n=e.Es.get(t)||P.min();r.forEach((e,t)=>{0<t.readTime.compareTo(n)&&(n=t.readTime)}),e.Es.set(t,n)}let dE="firestore_clients";function pE(e,t){return dE+`_${e}_`+t}let fE="firestore_mutations";function gE(e,t,r){let n=fE+`_${e}_`+r;return t.isAuthenticated()&&(n+="_"+t.uid),n}let mE="firestore_targets";function vE(e,t){return mE+`_${e}_`+t}let _E="SharedClientState";class yE{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static bs(e,t,r){var n=JSON.parse(r);let i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new N(n.error.code,n.error.message)),s?new yE(e,t,n.state,i):(Sm(_E,`Failed to parse mutation state for ID '${t}': `+r),null)}Ss(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wE{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static bs(e,t){var r=JSON.parse(t);let n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new N(r.error.code,r.error.message)),i?new wE(e,r.state,n):(Sm(_E,`Failed to parse target state for ID '${e}': `+t),null)}Ss(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class bE{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static bs(e,t){var r=JSON.parse(t);let n="object"==typeof r&&r.activeTargetIds instanceof Array,i=Nw;for(let s=0;n&&s<r.activeTargetIds.length;++s)n=Cv(r.activeTargetIds[s]),i=i.add(r.activeTargetIds[s]);return n?new bE(e,i):(Sm(_E,`Failed to parse client data for instance '${e}': `+t),null)}}class IE{constructor(e,t){this.clientId=e,this.onlineState=t}static bs(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new IE(t.clientId,t.onlineState):(Sm(_E,"Failed to parse online state: "+e),null)}}class TE{constructor(){this.activeTargetIds=Nw}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class EE{constructor(e,t,r,n,i){this.window=e,this.Ti=t,this.persistenceKey=r,this.Cs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Fs=this.Ms.bind(this),this.xs=new L(R),this.started=!1,this.Os=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ns=pE(this.persistenceKey,this.Cs),this.Bs="firestore_sequence_number_"+this.persistenceKey,this.xs=this.xs.insert(this.Cs,new TE),this.Ls=new RegExp(`^${dE}_${s}_([^_]*)$`),this.ks=new RegExp(`^${fE}_${s}_(\\d+)(?:_(.*))?$`),this.qs=new RegExp(`^${mE}_${s}_(\\d+)$`),this.Qs="firestore_online_state_"+this.persistenceKey,this.$s="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.Fs)}static D(e){return!(!e||!e.localStorage)}async start(){let e=await this.syncEngine.zi();for(let r of e)if(r!==this.Cs){let e=this.getItem(pE(this.persistenceKey,r));var t;e&&(t=bE.bs(r,e))&&(this.xs=this.xs.insert(t.clientId,t))}this.Ks();let r=this.storage.getItem(this.Qs);if(r){let e=this.Us(r);e&&this.Ws(e)}for(let e of this.Os)this.Ms(e);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Bs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Gs(this.xs)}isActiveQueryTarget(r){let n=!1;return this.xs.forEach((e,t)=>{t.activeTargetIds.has(r)&&(n=!0)}),n}addPendingMutation(e){this.zs(e,"pending")}updateMutationState(e,t,r){this.zs(e,t,r),this.js(e)}addLocalQueryTarget(t,e=!0){let r="not-current";if(this.isActiveQueryTarget(t)){let e=this.storage.getItem(vE(this.persistenceKey,t));var n;e&&(n=wE.bs(t,e))&&(r=n.state)}return e&&this.Hs.Ds(t),this.Ks(),r}removeLocalQueryTarget(e){this.Hs.vs(e),this.Ks()}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vE(this.persistenceKey,e))}updateQueryState(e,t,r){this.Js(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.js(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Ys(e)}notifyBundleLoaded(e){this.Zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Fs),this.removeItem(this.Ns),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return C(_E,"READ",e,t),t}setItem(e,t){C(_E,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){C(_E,"REMOVE",e),this.storage.removeItem(e)}Ms(e){let t=e;t.storageArea===this.storage&&(C(_E,"EVENT",t.key,t.newValue),t.key===this.Ns?Sm("Received WebStorage notification for local change. Another client might have garbage-collected our state"):this.Ti.enqueueRetryable(async()=>{if(this.started){if(null!==t.key){if(this.Ls.test(t.key))return null==t.newValue?(e=this.Xs(t.key),this.eo(e,null)):(e=this.no(t.key,t.newValue))?this.eo(e.clientId,e):void 0;if(this.ks.test(t.key)){if(null!==t.newValue){var e=this.ro(t.key,t.newValue);if(e)return this.io(e)}}else if(this.qs.test(t.key)){if(null!==t.newValue){var e=this.so(t.key,t.newValue);if(e)return this.oo(e)}}else if(t.key===this.Qs){if(null!==t.newValue){var e=this.Us(t.newValue);if(e)return this.Ws(e)}}else t.key===this.Bs?(e=(e=>{let t=bv.ae;if(null!=e)try{var r=JSON.parse(e);S("number"==typeof r),t=r}catch(e){Sm(_E,"Failed to read sequence number from WebStorage",e)}return t})(t.newValue))!==bv.ae&&this.sequenceNumberHandler(e):t.key===this.$s&&(e=this._o(t.newValue),await Promise.all(e.map(e=>this.syncEngine.ao(e))))}}else this.Os.push(t)}))}get Hs(){return this.xs.get(this.Cs)}Ks(){this.setItem(this.Ns,this.Hs.Ss())}zs(e,t,r){var n=new yE(this.currentUser,e,t,r),i=gE(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ss())}js(e){var t=gE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ys(e){var t={clientId:this.Cs,onlineState:e};this.storage.setItem(this.Qs,JSON.stringify(t))}Js(e,t,r){var n=vE(this.persistenceKey,e),i=new wE(e,t,r);this.setItem(n,i.Ss())}Zs(e){var t=JSON.stringify(Array.from(e));this.setItem(this.$s,t)}Xs(e){var t=this.Ls.exec(e);return t?t[1]:null}no(e,t){var r=this.Xs(e);return bE.bs(r,t)}ro(e,t){var r=this.ks.exec(e),n=Number(r[1]),r=void 0!==r[2]?r[2]:null;return yE.bs(new Tm(r),n,t)}so(e,t){var r=this.qs.exec(e),r=Number(r[1]);return wE.bs(r,t)}Us(e){return IE.bs(e)}_o(e){return JSON.parse(e)}async io(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.uo(e.batchId,e.state,e.error);C(_E,"Ignoring mutation for non-active user "+e.user.uid)}oo(e){return this.syncEngine.co(e.targetId,e.state,e.error)}eo(e,t){let r=t?this.xs.insert(e,t):this.xs.remove(e),n=this.Gs(this.xs),i=this.Gs(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.lo(s,a).then(()=>{this.xs=r})}Ws(e){this.xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Gs(e){let r=Nw;return e.forEach((e,t)=>{r=r.unionWith(t.activeTargetIds)}),r}}class CE{constructor(){this.ho=new TE,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new TE,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class kE{To(e){}shutdown(){}}let SE="ConnectivityMonitor";class AE{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){C(SE,"Network connectivity changed: AVAILABLE");for(var e of this.Vo)e(0)}Ro(){C(SE,"Network connectivity changed: UNAVAILABLE");for(var e of this.Vo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let NE=null;function RE(){return null===NE?NE=268435456+Math.round(2147483648*Math.random()):NE++,"0x"+NE.toString(16)}let PE="RestConnection",DE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xE{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}let OE="WebChannelConnection";class LE extends class{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/`+n,this.wo=this.databaseId.database===iy?"project_id="+r:`project_id=${r}&database_id=`+n}bo(t,e,r,n,i){let s=RE(),a=this.So(t,e.toUriEncodedString());C(PE,`Sending RPC '${t}' ${s}:`,a,r);var o={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(o,n,i),this.vo(t,a,o,r).then(e=>(C(PE,`Received RPC '${t}' ${s}: `,e),e),e=>{throw Am(PE,`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",r),e})}Co(e,t,r,n,i,s){return this.bo(e,t,r,n,i)}Do(r,e,t){r["X-Goog-Api-Client"]="gl-js/ fire/"+Em,r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>r[t]=e),t&&t.headers.forEach((e,t)=>r[t]=e)}So(e,t){var r=DE[e];return this.po+`/v1/${t}:`+r}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(l,t,r,n){let h=RE();return new Promise((s,a)=>{let o=new um;o.setWithCredentials(!0),o.listenOnce(dm.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case pm.NO_ERROR:var e=o.getResponseJson();C(OE,`XHR for RPC '${l}' ${h} received:`,JSON.stringify(e)),s(e);break;case pm.TIMEOUT:C(OE,`RPC '${l}' ${h} timed out`),a(new N(A.DEADLINE_EXCEEDED,"Request time out"));break;case pm.HTTP_ERROR:var t=o.getStatus();if(C(OE,`RPC '${l}' ${h} failed with status:`,t,"response text:",o.getResponseText()),0<t){let e=o.getResponseJson();var r=null==(e=Array.isArray(e)?e[0]:e)?void 0:e.error;if(r&&r.status&&r.message){n=r.status,i=n.toLowerCase().replace(/_/g,"-");let e=0<=Object.values(A).indexOf(i)?i:A.UNKNOWN;a(new N(e,r.message))}else a(new N(A.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new N(A.UNAVAILABLE,"Connection failed."));break;default:k()}}finally{C(OE,`RPC '${l}' ${h} completed.`)}var n,i});var e=JSON.stringify(n);C(OE,`RPC '${l}' ${h} sending request:`,n),o.send(t,"POST",e,r,15)})}Wo(i,e,t){let s=RE(),r=[this.po,"/","google.firestore.v1.Firestore","/",i,"/channel"],n=vm(),a=mm(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Do(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var h=r.join("");C(OE,`Creating RPC '${i}' stream ${s}: `+h,o);let u=n.createWebChannel(h,o),c=!1,d=!1,p=new xE({Fo:e=>{d?C(OE,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(c||(C(OE,`Opening RPC '${i}' stream ${s} transport.`),u.open(),c=!0),C(OE,`RPC '${i}' stream ${s} sending:`,e),u.send(e))},Mo:()=>u.close()}),f=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(u,cm.EventType.OPEN,()=>{d||(C(OE,`RPC '${i}' stream ${s} transport opened.`),p.Qo())}),f(u,cm.EventType.CLOSE,()=>{d||(d=!0,C(OE,`RPC '${i}' stream ${s} transport closed`),p.Ko())}),f(u,cm.EventType.ERROR,e=>{d||(d=!0,Am(OE,`RPC '${i}' stream ${s} transport errored:`,e),p.Ko(new N(A.UNAVAILABLE,"The operation could not be completed")))}),f(u,cm.EventType.MESSAGE,e=>{if(!d){var t=e.data[0],n=(S(!!t),t),n=(null==n?void 0:n.error)||(null==(n=n[0])?void 0:n.error);if(n){C(OE,`RPC '${i}' stream ${s} received error:`,n);let e=n.status,t=(e=>{var t=_m[e];if(void 0!==t)return hb(t)})(e),r=n.message;void 0===t&&(t=A.INTERNAL,r="Unknown error status: "+e+" with message "+n.message),d=!0,p.Ko(new N(t,r)),u.close()}else C(OE,`RPC '${i}' stream ${s} received:`,t),p.Uo(t)}}),f(a,gm.STAT_EVENT,e=>{e.stat===fm.PROXY?C(OE,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===fm.NOPROXY&&C(OE,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.$o()},0),p}}function ME(){return"undefined"!=typeof window?window:null}function FE(){return"undefined"!=typeof document?document:null}function UE(e){return new Ab(e,!0)}class VE{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=n,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();var t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),n=Math.max(0,t-r);0<n&&C("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,n,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}let qE="PersistentStream";class jE{constructor(e,t,r,n,i,s,a,o){this.Ti=e,this.n_=r,this.r_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new VE(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===A.RESOURCE_EXHAUSTED?(Sm(t.toString()),Sm("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===A.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;let e=this.R_(this.i_),r=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.i_===r&&this.V_(e,t)},t=>{e(()=>{var e=new N(A.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)})})}V_(e,t){let r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(e=>{r(()=>this.m_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.__?this.g_(e):this.onNext(e))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return C(qE,"close with error: "+e),this.stream=null,this.close(4,e)}R_(t){return e=>{this.Ti.enqueueAndForget(()=>this.i_===t?e():(C(qE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class BE extends jE{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();var t=((e,t)=>{let r;if("targetChange"in t){t.targetChange;var n="NO_CHANGE"===(l=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:k(),i=t.targetChange.targetIds||[],s=(l=t.targetChange.resumeToken,e.useProto3Json?(S(void 0===l||"string"==typeof l),W_.fromBase64String(l||"")):(S(void 0===l||l instanceof Buffer||l instanceof Uint8Array),W_.fromUint8Array(l||new Uint8Array))),a=t.targetChange.cause,a=a&&(a=void 0===(l=a).code?A.UNKNOWN:hb(l.code),new N(a,l.message||""));r=new wb(n,i,s,a||null)}else if("documentChange"in t){t.documentChange;var n=t.documentChange,i=(n.document,n.document.name,n.document.updateTime,Fb(e,n.document.name)),s=Db(n.document.updateTime),a=n.document.createTime?Db(n.document.createTime):P.min(),o=new Py({mapValue:{fields:n.document.fields}}),i=Dy.newFoundDocument(i,s,a,o),s=n.targetIds||[],o=n.removedTargetIds||[];r=new _b(s,o,i.key,i)}else if("documentDelete"in t){t.documentDelete;n=t.documentDelete,s=(n.document,Fb(e,n.document)),o=n.readTime?Db(n.readTime):P.min(),i=Dy.newNoDocument(s,o),s=n.removedTargetIds||[];r=new _b([],s,i.key,i)}else if("documentRemove"in t){t.documentRemove;o=t.documentRemove,n=(o.document,Fb(e,o.document)),s=o.removedTargetIds||[];r=new _b([],s,n,null)}else{if(!("filter"in t))return k();{t.filter;let e=t.filter;e.targetId;var{count:i=0,unchangedNames:o}=e,s=new ob(i,o),n=e.targetId;r=new yb(n,s)}}var l;return r})(this.serializer,e),r="targetChange"in(e=e)&&(!(r=e.targetChange).targetIds||!r.targetIds.length)&&r.readTime?Db(r.readTime):P.min();return this.listener.p_(t,r)}y_(e){var t={},r=(t.database=qb(this.serializer),t.addTarget=((t,r)=>{var n;let e=r.target;if((n=rw(e)?{documents:Gb(t,e)}:{query:$b(t,e).ht}).targetId=r.targetId,0<r.resumeToken.approximateByteSize()){n.resumeToken=Pb(t,r.resumeToken);let e=Nb(t,r.expectedCount);null!==e&&(n.expectedCount=e)}else if(0<r.snapshotVersion.compareTo(P.min())){n.readTime=Rb(t,r.snapshotVersion.toTimestamp());let e=Nb(t,r.expectedCount);null!==e&&(n.expectedCount=e)}return n})(this.serializer,e),Yb(this.serializer,e));r&&(t.labels=r),this.I_(t)}w_(e){var t={};t.database=qb(this.serializer),t.removeTarget=e,this.I_(t)}}class zE extends jE{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get b_(){return 0<this.__}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return S(!!e.streamToken),this.lastStreamToken=e.streamToken,S(!e.writeResults||0===e.writeResults.length),this.listener.D_()}onNext(e){S(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();var t=Hb(e.writeResults,e.commitTime),r=Db(e.commitTime);return this.listener.v_(r,t)}C_(){var e={};e.database=qb(this.serializer),this.I_(e)}S_(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>Kb(this.serializer,e))};this.I_(t)}}class KE extends class{}{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.F_=!1}M_(){if(this.F_)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.")}bo(r,n,i,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.bo(r,Ob(n,i),s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(A.UNKNOWN,e.toString())})}Co(r,n,i,s,a){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Co(r,Ob(n,i),s,e,t,a)).catch(e=>{throw"FirebaseError"===e.name?(e.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new N(A.UNKNOWN,e.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class WE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,1<=this.x_&&(this.Q_(),this.k_("Connection failed 1 times. Most recent error: "+e.toString()),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){var t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Sm(t),this.N_=!1):C("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}let HE="RemoteStore";class GE{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(e=>{r.enqueueAndForget(async()=>{var e;r0(this)&&(C(HE,"Restarting streams for network reachability change."),(e=this).W_.add(4),await QE(e),e.j_.set("Unknown"),e.W_.delete(4),await $E(e))})}),this.j_=new WE(r,n)}}async function $E(e){if(r0(e))for(var t of e.G_)await t(!0)}async function QE(e){for(var t of e.G_)await t(!1)}function YE(e,t){var r=e;r.U_.has(t.targetId)||(r.U_.set(t.targetId,t),t0(r)?e0(r):c0(r).c_()&&XE(r,t))}function JE(e,t){var r=e,n=c0(r);r.U_.delete(t),n.c_()&&ZE(r,t),0===r.U_.size&&(n.c_()?n.P_():r0(r)&&r.j_.set("Unknown"))}function XE(e,t){var r;e.H_.Ne(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(P.min()))&&(r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(r)),c0(e).y_(t)}function ZE(e,t){e.H_.Ne(t),c0(e).w_(t)}function e0(t){t.H_=new Ib({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.U_.get(e)||null,it:()=>t.datastore.serializer.databaseId}),c0(t).start(),t.j_.B_()}function t0(e){return r0(e)&&!c0(e).u_()&&0<e.U_.size}function r0(e){return 0===e.W_.size}function n0(e){e.H_=void 0}async function i0(e,t,r){if(!pv(t))throw t;e.W_.add(1),await QE(e),e.j_.set("Offline"),r=r||(()=>nE(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{C(HE,"Retrying IndexedDB access"),await r(),e.W_.delete(1),await $E(e)})}function s0(t,r){return r().catch(e=>i0(t,e,r))}async function a0(e){var t,r,n,i,s=e,a=d0(s);let o=0<s.K_.length?s.K_[s.K_.length-1].batchId:Iv;for(;r0(i=s)&&i.K_.length<10;)try{let e=await((e,t)=>{let r=e;return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=Iv),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))})(s.localStore,o);if(null===e){0===s.K_.length&&a.P_();break}o=e.batchId,t=s,r=e,n=void 0,t.K_.push(r),(n=d0(t)).c_()&&n.b_&&n.S_(r.mutations)}catch(e){await i0(s,e)}o0(s)&&l0(s)}function o0(e){return r0(e)&&!d0(e).u_()&&0<e.K_.length}function l0(e){d0(e).start()}async function h0(e,t){var r=e,n=(r.asyncQueue.verifyOperationInProgress(),C(HE,"RemoteStore received new credentials"),r0(r));r.W_.add(3),await QE(r),n&&r.j_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.W_.delete(3),await $E(r)}async function u0(e,t){var r=e;t?(r.W_.delete(2),await $E(r)):(r.W_.add(2),await QE(r),r.j_.set("Unknown"))}function c0(t){return t.J_||(t.J_=(e=t.datastore,r=t.asyncQueue,n={xo:(async function(e){e.j_.set("Online")}).bind(null,t),No:(async function(r){r.U_.forEach((e,t)=>{XE(r,e)})}).bind(null,t),Lo:(async function(e,t){n0(e),t0(e)?(e.j_.q_(t),e0(e)):e.j_.set("Unknown")}).bind(null,t),p_:(async function(t,e,r){if(t.j_.set("Online"),e instanceof wb&&2===e.state&&e.cause)try{var n,i=t,s=e,a=s.cause;for(n of s.targetIds)i.U_.has(n)&&(await i.remoteSyncer.rejectListen(n,a),i.U_.delete(n),i.H_.removeTarget(n))}catch(r){C(HE,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await i0(t,r)}else if(e instanceof _b?t.H_.We(e):e instanceof yb?t.H_.Ze(e):t.H_.je(e),!r.isEqual(P.min()))try{let e=await nE(t.localStore);0<=r.compareTo(e)&&(l=r,(h=(o=t).H_.ot(l)).targetChanges.forEach((e,t)=>{var r;0<e.resumeToken.approximateByteSize()&&(r=o.U_.get(t))&&o.U_.set(t,r.withResumeToken(e.resumeToken,l))}),h.targetMismatches.forEach((e,t)=>{var r=o.U_.get(e);r&&(o.U_.set(e,r.withResumeToken(W_.EMPTY_BYTE_STRING,r.snapshotVersion)),ZE(o,e),r=new rI(r.target,e,t,r.sequenceNumber),XE(o,r))}),await o.remoteSyncer.applyRemoteEvent(h))}catch(e){C(HE,"Failed to raise snapshot:",e),await i0(t,e)}var o,l,h}).bind(null,t)},(i=e).M_(),new BE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)),t.G_.push(async e=>{e?(t.J_.h_(),t0(t)?e0(t):t.j_.set("Unknown")):(await t.J_.stop(),n0(t))})),t.J_;var e,r,n,i}function d0(t){return t.Y_||(t.Y_=(e=t.datastore,r=t.asyncQueue,n={xo:()=>Promise.resolve(),No:(async function(e){d0(e).C_()}).bind(null,t),Lo:(async function(e,t){if(t&&d0(e).b_){var r=e,n=t;if(lb(t=n.code)&&t!==A.ABORTED){let e=r.K_.shift();d0(r).h_(),await s0(r,()=>r.remoteSyncer.rejectFailedWrite(e.batchId,n)),await a0(r)}await 0}o0(e)&&l0(e)}).bind(null,t),D_:(async function(e){var t,r=d0(e);for(t of e.K_)r.S_(t.mutations)}).bind(null,t),v_:(async function(e,t,r){let n=e.K_.shift(),i=sb.from(n,t,r);await s0(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await a0(e)}).bind(null,t)},(i=e).M_(),new zE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)),t.G_.push(async e=>{e?(t.Y_.h_(),await a0(t)):(await t.Y_.stop(),0<t.K_.length&&(C(HE,`Stopping write stream with ${t.K_.length} pending writes`),t.K_=[]))})),t.Y_;var e,r,n,i}class p0{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new Rm,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){var s=Date.now()+r,s=new p0(e,t,s,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new N(A.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function f0(e,t){if(Sm("AsyncQueue",t+": "+e),pv(e))return new N(A.UNAVAILABLE,t+": "+e);throw e}class g0{static emptySet(e){return new g0(e.comparator)}constructor(r){this.comparator=r?(e,t)=>r(e,t)||x.comparator(e.key,t.key):(e,t)=>x.comparator(e.key,t.key),this.keyedMap=Ew(),this.sortedSet=new L(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(r){this.sortedSet.inorderTraversal((e,t)=>(r(e),!1))}add(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof g0))return!1;if(this.size!==e.size)return!1;for(var r=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();r.hasNext();){let e=r.getNext().key,t=n.getNext().key;if(!e.isEqual(t))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){var r=new g0;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class m0{constructor(){this.Z_=new L(x.comparator)}track(e){var t=e.doc.key,r=this.Z_.get(t);!r||0!==e.type&&3===r.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==r.type?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Z_=this.Z_.remove(t):1===e.type&&2===r.type?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):k()}X_(){let r=[];return this.Z_.inorderTraversal((e,t)=>{r.push(t)}),r}}class v0{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new v0(e,t,g0.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&gw(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(t[n].type!==r[n].type||!t[n].doc.isEqual(r[n].doc))return!1;return!0}}class _0{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class y0{constructor(){this.queries=w0(),this.onlineState="Unknown",this.ia=new Set}terminate(){var e,r,t,n;e=this,r=new N(A.ABORTED,"Firestore shutting down"),n=(t=e).queries,t.queries=w0(),n.forEach((e,t)=>{for(let e of t.ta)e.onError(r)})}}function w0(){return new bw(e=>mw(e),gw)}async function b0(t,r){let e=t,n=3;var i=r.query;let s=e.queries.get(i);s?!s.na()&&r.ra()&&(n=2):(s=new _0,n=r.ra()?0:1);try{switch(n){case 0:s.ea=await e.onListen(i,!0);break;case 1:s.ea=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(t){let e=f0(t,`Initialization of query '${vw(r.query)}' failed`);return void r.onError(e)}e.queries.set(i,s),s.ta.push(r),r.sa(e.onlineState),s.ea&&r.oa(s.ea)&&T0(e)}async function I0(e,t){var r=e,n=t.query;let i=3;var s=r.queries.get(n);if(s){let e=s.ta.indexOf(t);0<=e&&(s.ta.splice(e,1),0===s.ta.length?i=t.ra()?0:1:!s.na()&&t.ra()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function T0(e){e.ia.forEach(e=>{e.next()})}(ym=ym||{})._a="default",ym.Cache="cache";class E0{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(t){if(!this.options.includeMetadataChanges){let e=[];for(var r of t.docChanges)3!==r.type&&e.push(r);t=new v0(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ua?this.la(t)&&(this.aa.next(t),e=!0):this.ha(t,this.onlineState)&&(this.Pa(t),e=!0),this.ca=t,e}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){return!e.fromCache||!this.ra()||(!this.options.Ta||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){var t;return 0<e.docChanges.length||(t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites,!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges)}Pa(e){e=v0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==ym.Cache}}class C0{constructor(e,t){this.Ia=e,this.byteLength=t}Ea(){return"metadata"in this.Ia}}class k0{constructor(e){this.serializer=e}ps(e){return Fb(this.serializer,e)}ys(e){return e.metadata.exists?zb(this.serializer,e.document,!1):Dy.newNoDocument(this.ps(e.metadata.name),this.ws(e.metadata.readTime))}ws(e){return Db(e)}}class S0{constructor(e,t,r){this.da=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=A0(e)}Aa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;var r;return e.Ia.namedQuery?this.queries.push(e.Ia.namedQuery):e.Ia.documentMetadata?(this.documents.push({metadata:e.Ia.documentMetadata}),e.Ia.documentMetadata.exists||++t,r=D.fromString(e.Ia.documentMetadata.name),this.collectionGroups.add(r.get(r.length-2))):e.Ia.document&&(this.documents[this.documents.length-1].document=e.Ia.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ra(e){let r=new Map,n=new k0(this.serializer);for(var i of e)if(i.metadata.queries){let e=n.ps(i.metadata.name);for(let t of i.metadata.queries){var s=(r.get(t)||V()).add(e);r.set(t,s)}}return r}async complete(){let e=await(async(r,n,e,t)=>{let i=r,s=V(),a=Iw;for(let r of e){let e=n.ps(r.metadata.name),t=(r.document&&(s=s.add(e)),n.ys(r));t.setReadTime(n.ws(r.metadata.readTime)),a=a.insert(e,t)}let o=i.ds.newChangeBuffer({trackRemovals:!0}),l=await aE(i,(r=t,dw(lw(D.fromString("__bundle__/docs/"+r)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>sE(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Hr.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.Hr.addMatchingKeys(t,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Vs,e.fs)).next(()=>e.Vs)))})(this.localStore,new k0(this.serializer),this.documents,this.da.id),t=this.Ra(this.documents);for(let e of this.queries)await(async(e,r,n=V())=>{let i=await aE(e,dw(cI(r.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=Db(r.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.Yr.saveNamedQuery(e,r):(t=i.withResumeToken(W_.EMPTY_BYTE_STRING,t),s.Ts=s.Ts.insert(t.targetId,t),s.Hr.updateTargetData(e,t).next(()=>s.Hr.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Hr.addMatchingKeys(e,n,i.targetId)).next(()=>s.Yr.saveNamedQuery(e,r)))})})(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Va:this.collectionGroups,ma:e}}}function A0(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class N0{constructor(e){this.key=e}}class R0{constructor(e){this.key=e}}class P0{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=V(),this.mutatedKeys=V(),this.ya=ww(e),this.wa=new g0(this.ya)}get ba(){return this.fa}Sa(e,t){let o=t?t.Da:new m0,l=(t||this).wa,h=(t||this).mutatedKeys,u=l,c=!1,d="F"===this.query.limitType&&l.size===this.query.limit?l.last():null,p="L"===this.query.limitType&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((e,t)=>{var r=l.get(e),n=_w(this.query,t)?t:null,i=!!r&&this.mutatedKeys.has(r.key),s=!!n&&(n.hasLocalMutations||this.mutatedKeys.has(n.key)&&n.hasCommittedMutations);let a=!1;r&&n?r.data.isEqual(n.data)?i!==s&&(o.track({type:3,doc:n}),a=!0):!this.va(r,n)&&(o.track({type:2,doc:n}),a=!0,d&&0<this.ya(n,d)||p&&this.ya(n,p)<0)&&(c=!0):!r&&n?(o.track({type:0,doc:n}),a=!0):r&&!n&&(o.track({type:1,doc:r}),a=!0,d||p)&&(c=!0),a&&(h=n?(u=u.add(n),s?h.add(e):h.delete(e)):(u=u.delete(e),h.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){let e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),h=h.delete(e.key),o.track({type:1,doc:e})}return{wa:u,Da:o,ls:c,mutatedKeys:h}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){var i=this.wa,s=(this.wa=e.wa,this.mutatedKeys=e.mutatedKeys,e.Da.X_()),a=(s.sort((e,t)=>{return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return k()}})(r)-i(n)||this.ya(e.doc,t.doc);var r,n,i}),this.Ca(r),n=null!=n&&n,t&&!n?this.Fa():[]),o=0===this.pa.size&&this.current&&!n?1:0,l=o!==this.ga;return this.ga=o,0!==s.length||l?{snapshot:new v0(this.query,e.wa,i,s,e.mutatedKeys,0==o,l,!1,!!r&&0<r.resumeToken.approximateByteSize()),Ma:a}:{Ma:a}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new m0,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(e=>this.fa=this.fa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.fa=this.fa.delete(e)),this.current=e.current)}Fa(){if(!this.current)return[];let t=this.pa,r=(this.pa=V(),this.wa.forEach(e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))}),[]);return t.forEach(e=>{this.pa.has(e)||r.push(new R0(e))}),this.pa.forEach(e=>{t.has(e)||r.push(new N0(e))}),r}Oa(e){this.fa=e.gs,this.pa=V();var t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return v0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}let D0="SyncEngine";class x0{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class O0{constructor(e){this.key=e,this.Ba=!1}}class L0{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.La={},this.ka=new bw(e=>mw(e),gw),this.qa=new Map,this.Qa=new Set,this.$a=new L(x.comparator),this.Ka=new Map,this.Ua=new RT,this.Wa={},this.Ga=new Map,this.za=nT.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function M0(e,t,r,n){var i=await aE(e.localStore,dw(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,r);let o;return n&&(o=await F0(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&r&&YE(e.remoteStore,i),o}async function F0(n,e,t,r,i){n.Ha=(e,t,r)=>(async(e,t,r,n)=>{let i=t.view.Sa(r);i.ls&&(i=await lE(e.localStore,t.query,!1).then(({documents:e})=>t.view.Sa(e,i)));var s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),s=t.view.applyChanges(i,e.isPrimaryClient,s,a);return G0(e,t.targetId,s.Ma),s.snapshot})(n,e,t,r);var s=await lE(n.localStore,e,!0),a=new P0(e,s.gs),s=a.Sa(s.documents),o=vb.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),s=a.applyChanges(s,n.isPrimaryClient,o),o=(G0(n,t,s.Ma),new x0(e,t,a));return n.ka.set(e,o),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),s.snapshot}async function U0(t,e,r){var n=eC(t);try{let t=await((e,i)=>{let s=e,a=zm.now(),o=i.reduce((e,t)=>e.add(t.key),V()),l,h;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=Iw,r=V();return s.ds.getEntries(n,o).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{l=e;var t=[];for(let r of i){let e=((e,r)=>{let n=null;for(var i of e.fieldTransforms){let e=r.data.field(i.field),t=Ow(i.transform,e||null);null!=t&&(n=null===n?Py.empty():n).set(i.field,t)}return n||null})(r,l.get(r.key).overlayedDocument);null!=e&&t.push(new Xw(r.key,e,function i(e){let s=[];return F_(e.fields,(e,r)=>{var n=new Gm([e]);if(Ey(r)){let t=i(r.mapValue).fields;if(0===t.length)s.push(n);else for(let e of t)s.push(n.child(e))}else s.push(n)}),new z_(s)}(e.value.mapValue),Ww.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(h=e).applyToLocalDocumentSet(l,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:h.batchId,changes:Cw(l)}))})(n.localStore,e);n.sharedClientState.addPendingMutation(t.batchId);{var i=n;var s=t.batchId;var a=r;let e=i.Wa[i.currentUser.toKey()];e=(e=e||new L(R)).insert(s,a),i.Wa[i.currentUser.toKey()]=e}await Q0(n,t.changes),await a0(n.remoteStore)}catch(t){let e=f0(t,"Failed to persist write");r.reject(e)}}async function V0(e,t){let n=e;try{let e=await iE(n.localStore,t);t.targetChanges.forEach((e,t)=>{var r=n.Ka.get(t);r&&(S(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?r.Ba=!0:0<e.modifiedDocuments.size?S(r.Ba):0<e.removedDocuments.size&&(S(r.Ba),r.Ba=!1))}),await Q0(n,e,t)}catch(e){await av(e)}}function q0(e,i,t){var s=e;if(s.isPrimaryClient&&0===t||!s.isPrimaryClient&&1===t){let n=[];s.ka.forEach((e,t)=>{var r=t.view.sa(i);r.snapshot&&n.push(r.snapshot)});{t=s.eventManager;var a=i;var o=t;o.onlineState=a;let r=!1;o.queries.forEach((e,t)=>{for(let e of t.ta)e.sa(a)&&(r=!0)}),r&&T0(o)}n.length&&s.La.p_(n),s.onlineState=i,s.isPrimaryClient&&s.sharedClientState.setOnlineState(i)}}async function j0(e,t,r){var n=e;try{let e=await((e,n)=>{let i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return i.mutationQueue.lookupMutationBatch(t,n).next(e=>(S(null!==e),r=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,r,n)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>i.localDocuments.getDocuments(t,r))})})(n.localStore,t);K0(n,t,r),z0(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await Q0(n,e)}catch(r){await av(r)}}async function B0(t,r){let n=t;r0(n.remoteStore)||C(D0,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await(e=>{let t=e;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))})(n.localStore);var i;e===Iv?r.resolve():((i=n.Ga.get(e)||[]).push(r),n.Ga.set(e,i))}catch(t){let e=f0(t,"Initialization of waitForPendingWrites() operation failed");r.reject(e)}}function z0(e,t){(e.Ga.get(t)||[]).forEach(e=>{e.resolve()}),e.Ga.delete(t)}function K0(e,t,r){var n=e;let i=n.Wa[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.Wa[n.currentUser.toKey()]=i}}function W0(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(var n of t.qa.get(e))t.ka.delete(n),r&&t.La.Ja(n,r);t.qa.delete(e),t.isPrimaryClient&&t.Ua.Sr(e).forEach(e=>{t.Ua.containsKey(e)||H0(t,e)})}function H0(e,t){e.Qa.delete(t.path.canonicalString());var r=e.$a.get(t);null!==r&&(JE(e.remoteStore,r),e.$a=e.$a.remove(t),e.Ka.delete(r),$0(e))}function G0(e,t,r){for(var n of r)n instanceof N0?(e.Ua.addReference(n.key,t),i=e,s=n,o=a=void 0,a=s.key,o=a.path.canonicalString(),i.$a.get(a)||i.Qa.has(o)||(C(D0,"New document in limbo: "+a),i.Qa.add(o),$0(i))):n instanceof R0?(C(D0,"Document no longer in limbo: "+n.key),e.Ua.removeReference(n.key,t),e.Ua.containsKey(n.key)||H0(e,n.key)):k();var i,s,a,o}function $0(e){for(;0<e.Qa.size&&e.$a.size<e.maxConcurrentLimboResolutions;){var t=e.Qa.values().next().value,t=(e.Qa.delete(t),new x(D.fromString(t))),r=e.za.next();e.Ka.set(r,new O0(t)),e.$a=e.$a.insert(t,r),YE(e.remoteStore,new rI(dw(lw(t.path)),r,"TargetPurposeLimboResolution",bv.ae))}}async function Q0(e,t,i){let s=e,a=[],o=[],r=[];if(!s.ka.isEmpty()){s.ka.forEach((e,n)=>{r.push(s.Ha(n,t,i).then(t=>{var r;if((t||i)&&s.isPrimaryClient){let e=t?!t.fromCache:null==(r=null==i?void 0:i.targetChanges.get(n.targetId))?void 0:r.current;s.sharedClientState.updateQueryState(n.targetId,e?"current":"not-current")}if(t){a.push(t);let e=$T.Yi(n.targetId,t);o.push(e)}}))}),await Promise.all(r),s.La.p_(a);{var n=s.localStore,l=o;let i=n;try{await i.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>O.forEach(l,t=>O.forEach(t.Hi,e=>i.persistence.referenceDelegate.addReference(r,t.targetId,e)).next(()=>O.forEach(t.Ji,e=>i.persistence.referenceDelegate.removeReference(r,t.targetId,e)))))}catch(n){if(!pv(n))throw n;C(JT,"Failed to update sequence numbers: "+n)}for(let e of l){let n=e.targetId;if(!e.fromCache){let e=i.Ts.get(n),t=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(t);i.Ts=i.Ts.insert(n,r)}}}}}async function Y0(e,t,r,n){var i=e,s=await((e,r)=>{let n=e,i=n.mutationQueue;return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Ln(t,r).next(e=>e?n.localDocuments.getDocuments(t,e):O.resolve(null)))})(i.localStore,t);null!==s?("pending"===r?await a0(i.remoteStore):"acknowledged"===r||"rejected"===r?(K0(i,t,n||null),z0(i,t),i.localStore.mutationQueue.qn(t)):k(),await Q0(i,s)):C(D0,"Cannot apply mutation batch with id: "+t)}async function J0(r,e){var n,i,s,a=r,o=[],l=[];for(let r of e){let t,e=a.qa.get(r);if(e&&0!==e.length){t=await aE(a.localStore,dw(e[0]));for(let r of e){let e=a.ka.get(r),t=(n=e,s=i=void 0,s=await lE((i=a).localStore,n.query,!0),s=n.view.Oa(s),i.isPrimaryClient&&G0(i,n.targetId,s.Ma),await s);t.snapshot&&l.push(t.snapshot)}}else{let e=await hE(a.localStore,r);t=await aE(a.localStore,e),await F0(a,X0(e),r,!1,t.resumeToken)}o.push(t)}return a.La.p_(l),o}function X0(e){return ow(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Z0(e){var t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=V0.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){let n=e,r=n.Ka.get(t);if(r&&r.Ba)return V().add(r.key);{let r=V(),e=n.qa.get(t);if(e)for(let t of e){let e=n.ka.get(t);r=r.unionWith(e.view.ba)}return r}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,n,t){let i=e,r=(i.sharedClientState.updateQueryState(n,"rejected",t),i.Ka.get(n)),s=r&&r.key;if(s){let e=new L(x.comparator),t=(e=e.insert(s,Dy.newNoDocument(s,P.min())),V().add(s)),r=new mb(P.min(),new Map,new L(R),e,t);await V0(i,r),i.$a=i.$a.remove(s),i.Ka.delete(n),$0(i)}else await oE(i.localStore,n,!1).then(()=>W0(i,n,t)).catch(av)}).bind(null,t),t.La.p_=(function(r,e){var n=r;let i=!1;for(let r of e){let e=r.query,t=n.queries.get(e);if(t){for(let e of t.ta)e.oa(r)&&(i=!0);t.ea=r}}i&&T0(n)}).bind(null,t.eventManager),t.La.Ja=(function(e,t,r){var n=e,i=n.queries.get(t);if(i)for(let e of i.ta)e.onError(r);n.queries.delete(t)}).bind(null,t.eventManager),t}function eC(e){var t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=(async function(e,t){var r=e,n=t.batch.batchId;try{let e=await rE(r.localStore,t);K0(r,n,null),z0(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await Q0(r,e)}catch(e){await av(e)}}).bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=j0.bind(null,t),t}function tC(e,t,r){let n=e;(async(e,r,n)=>{try{var i=await r.getMetadata();if(await((e,t)=>{let r=e,n=Db(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Yr.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(n))})(e.localStore,i))return await r.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(A0(i));var s=new S0(i,e.localStore,r.serializer);let t=await r.Ya();for(;t;){let e=await s.Aa(t);e&&n._updateProgress(e),t=await r.Ya()}var a=await s.complete();return await Q0(e,a.ma,void 0),await((e,t)=>{let r=e;return r.persistence.runTransaction("Save bundle","readwrite",e=>r.Yr.saveBundleMetadata(e,t))})(e.localStore,i),n._completeWith(a.progress),Promise.resolve(a.Va)}catch(e){return Am(D0,"Loading bundle failed with "+e),n._failWith(e),Promise.resolve(new Set)}})(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}class rC{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=UE(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return eE(this.persistence,new YT,e.initialUser,this.serializer)}Xa(e){return new MT(UT.ri,this.serializer)}Za(e){return new CE}async terminate(){var e;null!=(e=this.gcScheduler)&&e.stop(),null!=(e=this.indexBackfillerScheduler)&&e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}rC.provider={build:()=>new rC};class nC extends rC{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){S(this.persistence.referenceDelegate instanceof VT);var r=this.persistence.referenceDelegate.garbageCollector;return new cT(r,e.asyncQueue,t)}Xa(e){let t=void 0!==this.cacheSizeBytes?QI.withCacheSize(this.cacheSizeBytes):QI.DEFAULT;return new MT(e=>VT.ri(e,t),this.serializer)}}class iC extends rC{constructor(e,t,r){super(),this.ru=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.ru.initialize(this,e),await eC(this.ru.syncEngine),await a0(this.ru.remoteStore),await this.persistence.Ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}eu(e){return eE(this.persistence,new YT,e.initialUser,this.serializer)}tu(e,t){var r=this.persistence.referenceDelegate.garbageCollector;return new cT(r,e.asyncQueue,t)}nu(e,t){var r=new wv(t,this.persistence);return new yv(e.asyncQueue,r)}Xa(e){var t=GT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?QI.withCacheSize(this.cacheSizeBytes):QI.DEFAULT;return new KT(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,ME(),FE(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Za(e){return new CE}}class sC extends iC{constructor(e,t){super(e,t,!1),this.ru=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.ru.syncEngine;this.sharedClientState instanceof EE&&(this.sharedClientState.syncEngine={uo:Y0.bind(null,t),co:(async function(e,r,n,t){var i=e;if(i.ja)C(D0,"Ignoring unexpected query state notification.");else{var s=i.qa.get(r);if(s&&0<s.length)switch(n){case"current":case"not-current":{let e=await uE(i.localStore,yw(s[0])),t=mb.createSynthesizedRemoteEventForCurrentChange(r,"current"===n,W_.EMPTY_BYTE_STRING);await Q0(i,e,t);break}case"rejected":await oE(i.localStore,r,!0),W0(i,r,t);break;default:k()}}}).bind(null,t),lo:(async function(e,t,n){let i=Z0(e);if(i.ja){for(let r of t)if(i.qa.has(r)&&i.sharedClientState.isActiveQueryTarget(r))C(D0,"Adding an already active target "+r);else{let e=await hE(i.localStore,r),t=await aE(i.localStore,e);await F0(i,X0(e),t.targetId,!1,t.resumeToken),YE(i.remoteStore,t)}for(let r of n)i.qa.has(r)&&await oE(i.localStore,r,!1).then(()=>{JE(i.remoteStore,r),W0(i,r)}).catch(av)}}).bind(null,t),zi:(function(e){return e.localStore.persistence.zi()}).bind(null,t),ao:(async function(e,t){let r=e;return uE(r.localStore,t).then(e=>Q0(r,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ci(async e=>{{var t=this.ru.syncEngine,s=e;let i=t;if(Z0(i),eC(i),!0===s&&!0!==i.ja){let e=i.sharedClientState.getAllActiveQueryTargets(),t=await J0(i,e.toArray());i.ja=!0,await u0(i.remoteStore,!0);for(let e of t)YE(i.remoteStore,e)}else if(!1===s&&!1!==i.ja){let r=[],n=Promise.resolve();i.qa.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(W0(i,t),oE(i.localStore,t,!0))),JE(i.remoteStore,t)}),await n,await J0(i,r);{s=i;let r=s;r.Ka.forEach((e,t)=>{JE(r.remoteStore,t)}),r.Ua.Dr(),r.Ka=new Map,r.$a=new L(x.comparator)}i.ja=!1,await u0(i.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Za(e){var t,r=ME();if(EE.D(r))return t=GT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),new EE(r,e.asyncQueue,t,e.clientId,e.initialUser);throw new N(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}}class aC{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>q0(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){var r,n,i=e;if(!i.currentUser.isEqual(t)){C(D0,"User change. New user:",t.toKey());let e=await tE(i.localStore,t);i.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",(r=i).Ga.forEach(e=>{e.forEach(e=>{e.reject(new N(A.CANCELLED,n))})}),r.Ga.clear(),i.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Q0(i,e.Rs)}}).bind(null,this.syncEngine),await u0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new y0}createDatastore(e){var t,r,n,i=UE(e.databaseInfo.databaseId),s=(t=e.databaseInfo,new LE(t));return t=e.authCredentials,e=e.appCheckCredentials,r=s,n=i,new KE(t,e,r,n)}createRemoteStore(e){return t=this.localStore,r=this.datastore,e=e.asyncQueue,n=e=>q0(this.syncEngine,e,0),i=new(AE.D()?AE:kE),new GE(t,r,e,n,i);var t,r,n,i}createSyncEngine(e,t){return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,e=e.maxConcurrentLimboResolutions,t=t,o=new L0(r,n,i,s,a,e),t&&(o.ja=!0),o;var r,n,i,s,a,o}async terminate(){var e,t;e=this.remoteStore,t=e,C(HE,"RemoteStore shutting down."),t.W_.add(5),await QE(t),t.z_.shutdown(),await!t.j_.set("Unknown"),null!=(t=this.datastore)&&t.terminate(),null!=(t=this.eventManager)&&t.terminate()}}function oC(t,r=10240){let n=0;return{async read(){var e;return n<t.byteLength?(e={value:t.slice(n,n+r),done:!1},n+=r,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}aC.provider={build:()=>new aC};class lC{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Sm("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class hC{constructor(e,t){this.ou=e,this.serializer=t,this.metadata=new Rm,this.buffer=new Uint8Array,this._u=new TextDecoder("utf-8"),this.au().then(e=>{e&&e.Ea()?this.metadata.resolve(e.Ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(null==e?void 0:e.Ia)))},e=>this.metadata.reject(e))}close(){return this.ou.cancel()}async getMetadata(){return this.metadata.promise}async Ya(){return await this.getMetadata(),this.au()}async au(){var e,t,r=await this.uu();return null===r?null:(t=this._u.decode(r),e=Number(t),isNaN(e)&&this.cu(`length string (${t}) is not valid number`),t=await this.lu(e),new C0(JSON.parse(t),r.length+e))}hu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async uu(){for(;this.hu()<0&&!await this.Pu(););var e,t;return 0===this.buffer.length?null:((e=this.hu())<0&&this.cu("Reached the end of bundle when a length string is expected."),t=this.buffer.slice(0,e),this.buffer=this.buffer.slice(e),t)}async lu(e){for(;this.buffer.length<e;)await this.Pu()&&this.cu("Reached the end of bundle when more is expected.");var t=this._u.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}cu(e){throw this.ou.cancel(),new Error("Invalid bundle format: "+e)}async Pu(){var e,t=await this.ou.read();return t.done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),t.done}}class uC{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw this.lastTransactionError=new N(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;var t=await(async(e,t)=>{let l=e,r={documents:t.map(e=>Mb(l.serializer,e))},n=await l.Co("BatchGetDocuments",l.serializer.databaseId,D.emptyPath(),r,t.length),h=new Map,i=(n.forEach(e=>{t=l.serializer;var t,r,n,i,s,a,o="found"in(e=e)?(r=t,S(!!(n=e).found),n.found.name,n.found.updateTime,i=Fb(r,n.found.name),s=Db(n.found.updateTime),o=n.found.createTime?Db(n.found.createTime):P.min(),a=new Py({mapValue:{fields:n.found.fields}}),Dy.newFoundDocument(i,s,o,a)):"missing"in e?(r=t,S(!!(n=e).missing),S(!!n.readTime),i=Fb(r,n.missing),s=Db(n.readTime),Dy.newNoDocument(i,s)):k();h.set(o.key.toString(),o)}),[]);return t.forEach(e=>{var t=h.get(e.toString());S(!!t),i.push(t)}),i})(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new rb(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var r=x.fromPath(t);this.mutations.push(new nb(r,this.precondition(r)))});{var r=this.datastore,n=this.mutations;let t=r,e={writes:n.map(e=>Kb(t.serializer,e))};await t.bo("Commit",t.serializer.databaseId,D.emptyPath(),e)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw k();t=P.min()}var r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(P.min())?Ww.exists(!1):Ww.updateTime(t):Ww.none()}preconditionForUpdate(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Ww.exists(!0);if(t.isEqual(P.min()))throw new N(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ww.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class cC{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.Tu=r.maxAttempts,this.a_=new VE(this.asyncQueue,"transaction_retry")}Iu(){--this.Tu,this.Eu()}Eu(){this.a_.Xo(async()=>{let t=new uC(this.datastore),e=this.du(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Au(e)}))}).catch(e=>{this.Au(e)})})}du(e){try{var t=this.updateFunction(e);return!Tv(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Au(e){0<this.Tu&&this.Ru(e)?(--this.Tu,this.asyncQueue.enqueueAndForget(()=>(this.Eu(),Promise.resolve()))):this.deferred.reject(e)}Ru(e){var t;return"FirebaseError"===e.name&&("aborted"===(t=e.code)||"failed-precondition"===t||"already-exists"===t||!lb(t))}}let dC="FirestoreClient";class pC{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=Tm.UNAUTHENTICATED,this.clientId=Vm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{C(dC,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(C(dC,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let r=new Rm;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),r.resolve()}catch(e){var t=f0(e,"Failed to shutdown persistence");r.reject(t)}}),r.promise}}async function fC(e,t){e.asyncQueue.verifyOperationInProgress(),C(dC,"Initializing OfflineComponentProvider");var r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await tE(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gC(e,r){e.asyncQueue.verifyOperationInProgress();var t=await mC(e);C(dC,"Initializing OnlineComponentProvider"),await r.initialize(t,e.configuration),e.setCredentialChangeListener(e=>h0(r.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>h0(r.remoteStore,t)),e._onlineComponents=r}async function mC(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){C(dC,"Using user provided OfflineComponentProvider");try{await fC(t,t._uninitializedComponentsProvider._offline)}catch(e){var r=e;if(!("FirebaseError"===(n=r).name?n.code===A.FAILED_PRECONDITION||n.code===A.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;Am("Error using user provided cache. Falling back to memory cache: "+r),await fC(t,new rC)}}else C(dC,"Using default OfflineComponentProvider"),await fC(t,new nC(void 0));var n;return t._offlineComponents}async function vC(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(C(dC,"Using user provided OnlineComponentProvider"),await gC(e,e._uninitializedComponentsProvider._online)):(C(dC,"Using default OnlineComponentProvider"),await gC(e,new aC))),e._onlineComponents}function _C(e){return mC(e).then(e=>e.persistence)}function yC(e){return mC(e).then(e=>e.localStore)}function wC(e){return vC(e).then(e=>e.remoteStore)}function bC(e){return vC(e).then(e=>e.syncEngine)}async function IC(e){var t=await vC(e),r=t.eventManager;return r.onListen=(async function(e,t,r=!0){var n=Z0(e);let i;var s=n.ka.get(t);return i=s?(n.sharedClientState.addLocalQueryTarget(s.targetId),s.view.Na()):await M0(n,t,r,!0)}).bind(null,t.syncEngine),r.onUnlisten=(async function(e,t,r){let n=e,i=n.ka.get(t),s=n.qa.get(i.targetId);1<s.length?(n.qa.set(i.targetId,s.filter(e=>!gw(e,t))),n.ka.delete(t)):n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await oE(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&JE(n.remoteStore,i.targetId),W0(n,i.targetId)}).catch(av)):(W0(n,i.targetId),await oE(n.localStore,i.targetId,!0))}).bind(null,t.syncEngine),r.onFirstRemoteStoreListen=(async function(e,t){await M0(Z0(e),t,!0,!1)}).bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=(async function(e,t){var r=e,n=r.ka.get(t),i=r.qa.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),JE(r.remoteStore,n.targetId))}).bind(null,t.syncEngine),r}function TC(r){return r.asyncQueue.enqueue(async()=>{var e=await _C(r),t=await wC(r);return e.setNetworkEnabled(!1),(async e=>{var t=e;t.W_.add(0),await QE(t),t.j_.set("Offline")})(t)})}function EC(e,t){let r=new Rm;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await((e,t)=>{let r=e;return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))})(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new N(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){n=f0(e,`Failed to get document '${t} from cache`);r.reject(n)}})(await yC(e),t,r)),r.promise}function CC(e,t,h={}){let u=new Rm;return e.asyncQueue.enqueueAndForget(async()=>{{var i=await IC(e),s=e.asyncQueue,a=t,o=h,l=u;let r=new lC({next:e=>{r.su(),s.enqueueAndForget(()=>I0(i,n));var t=e.docs.has(a);!t&&e.fromCache?l.reject(new N(A.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?l.reject(new N(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(e)},error:e=>l.reject(e)}),n=new E0(lw(a.path),r,{includeMetadataChanges:!0,Ta:!0});return b0(i,n)}}),u.promise}function kC(e,t){let r=new Rm;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await lE(e,t,!0),i=new P0(t,n.gs),s=i.Sa(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(e){n=f0(e,`Failed to execute query '${t} against cache`);r.reject(n)}})(await yC(e),t,r)),r.promise}function SC(o,l,h={}){let u=new Rm;return o.asyncQueue.enqueueAndForget(async()=>{{var n=await IC(o),i=o.asyncQueue,e=l,s=h,a=u;let t=new lC({next:e=>{t.su(),i.enqueueAndForget(()=>I0(n,r)),e.fromCache&&"server"===s.source?a.reject(new N(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(e)},error:e=>a.reject(e)}),r=new E0(e,t,{includeMetadataChanges:!0,Ta:!0});return b0(n,r)}}),u.promise}function AC(r,e){let n=new lC(e);return r.asyncQueue.enqueueAndForget(async()=>{return e=await IC(r),t=n,e.ia.add(t),void t.next();var e,t}),()=>{n.su(),r.asyncQueue.enqueueAndForget(async()=>{var e,t;e=await IC(r),t=n,e.ia.delete(t)})}}function NC(e,t,r,n){r=r,t=UE(t),s="string"==typeof r?ub().encode(r):r,r=((e,t)=>{if(e instanceof Uint8Array)return oC(e,t);if(e instanceof ArrayBuffer)return oC(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(s),t=t;let i=new hC(r,t);var s;e.asyncQueue.enqueueAndForget(async()=>{tC(await bC(e),i,n)})}function RC(n,i){return n.asyncQueue.enqueue(async()=>{{var e=await yC(n),r=i;let t=e;return t.persistence.runTransaction("Get named query","readonly",e=>t.Yr.getNamedQuery(e,r))}})}function PC(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let DC=new Map;function xC(e,t,r){if(!r)throw new N(A.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function OC(e,t,r,n){if(!0===t&&!0===n)throw new N(A.INVALID_ARGUMENT,e+` and ${r} cannot be used together.`)}function LC(e){if(!x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function MC(e){if(x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function FC(e){var t,r;return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"==typeof e?e instanceof Array?"an array":(t=(r=e).constructor?r.constructor.name:null)?`a custom ${t} object`:"an object":"function"==typeof e?"a function":k()}function q(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new N(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var r=FC(e);throw new N(A.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+r)}function UC(e,t){if(t<=0)throw new N(A.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}let VC="firestore.googleapis.com";class qC{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new N(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=VC,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new N(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}OC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=PC(null!=(t=e.experimentalLongPollingOptions)?t:{});var r=this.experimentalLongPollingOptions;if(void 0!==r.timeoutSeconds){if(isNaN(r.timeoutSeconds))throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(30<r.timeoutSeconds)throw new N(A.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,r}}class jC{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qC({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(this._app)return this._app;throw new N(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qC(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=(e=>{if(!e)return new Dm;switch(e.type){case"firstParty":return new Mm(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new N(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return e=this,(t=DC.get(e))&&(C("ComponentProvider","Removing Datastore"),DC.delete(e),t.terminate()),Promise.resolve();var e,t}}class BC{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new BC(this.firestore,e,this._query)}}class zC{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new KC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new zC(this.firestore,e,this._key)}}class KC extends BC{constructor(e,t,r){super(e,t,lw(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){var e=this._path.popLast();return e.isEmpty()?null:new zC(this.firestore,null,new x(e))}withConverter(e){return new KC(this.firestore,e,this._path)}}function WC(e,t,...r){var n;if(e=w(e),xC("collection","path",t),e instanceof jC)return MC(n=D.fromString(t,...r)),new KC(e,null,n);if(e instanceof zC||e instanceof KC)return MC(n=e._path.child(D.fromString(t,...r))),new KC(e.firestore,null,n);throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function HC(e,t,...r){var n;if(e=w(e),xC("doc","path",t=1===arguments.length?Vm.newId():t),e instanceof jC)return LC(n=D.fromString(t,...r)),new zC(e,null,new x(n));if(e instanceof zC||e instanceof KC)return LC(n=e._path.child(D.fromString(t,...r))),new zC(e.firestore,e instanceof KC?e.converter:null,new x(n));throw new N(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function GC(e,t){return e=w(e),t=w(t),(e instanceof zC||e instanceof KC)&&(t instanceof zC||t instanceof KC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function $C(e,t){return e=w(e),t=w(t),e instanceof BC&&t instanceof BC&&e.firestore===t.firestore&&gw(e._query,t._query)&&e.converter===t.converter}let QC="AsyncQueue";class YC{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new VE(this,"async_queue_retry"),this.bu=()=>{var e=FE();e&&C(QC,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.Su=e;var t=FE();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){var t;this.mu||(this.mu=!0,this.yu=e||!1,(t=FE())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bu))}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});let t=new Rm;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!pv(e))throw e;C(QC,"Operation failed with retryable error: "+e)}0<this.Vu.length&&this.a_.Xo(()=>this.Cu())}}vu(e){var t=this.Su.then(()=>(this.pu=!0,e().catch(e=>{throw this.gu=e,this.pu=!1,Sm("INTERNAL UNHANDLED ERROR: ",(e=>{let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t})(e)),e}).then(e=>(this.pu=!1,e))));return this.Su=t}enqueueAfterDelay(e,t,r){this.Du(),-1<this.wu.indexOf(e)&&(t=0);var n=p0.createAndSchedule(this,e,t,r,e=>this.Fu(e));return this.fu.push(n),n}Du(){this.gu&&k()}verifyOperationInProgress(){}async Mu(){for(var e;await(e=this.Su),e!==this.Su;);}xu(e){for(var t of this.fu)if(t.timerId===e)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(var e of this.fu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){var t=this.fu.indexOf(e);this.fu.splice(t,1)}}function JC(t){var r=t,t=["next","error","complete"];if("object"==typeof r&&null!==r){var n=r;for(let e of t)if(e in n&&"function"==typeof n[e])return 1}}class XC{constructor(){this._progressObserver={},this._taskCompletionResolver=new Rm,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var ZC,ek;class tk extends jC{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new YC,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){var e;this._firestoreClient&&(e=this._firestoreClient.terminate(),this._queue=new YC(e),this._firestoreClient=void 0,await e)}}function rk(e){if(e._terminated)throw new N(A.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||nk(e),e._firestoreClient}function nk(e){var t,r,n,i,s,a=e._freezeSettings(),o=(i=e._databaseId,t=(null==(o=e._app)?void 0:o.options.appId)||"",r=e._persistenceKey,n=a,new ny(i,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,PC(n.experimentalLongPollingOptions),n.useFetchStreams));e._componentsProvider||null!=(s=a.localCache)&&s._offlineComponentProvider&&null!=(s=a.localCache)&&s._onlineComponentProvider&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new pC(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(i=e._componentsProvider,s=null==i?void 0:i._online.build(),{_offline:null==i?void 0:i._offline.build(s),_online:s}))}function ik(e,t,r){if((e=q(e,tk))._firestoreClient||e._terminated)throw new N(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new N(A.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},nk(e)}function sk(r){if(r._initialized&&!r._terminated)throw new N(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let n=new Rm;return r._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{e=GT(r._databaseId,r._persistenceKey),await(hv.D()?(t=e+"main",void await hv.delete(t)):Promise.resolve()),n.resolve()}catch(e){n.reject(e)}var e,t}),n.promise}function ak(e){return(r=rk(e=q(e,tk))).asyncQueue.enqueue(async()=>{var e=await _C(r),t=await wC(r);return e.setNetworkEnabled(!0),(e=t).W_.delete(0),$E(e)});var r}class ok{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ok(W_.fromBase64String(e))}catch(e){throw new N(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ok(W_.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lk{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new N(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gm(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class hk{constructor(e){this._methodName=e}}class uk{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new N(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new N(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return R(this._lat,e._lat)||R(this._long,e._long)}}class ck{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){var t=this._values,r=e._values;if(t.length!==r.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==r[n])return!1;return!0}}let dk=/^__.*__$/;class pk{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Xw(e,this.data,this.fieldMask,t,this.fieldTransforms):new Jw(e,this.data,t,this.fieldTransforms)}}class fk{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Xw(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gk(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw k()}}class mk{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new mk(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t=null==(t=this.path)?void 0:t.child(e),t=this.ku({path:t,Qu:!1});return t.$u(e),t}Ku(e){var t=null==(t=this.path)?void 0:t.child(e),t=this.ku({path:t,Qu:!1});return t.Bu(),t}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Mk(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(gk(this.Lu)&&dk.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class vk{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||UE(e)}ju(e,t,r,n=!1){return new mk({Lu:e,methodName:t,zu:r,path:Gm.emptyPath(),Qu:!1,Gu:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _k(e){var t=e._freezeSettings(),r=UE(e._databaseId);return new vk(e._databaseId,!!t.ignoreUndefinedProperties,r)}function yk(e,n,i,t,r,s={}){var a=e.ju(s.merge||s.mergeFields?2:0,n,i,r),o=(Dk("Data must be an object, but it was:",a,t),Rk(t,a));let l,h;if(s.merge)l=new z_(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){let t=[];for(let r of s.mergeFields){let e=xk(n,r,i);if(!a.contains(e))throw new N(A.INVALID_ARGUMENT,`Field '${e}' is specified in your field mask but missing from your input data.`);Fk(t,e)||t.push(e)}l=new z_(t),h=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,h=a.fieldTransforms;return new pk(new Py(o),l,h)}class wk extends hk{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(this._methodName+"() can only appear at the top level of your update data"):e.Wu(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wk}}function bk(e,t,r){return new mk({Lu:3,zu:t.settings.zu,methodName:e._methodName,Qu:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Ik extends hk{_toFieldTransform(e){return new zw(e.path,new Lw)}isEqual(e){return e instanceof Ik}}class Tk extends hk{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=bk(this,e,!0),r=this.Hu.map(e=>Nk(e,t)),n=new Mw(r);return new zw(e.path,n)}isEqual(e){return e instanceof Tk&&Te(this.Hu,e.Hu)}}class Ek extends hk{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){let t=bk(this,e,!0),r=this.Hu.map(e=>Nk(e,t)),n=new Uw(r);return new zw(e.path,n)}isEqual(e){return e instanceof Ek&&Te(this.Hu,e.Hu)}}class Ck extends hk{constructor(e,t){super(e),this.Ju=t}_toFieldTransform(e){var t=new qw(e.serializer,Dw(e.serializer,this.Ju));return new zw(e.path,t)}isEqual(e){return e instanceof Ck&&this.Ju===e.Ju}}function kk(e,i,s,t){let a=e.ju(1,i,s),o=(Dk("Data must be an object, but it was:",a,t),[]),l=Py.empty();F_(t,(e,t)=>{var r=Lk(i,e,s),n=(t=w(t),a.Ku(r));if(t instanceof wk)o.push(r);else{let e=Nk(t,n);null!=e&&(o.push(r),l.set(r,e))}});var r=new z_(o);return new fk(l,r,a.fieldTransforms)}function Sk(e,t,r,n,i,s){var a=e.ju(1,t,r),o=[xk(t,n,r)],l=[i];if(s.length%2!=0)throw new N(A.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(xk(t,s[p])),l.push(s[p+1]);var h=[],u=Py.empty();for(let f=o.length-1;0<=f;--f)if(!Fk(h,o[f])){let t=o[f];var c=w(l[f]);let r=a.Ku(t);if(c instanceof wk)h.push(t);else{let e=Nk(c,r);null!=e&&(h.push(t),u.set(t,e))}}var d=new z_(h);return new fk(u,d,a.fieldTransforms)}function Ak(e,t,r,n=!1){return Nk(r,e.ju(n?4:3,t))}function Nk(e,r){if(Pk(e=w(e)))return Dk("Unsupported field value:",r,e),Rk(e,r);if(e instanceof hk){{var t=e;var n=r;if(!gk(n.Lu))throw n.Wu(t._methodName+"() can only be used with update() and set()");if(!n.path)throw n.Wu(t._methodName+"() is not currently supported inside arrays");var i=t._toFieldTransform(n);i&&n.fieldTransforms.push(i)}return null}if(void 0===e&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),e instanceof Array){if(r.settings.Qu&&4!==r.Lu)throw r.Wu("Nested arrays are not supported");{var s,a=r,o=[];let t=0;for(s of e){let e=Nk(s,a.Uu(t));null==e&&(e={nullValue:"NULL_VALUE"}),o.push(e),t++}return{arrayValue:{values:o}}}}var l,t=e,n=r;if(null===(t=w(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Dw(n.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date)return h=zm.fromDate(t),{timestampValue:Rb(n.serializer,h)};if(t instanceof zm)return h=new zm(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Rb(n.serializer,h)};if(t instanceof uk)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ok)return{bytesValue:Pb(n.serializer,t._byteString)};if(t instanceof zC){var h=n.databaseId,i=t.firestore._databaseId;if(i.isEqual(h))return{referenceValue:xb(t.firestore._databaseId||n.databaseId,t._key.path)};throw n.Wu(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${h.projectId}/`+h.database)}if(t instanceof ck)return e=t,l=n,{mapValue:{fields:{[ay]:{stringValue:hy},[uy]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw l.Wu("VectorValues must only contain numeric values.");return Rw(l.serializer,e)})}}}}};throw n.Wu("Unsupported field value: "+FC(t))}function Rk(e,n){let i={};return U_(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):F_(e,(e,t)=>{var r=Nk(t,n.qu(e));null!=r&&(i[e]=r)}),{mapValue:{fields:i}}}function Pk(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof zm||e instanceof uk||e instanceof ok||e instanceof zC||e instanceof hk||e instanceof ck)}function Dk(e,t,r){var n,i;if(!Pk(r)||"object"!=typeof(i=r)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))throw"an object"===(n=FC(r))?t.Wu(e+" a custom object"):t.Wu(e+" "+n)}function xk(e,t,r){if((t=w(t))instanceof lk)return t._internalPath;if("string"==typeof t)return Lk(e,t);throw Mk("Field path arguments must be of type string or ",e,!1,void 0,r)}let Ok=new RegExp("[~\\*/\\[\\]]");function Lk(t,r,n){if(0<=r.search(Ok))throw Mk(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new lk(...r.split("."))._internalPath}catch(e){throw Mk(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Mk(e,t,r,n,i){var s=n&&!n.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,l=(r&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(l+=" (found",s&&(l+=" in field "+n),a&&(l+=" in document "+i),l+=")"),new N(A.INVALID_ARGUMENT,o+e+l)}function Fk(e,t){return e.some(e=>e.isEqual(t))}class Uk{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new zC(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new Vk(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){var t=this._document.data.field(qk("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Vk extends Uk{data(){return super.data()}}function qk(e,t){return"string"==typeof t?Lk(e,t):(t instanceof lk?t:t._delegate)._internalPath}function jk(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new N(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bk{}class zk extends Bk{}function Kk(e,t,...r){let n=[];t instanceof Bk&&n.push(t);var t=n=n.concat(r),i=t.filter(e=>!1).length,s=t.filter(e=>e instanceof Wk).length;if(1<i||0<i&&0<s)throw new N(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(let t of n)e=t._apply(e);return e}class Wk extends zk{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wk(e,t,r)}_apply(e){var t=this._parse(e);return Zk(e._query,t),new BC(e.firestore,e.converter,pw(e._query,t))}_parse(e){var t=_k(e.firestore);{var n=e._query,i="where",s=t,a=e.firestore._databaseId,o=(e=this._field,this._op),l=this._value;let r;if(e.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new N(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){Xk(l,o);let e=[];for(let t of l)e.push(Jk(a,n,t));r={arrayValue:{values:e}}}else r=Jk(a,n,l)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Xk(l,o),r=Ak(s,i,l,"in"===o||"not-in"===o);return F.create(e,o,r)}}}(class extends Bk{});class Hk extends zk{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Hk(e,t)}_apply(e){var t=((e,t,r)=>{if(null!==e.startAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new N(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new My(t,r)})(e._query,this._field,this._direction);return new BC(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new aw(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Gk extends zk{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Gk(e,t,r)}_apply(e){return new BC(e.firestore,e.converter,fw(e._query,this._limit,this._limitType))}}class $k extends zk{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $k(e,t,r)}_apply(e){var t,r=Yk(e,this.type,this._docOrFields,this._inclusive);return new BC(e.firestore,e.converter,(e=e._query,t=r,new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class Qk extends zk{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Qk(e,t,r)}_apply(e){var t,r=Yk(e,this.type,this._docOrFields,this._inclusive);return new BC(e.firestore,e.converter,(e=e._query,t=r,new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function Yk(e,r,n,i){if(n[0]=w(n[0]),n[0]instanceof Uk){var s=e._query,a=e.firestore._databaseId,o=r,l=n[0]._document,h=i;if(!l)throw new N(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);var u=[];for(let t of cw(s))if(t.field.isKeyField())u.push(yy(a,l.key));else{let e=l.data.field(t.field);if(ey(e))throw new N(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+t.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=t.field.canonicalString();throw new N(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}u.push(e)}return new xy(u,h)}var t=_k(e.firestore),c=e._query,d=e.firestore._databaseId,p=t,f=r,g=n,o=i,m=c.explicitOrderBy;if(g.length>m.length)throw new N(A.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);var v=[];for(let y=0;y<g.length;y++){var _=g[y];if(m[y].field.isKeyField()){if("string"!=typeof _)throw new N(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a `+typeof _);if(!uw(c)&&-1!==_.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${_}' contains a slash.`);let e=c.path.child(D.fromString(_));if(!x.isDocumentKey(e))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${e}' is not because it contains an odd number of segments.`);let t=new x(e);v.push(yy(d,t))}else{let e=Ak(p,f,_);v.push(e)}}return new xy(v,o)}function Jk(e,t,r){if("string"==typeof(r=w(r))){if(""===r)throw new N(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!uw(t)&&-1!==r.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);var n=t.path.child(D.fromString(r));if(x.isDocumentKey(n))return yy(e,new x(n));throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`)}if(r instanceof zC)return yy(e,r._key);throw new N(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${FC(r)}.`)}function Xk(e,t){if(!Array.isArray(e)||0===e.length)throw new N(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Zk(e,t){var r=((t,r)=>{for(var n of t)for(let e of n.getFlattenedFilters())if(0<=r.indexOf(e.op))return e.op;return null})(e.filters,(e=>{switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(null!==r)throw r===t.op?new N(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class eS{convertValue(e,t="none"){switch(dy(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $_(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Q_(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw k()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,r="none"){let n={};return F_(e,(e,t)=>{n[e]=this.convertValue(t,r)}),n}convertVectorValue(e){var t=null==(t=null==(t=null==(t=e.fields)?void 0:t[uy].arrayValue)?void 0:t.values)?void 0:t.map(e=>$_(e.doubleValue));return new ck(t)}convertGeoPoint(e){return new uk($_(e.latitude),$_(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var r=ty(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ry(e));default:return null}}convertTimestamp(e){var t=G_(e);return new zm(t.seconds,t.nanos)}convertDocumentKey(e,t){var r=D.fromString(e),n=(S(tI(r)),new sy(r.get(1),r.get(3))),r=new x(r.popFirst(5));return n.isEqual(t)||Sm(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function tS(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class rS extends eS{constructor(e){super(),this.firestore=e}convertBytes(e){return new ok(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new zC(this.firestore,null,t)}}class nS{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class iS extends Uk{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new sS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){var r=this._document.data.field(qk("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class sS extends iS{data(e={}){return super.data(e)}}class aS{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new nS(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,r){this._snapshot.docs.forEach(e=>{t.call(r,new sS(this._firestore,this._userDataWriter,e.key,e,new nS(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=((s,t)=>{if(s._snapshot.oldDocs.isEmpty()){let r=0;return s._snapshot.docChanges.map(e=>{var t=new sS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new nS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new sS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new nS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let r=-1,n=-1;return 0!==e.type&&(r=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),n=i.indexOf(e.doc.key)),{type:(e=>{switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k()}})(e.type),doc:t,oldIndex:r,newIndex:n}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function oS(e,t){return e instanceof iS&&t instanceof iS?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof aS&&t instanceof aS&&e._firestore===t._firestore&&$C(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class lS extends eS{constructor(e){super(),this.firestore=e}convertBytes(e){return new ok(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new zC(this.firestore,null,t)}}function hS(e,t,r){e=q(e,zC);var n=q(e.firestore,tk),i=tS(e.converter,t,r);return dS(n,[yk(_k(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,Ww.none())])}function uS(e,t,r,...n){e=q(e,zC);var i=q(e.firestore,tk),s=_k(i);return dS(i,[("string"==typeof(t=w(t))||t instanceof lk?Sk(s,"updateDoc",e._key,t,r,n):kk(s,"updateDoc",e._key,t)).toMutation(e._key,Ww.exists(!0))])}function cS(n,...i){var t,r;n=w(n);let e={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof i[s]||JC(i[s])||(e=i[s],s++);var a={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(JC(i[s])){let e=i[s];i[s]=null==(r=e.next)?void 0:r.bind(e),i[s+1]=null==(t=e.error)?void 0:t.bind(e),i[s+2]=null==(r=e.complete)?void 0:r.bind(e)}let o,l,h;if(n instanceof zC)l=q(n.firestore,tk),h=lw(n._key.path),o={next:e=>{i[s]&&i[s](pS(l,n,e))},error:i[s+1],complete:i[s+2]};else{let t=q(n,BC),r=(l=q(t.firestore,tk),h=t._query,new lS(l));o={next:e=>{i[s]&&i[s](new aS(l,r,t,e))},error:i[s+1],complete:i[s+2]},jk(n._query)}{var u=rk(l),c=h,d=a,p=o;let e=new lC(p),t=new E0(c,e,d);return u.asyncQueue.enqueueAndForget(async()=>b0(await IC(u),t)),()=>{e.su(),u.asyncQueue.enqueueAndForget(async()=>I0(await IC(u),t))}}}function dS(t,r){{var n=rk(t),i=r;let e=new Rm;return n.asyncQueue.enqueueAndForget(async()=>U0(await bC(n),i,e)),e.promise}}function pS(e,t,r){var n=r.docs.get(t._key),i=new lS(e);return new iS(e,i,t._key,n,new nS(r.hasPendingWrites,r.fromCache),t.converter)}let fS={maxAttempts:5};class gS{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_k(e)}set(e,t,r){this._verifyNotCommitted();var n=mS(e,this._firestore),i=tS(n.converter,t,r),i=yk(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(i.toMutation(n._key,Ww.none())),this}update(e,t,r,...n){this._verifyNotCommitted();var i=mS(e,this._firestore),s="string"==typeof(t=w(t))||t instanceof lk?Sk(this._dataReader,"WriteBatch.update",i._key,t,r,n):kk(this._dataReader,"WriteBatch.update",i._key,t);return this._mutations.push(s.toMutation(i._key,Ww.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=mS(e,this._firestore);return this._mutations=this._mutations.concat(new rb(t._key,Ww.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mS(e,t){if((e=w(e)).firestore!==t)throw new N(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class vS extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=_k(e)}get(e){let r=mS(e,this._firestore),n=new rS(this._firestore);return this._transaction.lookup([r._key]).then(e=>{if(!e||1!==e.length)return k();var t=e[0];if(t.isFoundDocument())return new Uk(this._firestore,n,t.key,t,r.converter);if(t.isNoDocument())return new Uk(this._firestore,n,r._key,null,r.converter);throw k()})}set(e,t,r){var n=mS(e,this._firestore),i=tS(n.converter,t,r),i=yk(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,i),this}update(e,t,r,...n){var i=mS(e,this._firestore),s="string"==typeof(t=w(t))||t instanceof lk?Sk(this._dataReader,"Transaction.update",i._key,t,r,n):kk(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=mS(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=mS(e,this._firestore),r=new lS(this._firestore);return super.get(e).then(e=>new iS(this._firestore,r,t._key,e._document,new nS(!1,!1),t.converter))}}function _S(r,n,e){r=q(r,tk);var i=Object.assign(Object.assign({},fS),e);if(i.maxAttempts<1)throw new N(A.INVALID_ARGUMENT,"Max attempts must be at least 1");{var s=rk(r),a=e=>n(new vS(r,e)),o=i;let t=new Rm;return s.asyncQueue.enqueueAndForget(async()=>{var e=await vC(s).then(e=>e.datastore);new cC(s.asyncQueue,e,o,a,t).Iu()}),t.promise}}ZC=!0,WD=xt,Em=WD,kt(new u("firestore",(e,{instanceIdentifier:t,options:r})=>{var n=e.getProvider("app").getImmediate(),n=new tk(new Om(e.getProvider("auth-internal")),new Um(n,e.getProvider("app-check-internal")),((e,t)=>{if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new sy(e.options.projectId,t);throw new N(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')})(n,t),n);return r=Object.assign({useFetchStreams:ZC},r),n._setSettings(r),n},"PUBLIC").setMultipleInstances(!0)),d(Im,"4.7.9",QN),d(Im,"4.7.9","esm2017");function yS(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new N("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function wS(){if("undefined"==typeof Uint8Array)throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function bS(){if("undefined"==typeof atob)throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}class IS{constructor(e){this._delegate=e}static fromBase64String(e){return bS(),new IS(ok.fromBase64String(e))}static fromUint8Array(e){return wS(),new IS(ok.fromUint8Array(e))}toBase64(){return bS(),this._delegate.toBase64()}toUint8Array(){return wS(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function TS(e){var t=["next","error","complete"];if("object"==typeof e&&null!==e){var r,n=e;for(r of t)if(r in n&&"function"==typeof n[r])return 1}}class ES{enableIndexedDbPersistence(e,r){{e=e._delegate;var n={forceOwnership:r};Am("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();return ik(e,aC.provider,{build:e=>new iC(e,t.cacheSizeBytes,null==n?void 0:n.forceOwnership)}),Promise.resolve()}}enableMultiTabIndexedDbPersistence(e){return(async e=>{Am("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();ik(e,aC.provider,{build:e=>new sC(e,t.cacheSizeBytes)})})(e._delegate)}clearIndexedDbPersistence(e){return sk(e._delegate)}}class CS{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof sy||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Am("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(i,s,a={}){{var[i,s,a,o={}]=[this._delegate,i,s,a];let n,e=(i=q(i,jC))._getSettings(),t=Object.assign(Object.assign({},e),{emulatorOptions:i._getEmulatorOptions()}),r=s+":"+a;e.host!==VC&&e.host!==r&&Am("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");var l=Object.assign(Object.assign({},e),{host:r,ssl:!1,emulatorOptions:o});if(!Te(l,t)&&(i._setSettings(l),o.mockUserToken)){let t,r;if("string"==typeof o.mockUserToken)t=o.mockUserToken,r=Tm.MOCK_USER;else{t=ee(o.mockUserToken,null==(n=i._app)?void 0:n.options.projectId);let e=o.mockUserToken.sub||o.mockUserToken.user_id;if(!e)throw new N(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new Tm(e)}i._authCredentials=new xm(new Pm(t,r))}}}enableNetwork(){return ak(this._delegate)}disableNetwork(){return TC(rk(q(this._delegate,tk)))}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,OC("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var t=this._delegate;{var r=rk(t=q(t,tk));let e=new Rm;return r.asyncQueue.enqueueAndForget(async()=>B0(await bC(r),e)),e.promise}}onSnapshotsInSync(e){return t=this._delegate,e=e,AC(rk(t=q(t,tk)),JC(e)?e:{next:e});var t}get app(){if(this._appCompat)return this._appCompat;throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new VS(this,WC(this._delegate,e))}catch(e){throw PS(e,"collection()","Firestore.collection()")}}doc(e){try{return new RS(this,HC(this._delegate,e))}catch(e){throw PS(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new MS(this,((e,t)=>{if(e=q(e,jC),xC("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new N(A.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new BC(e,null,(e=t,new aw(D.emptyPath(),e)))})(this._delegate,e))}catch(e){throw PS(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return _S(this._delegate,e=>t(new SS(this,e)))}batch(){return rk(this._delegate),new AS(new gS(this._delegate,e=>dS(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,r=rk(t=q(t,tk)),n=new XC,NC(r,t._databaseId,e,n),n;var t,r,n}namedQuery(e){return t=this._delegate,e=e,RC(rk(t=q(t,tk)),e).then(e=>e?new BC(t,null,e.query):null).then(e=>e?new MS(this,e):null);var t}}class kS extends eS{constructor(e){super(),this.firestore=e}convertBytes(e){return new IS(new ok(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return RS.forKey(t,this.firestore,null)}}class SS{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}get(e){let t=qS(e);return this._delegate.get(t).then(e=>new OS(this._firestore,new iS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,r){var n=qS(e);return r?(yS("Transaction.set",r),this._delegate.set(n,t,r)):this._delegate.set(n,t),this}update(e,t,r,...n){var i=qS(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){var t=qS(e);return this._delegate.delete(t),this}}class AS{constructor(e){this._delegate=e}set(e,t,r){var n=qS(e);return r?(yS("WriteBatch.set",r),this._delegate.set(n,t,r)):this._delegate.set(n,t),this}update(e,t,r,...n){var i=qS(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){var t=qS(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class NS{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){var r=new sS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new LS(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){var r=NS.INSTANCES;let n=r.get(e),i=(n||(n=new WeakMap,r.set(e,n)),n.get(t));return i||(i=new NS(e,new kS(e),t),n.set(t,i)),i}}NS.INSTANCES=new WeakMap;class RS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}static forPath(e,t,r){if(e.length%2!=0)throw new N("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new RS(t,new zC(t._delegate,r,new x(e)))}static forKey(e,t,r){return new RS(t,new zC(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new VS(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new VS(this.firestore,WC(this._delegate,e))}catch(e){throw PS(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=w(e))instanceof zC&&GC(this._delegate,e)}set(e,t){t=yS("DocumentReference.set",t);try{return t?hS(this._delegate,e,t):hS(this._delegate,e)}catch(e){throw PS(e,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?uS(this._delegate,e):uS(this._delegate,e,t,...r)}catch(e){throw PS(e,"updateDoc()","DocumentReference.update()")}}delete(){return dS(q((e=this._delegate).firestore,tk),[new rb(e._key,Ww.none())]);var e}onSnapshot(...e){var t=DS(e),r=xS(e,e=>new OS(this.firestore,new iS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return cS(this._delegate,t,r)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?t=>{t=q(t,zC);let r=q(t.firestore,tk),e=rk(r),n=new lS(r);return EC(e,t._key).then(e=>new iS(r,n,t._key,e,new nS(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?t=>{t=q(t,zC);let r=q(t.firestore,tk);return CC(rk(r),t._key,{source:"server"}).then(e=>pS(r,t,e))}:t=>{t=q(t,zC);let r=q(t.firestore,tk);return CC(rk(r),t._key).then(e=>pS(r,t,e))})(this._delegate)).then(e=>new OS(this.firestore,new iS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new RS(this.firestore,e?this._delegate.withConverter(NS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function PS(e,t,r){return e.message=e.message.replace(t,r),e}function DS(e){for(var t of e)if("object"==typeof t&&!TS(t))return t;return{}}function xS(e,t){let r,n,i;return i=TS(e[0])?e[0]:TS(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null==(r=i.error)?void 0:r.bind(i),complete:null==(n=i.complete)?void 0:n.bind(i)}}class OS{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new RS(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return oS(this._delegate,e._delegate)}}class LS extends OS{data(e){var t=this._delegate.data(e);return this._delegate._converter||void 0!==t||k(),t}}class MS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}where(e,t,r){try{return new MS(this.firestore,Kk(this._delegate,(n=r,i=t,s=qk("where",e),Wk._create(s,i,n))))}catch(e){throw PS(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,i,s}orderBy(e,t){try{return new MS(this.firestore,Kk(this._delegate,([r,n="asc"]=[e,t],i=n,s=qk("orderBy",r),Hk._create(s,i))))}catch(e){throw PS(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,n,i,s}limit(e){try{return new MS(this.firestore,Kk(this._delegate,(UC("limit",t=e),Gk._create("limit",t,"F"))))}catch(e){throw PS(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new MS(this.firestore,Kk(this._delegate,(UC("limitToLast",t=e),Gk._create("limitToLast",t,"L"))))}catch(e){throw PS(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new MS(this.firestore,Kk(this._delegate,([...t]=[...e],$k._create("startAt",t,!0))))}catch(e){throw PS(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new MS(this.firestore,Kk(this._delegate,([...t]=[...e],$k._create("startAfter",t,!1))))}catch(e){throw PS(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new MS(this.firestore,Kk(this._delegate,([...t]=[...e],Qk._create("endBefore",t,!1))))}catch(e){throw PS(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new MS(this.firestore,Kk(this._delegate,([...t]=[...e],Qk._create("endAt",t,!0))))}catch(e){throw PS(e,"endAt()","Query.endAt()")}var t}isEqual(e){return $C(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?t=>{t=q(t,BC);let r=q(t.firestore,tk),e=rk(r),n=new lS(r);return kC(e,t._query).then(e=>new aS(r,n,t,e))}:"server"===(null==e?void 0:e.source)?t=>{t=q(t,BC);let r=q(t.firestore,tk),e=rk(r),n=new lS(r);return SC(e,t._query,{source:"server"}).then(e=>new aS(r,n,t,e))}:t=>{t=q(t,BC);let r=q(t.firestore,tk),e=rk(r),n=new lS(r);return jk(t._query),SC(e,t._query).then(e=>new aS(r,n,t,e))})(this._delegate)).then(e=>new US(this.firestore,new aS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=DS(e),r=xS(e,e=>new US(this.firestore,new aS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return cS(this._delegate,t,r)}withConverter(e){return new MS(this.firestore,e?this._delegate.withConverter(NS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class FS{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new LS(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class US{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new MS(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new LS(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new FS(this._firestore,e))}forEach(t,r){this._delegate.forEach(e=>{t.call(r,new LS(this._firestore,e))})}isEqual(e){return oS(this._delegate,e._delegate)}}class VS extends MS{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new RS(this.firestore,e):null}doc(e){try{return void 0===e?new RS(this.firestore,HC(this._delegate)):new RS(this.firestore,HC(this._delegate,e))}catch(e){throw PS(e,"doc()","CollectionReference.doc()")}}add(e){return((e,t)=>{let r=q(e.firestore,tk),n=HC(e),i=tS(e.converter,t);return dS(r,[yk(_k(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,Ww.exists(!1))]).then(()=>n)})(this._delegate,e).then(e=>new RS(this.firestore,e))}isEqual(e){return GC(this._delegate,e._delegate)}withConverter(e){return new VS(this.firestore,e?this._delegate.withConverter(NS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function qS(e){return q(e,zC)}class jS{static serverTimestamp(){var e=new Ik("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new jS(e)}static delete(){var e=new wk("deleteField");return e._methodName="FieldValue.delete",new jS(e)}static arrayUnion(...e){[...e]=[...e];var t=new Tk("arrayUnion",e);return t._methodName="FieldValue.arrayUnion",new jS(t)}static arrayRemove(...e){[...e]=[...e];var t=new Ek("arrayRemove",e);return t._methodName="FieldValue.arrayRemove",new jS(t)}static increment(e){e=e;var t=new Ck("increment",e);return t._methodName="FieldValue.increment",new jS(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}}let BS={Firestore:CS,GeoPoint:uk,Timestamp:zm,Blob:IS,Transaction:SS,WriteBatch:AS,DocumentReference:RS,DocumentSnapshot:OS,Query:MS,QueryDocumentSnapshot:LS,QuerySnapshot:US,CollectionReference:VS,FieldPath:class g1{constructor(...e){this._delegate=new lk(...e)}static documentId(){return new g1(Gm.keyField().canonicalString())}isEqual(e){return(e=w(e))instanceof lk&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:jS,setLogLevel:function(e){e=e,Cm.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};t=rr,ek=(e,t)=>new CS(e,t,new ES),t.INTERNAL.registerComponent(new u("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return ek(t,r)},"PUBLIC").setServiceProps(Object.assign({},BS))),t.registerVersion("@firebase/firestore-compat","0.3.44");let zS="type.googleapis.com/google.protobuf.Int64Value",KS="type.googleapis.com/google.protobuf.UInt64Value";function WS(e,t){var r,n={};for(r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function HS(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>HS(e));if("function"==typeof e||"object"==typeof e)return WS(e,e=>HS(e));throw new Error("Data cannot be encoded in JSON: "+e)}function GS(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case zS:case KS:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>GS(e)):"function"==typeof e||"object"==typeof e?WS(e,e=>GS(e)):e}let $S="functions",QS={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class YS extends pe{constructor(e,t,r){super($S+"/"+e,t||""),this.details=r,Object.setPrototypeOf(this,YS.prototype)}}function JS(e,t){let r=(e=>{if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"})(e),n=r,i=void 0;try{var s=t&&t.error;if(s){let e=s.status;if("string"==typeof e){if(!QS[e])return new YS("internal","internal");r=QS[e],n=e}var a=s.message;"string"==typeof a&&(n=a),void 0!==(i=s.details)&&(i=GS(i))}}catch(e){}return"ok"===r?null:new YS(r,n,i)}class XS{constructor(e,t,r,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,h(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||r.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null!=n&&n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){}}async getAppCheckToken(e){var t;return this.serverAppAppCheckToken||(!this.appCheck||(t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken()).error?null:t.token)}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let ZS="us-central1",eA=/^data: (.*?)(?:\n|$)/;class tA{constructor(e,t,r,n,i=ZS,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new XS(e,t,r,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin+("/"===a.pathname?"":a.pathname),this.region=ZS}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/`+e:null!==this.customDomain?this.customDomain+"/"+e:`https://${this.region}-${t}.cloudfunctions.net/`+e}}function rA(i,s,a){var e=e=>{return e=e,r=a||{},n=(t=i)._url(s),iA(t,n,e,r);var t,r,n};return e.stream=(e,t)=>{return e=e,t=t,n=(r=i)._url(s),sA(r,n,e,t||{});var r,n},e}async function nA(e,t){var r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),null!==n.appCheckToken&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}async function iA(e,t,r,n){var i={data:r=HS(r)},s=await nA(e,n),a=(r=>{let n=null;return{promise:new Promise((e,t)=>{n=setTimeout(()=>{t(new YS("deadline-exceeded","deadline-exceeded"))},r)}),cancel:()=>{n&&clearTimeout(n)}}})(n.timeout||7e4),i=await Promise.race([(async(e,t,r,n)=>{r["Content-Type"]="application/json";let i;try{i=await n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}})(t,i,s,e.fetchImpl),a.promise,e.cancelAllRequests]);if(a.cancel(),!i)throw new YS("cancelled","Firebase Functions instance was deleted.");s=JS(i.status,i.json);if(s)throw s;if(!i.json)throw new YS("internal","Response is not valid JSON object.");let o=i.json.data;if(void 0===(o=void 0===o?i.json.result:o))throw new YS("internal","Response is missing data field.");return{data:GS(o)}}async function sA(e,t,r,n){var i={data:r=HS(r)},s=await nA(e,n);s["Content-Type"]="application/json",s.Accept="text/event-stream";let a;try{a=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(i),headers:s,signal:null==n?void 0:n.signal})}catch(e){if(e instanceof Error&&"AbortError"===e.name){let e=new YS("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(e)}}}}}}let t=JS(0,null);return{data:Promise.reject(t),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(t)}}}}}}let o,l;i=new Promise((e,t)=>{o=e,l=t}),null!=(s=null==n?void 0:n.signal)&&s.addEventListener("abort",()=>{var e=new YS("cancelled","Request was cancelled.");l(e)}),s=a.body.getReader();let h=((a,s,o,l)=>{let h=(e,t)=>{var r=e.match(eA);if(r){r=r[1];try{var n,i=JSON.parse(r);"result"in i?s(GS(i.result)):"message"in i?t.enqueue(GS(i.message)):"error"in i&&(n=JS(0,i),t.error(n),o(n))}catch(e){e instanceof YS&&(t.error(e),o(e))}}},u=new TextDecoder;return new ReadableStream({start(i){let s="";return async function r(){if(null!=l&&l.aborted){let e=new YS("cancelled","Request was cancelled");return i.error(e),o(e),Promise.resolve()}try{let{value:t,done:e}=await a.read();if(e)s.trim()&&h(s.trim(),i),i.close();else{if(null==l||!l.aborted){let e=(s+=u.decode(t,{stream:!0})).split("\n");s=e.pop()||"";for(var n of e)n.trim()&&h(n.trim(),i);return r()}{let e=new YS("cancelled","Request was cancelled");i.error(e),o(e),void await a.cancel()}}}catch(e){let t=e instanceof YS?e:JS(0,null);i.error(t),o(t)}}()},cancel(){return a.cancel()}})})(s,o,l,null==n?void 0:n.signal);return{stream:{[Symbol.asyncIterator](){let r=h.getReader();return{async next(){var{value:e,done:t}=await r.read();return{value:e,done:t}},async return(){return await r.cancel(),{done:!0,value:void 0}}}}},data:i}}let aA="@firebase/functions";function oA(e,t,r){w(e).emulatorOrigin=`http://${t}:`+r}function lA(e,t,r){return n=w(e),i=t,s=r,(a=e=>iA(n,i,e,s||{})).stream=(e,t)=>sA(n,i,e,t||{}),a;var n,i,s,a}kt(new u($S,(e,{instanceIdentifier:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new tA(r,n,i,s,t)},"PUBLIC").setMultipleInstances(!0)),d(aA,"0.12.3",r),d(aA,"0.12.3","esm2017");var hA,uA,cA;class dA{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return rA(w(this._delegate),e,t)}httpsCallableFromURL(e,t){return lA(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new pe("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new pe("functions","Port missing in origin provided to useFunctionsEmulator()");return oA(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return oA(this._delegate,e,t)}}let pA="us-central1",fA=(e,{instanceIdentifier:t})=>{var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("functions").getImmediate({identifier:null!=t?t:pA});return new dA(r,n)};er={Functions:dA},rr.INTERNAL.registerComponent(new u("functions-compat",fA,"PUBLIC").setServiceProps(er).setMultipleInstances(!0)),rr.registerVersion("@firebase/functions-compat","0.3.20");let gA="/firebase-messaging-sw.js",mA="/firebase-cloud-messaging-push-scope",vA="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",_A="https://fcmregistrations.googleapis.com/v1",yA="google.c.a.c_id",wA="google.c.a.c_l",bA="google.c.a.ts",IA="google.c.a.e",TA=1e4;function EA(e){var t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(WD=hA=hA||{}).PUSH_RECEIVED="push-received",WD.NOTIFICATION_CLICKED="notification-clicked";let CA="fcm_token_details_db",kA=5,SA="fcm_token_object_Store";async function AA(o){if("databases"in indexedDB&&!(await indexedDB.databases()).map(e=>e.name).includes(CA))return null;let l=null;return(await ht(CA,kA,{upgrade:async(e,t,r,n)=>{var i,s,a;t<2||e.objectStoreNames.contains(SA)&&(i=await(a=n.objectStore(SA)).index("fcmSenderId").get(o),await a.clear(),i)&&(2===t?(a=i).auth&&a.p256dh&&a.endpoint&&(l={token:a.fcmToken,createTime:null!=(s=a.createTime)?s:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:"string"==typeof a.vapidKey?a.vapidKey:EA(a.vapidKey)}}):3===t?(s=i,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:EA(s.auth),p256dh:EA(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:EA(s.vapidKey)}}):4===t&&(a=i,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:EA(a.auth),p256dh:EA(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:EA(a.vapidKey)}}))}})).close(),await ut(CA),await ut("fcm_vapid_details_db"),await ut("undefined"),(e=>{var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length})(l)?l:null}let NA="firebase-messaging-database",RA=1,PA="firebase-messaging-store",DA=null;function xA(){return DA=DA||ht(NA,RA,{upgrade:(e,t)=>{0===t&&e.createObjectStore(PA)}})}async function OA(e){var t=MA(e),t=await(await xA()).transaction(PA).objectStore(PA).get(t);return t||((t=await AA(e.appConfig.senderId))?(await LA(e,t),t):void 0)}async function LA(e,t){var r=MA(e),n=(await xA()).transaction(PA,"readwrite");return await n.objectStore(PA).put(t,r),await n.done,t}function MA({appConfig:e}){return e.appId}let FA=new fe("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function UA(e,t){var r={method:"DELETE",headers:await qA(e)};try{var n,i=await(await fetch(VA(e.appConfig)+"/"+t,r)).json();if(i.error)throw n=i.error.message,FA.create("token-unsubscribe-failed",{errorInfo:n})}catch(e){throw FA.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function VA({projectId:e}){return _A+`/projects/${e}/registrations`}async function qA({appConfig:e,installations:t}){var r=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+r})}function jA({p256dh:e,auth:t,endpoint:r,vapidKey:n}){var i={web:{endpoint:r,auth:t,p256dh:e}};return n!==vA&&(i.web.applicationPubKey=n),i}let BA=6048e5;async function zA(e){var t,r,n,i,s,a=await(async(e,t)=>{var r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(e=>{var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n})(t)})})(e.swRegistration,e.vapidKey),a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:a.endpoint,auth:EA(a.getKey("auth")),p256dh:EA(a.getKey("p256dh"))},o=await OA(e.firebaseDependencies);if(o){if(t=o.subscriptionOptions,r=a.vapidKey===t.vapidKey,n=a.endpoint===t.endpoint,i=a.auth===t.auth,s=a.p256dh===t.p256dh,r&&n&&i&&s)return Date.now()>=o.createTime+BA?(async(e,t)=>{try{var r=await(async(e,t)=>{var r=await qA(e),n=jA(t.subscriptionOptions),r={method:"PATCH",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(VA(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw FA.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,FA.create("token-update-failed",{errorInfo:n});if(i.token)return i.token;throw FA.create("token-update-no-token")})(e.firebaseDependencies,t),n=Object.assign(Object.assign({},t),{token:r,createTime:Date.now()});return await LA(e.firebaseDependencies,n),r}catch(e){throw e}})(e,{token:o.token,createTime:Date.now(),subscriptionOptions:a}):o.token;try{await UA(e.firebaseDependencies,o.token)}catch(e){console.warn(e)}}return WA(e.firebaseDependencies,a)}async function KA(e){var t,r=await OA(e.firebaseDependencies),r=(r&&(await UA(e.firebaseDependencies,r.token),r=MA(e.firebaseDependencies),await(t=(await xA()).transaction(PA,"readwrite")).objectStore(PA).delete(r),await t.done),await e.swRegistration.pushManager.getSubscription());return!r||r.unsubscribe()}async function WA(e,t){var r={token:await(async(e,t)=>{var r=await qA(e),n=jA(t),r={method:"POST",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(VA(e.appConfig),r);i=await s.json()}catch(e){throw FA.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,FA.create("token-subscribe-failed",{errorInfo:n});if(i.token)return i.token;throw FA.create("token-subscribe-no-token")})(e,t),createTime:Date.now(),subscriptionOptions:t};return await LA(e,r),r.token}function HA(e){var t,r,n,i,s={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return n=s,(r=e).notification&&(n.notification={},(t=r.notification.title)&&(n.notification.title=t),(t=r.notification.body)&&(n.notification.body=t),(t=r.notification.image)&&(n.notification.image=t),t=r.notification.icon)&&(n.notification.icon=t),r=s,(n=e).data&&(r.data=n.data),r=s,((n=e).fcmOptions||null!=(i=n.notification)&&i.click_action)&&(r.fcmOptions={},(i=null!=(i=null==(i=n.fcmOptions)?void 0:i.link)?i:null==(i=n.notification)?void 0:i.click_action)&&(r.fcmOptions.link=i),i=null==(i=n.fcmOptions)?void 0:i.analytics_label)&&(r.fcmOptions.analyticsLabel=i),s}var GA="AzSCbw63g1R0nCw85jG8",$A="Iaya3yLKwmgvh7cF0q4",QA=[];for(let m1=0;m1<GA.length;m1++)QA.push(GA.charAt(m1)),m1<$A.length&&QA.push($A.charAt(m1));function YA(e){return FA.create("missing-app-config-values",{valueName:e})}QA.join("");class JA{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var n=(e=>{if(!e||!e.options)throw YA("App Configuration Object");if(!e.name)throw YA("App Name");var t,r=e.options;for(t of["projectId","apiKey","appId","messagingSenderId"])if(!r[t])throw YA(t);return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}})(e);this.firebaseDependencies={app:e,appConfig:n,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}async function XA(e){try{e.swRegistration=await navigator.serviceWorker.register(gA,{scope:mA}),e.swRegistration.update().catch(()=>{}),t=e.swRegistration,await new Promise((r,e)=>{let n=setTimeout(()=>e(new Error(`Service worker not registered after ${TA} ms`)),TA),i=t.installing||t.waiting;t.active?(clearTimeout(n),r()):i?i.onstatechange=e=>{var t;"activated"===(null==(t=e.target)?void 0:t.state)&&(i.onstatechange=null,clearTimeout(n),r())}:(clearTimeout(n),e(new Error("No incoming service worker found.")))})}catch(e){throw FA.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}var t}async function ZA(e,t){if(!navigator)throw FA.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw FA.create("permission-blocked");n=e,await!((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=vA));var r=e,n=null==t?void 0:t.serviceWorkerRegistration;if(n||r.swRegistration||await XA(r),n||!r.swRegistration){if(!(n instanceof ServiceWorkerRegistration))throw FA.create("invalid-sw-registration");r.swRegistration=n}return await 0,zA(e)}async function eN(e,t,r){var n=(e=>{switch(e){case hA.NOTIFICATION_CLICKED:return"notification_open";case hA.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}})(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(n,{message_id:r[yA],message_name:r[wA],message_time:r[bA],message_device_time:Math.floor(Date.now()/1e3)})}async function tN(e,t){var r,n=t.data;n.isFirebaseMessaging&&(e.onMessageHandler&&n.messageType===hA.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(HA(n)):e.onMessageHandler.next(HA(n))),"object"==typeof(t=r=n.data))&&t&&yA in t&&"1"===r[IA]&&await eN(e,n.messageType,r)}let rN="@firebase/messaging",nN="0.12.17",iN=e=>{let t=new JA(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>tN(t,e)),t},sN=e=>{let t=e.getProvider("messaging").getImmediate();return{getToken:e=>ZA(t,e)}};function aN(e){return(async e=>{if(navigator)return e.swRegistration||await XA(e),KA(e);throw FA.create("only-available-in-window")})(e=w(e))}function oN(e,t){var r=e=w(e),e=t;if(navigator)return r.onMessageHandler=e,()=>{r.onMessageHandler=null};throw FA.create("only-available-in-window")}kt(new u("messaging",iN,"PUBLIC")),kt(new u("messaging-internal",sN,"PRIVATE")),d(rN,nN),d(rN,nN,"esm2017");let lN="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hN="https://fcmregistrations.googleapis.com/v1",uN="FCM_MSG",cN="google.c.a.c_id",dN=3,pN=1;function fN(e){var t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(QN=uA=uA||{})[QN.DATA_MESSAGE=1]="DATA_MESSAGE",QN[QN.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(t=cA=cA||{}).PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked";let gN="fcm_token_details_db",mN=5,vN="fcm_token_object_Store";async function _N(o){if("databases"in indexedDB&&!(await indexedDB.databases()).map(e=>e.name).includes(gN))return null;let l=null;return(await ht(gN,mN,{upgrade:async(e,t,r,n)=>{var i,s,a;t<2||e.objectStoreNames.contains(vN)&&(i=await(a=n.objectStore(vN)).index("fcmSenderId").get(o),await a.clear(),i)&&(2===t?(a=i).auth&&a.p256dh&&a.endpoint&&(l={token:a.fcmToken,createTime:null!=(s=a.createTime)?s:Date.now(),subscriptionOptions:{auth:a.auth,p256dh:a.p256dh,endpoint:a.endpoint,swScope:a.swScope,vapidKey:"string"==typeof a.vapidKey?a.vapidKey:fN(a.vapidKey)}}):3===t?(s=i,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:fN(s.auth),p256dh:fN(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:fN(s.vapidKey)}}):4===t&&(a=i,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:fN(a.auth),p256dh:fN(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:fN(a.vapidKey)}}))}})).close(),await ut(gN),await ut("fcm_vapid_details_db"),await ut("undefined"),(e=>{var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length})(l)?l:null}let yN="firebase-messaging-database",wN=1,bN="firebase-messaging-store",IN=null;function TN(){return IN=IN||ht(yN,wN,{upgrade:(e,t)=>{0===t&&e.createObjectStore(bN)}})}async function EN(e){var t=kN(e),t=await(await TN()).transaction(bN).objectStore(bN).get(t);return t||((t=await _N(e.appConfig.senderId))?(await CN(e,t),t):void 0)}async function CN(e,t){var r=kN(e),n=(await TN()).transaction(bN,"readwrite");return await n.objectStore(bN).put(t,r),await n.done,t}function kN({appConfig:e}){return e.appId}let SN=new fe("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function AN(e,t){var r={method:"DELETE",headers:await RN(e)};try{var n,i=await(await fetch(NN(e.appConfig)+"/"+t,r)).json();if(i.error)throw n=i.error.message,SN.create("token-unsubscribe-failed",{errorInfo:n})}catch(e){throw SN.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function NN({projectId:e}){return hN+`/projects/${e}/registrations`}async function RN({appConfig:e,installations:t}){var r=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+r})}function PN({p256dh:e,auth:t,endpoint:r,vapidKey:n}){var i={web:{endpoint:r,auth:t,p256dh:e}};return n!==lN&&(i.web.applicationPubKey=n),i}let DN=6048e5;async function xN(e){var t,r,n,i,s,a=await(async(e,t)=>{var r=await e.pushManager.getSubscription();return r||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(e=>{var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),n=new Uint8Array(r.length);for(let i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n})(t)})})(e.swRegistration,e.vapidKey),a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:a.endpoint,auth:fN(a.getKey("auth")),p256dh:fN(a.getKey("p256dh"))},o=await EN(e.firebaseDependencies);if(o){if(t=o.subscriptionOptions,r=a.vapidKey===t.vapidKey,n=a.endpoint===t.endpoint,i=a.auth===t.auth,s=a.p256dh===t.p256dh,r&&n&&i&&s)return Date.now()>=o.createTime+DN?(async(e,t)=>{try{var r=await(async(e,t)=>{var r=await RN(e),n=PN(t.subscriptionOptions),r={method:"PATCH",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(NN(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw SN.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,SN.create("token-update-failed",{errorInfo:n});if(i.token)return i.token;throw SN.create("token-update-no-token")})(e.firebaseDependencies,t),n=Object.assign(Object.assign({},t),{token:r,createTime:Date.now()});return await CN(e.firebaseDependencies,n),r}catch(e){throw e}})(e,{token:o.token,createTime:Date.now(),subscriptionOptions:a}):o.token;try{await AN(e.firebaseDependencies,o.token)}catch(e){console.warn(e)}}return LN(e.firebaseDependencies,a)}async function ON(e){var t,r=await EN(e.firebaseDependencies),r=(r&&(await AN(e.firebaseDependencies,r.token),r=kN(e.firebaseDependencies),await(t=(await TN()).transaction(bN,"readwrite")).objectStore(bN).delete(r),await t.done),await e.swRegistration.pushManager.getSubscription());return!r||r.unsubscribe()}async function LN(e,t){var r={token:await(async(e,t)=>{var r=await RN(e),n=PN(t),r={method:"POST",headers:r,body:JSON.stringify(n)};let i;try{var s=await fetch(NN(e.appConfig),r);i=await s.json()}catch(e){throw SN.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw n=i.error.message,SN.create("token-subscribe-failed",{errorInfo:n});if(i.token)return i.token;throw SN.create("token-subscribe-no-token")})(e,t),createTime:Date.now(),subscriptionOptions:t};return await CN(e,r),r.token}var MN="AzSCbw63g1R0nCw85jG8",FN="Iaya3yLKwmgvh7cF0q4",UN=[];for(let v1=0;v1<MN.length;v1++)UN.push(MN.charAt(v1)),v1<FN.length&&UN.push(FN.charAt(v1));async function VN(e,t){var r=((e,t)=>{var r,n={};return e.from&&(n.project_number=e.from),e.fcmMessageId&&(n.message_id=e.fcmMessageId),n.instance_id=t,n.message_type=(e.notification?uA.DISPLAY_NOTIFICATION:uA.DATA_MESSAGE).toString(),n.sdk_platform=dN.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=pN.toString(),null!=(r=e.fcmOptions)&&r.analytics_label&&(n.analytics_label=null==(r=e.fcmOptions)?void 0:r.analytics_label),n})(t,await e.firebaseDependencies.installations.getId()),n=r,t=t.productId,r={};r.event_time_ms=Math.floor(Date.now()).toString(),r.source_extension_json_proto3=JSON.stringify({messaging_client_event:n}),t&&(r.compliance_data=(e=>({privacy_context:{prequest:{origin_associated_product_id:e}}}))(t)),e.logEvents.push(r)}async function qN(e,t){var r=(({data:e})=>{if(!e)return null;try{return e.json()}catch(e){return null}})(e);if(r){t.deliveryMetricsExportedToBigQueryEnabled&&await VN(t,r);var n,i,s,a=await BN();if(a.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))){var o,e=a,l=r;l.isFirebaseMessaging=!0,l.messageType=cA.PUSH_RECEIVED;for(o of e)o.postMessage(l)}else r.notification&&await(e=>{var t=e.actions,r=Notification.maxActions;return t&&r&&t.length>r&&console.warn(`This browser only supports ${r} actions. The remaining actions will not be displayed.`),self.registration.showNotification(null!=(t=e.title)?t:"",e)})((e=r,(a=Object.assign({},e.notification)).data={[uN]:e},a)),t&&t.onBackgroundMessageHandler&&(a={from:(e=r).from,collapseKey:e.collapse_key,messageId:e.fcmMessageId},i=a,(n=e).notification&&(i.notification={},(r=n.notification.title)&&(i.notification.title=r),(r=n.notification.body)&&(i.notification.body=r),(r=n.notification.image)&&(i.notification.image=r),r=n.notification.icon)&&(i.notification.icon=r),n=a,(i=e).data&&(n.data=i.data),n=a,((i=e).fcmOptions||null!=(s=i.notification)&&s.click_action)&&(n.fcmOptions={},(s=null!=(s=null==(s=i.fcmOptions)?void 0:s.link)?s:null==(s=i.notification)?void 0:s.click_action)&&(n.fcmOptions.link=s),s=null==(s=i.fcmOptions)?void 0:s.analytics_label)&&(n.fcmOptions.analyticsLabel=s),r=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(r):t.onBackgroundMessageHandler.next(r))}}async function jN(e){var t=null==(t=null==(t=e.notification)?void 0:t.data)?void 0:t[uN];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var r=(e=>{var t=null!=(t=null==(t=e.fcmOptions)?void 0:t.link)?t:null==(t=e.notification)?void 0:t.click_action;return t||((e=>"object"==typeof e&&e&&cN in e)(e.data)?self.location.origin:null)})(t);if(r){var n,i=new URL(r,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await(async e=>{var t;for(t of await BN()){var r=new URL(t.url,self.location.href);if(e.host===r.host)return t}return null})(i);if(e?e=await e.focus():(e=await self.clients.openWindow(r),n=3e3,await new Promise(e=>{setTimeout(e,n)})),e)return t.messageType=cA.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function BN(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function zN(e){return SN.create("missing-app-config-values",{valueName:e})}UN.join("");class KN{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var n=(e=>{if(!e||!e.options)throw zN("App Configuration Object");if(!e.name)throw zN("App Name");var t,r=e.options;for(t of["projectId","apiKey","appId","messagingSenderId"])if(!r[t])throw zN(t);return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}})(e);this.firebaseDependencies={app:e,appConfig:n,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}let WN=e=>{let t=new KN(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(qN(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil((async(e,t)=>{var r;(r=e.newSubscription)?(r=await EN(t.firebaseDependencies),await ON(t),t.vapidKey=null!=(r=null==(r=null==r?void 0:r.subscriptionOptions)?void 0:r.vapidKey)?r:lN,await xN(t)):await ON(t)})(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(jN(e))}),t};function HN(e,t){var r=e=w(e),e=t;if(void 0!==self.document)throw SN.create("only-available-in-sw");return r.onBackgroundMessageHandler=e,()=>{r.onBackgroundMessageHandler=null}}kt(new u("messaging-sw",WN,"PUBLIC"));var GN,$N,QN;class YN{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return(async(e,t)=>ZA(e=w(e),t))(this._delegate,e)}async deleteToken(){return aN(this._delegate)}onMessage(e){return oN(this._delegate,e)}onBackgroundMessage(e){return HN(this._delegate,e)}}let JN=e=>self&&"ServiceWorkerGlobalScope"in self?new YN(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new YN(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),XN={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?ue()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&ue()&&de()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};rr.INTERNAL.registerComponent(new u("messaging-compat",JN,"PUBLIC").setServiceProps(XN)),rr.registerVersion("@firebase/messaging-compat","0.2.17");let ZN="firebasestorage.googleapis.com",eR="storageBucket";class tR extends pe{constructor(e,t,r=0){super(rR(e),`Firebase Storage: ${t} (${rR(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,tR.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return rR(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+`
`+this.customData.serverResponse:this.message=this._baseMessage}}function rR(e){return"storage/"+e}function nR(){return new tR(GN.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function iR(){return new tR(GN.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function sR(){return new tR(GN.CANCELED,"User canceled the upload/download.")}function aR(){return new tR(GN.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function oR(e){return new tR(GN.INVALID_ARGUMENT,e)}function lR(){return new tR(GN.APP_DELETED,"The Firebase app was deleted.")}function hR(e){return new tR(GN.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function uR(e,t){return new tR(GN.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function cR(e){throw new tR(GN.INTERNAL_ERROR,"Internal error: "+e)}(r=GN=GN||{}).UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class dR{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let r;try{r=dR.makeFromUrl(t,e)}catch(e){return new dR(t,"")}if(""===r.path)return r;throw e=t,new tR(GN.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null;var n="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),a=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),o=t===ZN?"(?:storage.googleapis.com|storage.cloud.google.com)":t,l=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${o}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let d=0;d<l.length;d++){var h=l[d],u=h.regex.exec(e);if(u){var c=u[h.indices.bucket];let e=u[h.indices.path];e=e||"",r=new dR(c,e),h.postModify(r);break}}if(null==r)throw t=e,new tR(GN.INVALID_URL,"Invalid URL '"+t+"'.");return r}}class pR{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function fR(e){return"string"==typeof e||e instanceof String}function gR(e){return mR()&&e instanceof Blob}function mR(){return"undefined"!=typeof Blob}function vR(e,t,r,n){if(n<t)throw oR(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r<n)throw oR(`Invalid value for '${e}'. Expected ${r} or less.`)}function _R(e,t,r){let n=null==r?"https://"+t:t;return`${r}://${n}/v0`+e}function yR(e){var t,r,n=encodeURIComponent;let i="?";for(t in e)e.hasOwnProperty(t)&&(r=n(t)+"="+n(e[t]),i=i+r+"&");return i=i.slice(0,-1)}function wR(e,t){var r=500<=e&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}(WD=$N=$N||{})[WD.NO_ERROR=0]="NO_ERROR",WD[WD.NETWORK_ERROR=1]="NETWORK_ERROR",WD[WD.ABORT=2]="ABORT";class bR{constructor(e,t,r,n,i,s,a,o,l,h,u,c=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=c,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(i,e)=>{if(e)i(!1,new IR(!1,null,!0));else{let r=this.connectionFactory_(),n=(this.pendingConnection_=r,e=>{var t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)});null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;var e=r.getErrorCode()===$N.NO_ERROR,t=r.getStatus();!e||wR(t,this.additionalRetryCodes_)&&this.retry?(e=r.getErrorCode()===$N.ABORT,i(!1,new IR(!1,null,e))):(e=-1!==this.successCodes_.indexOf(t),i(!0,new IR(e,r)))})}},t=(e,t)=>{var r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?r(s):r()}catch(e){n(e)}else null!==i?((s=nR()).serverResponse=i.getErrorText(),this.errorCallback_?n(this.errorCallback_(i,s)):n(s)):t.canceled?n((this.appDelete_?lR:sR)()):n(iR())};this.canceled_?t(0,new IR(!1,null,!0)):this.backoffId_=((t,r,e)=>{let n=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let h=!1;function u(...e){h||(h=!0,r.apply(null,e))}function c(e){i=setTimeout(()=>{i=null,t(p,l())},e)}function d(){s&&clearTimeout(s)}function p(e,...t){if(h)d();else if(e)d(),u.call(null,e,...t);else if(l()||a)d(),u.call(null,e,...t);else{n<64&&(n*=2);let e;c(e=1===o?(o=2,0):1e3*(n+Math.random()))}}let f=!1;function g(e){f||(f=!0,d(),h)||(null!==i?(e||(o=2),clearTimeout(i),c(0)):e||(o=1))}return c(0),s=setTimeout(()=>{g(a=!0)},e),g})(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class IR{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function TR(...t){var r="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==r){var n=new r;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(mR())return new Blob(t);throw new tR(GN.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function ER(e){if("undefined"==typeof atob)throw new tR(GN.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}let CR={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class kR{constructor(e,t){this.data=e,this.contentType=t||null}}function SR(e,t){switch(e){case CR.RAW:return new kR(AR(t));case CR.BASE64:case CR.BASE64URL:return new kR(NR(e,t));case CR.DATA_URL:return new kR((r=t,(n=new RR(r)).base64?NR(CR.BASE64,n.rest):(e=>{let t;try{t=decodeURIComponent(e)}catch(e){throw uR(CR.DATA_URL,"Malformed data URL.")}return AR(t)})(n.rest)),(r=t,new RR(r).contentType))}var r,n;throw nR()}function AR(t){var r,n,i=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);e<=127?i.push(e):e<=2047?i.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,n=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&n,i.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):i.push(239,191,189):56320==(64512&e)?i.push(239,191,189):i.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(i)}function NR(t,e){switch(t){case CR.BASE64:var r=-1!==e.indexOf("-"),n=-1!==e.indexOf("_");if(r||n)throw uR(t,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break;case CR.BASE64URL:n=-1!==e.indexOf("+"),r=-1!==e.indexOf("/");if(n||r)throw uR(t,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=ER(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw uR(t,"Invalid character found")}var s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class RR{constructor(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw uR(CR.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var r,n,t=t[1]||null;null!=t&&(this.base64=(n=";base64",(r=t).length>=n.length&&r.substring(r.length-n.length)===n),this.contentType=this.base64?t.substring(0,t.length-";base64".length):t),this.rest=e.substring(e.indexOf(",")+1)}}class PR{constructor(e,t){let r=0,n="";gR(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){var r,n,i,s;return gR(this.data_)?(r=this.data_,i=e,s=t,null===(r=(n=r).webkitSlice?n.webkitSlice(i,s):n.mozSlice?n.mozSlice(i,s):n.slice?n.slice(i,s):null)?null:new PR(r)):(r=new Uint8Array(this.data_.buffer,e,t-e),new PR(r,!0))}static getBlob(...e){if(mR())return i=e.map(e=>e instanceof PR?e.data_:e),new PR(TR.apply(null,i));{var i=e.map(e=>fR(e)?SR(CR.RAW,e).data:e.data_);let t=0,r=(i.forEach(e=>{t+=e.byteLength}),new Uint8Array(t)),n=0;return i.forEach(e=>{for(let t=0;t<e.length;t++)r[n++]=e[t]}),new PR(r,!0)}}uploadData(){return this.data_}}function DR(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function xR(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function OR(e,t){return t}class LR{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||OR}}let MR=null;function FR(){var e,t;return MR||((e=[]).push(new LR("bucket")),e.push(new LR("generation")),e.push(new LR("metageneration")),e.push(new LR("name","fullPath",!0)),(t=new LR("name")).xform=function(e,t){return!fR(t=t)||t.length<2?t:xR(t)},e.push(t),(t=new LR("size")).xform=function(e,t){return void 0!==t?Number(t):t},e.push(t),e.push(new LR("timeCreated")),e.push(new LR("updated")),e.push(new LR("md5Hash",null,!0)),e.push(new LR("cacheControl",null,!0)),e.push(new LR("contentDisposition",null,!0)),e.push(new LR("contentEncoding",null,!0)),e.push(new LR("contentLanguage",null,!0)),e.push(new LR("contentType",null,!0)),e.push(new LR("metadata","customMetadata",!0)),MR=e),MR}function UR(r,n){Object.defineProperty(r,"ref",{get:function(){var e=r.bucket,t=r.fullPath,e=new dR(e,t);return n._makeStorageReference(e)}})}function VR(e,t,r){var n=DR(t);if(null===n)return null;var t=e,i=n,s=r,a={type:"file"},o=s.length;for(let h=0;h<o;h++){var l=s[h];a[l.local]=l.xform(a,i[l.server])}return UR(a,t),a}function qR(e,t){var r={},n=t.length;for(let s=0;s<n;s++){var i=t[s];i.writable&&(r[i.server]=e[i.local])}return JSON.stringify(r)}let jR="prefixes",BR="items";function zR(e,t,r){var n=DR(r);if(null===n)return null;var i=e,s=t,r=n,a={prefixes:[],items:[],nextPageToken:r.nextPageToken};if(r[jR])for(var o of r[jR]){o=o.replace(/\/$/,""),o=i._makeStorageReference(new dR(s,o));a.prefixes.push(o)}if(r[BR])for(var l of r[BR]){l=i._makeStorageReference(new dR(s,l.name));a.items.push(l)}return a}class KR{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function WR(e){if(!e)throw nR()}function HR(n,i){return function(e,t){var r=VR(n,t,i);return WR(null!==r),r}}function GR(n,i){return function(e,t){var r=zR(n,i,t);return WR(null!==r),r}}function $R(o,n){return function(e,t){var r=VR(o,t,n);WR(null!==r);{var i=r,s=o.host,a=o._protocol;if(null===(r=DR(t)))return null;if(!fR(r.downloadTokens))return null;if(0===(r=r.downloadTokens).length)return null;let n=encodeURIComponent;return r.split(",").map(e=>{var t=i.bucket,r=i.fullPath;return _R("/b/"+n(t)+"/o/"+n(r),s,a)+yR({alt:"media",token:e})})[0]}}}function QR(i){return function(e,t){let r;var n;return(r=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new tR(GN.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new tR(GN.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(n=i.bucket,new tR(GN.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(n=i.path,new tR(GN.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")):t).status=e.getStatus(),r.serverResponse=t.serverResponse,r}}function YR(n){let i=QR(n);return function(e,t){let r=i(e,t);return(r=404===e.getStatus()?(e=n.path,new tR(GN.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")):r).serverResponse=t.serverResponse,r}}function JR(e,t,r){var n=_R(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,n=new KR(n,"GET",HR(e,r),i);return n.errorHandler=YR(t),n}function XR(e,t,r){var n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=(r=t,(e=null)&&e.contentType||r&&r.type()||"application/octet-stream")),n}function ZR(e,t,r,n,i){var s=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var o=(()=>{let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e})(),l=(a["Content-Type"]="multipart/related; boundary="+o,XR(t,n,i)),h="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+qR(l,r)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",o="\r\n--"+o+"--",h=PR.getBlob(h,n,o);if(null===h)throw aR();o={name:l.fullPath},l=_R(s,e.host,e._protocol),s=e.maxUploadRetryTime,l=new KR(l,"POST",HR(e,r),s);return l.urlParams=o,l.headers=a,l.body=h.uploadData(),l.errorHandler=QR(t),l}class eP{constructor(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null}}function tP(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){WR(!1)}return WR(!!r&&-1!==(t||["active"]).indexOf(r)),r}function rP(e,t,r,n,i){var s=t.bucketOnlyServerUrl(),a=XR(t,n,i),o={name:a.fullPath},s=_R(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+n.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},a=qR(a,r),h=e.maxUploadRetryTime;s=new KR(s,"POST",function(e){tP(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){WR(!1)}return WR(fR(t)),t},h);return s.urlParams=o,s.headers=l,s.body=a,s.errorHandler=QR(t),s}function nP(e,t,r,i){var n=e.maxUploadRetryTime,n=new KR(r,"POST",function(e){var t=tP(e,["active","final"]);let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){WR(!1)}r||WR(!1);var n=Number(r);return WR(!isNaN(n)),new eP(n,i.size(),"final"===t)},n);return n.headers={"X-Goog-Upload-Command":"query"},n.errorHandler=QR(t),n}function iP(e,a,t,o,r,l,n,i){let h=new eP(0,0);if(n?(h.current=n.current,h.total=n.total):(h.current=0,h.total=o.size()),o.size()!==h.total)throw new tR(GN.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var s=h.total-h.current;let u=s;0<r&&(u=Math.min(u,r));var c=h.current,d=c+u;let p="";s={"X-Goog-Upload-Command":p=0===u?"finalize":s===u?"upload, finalize":"upload","X-Goog-Upload-Offset":""+h.current},c=o.slice(c,d);if(null===c)throw aR();d=a.maxUploadRetryTime,d=new KR(t,"POST",function(e,t){var r=tP(e,["active","final"]),n=h.current+u,i=o.size();let s;return s="final"===r?HR(a,l)(e,t):null,new eP(n,i,"final"===r,s)},d);return d.headers=s,d.body=c.uploadData(),d.progressCallback=i||null,d.errorHandler=QR(e),d}let sP={STATE_CHANGED:"state_changed"},aP={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function oP(e){switch(e){case"running":case"pausing":case"canceling":return aP.RUNNING;case"paused":return aP.PAUSED;case"success":return aP.SUCCESS;case"canceled":return aP.CANCELED;default:return aP.ERROR}}class lP{constructor(e,t,r){var n;"function"==typeof e||null!=t||null!=r?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0):(this.next=(n=e).next,this.error=n.error,this.complete=n.complete)}}function hP(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class uP extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=$N.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$N.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$N.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,n){if(this.sent_)throw cR("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==n)for(var i in n)n.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,n[i].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(this.sent_)return this.errorCode_;throw cR("cannot .getErrorCode() before sending")}getStatus(){if(!this.sent_)throw cR("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(this.sent_)return this.xhr_.response;throw cR("cannot .getResponse() before sending")}getErrorText(){if(this.sent_)return this.xhr_.statusText;throw cR("cannot .getErrorText() before sending")}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function cP(){return new uP}class dP{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=FR(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(GN.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(wR(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=iR()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(GN.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){let t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(r){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":r(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var r=rP(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(r,cP,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let n=this._uploadUrl;this._resolveToken((e,t)=>{var r=nP(this._ref.storage,this._ref._location,n,this._blob),r=this._ref.storage._makeRequest(r,cP,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let i=262144*this._chunkMultiplier,s=new eP(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let r;try{r=iP(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}var n=this._ref.storage._makeRequest(r,cP,e,t,!1);(this._request=n).getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(262144*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var r=JR(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(r,cP,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var r=ZR(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(r,cP,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=sR(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=oP(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,n){let i=new lP(t||void 0,r||void 0,n||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(oP(this._state)){case aP.SUCCESS:hP(this._resolve.bind(null,this.snapshot))();break;case aP.CANCELED:case aP.ERROR:hP(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(oP(this._state)){case aP.RUNNING:case aP.PAUSED:e.next&&hP(e.next.bind(e,this.snapshot))();break;case aP.SUCCESS:e.complete&&hP(e.complete.bind(e))();break;case aP.CANCELED:case aP.ERROR:default:e.error&&hP(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class pP{constructor(e,t){this._service=e,t instanceof dR?this._location=t:this._location=dR.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new pP(e,t)}get root(){var e=new dR(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return xR(this._location.path)}get storage(){return this._service}get parent(){var e,t,r=0===(e=this._location.path).length?null:-1===(r=e.lastIndexOf("/"))?"":e.slice(0,r);return null===r?null:(t=new dR(this._location.bucket,r),new pP(this._service,t))}_throwIfRoot(e){if(""===this._location.path)throw hR(e)}}function fP(e){let t={prefixes:[],items:[]};return async function e(t,r,n){let i={pageToken:n};let s=await gP(t,i);r.prefixes.push(...s.prefixes);r.items.push(...s.items);null!=s.nextPageToken&&await e(t,r,s.nextPageToken)}(e,t).then(()=>t)}function gP(e,t){null!=t&&"number"==typeof t.maxResults&&vR("options.maxResults",1,1e3,t.maxResults);var r,n,i,s,a,o=t||{},l=(t=e.storage,r=e._location,n="/",i=o.pageToken,s=o.maxResults,o={},r.isRoot?o.prefix="":o.prefix=r.path+"/",n&&0<n.length&&(o.delimiter=n),i&&(o.pageToken=i),s&&(o.maxResults=s),a=_R(a=r.bucketOnlyServerUrl(),t.host,t._protocol),l=t.maxOperationRetryTime,(a=new KR(a,"GET",GR(t,r.bucket),l)).urlParams=o,a.errorHandler=QR(r),a);return e.storage.makeRequestWithTokens(l,cP)}function mP(e,t){e._throwIfRoot("updateMetadata");r=e.storage,n=e._location,t=t,i=FR(),s=_R(n.fullServerUrl(),r.host,r._protocol),a=qR(t,i),o=r.maxOperationRetryTime,(s=new KR(s,"PATCH",HR(r,i),o)).headers={"Content-Type":"application/json; charset=utf-8"},s.body=a,s.errorHandler=YR(n);var r,n,i,s,a,o=s;return e.storage.makeRequestWithTokens(o,cP)}function vP(e){e._throwIfRoot("getDownloadURL");t=e.storage,r=e._location,n=FR(),i=_R(r.fullServerUrl(),t.host,t._protocol),s=t.maxOperationRetryTime,(i=new KR(i,"GET",$R(t,n),s)).errorHandler=YR(r);var t,r,n,i,s=i;return e.storage.makeRequestWithTokens(s,cP).then(e=>{if(null===e)throw new tR(GN.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function _P(e){e._throwIfRoot("deleteObject");t=e.storage,n=_R((r=e._location).fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,(n=new KR(n,"DELETE",function(e,t){},i)).successCodes=[200,204],n.errorHandler=YR(r);var t,r,n,i=n;return e.storage.makeRequestWithTokens(i,cP)}function yP(e,t){r=e._location.path,n=t.split("/").filter(e=>0<e.length).join("/");var r,n=0===r.length?n:r+"/"+n,n=new dR(e._location.bucket,n);return new pP(e.storage,n)}function wP(e,t){if(e instanceof TP){var r=e;if(null==r._bucket)throw new tR(GN.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+eR+"' property when initializing the app?");r=new pP(r,r._bucket);return null!=t?wP(r,t):r}return void 0!==t?yP(e,t):e}function bP(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof TP)return r=e,n=t,new pP(r,n);throw oR("To use ref(service, url), the first argument must be a Storage instance.")}return wP(e,t);var r,n}function IP(e,t){var r=null==t?void 0:t[eR];return null==r?null:dR.makeFromBucketSpec(r,e)}class TP{constructor(e,t,r,n,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._bucket=null,this._host=ZN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=n?dR.makeFromBucketSpec(n,this._host):IP(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=dR.makeFromBucketSpec(this._url,e):this._bucket=IP(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){vR("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){vR("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;var e=this._authProvider.getImmediate({optional:!0});if(e){e=await e.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){var e;return h(this.app)&&this.app.settings.appCheckToken?this.app.settings.appCheckToken:(e=this._appCheckProvider.getImmediate({optional:!0}))?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pP(this,e)}_makeRequest(t,r,n,i,s=!0){if(this._deleted)return new pR(lR());{[t,n,i,r,s,a,o=!0]=[t,this._appId,n,i,r,this._firebaseVersion,s],h=yR(t.urlParams),h=t.url+h,u=Object.assign({},t.headers),l=u,(n=n)&&(l["X-Firebase-GMPID"]=n),l=u,null!==(n=i)&&0<n.length&&(l.Authorization="Firebase "+n),i=a,u["X-Firebase-Storage-Version"]="webjs/"+(null!=i?i:"AppManager"),l=u,null!==(n=r)&&(l["X-Firebase-AppCheck"]=n);let e=new bR(h,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o);return this._requests.add(e),e.getPromise().then(()=>this._requests.delete(e),()=>this._requests.delete(e)),e}var a,o,l,h,u}async makeRequestWithTokens(e,t){var[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let EP="@firebase/storage";function CP(e,t,r){return e=w(e),t=t,r=r,(e=e)._throwIfRoot("uploadBytesResumable"),new dP(e,new PR(t),r)}function kP(e){return e=w(e),(e=e)._throwIfRoot("getMetadata"),t=JR(e.storage,e._location,FR()),e.storage.makeRequestWithTokens(t,cP);var t}function SP(e,t){return bP(e=w(e),t)}function AP(e,t,r,n={}){var i;[e,t,r,n={}]=[e,t,r,n],e.host=t+":"+r,e._protocol="http",(i=n.mockUserToken)&&(e._overrideAuthToken="string"==typeof i?i:ee(i,e.app.options.projectId))}function NP(e,{instanceIdentifier:t}){var r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new TP(r,n,i,t,xt)}kt(new u("storage",NP,"PUBLIC").setMultipleInstances(!0)),d(EP,"0.13.7",""),d(EP,"0.13.7","esm2017");class RP{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class PP{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new RP(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new RP(e,this,this._ref))},e)}on(e,t,r,n){let i=void 0;return t&&(i="function"==typeof t?e=>t(new RP(e,this,this._ref)):{next:t.next?e=>t.next(new RP(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,r||void 0,n||void 0)}}class DP{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new xP(e,this._service))}get items(){return this._delegate.items.map(e=>new xP(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class xP{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=yP(this._delegate,e);return new xP(t,this.storage)}get root(){return new xP(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new xP(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new PP(CP(this._delegate,e,t),this)}putString(e,t=CR.RAW,r){this._throwIfRoot("putString");var n=SR(t,e),i=Object.assign({},r);return null==i.contentType&&null!=n.contentType&&(i.contentType=n.contentType),new PP(new dP(this._delegate,new PR(n.data,!0),i),this)}listAll(){return fP(w(this._delegate)).then(e=>new DP(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,gP(t=w(t),e).then(e=>new DP(e,this.storage));var t}getMetadata(){return kP(this._delegate)}updateMetadata(e){return mP(w(this._delegate),e)}getDownloadURL(){return vP(w(this._delegate))}delete(){return this._throwIfRoot("delete"),_P(w(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw hR(e)}}class OP{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(LP(e))throw oR("ref() expected a child path but got a URL, use refFromURL instead.");return new xP(SP(this._delegate,e),this)}refFromURL(e){if(!LP(e))throw oR("refFromURL() expected a full URL but got a child path, use ref() instead.");try{dR.makeFromUrl(e,this._delegate.host)}catch(e){throw oR("refFromUrl() expected a valid full URL but got an invalid one.")}return new xP(SP(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){AP(this._delegate,e,t,r)}}function LP(e){return/^[A-Za-z]+:\/\//.test(e)}function MP(e,{instanceIdentifier:t}){var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("storage").getImmediate({identifier:t});return new OP(r,n)}QN=rr,wm={TaskState:aP,TaskEvent:sP,StringFormat:CR,Storage:OP,Reference:xP},QN.INTERNAL.registerComponent(new u("storage-compat",MP,"PUBLIC").setServiceProps(wm).setMultipleInstances(!0)),QN.registerVersion("@firebase/storage-compat","0.3.17");function FP(e){if("loading"===document.readyState)return"loading";var t=GP();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"}function UP(e,t){var r="";try{for(;e&&9!==e.nodeType;){var n=e,i=n.id?"#"+n.id:$P(n)+(n.classList&&n.classList.value&&n.classList.value.trim()&&n.classList.value.trim().length?"."+n.classList.value.trim().replace(/\s+/g,"."):"");if(r.length+i.length>(t||100)-1)return r||i;if(r=r?i+">"+r:i,n.id)break;e=n.parentNode}}catch(e){}return r}function VP(i,e){var a,o,s,l;a=function(e){r={},(e=e).entries.length&&(t=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t}))&&t.sources&&t.sources.length&&(n=(n=t.sources).find(function(e){return e.node&&1===e.node.nodeType})||n[0])&&(r={largestShiftTarget:UP(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:FP(t.startTime)});var t,r,n=Object.assign(e,{attribution:r});i(n)},o=e||{},s=iD(function(){function e(e){e.forEach(function(e){var t,r;e.hadRecentInput||(t=i[0],r=i[i.length-1],n&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(n+=e.value,i.push(e)):(n=e.value,i=[e]))}),n>r.value&&(r.value=n,r.entries=i,t())}var t,r=ZP("CLS",0),n=0,i=[],s=eD("layout-shift",e);s&&(t=tD(a,r,pD,o.reportAllChanges),nD(function(){e(s.takeRecords()),t(!0)}),JP(function(){r=ZP("CLS",n=0),t=tD(a,r,pD,o.reportAllChanges),rD(function(){return t()})}),setTimeout(t,0))}),l=l||{},cD(function(){var t,r=uD(),n=ZP("FCP"),i=eD("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<r.firstHiddenTime)&&(n.value=Math.max(e.startTime-XP(),0),n.entries.push(e),t(!0))})});i&&(t=tD(s,n,dD,l.reportAllChanges),JP(function(e){n=ZP("FCP"),t=tD(s,n,dD,l.reportAllChanges),rD(function(){n.value=performance.now()-e.timeStamp,t(!0)})}))})}function qP(s,a){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(a=a||{},cD(function(){var e;yD();function t(t){kD(function(){t.forEach(CD);var e=TD();e&&e.latency!==r.value&&(r.value=e.latency,r.entries=e.entries,i())})}var r=ZP("INP"),n=eD("event",t,{durationThreshold:null!=(e=a.durationThreshold)?e:40}),i=tD(s,r,SD,a.reportAllChanges);n&&(n.observe({type:"first-input",buffered:!0}),nD(function(){t(n.takeRecords()),i(!0)}),JP(function(){ID=_D(),wD.length=0,bD.clear(),r=ZP("INP"),i=tD(s,r,SD,a.reportAllChanges)}))}))}function jP(e){AD=AD.concat(e),OD()}function BP(){10<DD.size&&DD.forEach(function(e,t){bD.has(t)||DD.delete(t)});var r=wD.map(function(e){return PD.get(e.entries[0])}),n=ND.length-50;ND=ND.filter(function(e,t){return n<=t||r.includes(e)});for(var i=new Set,e=0;e<ND.length;e++){var t=ND[e];LD(t.startTime,t.processingEnd).forEach(function(e){i.add(e)})}var s=AD.length-1-50;AD=AD.filter(function(e,t){return e.startTime>RD&&s<t||i.has(e)}),xD=-1}function zP(l,e){HP=HP||eD("long-animation-frame",jP),qP(function(e){t=(e=e).entries[0],o=PD.get(t),r=t.processingStart,n=o.processingEnd,o=o.entries.sort(function(e,t){return e.processingStart-t.processingStart}),i=LD(t.startTime,n),s=(s=e.entries.find(function(e){return e.target}))&&s.target||DD.get(t.interactionId),a=[t.startTime+t.duration,n].concat(i.map(function(e){return e.startTime+e.duration})),a=Math.max.apply(Math,a),s={interactionTarget:UP(s),interactionTargetElement:s,interactionType:t.name.startsWith("key")?"keyboard":"pointer",interactionTime:t.startTime,nextPaintTime:a,processedEventEntries:o,longAnimationFrameEntries:i,inputDelay:r-t.startTime,processingDuration:n-r,presentationDelay:Math.max(a-n,0),loadState:FP(t.startTime)};var t,r,n,i,s,a,o=Object.assign(e,{attribution:s});l(o)},e)}function KP(h,e){var a,o;a=function(e){o={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:(e=e).value},e.entries.length&&(t=GP())&&(a=t.activationStart||0,n=(r=e.entries[e.entries.length-1]).url&&performance.getEntriesByType("resource").filter(function(e){return e.name===r.url})[0],l=Math.max(0,t.responseStart-a),i=Math.max(l,n?(n.requestStart||n.startTime)-a:0),s=Math.max(i,n?n.responseEnd-a:0),a=Math.max(s,r.startTime-a),o={element:UP(r.element),timeToFirstByte:l,resourceLoadDelay:i-l,resourceLoadDuration:s-i,elementRenderDelay:a-s,navigationEntry:t,lcpEntry:r},r.url&&(o.url=r.url),n)&&(o.lcpResourceEntry=n);var t,r,n,i,s,a,o,l=Object.assign(e,{attribution:o});h(l)},o=e||{},cD(function(){function e(e){(e=o.reportAllChanges?e:e.slice(-1)).forEach(function(e){e.startTime<n.firstHiddenTime&&(i.value=Math.max(e.startTime-XP(),0),i.entries=[e],t())})}var t,r,n=uD(),i=ZP("LCP"),s=eD("largest-contentful-paint",e);s&&(t=tD(a,i,MD,o.reportAllChanges),r=iD(function(){FD[i.id]||(e(s.takeRecords()),s.disconnect(),FD[i.id]=!0,t(!0))}),["keydown","click"].forEach(function(e){addEventListener(e,function(){return kD(r)},{once:!0,capture:!0})}),nD(r),JP(function(e){i=ZP("LCP"),t=tD(a,i,MD,o.reportAllChanges),rD(function(){i.value=performance.now()-e.timeStamp,FD[i.id]=!0,t(!0)})}))})}var WP,HP,GP=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&0<e.responseStart&&e.responseStart<performance.now())return e},$P=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},QP=-1,YP=function(){return QP},JP=function(t){addEventListener("pageshow",function(e){e.persisted&&(QP=e.timeStamp,t(e))},!0)},XP=function(){var e=GP();return e&&e.activationStart||0},ZP=function(e,t){var r=GP(),n="navigate";return 0<=YP()?n="back-forward-cache":r&&(document.prerendering||0<XP()?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},eD=function(e,t,r){try{var n;if(PerformanceObserver.supportedEntryTypes.includes(e))return(n=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},r||{})),n}catch(e){}},tD=function(t,r,n,i){var s,a;return function(e){0<=r.value&&(e||i)&&((a=r.value-(s||0))||void 0===s)&&(s=r.value,r.delta=a,r.rating=(e=r.value)>n[1]?"poor":e>n[0]?"needs-improvement":"good",t(r))}},rD=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},nD=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},iD=function(e){var t=!1;return function(){t||(e(),t=!0)}},sD=-1,aD=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},oD=function(e){"hidden"===document.visibilityState&&-1<sD&&(sD="visibilitychange"===e.type?e.timeStamp:0,hD())},lD=function(){addEventListener("visibilitychange",oD,!0),addEventListener("prerenderingchange",oD,!0)},hD=function(){removeEventListener("visibilitychange",oD,!0),removeEventListener("prerenderingchange",oD,!0)},uD=function(){return sD<0&&(sD=aD(),lD(),JP(function(){setTimeout(function(){sD=aD(),lD()},0)})),{get firstHiddenTime(){return sD}}},cD=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},dD=[1800,3e3],pD=[.1,.25],fD=0,gD=1/0,mD=0,vD=function(e){e.forEach(function(e){e.interactionId&&(gD=Math.min(gD,e.interactionId),mD=Math.max(mD,e.interactionId),fD=mD?(mD-gD)/7+1:0)})},_D=function(){return WP?fD:performance.interactionCount||0},yD=function(){"interactionCount"in performance||(WP=WP||eD("event",vD,{type:"event",buffered:!0,durationThreshold:0}))},wD=[],bD=new Map,ID=0,TD=function(){var e=Math.min(wD.length-1,Math.floor((_D()-ID)/50));return wD[e]},ED=[],CD=function(t){var e,r;ED.forEach(function(e){return e(t)}),!t.interactionId&&"first-input"!==t.entryType||(r=wD[wD.length-1],((e=bD.get(t.interactionId))||wD.length<10||t.duration>r.latency)&&(e?t.duration>e.latency?(e.entries=[t],e.latency=t.duration):t.duration===e.latency&&t.startTime===e.entries[0].startTime&&e.entries.push(t):(r={id:t.interactionId,latency:t.duration,entries:[t]},bD.set(r.id,r),wD.push(r)),wD.sort(function(e,t){return t.latency-e.latency}),10<wD.length)&&wD.splice(10).forEach(function(e){return bD.delete(e.id)}))},kD=function(e){var t=self.requestIdleCallback||self.setTimeout,r=-1;return e=iD(e),"hidden"===document.visibilityState?e():(r=t(e),nD(e)),r},SD=[200,500],AD=[],ND=[],RD=0,PD=new WeakMap,DD=new Map,xD=-1,OD=function(){xD<0&&(xD=kD(BP))},LD=(ED.push(function(e){e.interactionId&&e.target&&!DD.has(e.interactionId)&&DD.set(e.interactionId,e.target)},function(e){var t,r=e.startTime+e.duration;RD=Math.max(RD,e.processingEnd);for(var n=ND.length-1;0<=n;n--){var i=ND[n];if(Math.abs(r-i.renderTime)<=8){(t=i).startTime=Math.min(e.startTime,t.startTime),t.processingStart=Math.min(e.processingStart,t.processingStart),t.processingEnd=Math.max(e.processingEnd,t.processingEnd),t.entries.push(e);break}}t||(t={startTime:e.startTime,processingStart:e.processingStart,processingEnd:e.processingEnd,renderTime:r,entries:[e]},ND.push(t)),!e.interactionId&&"first-input"!==e.entryType||PD.set(e,t),OD()}),function(e,t){for(var r,n=[],i=0;r=AD[i];i++)if(!(r.startTime+r.duration<e)){if(r.startTime>t)break;n.push(r)}return n}),MD=[2500,4e3],FD={};let UD="@firebase/performance",VD="0.7.1",qD=VD,jD="FB-PERF-TRACE-MEASURE",BD="@firebase/performance/config",zD="@firebase/performance/configexpire";var KD,t,r,WD,e="Performance";let HD=new fe("performance",e,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),GD=new Qe(e);GD.logLevel=c.INFO;let $D,QD;class YD{constructor(e){if(!(this.window=e))throw HD.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=KP,this.onINP=zP,this.onCLS=VP}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,r){this.performance&&this.performance.measure&&this.performance.measure(e,t,r)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&de()?!!ue()||(GD.info("IndexedDB is not supported by current browser"),!1):(GD.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,r){this.PerformanceObserver&&new this.PerformanceObserver(e=>{for(var t of e.getEntries())r(t)}).observe({entryTypes:[e]})}static getInstance(){return $D=void 0===$D?new YD(QD):$D}}let JD;function XD(e,t){var r=e.length-t.length;if(r<0||1<r)throw HD.create("invalid String merger input");var n=[];for(let i=0;i<e.length;i++)n.push(e.charAt(i)),t.length>i&&n.push(t.charAt(i));return n.join("")}let ZD;class ex{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=XD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=XD("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return ZD=void 0===ZD?new ex:ZD}}(t=KD=KD||{})[t.UNKNOWN=0]="UNKNOWN",t[t.VISIBLE=1]="VISIBLE",t[t.HIDDEN=2]="HIDDEN";let tx=["firebase_","google_","ga_"],rx=new RegExp("^[a-zA-Z]\\w*$");function nx(e){var t=null==(t=e.options)?void 0:t.appId;if(t)return t;throw HD.create("no app id")}let ix="0.0.1",sx={loggingEnabled:!0},ax="FIREBASE_INSTALLATIONS_AUTH";function ox(e,t){var n,i,r=(()=>{var e=YD.getInstance().localStorage;if(e){var t=e.getItem(zD);if(t&&(e=>Number(e)>Date.now())(t)){t=e.getItem(BD);if(t)try{return JSON.parse(t)}catch(e){}}}})();return r?(hx(r),Promise.resolve()):(i=t,(e=>{var t=e.getToken();return t.then(e=>{}),t})((n=e).installations).then(e=>{var t=(e=>{var t=null==(t=e.options)?void 0:t.projectId;if(t)return t;throw HD.create("no project id")})(n.app),r=(e=>{var t=null==(t=e.options)?void 0:t.apiKey;if(t)return t;throw HD.create("no api key")})(n.app),t=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=`+r,{method:"POST",headers:{Authorization:ax+" "+e},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:nx(n.app),app_version:qD,sdk_version:ix})});return fetch(t).then(e=>{if(e.ok)return e.json();throw HD.create("RC response not ok")})}).catch(()=>{GD.info(lx)}).then(hx).then(e=>{var t;e=e,t=YD.getInstance().localStorage,e&&t&&(t.setItem(BD,JSON.stringify(e)),t.setItem(zD,String(Date.now()+60*ex.getInstance().configTimeToLive*60*1e3)))},()=>{}))}let lx="Could not fetch config, will use default configs";function hx(e){var t,r;return e&&(t=ex.getInstance(),void 0!==(r=e.entries||{}).fpr_enabled?t.loggingEnabled="true"===String(r.fpr_enabled):t.loggingEnabled=sx.loggingEnabled,r.fpr_log_source?t.logSource=Number(r.fpr_log_source):sx.logSource&&(t.logSource=sx.logSource),r.fpr_log_endpoint_url?t.logEndPointUrl=r.fpr_log_endpoint_url:sx.logEndPointUrl&&(t.logEndPointUrl=sx.logEndPointUrl),r.fpr_log_transport_key?t.transportKey=r.fpr_log_transport_key:sx.transportKey&&(t.transportKey=sx.transportKey),void 0!==r.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(r.fpr_vc_network_request_sampling_rate):void 0!==sx.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=sx.networkRequestsSamplingRate),void 0!==r.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(r.fpr_vc_trace_sampling_rate):void 0!==sx.tracesSamplingRate&&(t.tracesSamplingRate=sx.tracesSamplingRate),t.logTraceAfterSampling=ux(t.tracesSamplingRate),t.logNetworkAfterSampling=ux(t.networkRequestsSamplingRate)),e}function ux(e){return Math.random()<=e}let cx=1,dx;function px(e){var r;return cx=2,dx=dx||(r=e,(()=>{let r=YD.getInstance().document;return new Promise(t=>{if(r&&"complete"!==r.readyState){let e=()=>{"complete"===r.readyState&&(r.removeEventListener("readystatechange",e),t())};r.addEventListener("readystatechange",e)}else t()})})().then(()=>{return e=r.installations,(t=e.getId()).then(e=>{JD=e}),t;var e,t}).then(e=>ox(r,e)).then(()=>fx(),()=>fx()))}function fx(){cx=3}let gx=1e4,mx=1e3,vx=3,_x=vx,yx=[],wx=!1;function bx(e){setTimeout(()=>{0!==_x&&(0<yx.length&&Ix(),bx(gx))},e)}function Ix(){let e=yx.splice(0,mx);var t,r,n=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ex.getInstance().logSource,log_event:n};t=n,n=ex.getInstance().getFlTransportFullUrl(),r=JSON.stringify(t),(navigator.sendBeacon&&navigator.sendBeacon(n,r)?Promise.resolve():fetch(n,{method:"POST",body:r,keepalive:!0}).then()).then(()=>{_x=vx}).catch(()=>{yx=[...e,...yx],_x--,GD.info(`Tries left: ${_x}.`),bx(gx)})}function Tx(t){return(...e)=>{e={message:t(...e),eventTime:Date.now()};if(!e.eventTime||!e.message)throw HD.create("invalid cc log");yx=[...yx,e]}}function Ex(){for(;0<yx.length;)Ix()}let Cx;function kx(e,t){(Cx=Cx||{send:Tx(Nx),flush:Ex}).send(e,t)}function Sx(e){var t=ex.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&YD.getInstance().requiredApisAvailable()&&(3===cx?Ax(e):px(e.performanceController).then(()=>Ax(e),()=>Ax(e)))}function Ax(e){var t;JD&&(t=ex.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&kx(e,1)}function Nx(e,t){var r,n;return 0===t?(r={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},r={application_info:Rx(e.performanceController.app),network_request_metric:r},JSON.stringify(r)):(r={name:(t=e).name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs},0!==Object.keys(t.counters).length&&(r.counters=t.counters),n=t.getAttributes(),0!==Object.keys(n).length&&(r.custom_attributes=n),n={application_info:Rx(t.performanceController.app),trace_metric:r},JSON.stringify(n))}function Rx(e){return{google_app_id:nx(e),app_instance_id:JD,web_app_info:{sdk_version:qD,page_url:YD.getInstance().getUrl(),service_worker_status:null!=(t=YD.getInstance().navigator)&&t.serviceWorker?t.serviceWorker.controller?2:3:1,visibility_state:(()=>{switch(YD.getInstance().document.visibilityState){case"visible":return KD.VISIBLE;case"hidden":return KD.HIDDEN;default:return KD.UNKNOWN}})(),effective_connection_type:(()=>{var e=YD.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}})()},application_process_state:0};var t}function Px(e,t){var r,n,i,s=t;s&&void 0!==s.responseStart&&(i=YD.getInstance().getTimeOrigin(),i=Math.floor(1e3*(s.startTime+i)),r=s.responseStart?Math.floor(1e3*(s.responseStart-s.startTime)):void 0,n=Math.floor(1e3*(s.responseEnd-s.startTime)),s={performanceController:e,url:s.name&&s.name.split("?")[0],responsePayloadBytes:s.transferSize,startTimeUs:i,timeToResponseInitiatedUs:r,timeToResponseCompletedUs:n},t=s,(i=ex.getInstance()).instrumentationEnabled)&&(r=t.url,n=i.logEndPointUrl.split("?")[0],s=i.flTransportEndpointUrl.split("?")[0],r!==n)&&r!==s&&i.loggingEnabled&&i.logNetworkAfterSampling&&kx(t,0)}let Dx=["_fp","_fcp","_fid","_lcp","_cls","_inp"];class xx{constructor(e,t,r=!1,n){this.performanceController=e,this.name=t,this.isAuto=r,this.state=1,this.customAttributes={},this.counters={},this.api=YD.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-`+this.name,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-`+this.name,this.traceMeasure=n||`${jD}-${this.randomId}-`+this.name,n&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw HD.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw HD.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Sx(this)}record(e,t,r){if(e<=0)throw HD.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw HD.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),r&&r.attributes&&(this.customAttributes=Object.assign({},r.attributes)),r&&r.metrics)for(var n of Object.keys(r.metrics))isNaN(Number(r.metrics[n]))||(this.counters[n]=Math.floor(Number(r.metrics[n])));Sx(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,i=this.name,0===n.length||100<n.length||!(i&&i.startsWith("_wt_")&&-1<Dx.indexOf(n))&&n.startsWith("_"))throw HD.create("invalid custom metric name",{customMetricName:e});var r,n,i;this.counters[e]=(i=null!=t?t:0,(r=Math.floor(i))<i&&GD.info(`Metric value should be an Integer, setting the value as : ${r}.`),r)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var r,n,i=!(0===(r=e).length||40<r.length||tx.some(e=>r.startsWith(e))||!r.match(rx)),s=0!==(n=t).length&&n.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw HD.create("invalid attribute name",{attributeName:e});if(!s)throw HD.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,r,n,i){var s=YD.getInstance().getUrl();if(s){var s=new xx(e,"_wt_"+s,!0),a=Math.floor(1e3*YD.getInstance().getTimeOrigin());s.setStartTime(a),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));r&&((a=r.find(e=>"first-paint"===e.name))&&a.startTime&&s.putMetric("_fp",Math.floor(1e3*a.startTime)),(a=r.find(e=>"first-contentful-paint"===e.name))&&a.startTime&&s.putMetric("_fcp",Math.floor(1e3*a.startTime)),i)&&s.putMetric("_fid",Math.floor(1e3*i)),this.addWebVitalMetric(s,"_lcp","lcp_element",n.lcp),this.addWebVitalMetric(s,"_cls","cls_largestShiftTarget",n.cls),this.addWebVitalMetric(s,"_inp","inp_interactionTarget",n.inp),Sx(s),Cx&&Cx.flush()}}static addWebVitalMetric(e,t,r,n){n&&(e.putMetric(t,Math.floor(1e3*n.value)),n.elementAttribution)&&e.putAttribute(r,n.elementAttribution)}static createUserTimingTrace(e,t){Sx(new xx(e,t,!1,t))}}let Ox={},Lx=!1,Mx;function Fx(n){JD&&(setTimeout(()=>{{var t=n;let e=YD.getInstance();"onpagehide"in window?e.document.addEventListener("pagehide",()=>Vx(t)):e.document.addEventListener("unload",()=>Vx(t)),e.document.addEventListener("visibilitychange",()=>{"hidden"===e.document.visibilityState&&Vx(t)}),e.onFirstInputDelay&&e.onFirstInputDelay(e=>{Mx=e}),e.onLCP(e=>{var t;Ox.lcp={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.element}}),e.onCLS(e=>{var t;Ox.cls={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.largestShiftTarget}}),e.onINP(e=>{var t;Ox.inp={value:e.value,elementAttribution:null==(t=e.attribution)?void 0:t.interactionTarget}})}},0),setTimeout(()=>{var e,t=n,r=YD.getInstance();for(e of r.getEntriesByType("resource"))Px(t,e);r.setupObserver("resource",e=>Px(t,e))},0),setTimeout(()=>{var e,t=n,r=YD.getInstance();for(e of r.getEntriesByType("measure"))Ux(t,e);r.setupObserver("measure",e=>Ux(t,e))},0))}function Ux(e,t){var r=t.name;r.substring(0,jD.length)!==jD&&xx.createUserTimingTrace(e,r)}function Vx(r){if(!Lx){Lx=!0;var n=YD.getInstance();let e=n.getEntriesByType("navigation"),t=n.getEntriesByType("paint");setTimeout(()=>{xx.createOobTrace(r,e,t,Ox,Mx)},0)}}class qx{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),YD.getInstance().requiredApisAvailable()?ce().then(e=>{e&&(wx||(bx(5500),wx=!0),px(this).then(()=>Fx(this),()=>Fx(this)),this.initialized=!0)}).catch(e=>{GD.info("Environment doesn't support IndexedDB: "+e)}):GD.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){ex.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return ex.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){ex.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return ex.getInstance().dataCollectionEnabled}}let jx="[DEFAULT]";let Bx=(e,{options:t})=>{var r=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(r.name!==jx)throw HD.create("FB not default");if("undefined"==typeof window)throw HD.create("no window");e=window,QD=e;r=new qx(r,n);return r._init(t),r};kt(new u("performance",Bx,"PUBLIC")),d(UD,VD),d(UD,VD,"esm2017");class zx{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=w(t),new xx(t,e);var t}}function Kx(e){var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("performance").getImmediate();return new zx(t,r)}(r=rr).INTERNAL.registerComponent(new u("performance-compat",Kx,"PUBLIC")),r.registerVersion("@firebase/performance-compat","0.2.14");let Wx="@firebase/remote-config";class Hx{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let Gx=new fe("remoteconfig","Remote Config",{"already-initialized":"Remote Config already initialized","registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser","custom-signal-max-allowed-signals":"Setting more than {$maxSignals} custom signals is not supported."});let $x=["1","true","t","yes","y","on"];class Qx{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=$x.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return e=isNaN(e)?0:e}getSource(){return this._source}}async function Yx(e){var t=w(e),[r,n]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(r&&r.config&&r.eTag&&r.eTag!==n)&&(await Promise.all([t._storageCache.setActiveConfig(r.config),t._storage.setActiveConfigEtag(r.eTag)]),!0)}function Jx(e){let t=w(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function Xx(t){var r=w(t);let e=new Hx;setTimeout(async()=>{e.abort()},r.settings.fetchTimeoutMillis);var n,i=r._storageCache.getCustomSignals();i&&r._logger.debug("Fetching config with custom signals: "+JSON.stringify(i));try{await r._client.fetch({cacheMaxAgeMillis:r.settings.minimumFetchIntervalMillis,signal:e,customSignals:i}),await r._storageCache.setLastFetchStatus("success")}catch(e){t="fetch-throttle";i=(n=e)instanceof pe&&-1!==n.code.indexOf(t)?"throttle":"failure";throw await r._storageCache.setLastFetchStatus(i),e}}function Zx(r){var e,t,n=w(r);return[e={},t={}]=[n._storageCache.getActiveConfig(),n.defaultConfig],Object.keys(Object.assign(Object.assign({},e),t)).reduce((e,t)=>(e[t]=e1(r,t),e),{})}function e1(e,t){var r=w(e),n=(r._isInitializationComplete||r._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value."),r._storageCache.getActiveConfig());return n&&void 0!==n[t]?new Qx("remote",n[t]):r.defaultConfig&&void 0!==r.defaultConfig[t]?new Qx("default",String(r.defaultConfig[t])):(r._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new Qx("static"))}class t1{constructor(e,t,r,n){this.client=e,this.storage=t,this.storageCache=r,this.logger=n}isCachedDataFresh(e,t){var r;return t?(r=Date.now()-t,this.logger.debug("Config fetch cache check."+` Cache age millis: ${r}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r=r<=e}.`),r):(this.logger.debug("Config fetch cache check. Cache unpopulated."),!1)}async fetch(e){var[t,r]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(r&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return r;e.eTag=r&&r.eTag;t=await this.client.fetch(e),r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===t.status&&r.push(this.storage.setLastSuccessfulFetchResponse(t)),await Promise.all(r),t}}class r1{constructor(e,t,r,n,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=r,this.projectId=n,this.apiKey=i,this.appId=s}async fetch(r){var e,[t,n]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=`+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":r.eTag||"*"},t={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:n,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language,custom_signals:r.customSignals},n={method:"POST",headers:s,body:JSON.stringify(t)},s=fetch(i,n),t=new Promise((e,t)=>{r.signal.addEventListener(()=>{var e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([s,t]),a=await s}catch(e){let t="fetch-client-network";throw"AbortError"===(null==e?void 0:e.name)&&(t="fetch-timeout"),Gx.create(t,{originalErrorMessage:null==e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let l,h;if(200===a.status){let e;try{e=await a.json()}catch(e){throw Gx.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}l=e.entries,h=e.state}if("INSTANCE_STATE_UNSPECIFIED"===h?o=500:"NO_CHANGE"===h?o=304:"NO_TEMPLATE"!==h&&"EMPTY_CONFIG"!==h||(l={}),304!==o&&200!==o)throw Gx.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:l}}}class n1{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:r}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var r=Math.max(s-Date.now(),0);let n=setTimeout(e,r);i.addEventListener(()=>{clearTimeout(n),t(Gx.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var n=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),n}catch(e){if((e=>{var t;return e instanceof pe&&e.customData&&(429===(t=Number(e.customData.httpStatus))||500===t||503===t||504===t)})(e))return n={throttleEndTimeMillis:Date.now()+qe(r),backoffCount:r+1},await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n);throw e}}}class i1{get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}constructor(e,t,r,n,i){this.app=e,this._client=t,this._storageCache=r,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}}function s1(e,t){var r=e.target.error||void 0;return Gx.create(t,{originalErrorMessage:r&&(null==r?void 0:r.message)})}let a1="app_namespace_store";class o1{getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}getCustomSignals(){return this.get("custom_signals")}}class l1 extends o1{constructor(e,t,r,n=(()=>new Promise((t,r)=>{try{var e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{r(s1(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{var t=e.target.result;0===e.oldVersion&&t.createObjectStore(a1,{keyPath:"compositeKey"})}}catch(e){r(Gx.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}))()){super(),this.appId=e,this.appName=t,this.namespace=r,this.openDbPromise=n}async setCustomSignals(e){var t=(await this.openDbPromise).transaction([a1],"readwrite"),r=u1(e,await this.getWithTransaction("custom_signals",t)||{});return await this.setWithTransaction("custom_signals",r,t),r}async getWithTransaction(s,a){return new Promise((r,t)=>{var e=a.objectStore(a1),n=this.createCompositeKey(s);try{var i=e.get(n);i.onerror=e=>{t(s1(e,"storage-get"))},i.onsuccess=e=>{var t=e.target.result;r(t?t.value:void 0)}}catch(e){t(Gx.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async setWithTransaction(s,a,o){return new Promise((e,t)=>{var r=o.objectStore(a1),n=this.createCompositeKey(s);try{var i=r.put({compositeKey:n,value:a});i.onerror=e=>{t(s1(e,"storage-set"))},i.onsuccess=()=>{e()}}catch(e){t(Gx.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async get(e){var t=(await this.openDbPromise).transaction([a1],"readonly");return this.getWithTransaction(e,t)}async set(e,t){var r=(await this.openDbPromise).transaction([a1],"readwrite");return this.setWithTransaction(e,t,r)}async delete(s){let a=await this.openDbPromise;return new Promise((e,t)=>{var r=a.transaction([a1],"readwrite").objectStore(a1),n=this.createCompositeKey(s);try{var i=r.delete(n);i.onerror=e=>{t(s1(e,"storage-delete"))},i.onsuccess=()=>{e()}}catch(e){t(Gx.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class h1 extends o1{constructor(){super(...arguments),this.storage={}}async get(e){return Promise.resolve(this.storage[e])}async set(e,t){return this.storage[e]=t,Promise.resolve(void 0)}async delete(e){return this.storage[e]=void 0,Promise.resolve()}async setCustomSignals(e){var t=this.storage.custom_signals||{};return this.storage.custom_signals=u1(e,t),Promise.resolve(this.storage.custom_signals)}}function u1(e,t){var r=Object.assign(Object.assign({},t),e),r=Object.fromEntries(Object.entries(r).filter(([,e])=>null!==e).map(([e,t])=>"number"==typeof t?[e,t.toString()]:[e,t]));if(100<Object.keys(r).length)throw Gx.create("custom-signal-max-allowed-signals",{maxSignals:100});return r}class c1{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}getCustomSignals(){return this.customSignals}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),n=this.storage.getCustomSignals(),e=await e,e=(e&&(this.lastFetchStatus=e),await t),t=(e&&(this.lastSuccessfulFetchTimestampMillis=e),await r),e=(t&&(this.activeConfig=t),await n);e&&(this.customSignals=e)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}async setCustomSignals(e){this.customSignals=await this.storage.setCustomSignals(e)}}async function d1(){if(!ue())return!1;try{return await ce()}catch(e){return!1}}kt(new u("remote-config",function(e,{options:t}){var r=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate(),{projectId:i,apiKey:s,appId:a}=r.options;if(!i)throw Gx.create("registration-project-id");if(!s)throw Gx.create("registration-api-key");if(!a)throw Gx.create("registration-app-id");var o=(null==t?void 0:t.templateId)||"firebase",l=ue()?new l1(a,r.name,o):new h1,h=new c1(l),u=new Qe(Wx),n=(u.logLevel=c.ERROR,new r1(n,xt,o,i,s,a)),o=new n1(n,l),i=new t1(o,l,h,u),s=new i1(r,i,h,l,u);return Jx(s),s},"PUBLIC").setMultipleInstances(!0)),d(Wx,"0.6.0"),d(Wx,"0.6.0","esm2017");class p1{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return Yx(this._delegate)}ensureInitialized(){return Jx(this._delegate)}fetch(){return Xx(this._delegate)}fetchAndActivate(){return(async e=>(await Xx(e=w(e)),Yx(e)))(this._delegate)}getAll(){return Zx(this._delegate)}getBoolean(e){return e1(w(this._delegate),e).asBoolean()}getNumber(e){return e1(w(this._delegate),e).asNumber()}getString(e){return e1(w(this._delegate),e).asString()}getValue(e){return e1(this._delegate,e)}setLogLevel(e){var t=this._delegate,r=w(t);switch(e){case"debug":r._logger.logLevel=c.DEBUG;break;case"silent":r._logger.logLevel=c.SILENT;break;default:r._logger.logLevel=c.ERROR}}}function f1(e,{instanceIdentifier:t}){var r=e.getProvider("app-compat").getImmediate(),n=e.getProvider("remote-config").getImmediate({identifier:t});return new p1(r,n)}return(WD=rr).INTERNAL.registerComponent(new u("remoteConfig-compat",f1,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:d1})),WD.registerVersion("@firebase/remote-config-compat","0.2.13"),console.warn(`
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
It looks like you're using the development build of the Firebase JS SDK.
When deploying Firebase apps to production, it is advisable to only import
the individual SDK components you intend to use.

For the CDN builds, these are available in the following manner
(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):

https://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js
<<<<<<< HEAD
`),or.registerVersion("firebase","11.7.3","compat-cdn"),or});
=======
`),rr.registerVersion("firebase","11.4.0","compat-cdn"),rr});
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
//# sourceMappingURL=firebase-compat.js.map
