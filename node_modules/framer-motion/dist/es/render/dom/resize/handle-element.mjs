<<<<<<< HEAD
import { resolveElements, isSVGElement } from 'motion-dom';
=======
import { resolveElements } from 'motion-dom';
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c

const resizeHandlers = new WeakMap();
let observer;
function getElementSize(target, borderBoxSize) {
    if (borderBoxSize) {
        const { inlineSize, blockSize } = borderBoxSize[0];
        return { width: inlineSize, height: blockSize };
    }
<<<<<<< HEAD
    else if (isSVGElement(target) && "getBBox" in target) {
=======
    else if (target instanceof SVGElement && "getBBox" in target) {
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
        return target.getBBox();
    }
    else {
        return {
            width: target.offsetWidth,
            height: target.offsetHeight,
        };
    }
}
function notifyTarget({ target, contentRect, borderBoxSize, }) {
<<<<<<< HEAD
    resizeHandlers.get(target)?.forEach((handler) => {
=======
    var _a;
    (_a = resizeHandlers.get(target)) === null || _a === void 0 ? void 0 : _a.forEach((handler) => {
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
        handler({
            target,
            contentSize: contentRect,
            get size() {
                return getElementSize(target, borderBoxSize);
            },
        });
    });
}
function notifyAll(entries) {
    entries.forEach(notifyTarget);
}
function createResizeObserver() {
    if (typeof ResizeObserver === "undefined")
        return;
    observer = new ResizeObserver(notifyAll);
}
function resizeElement(target, handler) {
    if (!observer)
        createResizeObserver();
    const elements = resolveElements(target);
    elements.forEach((element) => {
        let elementHandlers = resizeHandlers.get(element);
        if (!elementHandlers) {
            elementHandlers = new Set();
            resizeHandlers.set(element, elementHandlers);
        }
        elementHandlers.add(handler);
<<<<<<< HEAD
        observer?.observe(element);
=======
        observer === null || observer === void 0 ? void 0 : observer.observe(element);
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
    });
    return () => {
        elements.forEach((element) => {
            const elementHandlers = resizeHandlers.get(element);
<<<<<<< HEAD
            elementHandlers?.delete(handler);
            if (!elementHandlers?.size) {
                observer?.unobserve(element);
=======
            elementHandlers === null || elementHandlers === void 0 ? void 0 : elementHandlers.delete(handler);
            if (!(elementHandlers === null || elementHandlers === void 0 ? void 0 : elementHandlers.size)) {
                observer === null || observer === void 0 ? void 0 : observer.unobserve(element);
>>>>>>> 3b008e380491e6ba2d199016330fcd7fa128de4c
            }
        });
    };
}

export { resizeElement };
